---
title: Планирование необходимых компонентов для служб управления Azure Server
titleSuffix: Microsoft Cloud Adoption Framework for Azure
description: Необходимые средства и планирование для служб управления сервером Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 05/10/2019
ms.topic: article
ms.service: cloud-adoption-framework
ms.subservice: operate
ms.openlocfilehash: a684880537fa4dc2d7a56e93b9a6e35a94425dae
ms.sourcegitcommit: a26c27ed72ac89198231ec4b11917a20d03bd222
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/06/2019
ms.locfileid: "70819105"
---
# <a name="phase-1-prerequisite-planning-for-azure-server-management-services"></a>Этап 1. Планирование необходимых компонентов для служб управления Azure Server

На этом этапе вы знакомы с набором служб Azure Server Management Suite и планируете развертывание ресурсов, необходимых для реализации этих решений по управлению.

## <a name="understand-the-tools-and-services"></a>Общие сведения о средствах и службах

Ознакомьтесь с [инструментами и службами управления сервером Azure](./tools-services.md) , чтобы получить подробный обзор областей управления, участвующих в текущих операциях Azure, а также служб и средств Azure, которые помогут вам в этих областях. Соблюдение требований к управлению предполагает использование нескольких этих служб вместе. Эти средства часто упоминаются в рамках этого руководства.

В следующих разделах рассматриваются планирование и подготовка, необходимые для использования этих средств и служб.

## <a name="log-analytics-workspace-and-automation-account-planning"></a>Планирование учетных записей рабочей области и службы автоматизации Log Analytics

Для многих служб, которые будут использоваться для подключения служб управления Azure, требуется рабочая область Log Analytics и связанная учетная запись службы автоматизации Azure.

[Log Analytics Рабочая область](/azure/azure-monitor/learn/quick-create-workspace) — это уникальная среда для хранения Azure Monitor данных журнала. Каждая Рабочая область имеет собственный репозиторий и конфигурацию. Источники данных и решения настраиваются для хранения данных в определенных рабочих областях. Для решения мониторинга Azure требуется, чтобы все серверы были подключены к рабочей области, чтобы их данные журналов можно было хранить и получать к ним доступ.

Для некоторых служб управления требуется учетная запись службы [автоматизации Azure](/azure/automation/automation-intro) . Используя эту учетную запись и возможности службы автоматизации Azure, можно интегрировать службы Azure и другие общедоступные системы для развертывания, настройки и управления процессами управления сервером.

Для работы следующих служб управления сервером Azure требуется связанная Рабочая область Log Analytics и учетная запись службы автоматизации.

- [Управление обновлениями Azure](/azure/automation/automation-update-management)
- [Отслеживание изменений и Инвентаризация](/azure/automation/change-tracking)
- [Гибридный компонент Runbook Worker](/azure/automation/automation-hybrid-runbook-worker)
- [Настройка требуемого состояния](/azure/virtual-machines/extensions/dsc-overview)

Вторая фаза этого руководства посвящена развертыванию служб и скриптов автоматизации. В нем показано, как создать рабочую область Log Analytics и учетную запись службы автоматизации. В этом руководстве также показано, как использовать политику Azure, чтобы убедиться, что новые виртуальные машины подключены к нужной рабочей области.

В примерах, описанных в этом руководстве, предполагается развертывание, в котором еще нет серверов, развернутых в облаке. Дополнительные сведения о принципах и вопросах, связанных с планированием рабочих областей, см. [в статье Управление данными журнала и рабочими областями в Azure Monitor](/azure/azure-monitor/platform/manage-access).

## <a name="planning-considerations"></a>Рекомендации относительно планирования

При подготовке рабочих областей и учетных записей, создаваемых для адаптации служб управления, ознакомьтесь со следующими обсуждениями проблем.

- **География и соответствие нормативам Azure**. Регионы Azure организованы в *географические*области. География [Azure](https://azure.microsoft.com/global-infrastructure/geographies/) гарантирует, что требования к местонахождение данных, независимости, соответствие требованиям и устойчивости будут учитываться в географических границах. Если ваши рабочие нагрузки подчиняются независимостиу данных или другим требованиям соответствия требованиям, рабочие области и учетные записи службы автоматизации должны быть развернуты в регионах в пределах той же службы Azure geography, что и ресурсы рабочей нагрузки, которые они поддерживают.
- **Число рабочих областей**. В качестве принципа GUID создайте минимальное число рабочих областей, необходимое для каждого региона Azure. Мы рекомендуем по крайней мере одну рабочую область для каждого географического хранилища Azure, где находятся ресурсы для вычислений или хранения. Это начальное выравнивание позволяет избежать будущих нормативных проблем при переносе данных в разные географические регионы.
- **Хранение и ограниченность данных**. При создании рабочих областей или учетных записей автоматизации может также потребоваться использовать политики хранения данных или требования ограниченного выделения данных. Дополнительные сведения об этих принципах и дополнительные рекомендации по планированию рабочих областей см. [в статье Управление данными журнала и рабочими областями в Azure Monitor](/azure/azure-monitor/platform/manage-access).
- **Сопоставление регионов**. Связывание Log Analytics рабочей области и учетной записи службы автоматизации Azure поддерживается только между определенными регионами Azure. Например, если Рабочая область Log Analytics размещается в регионе *EastUS* , связанная учетная запись службы автоматизации должна быть создана в регионе *EastUS2* для использования со службами управления. Если у вас есть учетная запись службы автоматизации, созданная в другом регионе, она не сможет установить связь с рабочей областью в *EastUS*. Выбор региона развертывания может значительно повлиять на требования Azure geography. Просмотрите [таблицу "сопоставление регионов](/azure/automation/how-to/region-mappings) ", чтобы выбрать регион для размещения рабочих областей и учетных записей автоматизации.
- **Многосайтовое пространство рабочей области**. В некоторых сценариях Log Analytics агент поддерживает множественную адресацию, но при выполнении этой конфигурации агент сталкивается с несколькими ограничениями и проблемами. Если корпорация Майкрософт не рекомендует использовать многосетевых интерфейсов для вашего сценария, мы не рекомендуем настраивать многосетевых интерфейсов в агенте Log Analytics.

## <a name="resource-placement-examples"></a>Примеры размещения ресурсов

Существует несколько различных моделей выбора подписки, в которую вы размещаете Log Analytics рабочую область и учетную запись службы автоматизации. Вкратце, рабочую область и учетные записи службы автоматизации следует поместить в подписку, принадлежащую команде, которая отвечает за реализацию служб Управление обновлениями и Отслеживание изменений и инвентаризации.

В следующих примерах показаны некоторые способы развертывания рабочих областей и учетных записей автоматизации.

### <a name="placement-by-geography"></a>Размещение по географическому положению

Для малых и средних сред с одной подпиской и несколькими сотнями ресурсов, охватывающих несколько географических регионов Azure, создайте одну Log Analytics рабочую область и одну учетную запись службы автоматизации Azure в каждом географическом регионе.

Вы можете создать рабочую область и учетную запись службы автоматизации Azure — одну пару — в каждой группе ресурсов и развернуть пару в соответствующем регионе для виртуальных машин. Кроме того, если политики соответствия данных не определяют, что ресурсы находятся в конкретных регионах, можно создать одну пару для управления всеми виртуальными машинами. Мы также рекомендуем разместить пары учетных записей рабочей области и службы автоматизации в отдельных группах ресурсов, чтобы обеспечить более детализированный контроль доступа на основе ролей (RBAC).

Пример на следующей диаграмме имеет одну подписку с двумя группами ресурсов, каждая из которых находится в разных регионах.

![Модель рабочей области для малых и средних сред](./media/workspace-model-small.png)

### <a name="placement-in-a-management-subscription"></a>Размещение в подписке на управление

Для более крупных сред, охватывающих несколько подписок и имеющих централизованный ИТ-отдел, который владеет мониторингом и соответствием, создайте пары рабочих областей и учетных записей автоматизации в подписке ИТ-управления. В этой модели ресурсы виртуальной машины в географическом регионе хранят свои данные в соответствующей рабочей области geography в подписке ИТ-управления. Группы приложений, которым требуется выполнять задачи автоматизации, но не требующие связанных рабочих областей и учетных записей автоматизации, могут создавать отдельные учетные записи службы автоматизации в собственных подписках приложений.

![Модель рабочей области для крупных сред](./media/workspace-model-large.png)

### <a name="decentralized-placement"></a>Децентрализованное размещение

В альтернативной модели для крупных сред ответственность за установку исправлений и управление может находиться в группе разработки приложений. В этом случае необходимо разместить пары учетных записей рабочей области и службы автоматизации в подписках группы приложений вместе с другими ресурсами.

  ![Модель учетной записи рабочей области для децентрализованных сред](./media/workspace-model-decentralized.png)

## <a name="create-a-workspace-and-automation-account"></a>Создание рабочей области и учетной записи службы автоматизации

После принятия решения о том, как лучше размещать и упорядочивать пары рабочей области и учетной записи, необходимо убедиться, что вы создали эти ресурсы перед началом процесса адаптации. В примерах автоматизации, приведенных далее в этом руководстве, создается пара учетных записей для рабочей области и службы автоматизации. Однако если у вас нет существующей пары рабочей области и учетной записи службы автоматизации, необходимо создать ее, если вы хотите подключить с помощью портала.

Сведения о создании рабочей области Log Analytics с помощью портал Azure см. в разделе [Создание рабочей области](/azure/azure-monitor/learn/quick-create-workspace#create-a-workspace). Затем создайте соответствующую учетную запись службы автоматизации для каждой рабочей области, выполнив действия, описанные в разделе [Создание учетной записи службы автоматизации Azure](/azure/automation/automation-quickstart-create-account).

> [!NOTE]
> При создании учетной записи службы автоматизации с помощью портал Azure поведение по умолчанию пытается создать учетные записи запуска от имени как для Azure Resource Manager, так и для ресурсов классической модели развертывания. Если у вас нет классических виртуальных машин в вашей среде и вы не являетесь соадминистратором подписки, на портале будет создана учетная запись запуска от имени для диспетчер ресурсов, но при развертывании классической учетной записи запуска от имени будет выдаваться ошибка. Если вы не планируете поддерживать классические ресурсы, эту ошибку можно пропустить.
>
> Вы также можете создать учетные записи запуска от имени с помощью [PowerShell](/azure/automation/manage-runas-account#create-run-as-account-using-powershell).

## <a name="next-steps"></a>Следующие шаги

Узнайте, как подключить [серверы](./onboarding-overview.md) к службам управления Azure.

> [!div class="nextstepaction"]
> [Подключение к службам управления сервером Azure](./onboarding-overview.md)
