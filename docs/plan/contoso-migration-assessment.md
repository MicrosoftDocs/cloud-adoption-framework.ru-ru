---
title: Оценка локальных рабочих нагрузок для миграции в Azure
description: Изучите пример, как оценить локальное приложение для миграции в Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 02/25/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.custom: internal
ms.openlocfilehash: 299077de339074eb1ae21ab84d727fb5f4e6d598
ms.sourcegitcommit: 9e4bc0e233a24642853f5e8acbeb9746b2444024
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/04/2021
ms.locfileid: "102116484"
---
<!-- cSpell:ignore OSTICKETWEB OSTICKETMYSQL CONTOSODC contosohost vcenter prereqs ctypes ctypeslib smarthotelapp -->

# <a name="assess-on-premises-workloads-for-migration-to-azure"></a>Оценка локальных рабочих нагрузок для переноса в Azure

В этой статье показано, как вымышленная компания Contoso оценивает локальное приложение для переноса в Azure. В примере сценария локальная SmartHotel360-приложение Contoso в настоящее время работает в VMware. Компания Contoso оценивает виртуальные машины приложений с помощью службы "миграция Azure" и базы данных SQL Server приложений с помощью Помощник по миграции данных.

## <a name="overview"></a>Обзор

Компании Contoso требуется провести техническую и финансовую оценку, чтобы определить, можно ли выполнить перенос своих локальных рабочих нагрузок в облако Azure. В частности, команда компании Contoso хочет оценить совместимость компьютеров и баз данных для миграции. Компания хочет оценить производительность и затраты на запуск ресурсов компании Contoso в Azure.

Чтобы начать работу и лучше понять суть используемых технологий, компания Contoso оценивает два локальных приложения, приведенные в следующей таблице. Она оценивает сценарии миграции при перемещении и рефакторинге приложений для миграции. Узнайте больше о повторном размещении и рефакторинге, ознакомившись с [обзором примеров миграции](../migrate/azure-best-practices/contoso-migration-overview.md).

| Имя приложения. | Платформа | Уровни приложения | Сведения |
| --- | --- | --- | --- |
| **SmartHotel360** <br><br> (управляет требованиями к путешествиям в компании Contoso) | Работает на системе Windows с помощью базы данных SQL Server | Двухуровневое приложение. Интерфейсный веб-сайт ASP.NET работает на одной виртуальной машине ( `WEBVM` ), а SQL Server выполняется на другой виртуальной машине ( `SQLVM` ). | Виртуальные машины работают на VMware ESXi узле, управляемом vCenter Server. <br><br> Вы можете скачать пример приложения с сайта [GitHub](https://github.com/Microsoft/SmartHotel360). |
| **остиккет** <br><br> (Приложение службы поддержки компании Contoso) | Выполняется в стеке [лампы](https://wikipedia.org/wiki/LAMP_software_bundle) . | Двухуровневое приложение. Клиентский веб-сайт PHP работает на одной виртуальной машине ( `OSTICKETWEB` ), а база данных MySQL работает на другой виртуальной машине ( `OSTICKETMYSQL` ). | Приложение используется приложениями служб клиента для отслеживания проблем у внутренних сотрудников и внешних клиентов. <br><br> Пример можно загрузить в репозитории [GitHub](https://github.com/osTicket/osTicket). |

## <a name="current-architecture"></a>Текущая архитектура

Эта схема показывает текущую локальную инфраструктуру компании Contoso.

![Текущая архитектура Contoso](../migrate/azure-best-practices/media/contoso-migration-assessment/contoso-architecture.png)

- Компания Contoso имеет единственный главный центр обработки данных. Он находится в Нью-Йорке (в восточной части США).
- У компании есть еще три местных филиала в других уголках США.
- Главный центр обработки данных подключен к Интернету по оптоволоконному соединению метро Ethernet (500 Мбит/с).
- Каждый филиал подключен локально к Интернету с помощью соединений бизнес-класса и применяет VPN-туннели IPSec для передачи данных в основной центр обработки данных. Эта настройка позволяет компании Contoso обеспечивать постоянство подключения всей сети и оптимизацию подключения к Интернету.
- Основной центр обработки данных полностью виртуализирован на базе решений VMware. Компания использует два узла виртуализации ESXi 6.5 под управлением vCenter Server 6.5.
- Компания Contoso использует управление удостоверениями в Active Directory. Компания Contoso использует DNS-серверы внутренней сети.
- Контроллеры домена в центре обработки данных размещены в виртуальных машинах VMware. Контроллеры домена в местных филиалах размещены на физических серверах.

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство компании Contoso и деловые партнеры определили указанные ниже цели этой миграции.

- **Устраните бизнес-рост.** Компания Contoso растет. В результате увеличилось давление на внутренние системы и инфраструктуру компании.
- **Повышение эффективности.** Компании Contoso необходимо удалить ненужные процедуры и оптимизировать процессы для разработчиков и пользователей. Бизнес нуждается в том, чтобы ИТ были быстрыми и не тратили время или деньги, поэтому компания может быстрее выполнять требования клиентов.
- **Повышение гибкости.** ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Он должен реагировать быстрее чем изменения, которые происходят на рынке, для достижение компанией успеха в глобальной экономике. ИТ-отдел в компании Contoso не должен мешать или становиться помехой для бизнеса.
- **Измените.** По мере роста бизнеса компании ИТ-отдел компании Contoso должен предоставлять системы, которые могут расти с той же скоростью.

## <a name="assessment-goals"></a>Цели оценки

Команда, работающая над облачной инфраструктурой компании Contoso, определила цели оценки миграции:

- После миграции приложения Azure должны иметь те же возможности с точки зрения производительности, что и приложения в текущей локальной среде VMware компании Contoso. Переход в облако не означает, что производительность приложения сильно уменьшится.
- Компания Contoso должна понять, соответствуют ли приложения и базы данных требованиям Azure. Компания Contoso также должна понять варианты размещения в Azure.
- После перехода приложений в облако администрирование баз данных компании Contoso должно быть минимальным.
- Компании необходимо получить сведения не только о параметрах миграции, но и о стоимости инфраструктуры после перехода в облако.

## <a name="assessment-tools"></a>Средства оценки

Компания Contoso использует инструменты Майкрософт для оценки миграции. Эти средства соответствуют целям компании и должны предоставить Contoso необходимые сведения.

| Технология | Описание | Стоимость |
| --- | --- | --- |
| [Помощник по миграции данных](/sql/dma/dma-overview) | Компания Contoso использует Помощник по миграции данных для оценки и выявления проблем совместимости, которые могут повлиять на функциональность базы данных в Azure. Помощник по миграции данных оценивает равенство функций между источниками и целевыми объектами SQL. Он рекомендует улучшения производительности и надежности. | Помощник по миграции данных — это бесплатное загружаемое средство. |
| [Миграция Azure](/azure/migrate/migrate-services-overview) | Компания Contoso использует службу "Миграция Azure" для оценки виртуальных машин VMware. Служба "Миграция Azure" оценивает миграционную пригодность компьютеров. Она обеспечивает оценку размера и стоимости для работы в Azure. | За использование службы "Миграция Azure" не нужно дополнительно платить. Однако оплата может взиматься в зависимости от средств (от первой стороны или ISV), которые вы решили использовать для оценки и миграции. Дополнительные сведения о [ценах на миграцию Azure](https://azure.microsoft.com/pricing/details/azure-migrate/). |
| [Сопоставление служб](/azure/azure-monitor/vm/service-map) | Служба "Миграция Azure" использует решение "Схема услуги" для отображения зависимостей между компьютерами, которые компания хочет перенести. | Сопоставление служб входит в журналы Azure Monitor. В настоящее время компания Contoso может использовать решение "Схема услуги" в течение 180 дней без каких-либо затрат. |

В рамках этого сценария компания Contoso загружает и запускает Помощник по миграции данных, чтобы оценить локальную базу данных SQL Server приложения путешествий компании. Компания Contoso использует службу "Миграция Azure" с сопоставлением зависимостей для оценки виртуальных машин приложения, прежде чем переносить их в Azure.

## <a name="assessment-architecture"></a>Архитектура оценки

![Архитектура оценки миграции](../migrate/azure-best-practices/media/contoso-migration-assessment/migration-assessment-architecture.png)

- Contoso — это вымышленное название, представляющее типичную крупную организацию.
- Contoso имеет локальный центр обработки данных ( `contoso-datacenter` ) и локальные контроллеры домена ( `CONTOSODC1` , `CONTOSODC2` ).
- Виртуальные машины VMware расположены на VMware ESXi узлах, работающих под управлением версии 6,5 ( `contosohost1` , `contosohost2` ).
- Управление средой VMware осуществляется с vCenter Server 6,5 ( `vcenter.contoso.com` и выполняется на виртуальной машине).
- Приложение для путешествий SmartHotel360 имеет следующие характеристики:
  - Приложение распространяется на две виртуальные машины VMware ( `WEBVM` и `SQLVM` ).
  - Виртуальные машины расположены на VMware ESXi узле `contosohost1.contoso.com` .
  - Виртуальные машины используют центр обработки данных, для которого используется ОС Windows Server 2008 R2 с пакетом обновления 1 (SP1).
- Управление средой VMware осуществляется с помощью vCenter Server ( `vcenter.contoso.com` ), работающего на виртуальной машине.
- osTicket — приложение службы поддержки:
  - Приложение разбито на уровни на двух виртуальных машинах (`OSTICKETWEB` и `OSTICKETMYSQL`).
  - Виртуальные машины работают на ОС Ubuntu Linux Server 16.04-LTS.
  - `OSTICKETWEB` использует Apache 2 и PHP 7,0.
  - `OSTICKETMYSQL` работает под 5.7.22 MySQL.

## <a name="prerequisites"></a>Предварительные требования

Компания Contoso и другие пользователи должны отвечать следующим предварительным условиям оценки:

- Разрешение на подписку Azure на уровне участника или владельца или разрешение на группу ресурсов в подписке Azure.
- Локальный сервер vCenter Server версии 6.5, 6.0 или 5.5.
- Учетная запись только для чтения на сервере vCenter Server или разрешения на ее создание.
- Разрешения на создание виртуальной машины на экземпляре сервера vCenter Server с использованием шаблона в формате OVA.
- По крайней мере один узел ESXi версии 5.5 или более поздней.
- По крайней мере две виртуальные машины VMware, на одной из который выполняется база данных SQL Server.
- Разрешения на установку агентов службы "Миграция Azure" на каждой виртуальной машине.
- Виртуальные машины должны иметь прямое подключение к Интернету.
  - Вы можете ограничить доступ к [требуемым URL-адресам](/azure/migrate/migrate-appliance) в Интернете.
  - Если виртуальные машины не подключены к Интернету, на них должен быть установлен [шлюз Azure Log Analytics](/azure/azure-monitor/agents/gateway), через который будет направляться трафик агента.
- Полное доменное имя (FQDN) виртуальной машины, на которой работает экземпляр SQL Server, для оценки базы данных.
- Брандмауэр Windows, работающий на виртуальной машине SQL Server, должен разрешать внешние подключения по TCP-порту 1433 (по умолчанию). Эта настройка позволяет подключиться к Помощнику по миграции данных.

## <a name="assessment-overview"></a>Общие сведения об оценке

Вот как компания Contoso производит оценку:

> [!div class="checklist"]
>
> - **Шаг 1. Скачайте и установите Помощник по миграции данных.** Компания Contoso подготавливает Помощник по миграции данных для оценки локальной базы данных SQL Server.
> - **Шаг 2. Оценка базы данных с помощью Помощник по миграции данных.** Компания Contoso выполняет оценку базы данных и анализирует полученные результаты.
> - **Шаг 3. Подготовка к оценке виртуальных машин с помощью службы "миграция Azure".** Компания Contoso создает локальные учетные записи и настраивает параметры VMware.
> - **Шаг 4. обнаружение локальных виртуальных машин с помощью службы "миграция Azure".** Компания Contoso создает виртуальную машину сборщика для Миграции Azure. Затем компания запускает сборщик, чтобы обнаружить виртуальные машины для оценки.
> - **Шаг 5. Подготовка к анализу зависимостей с помощью службы "миграция Azure".** Компания Contoso устанавливает агенты Миграции Azure на виртуальных машинах, чтобы проанализировать зависимости между виртуальными машинами.
> - **Шаг 6. Оценка виртуальных машин с помощью службы "миграция Azure".** Компания Contoso проверяет зависимости, группирует виртуальные машины и выполняет оценку. Когда оценка будет выполнена, компания Contoso проанализирует ее в процессе подготовки к миграции.

<!-- -->

> [!NOTE]
> Оценки не должны быть ограничены использованием инструментария для обнаружения сведений о среде. Вы также должны запланировать время говорить с владельцами бизнеса, конечными пользователями и другими участниками ИТ-отдела, чтобы полностью понять, что происходит в среде, и определить факторы, которые не могут сообщить вам.

## <a name="step-1-download-and-install-data-migration-assistant"></a>Шаг 1. Загрузка и установка Помощника по миграции данных

1. Компания Contoso загружает Помощник по миграции данных из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53595).
    - Помощник по миграции данных может быть установлен на любом компьютере, который может подключиться к экземпляру SQL Server. Компании Contoso не нужно запускать его на компьютере SQL Server.
    - Помощник по миграции данных не следует запускать на хост-компьютере SQL Server.
2. Чтобы начать установку, компания Contoso запускает загруженный файл (DownloadMigrationAssistant.msi).
3. Перед закрытием мастера на странице **Готово** компания Contoso выбирает **Запустить помощник по миграции данных Майкрософт**.

## <a name="step-2-run-and-analyze-the-database-assessment-for-smarthotel360"></a>Шаг 2. Запуск и анализ оценки базы данных для SmartHotel360

Теперь компания Contoso может запустить оценку анализа локального сервера базы данных SQL Server для приложения SmartHotel360.

1. В помощник по миграции данных Contoso выбирает **новую**  >  **оценку**, а затем выдает оценку имени проекта.

2. Для параметра **Тип исходного сервера** специалисты Contoso выбирают **SQL Server**, а для параметра **Тип целевого сервера** — **SQL Server на виртуальных машинах Azure**.

    ![Помощник по миграции данных: Выбор источника](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-1.png)

    > [!NOTE]
    > В настоящее время Помощник по миграции данных не поддерживает оценку для перехода на Управляемый экземпляр SQL Azure. Чтобы обойти это ограничение, компания Contoso использует SQL Server на виртуальной машине Azure в качестве предполагаемого целевого объекта оценки.

3. В поле **Выберите целевую версию** компания Contoso выбирает SQL Server 2017. Contoso необходимо выбрать эту версию, так как это версия, используемая Управляемый экземпляр SQL.

4. Для получения сведений о совместимости и новых функциях компания Contoso выбирает отчеты:

    - **Проблемы совместимости** Обратите внимание на изменения, которые могут нарушить миграцию или которые требует незначительной корректировки перед миграцией. Этот отчет позволяет компании Contoso получать сведения о функциях, которые являются устаревшими, но на данный момент работают. Проблемы упорядочены по уровню совместимости.
    - Параметр **Рекомендации по новым функциям** позволяет выявить новые возможности целевой платформы SQL Server, которые можно использовать в базе данных после миграции. Новые рекомендации упорядочены по заголовкам **производительности**, **безопасности** и **хранилища.**

    ![Помощник по миграции данных: проблемы совместимости и новые функции](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-2.png)

5. На вкладке **Подключение к серверу** компания Contoso вводит имя виртуальной машины, на которой работает база данных, а также учетные данные для доступа к ней. Компания Contoso выбирает **Сертификат сервера доверия**, чтобы убедиться, что виртуальная машина может получить доступ к SQL Server. Затем компания выбирает **Подключить**.

    ![Помощник по миграции данных: подключение к серверу](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-3.png)

6. В поле **Добавить источник** компания Contoso добавляет базу данных, которую необходимо оценить, а затем выбирает **Далее** для начала оценки.

7. Оценка создана.

    ![Помощник по миграции данных: создание оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-4.png)

8. Результаты оценки компания Contoso может увидеть в поле **Просмотр результатов**.

### <a name="analyze-the-database-assessment"></a>Анализ оценки базы данных

Как только результаты станут доступными, оны будут отображены. Если компания Contoso исправляет проблемы, для повторной оценки необходимо выбрать **Перезапустить оценку**.

1. Ошибки, находящиеся на каждом уровне совместимости, компания может проверить в поле **Проблемы совместимости**. Уровни совместимости сопоставляются с версиями SQL Server следующим образом:

    - 100: SQL Server 2008/база данных SQL Azure
    - 110: SQL Server 2012/база данных SQL Azure
    - 120: SQL Server 2014/база данных SQL Azure
    - 130: SQL Server 2016/база данных SQL Azure
    - 140: SQL Server 2017/база данных SQL Azure

    ![Помощник по миграции данных: отчет о проблемах совместимости](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-5.png)

2. В отчете **Рекомендуемые возможности** компанией Contoso просматриваются функции для обеспечения производительности и безопасности, а также возможности хранения после миграции. Рекомендуется использовать различные функции, в том числе выполняющуюся в памяти OLTP, индексы columnstore, Stretch Database, Always Encrypted, динамическое маскирование данных и прозрачное шифрование данных.

    ![Помощник по миграции данных: отчет о рекомендациях по компонентам](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-6.png)

    > [!NOTE]
    > Компании Contoso следует [включить прозрачное шифрование данных](/sql/relational-databases/security/encryption/transparent-data-encryption) для всех баз данных SQL Server. Это еще более важно, когда база данных находится в облаке, чем когда она размещается локально. Прозрачное шифрование данных следует включать только после миграции. Если прозрачное шифрование данных уже включено, компания Contoso должна переместить сертификат или асимметричный ключ в `master` базу данных целевого сервера. Узнайте, как [переместить прозрачное шифрование защищенной базы данных на другой экземпляр SQL Server](/sql/relational-databases/security/encryption/move-a-tde-protected-database-to-another-sql-server).

3. Затем компания Contoso может экспортировать оценку в формате JSON или CSV.

> [!NOTE]
> Для крупномасштабных оценок:
>
> - Одновременно выполняйте несколько оценок и просматривайте их состояние на странице **Все оценки**.
> - Консолидируйте оценки в [базу данных SQL Server](/sql/dma/dma-consolidatereports).
> - Консолидируйте оценки в [отчете Power BI](/sql/dma/dma-consolidatereports).

## <a name="step-3-prepare-for-vm-assessment-by-using-azure-migrate"></a>Шаг 3. Подготовка к оценке виртуальных машин с помощью службы "Миграция Azure"

Компании Contoso необходимо создать учетную запись VMware, которую служба "Миграция Azure" сможет использовать для автоматического обнаружения виртуальных машин для оценки. Также необходимо убедиться в наличии прав на создание виртуальной машины, обратить внимание на порты, которые должны быть открыты, и установить уровень параметров статистики.

### <a name="set-up-a-vmware-account"></a>Настройка учетной записи VMware

Обнаружению виртуальных машин требуется учетная запись только для чтения в vCenter Server, которая бы обладала следующими свойствами:

- **Тип пользователя:** Как минимум пользователь с правами только для чтения.
- **Разрешения:** Для объекта центр обработки данных установите флажок **распространить на дочерние объекты** . Для **роли** выберите **только для чтения.**
- **Сведения:** Пользователь назначается на уровне центра обработки данных с доступом ко всем объектам в центре обработки данных.
- Чтобы ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **без доступа** с параметром **распространить на дочерний** объект.

### <a name="verify-permissions-to-create-a-vm"></a>Проверка разрешений для создания виртуальной машины

Компания Contoso проверяет наличие разрешения на создание виртуальной машины путем импорта файла в формате OVA. Узнайте, как [создать и назначить роль с разрешениями](https://kb.vmware.com/s/article/1023189?other.KM_Utility.getArticleLanguage=1&r=2&other.KM_Utility.getArticleData=1&other.KM_Utility.getArticle=1&ui-comm-runtime-components-aura-components-siteforce-qb.Quarterback.validateRoute=1&other.KM_Utility.getGUser=1).

### <a name="verify-ports"></a>Проверка портов

При оценке компании Contoso используется сопоставление зависимостей. Для сопоставления зависимостей требуется, чтобы агент был установлен на виртуальных машинах, которые будут оцениваться. Агент должен иметь возможность подключиться к Azure по TCP-порту 443 на каждой виртуальной машине. Узнайте больше о [требованиях к подключению](/azure/azure-monitor/agents/log-analytics-agent).

## <a name="step-4-discover-vms"></a>Шаг 4. Обнаружение виртуальных машин

Компания Contoso создает проект службы "Миграция Azure" для обнаружения виртуальных машин. Компания Contoso загружает и устанавливает сборщик виртуальной машины. Затем компания запускает сборщик, чтобы обнаружить локальные виртуальные машины.

### <a name="create-a-project"></a>Создание проекта

Настройте новый проект службы "Миграция Azure" следующим образом.

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.

1. В разделе **Службы** выберите **Миграция Azure**.

1. В разделе **Обзор** в области **Обнаружение, оценка и миграция серверов** выберите **Оценка и миграция серверов**.

    ![Миграция Azure: Создание проекта миграции](../migrate/azure-best-practices/media/contoso-migration-assessment/assess-migrate.png)

1. В разделе **Начало работы** щелкните **Добавить инструменты**.

1. В разделе **Проект миграции** выберите подписку Azure и создайте группу ресурсов, если у вас ее нет.

1. В разделе **Сведения о проекте** укажите имя проекта и регион для создания проекта. Поддерживаются США, Азия, Европа, Австралия, Великобритания, Канада, Индия и Япония.

    - Географический регион проекта используется только для хранения обнаруженных метаданных локальных виртуальных машин.
    - При выполнении миграции можно выбрать любой целевой регион.

1. Выберите **Далее**.

1. В области **Выберите инструмент оценки** выберите **Azure Migrate: Server Assessment (Миграция Azure: оценка сервера)**  > **Далее**.

    ![Инструмент "миграция Azure": средство оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-tool.png)

1. В области **Выберите инструмент миграции** выберите **Пропустить добавление инструмента миграции** > **Далее**.

1. В разделе **Проверка и добавление инструментов** проверьте параметры и щелкните **Добавить инструменты**.

1. Развертывание проекта службы "Миграция Azure" может занять несколько минут. После этого откроется страница проекта. Если проект не отображается, доступ к нему можно получить в разделе **Серверы** на панели мониторинга службы "Миграция Azure".

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

1. Последовательно выберите разделы **Цели миграции** > **Серверы** > **Azure Migrate: оценка серверов** и щелкните **Обнаружить**.

1. В разделе **Обнаружение компьютеров** > **Ваши компьютеры виртуализированы?** щелкните **Да, с использованием VMware vSphere Hypervisor**.

1. Щелкните **скачать** , чтобы скачать. Файл шаблона OVA.

     ![Служба "миграция Azure": сборщик данных скачивания](../migrate/azure-best-practices/media/contoso-migration-assessment/download-ova-v2.png)

### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, компания Contoso проверяет, что он не поврежден:

1. На компьютере, на который был загружен файл, компания Contoso открывает окно командной строки с правами администратора.
2. Чтобы создать хэш файла в формате OVA, компания Contoso выполняет следующую команду:

    `C:\> CertUtil -HashFile <file_location> [Hashing Algorithm]`

    **Пример**.

    `C:\> CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256`

3. Созданный хэш должен соответствовать хэш-значениям, указанным в разделе [Проверка безопасности](/azure/migrate/tutorial-assess-vmware-azure-vm#verify-security) руководства по [оценке виртуальных машин VMware для миграции](/azure/migrate/tutorial-assess-vmware-azure-vm) .

### <a name="create-the-collector-appliance"></a>Создание модуля сборщика

Теперь у компании Contoso появилась возможность импортировать скачанный файл в экземпляр vCenter Server и подготовить виртуальную машину для модуля сборщика.

1. В клиентской консоли vSphere компания Contoso выбирает **файл**  >  **развернуть шаблон OVF**.

    ![Веб-клиент vSphere: развертывание шаблона OVF](../migrate/azure-best-practices/media/contoso-migration-assessment/vcenter-wizard.png)

2. В мастере шаблонов развертывания OVF компания Contoso выбирает **Источник**, а затем указывает местоположение файла OVA.

3. В **Название и местоположение** компания Contoso указывает отображаемое имя для сборщика виртуальной машины. Затем она выбирает местоположение инвентаря для размещения виртуальной машины. Также компания Contoso указывает узел или кластер, в котором будет выполняться модуль сборщика.

4. В **Хранилище** компания Contoso задает место хранения. В **Формат диска** компания Contoso выбирает, как нужно подготовить к работе хранилище.

5. В **Сетевое сопоставление** компания Contoso задает сеть, в которой будет подключаться сборщик виртуальной машины. Этой сети требуется подключение к Интернету для отправки метаданных в Azure.

6. Contoso проверяет параметры, а затем выбирает **Включение питания после**  >  **завершения** развертывания. Когда устройство будет создано, появится сообщение, подтверждающее успешное завершение работы.

### <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Теперь компания Contoso запускает сборщик для обнаружения виртуальных машин. В настоящее время сборщик поддерживает только **английский (США)** в качестве языка операционной системы и языка интерфейса сборщика.

1. В консоли клиента vSphere компания Contoso выбирает **Открыть консоль**. Компания Contoso принимает условия лицензирования и задает параметры пароля для сборщика виртуальной машины.
2. На рабочем столе компания Contoso выбирает ярлык **Диспетчер конфигураций устройства Microsoft Azure**.

    ![консоль клиента vSphere: ярлык сборщика](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-shortcut-v2.png)

3. В Сборщик Миграции Azure Contoso выбирает **Настройка необходимых компонентов**. Компания Contoso принимает условия лицензии и считывает информацию от сторонних производителей.

4. Сборщик проверяет, что виртуальная машина имеет доступ к Интернету, время синхронизировано и служба сборщика запущена. (Служба сборщика по умолчанию устанавливается на виртуальной машине.) Contoso также устанавливает пакет средств разработки VMware vSphere виртуального диска.

    > [!NOTE]
    > Предполагается, что виртуальная машина имеет прямой доступ к Интернету без использования прокси-сервера.

    ![Сборщик Миграции Azure: Проверка предварительных требований](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-verify-prereqs-v2.png)

5. Войдите в учетную запись Azure и выберите подписку и выполните миграцию проекта, созданного ранее. Также введите имя **устройства** , чтобы его можно было найти в портал Azure.

6. На вкладке **Укажите сведения о vCenter Server** компания Contoso указывает имя (FQDN) или IP-адрес экземпляра vCenter Server, а также учетные данные только для чтения, используемые для обнаружения.

7. Компания Contoso выбирает область для обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины, находящиеся в указанной области. Областью может быть определенная папка, центр обработки данных или кластер.

    ![Укажите сведения о vCenter Server](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-connect-vcenter.png)

8. Сборщик запустит процесс обнаружения и сбора информации о среде Contoso.

    ![Просмотр хода выполнения сбора](../migrate/azure-best-practices/media/contoso-migration-assessment/migrate-discovery.png)

### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После завершения сбора компания Contoso проверяет, что виртуальные машины отображаются на портале.

1. В проекте службы "миграция Azure" компания Contoso выбирает **серверы** серверов * *. Компания Contoso проверяет, что нужные виртуальные машины обнаружены.

    ![Служба "миграция Azure": обнаруженные компьютеры](../migrate/azure-best-practices/media/contoso-migration-assessment/discovery-complete.png)

2. В настоящее время на компьютерах нет установленных агентов службы "Миграция Azure". Компания Contoso должна установить агенты для просмотра зависимостей.

    ![Миграция Azure: требуется установка агента](../migrate/azure-best-practices/media/contoso-migration-assessment/machines-no-agent.png)

## <a name="step-5-prepare-for-dependency-analysis"></a>Шаг 5. Подготовка к анализу зависимостей

Чтобы просмотреть зависимости между виртуальными машинами, которые компания Contoso хочет оценить, необходимо скачать и установить агенты на виртуальные машины приложений. Компания Contoso устанавливает агенты на всех виртуальных машинах для своих приложений, как для Windows, так и для Linux.

### <a name="take-a-snapshot"></a>Сделайте моментальный снимок

Компания Contoso выполняет моментальный снимок виртуальной машины перед установкой агента, что позволяет сохранить ее копию перед изменением.

![Моментальный снимок компьютера](../migrate/azure-best-practices/media/contoso-migration-assessment/snapshot-vm.png)

### <a name="download-and-install-the-vm-agents"></a>Скачивание и установка агентов виртуальной машины

1. В разделе **Компьютеры** компания Contoso выбирает компьютер. В столбце **Зависимости** она выбирает **Требует установки**.

2. В области **Обнаружение компьютеров** специалист Contoso:
    - Скачивает Microsoft Monitoring Agent и Microsoft Dependency Agent для каждой виртуальной машины Windows.
    - Скачивает Microsoft Monitoring Agent и Microsoft Dependency Agent для каждой виртуальной машины Linux.

3. Компания Contoso копирует идентификатор рабочей области и ключ. Компании Contoso требуется идентификатор и ключ рабочей области при установке Microsoft Monitoring Agent.

    ![Скачивание агента](../migrate/azure-best-practices/media/contoso-migration-assessment/download-agents.png)

### <a name="install-the-agents-on-windows-vms"></a>Установите агент для виртуальных машин Windows

Компания Contoso запускает установку на каждой виртуальной машине.

#### <a name="install-the-mma-on-windows-vms"></a>Установите MMA для виртуальных машин Windows

1. Компания Contoso дважды щелкает загруженный файл агента.

2. В **папке назначения** Contoso сохраняет папку установки по умолчанию и выбирает **Далее**.

3. В окне **Параметры установки агента** она выбирает **Подключить агент к Azure Log Analytics** > **Далее**.

    ![Настройка Microsoft Monitoring Agent: параметры установки агента](../migrate/azure-best-practices/media/contoso-migration-assessment/mma-install.png)

4. В окне **Azure Log Analytics** компания Contoso вставляет идентификатор и ключ рабочей области, скопированные на портале.

    ![Настройка Microsoft Monitoring Agent: Azure Log Analytics](../migrate/azure-best-practices/media/contoso-migration-assessment/mma-install2.png)

5. В окне **Готово к установке** компания Contoso устанавливает MMA.

#### <a name="install-the-microsoft-dependency-agent-on-windows-vms"></a>Установка Microsoft Dependency Agent на виртуальных машинах Windows

1. Компания Contoso дважды щелкает загруженный файл агента.

2. Компания принимает условия лицензионного соглашения и ждет окончания установки.

    ![Установка Microsoft Dependency Agent](../migrate/azure-best-practices/media/contoso-migration-assessment/dependency-agent.png)

### <a name="install-the-agents-on-linux-vms"></a>Установка агентов на виртуальные машины Linux

Компания Contoso запускает установку на каждой виртуальной машине.

#### <a name="install-the-mma-on-linux-vms"></a>Установите MMA для виртуальных машин Linux

1. Специалисты компании Contoso устанавливают библиотеку ctypes Python для каждой виртуальной машины, используя следующую команду:

    `sudo apt-get install python-ctypeslib`

2. Чтобы установить агент MMA, компания Contoso должна запустить команды от имени привилегированного пользователя. Чтобы стать привилегированным пользователем, компания Contoso выполняет команду и вводит пароль:

    `sudo -i`

3. Компания Contoso устанавливает MMA:

    - Она вводит идентификатор и ключ рабочей области в команде.
    - Команды предназначены для 64-разрядных систем.
    - Идентификатор рабочей области и первичный ключ находятся в рабочей области Log Analytics на портале Azure. Выберите **Параметры** и перейдите на вкладку **подключенные источники** .
    - Выполните следующие команды для загрузки агента Log Analytics, проверки контрольной суммы, установки и подключения агента:

        `wget https://raw.githubusercontent.com/Microsoft/OMS-Agent-for-Linux/master/installer/scripts/onboard_agent.sh && sh onboard_agent.sh -w 6b7fcaff-7efb-4356-ae06-516cacf5e25d -s k7gAMAw5Bk8pFVUTZKmk2lG4eUciswzWfYLDTxGcD8pcyc4oT8c6ZRgsMy3MmsQSHuSOcmBUsCjoRiG2x9A8Mg==`

#### <a name="install-the-microsoft-dependency-agent-on-linux-vms"></a>Установка Microsoft Dependency Agent на виртуальных машинах Linux

После установки Microsoft Monitoring Agent компания Contoso устанавливает Microsoft Dependency Agent на виртуальных машинах Linux:

1. Microsoft Dependency Agent устанавливается на компьютеры Linux с помощью `InstallDependencyAgent-Linux64.bin` среды, сценария оболочки, который содержит самораспаковывающийся двоичный файл. Contoso запускает файл с помощью `sh` или добавляет разрешения на выполнение для самого файла.

2. Компания Contoso устанавливает агент зависимостей Linux в качестве привилегированного пользователя:

    `wget --content-disposition https://aka.ms/dependencyagentlinux -O InstallDependencyAgent-Linux64.bin && sudo sh InstallDependencyAgent-Linux64.bin -s`

## <a name="step-6-run-and-analyze-the-vm-assessment"></a>Шаг 6. Запуск и анализ оценки виртуальных машин

Теперь компания Contoso может проверить зависимости компьютера и создать группу. Затем она запускает оценку для группы.

### <a name="verify-dependencies-and-create-a-group"></a>Проверка зависимостей и создание группы

1. Чтобы определить, какие компьютеры анализировать, Contoso выбирает **Показать зависимости**.

    ![Миграция Azure: Просмотр зависимостей компьютера](../migrate/azure-best-practices/media/contoso-migration-assessment/view-machine-dependencies.png)

2. На карте зависимостей SQLVM появятся следующие сведения:

    - Группы процессов или процессы, которые имеют активные сетевые подключения, запущенные на SQLVM в течение указанного периода времени (час, по умолчанию).
    - Входящие (клиент) и исходящие (сервер) TCP-подключения всех зависимых компьютеров.
    - Зависимые компьютеры, которые имеют установленные агенты службы "Миграция Azure", показаны в виде отдельных полей.
    - Компьютеры, на которых не установлены агенты, отображают информацию о портах и ​​IP-адресах.

3. Для компьютеров, на которых установлен агент ( `WEBVM` ), Contoso выбирает поле "компьютер" для просмотра дополнительных сведений. Информация включает FQDN, операционную систему и MAC-адрес.

    ![Служба "миграция Azure": Просмотр зависимостей группы](../migrate/azure-best-practices/media/contoso-migration-assessment/sqlvm-dependencies.png)

4. Contoso выбирает виртуальные машины для добавления в группу ( `SQLVM` и `WEBVM` ). Contoso удерживает `Ctrl` ключ при выборе нескольких виртуальных машин.
5. Contoso выбирает **Create Group (создать группу**), а затем вводит имя ( `smarthotelapp` ).

    > [!NOTE]
    > Чтобы просмотреть более подробные зависимости, можно расширить диапазон времени. Можно выбрать конкретную продолжительность или даты начала и окончания.

### <a name="run-an-assessment"></a>Запуск оценки

1. В **группе** Contoso открывает группу ( `smarthotelapp` ), а затем выбирает команду **создать оценку**.

    ![Служба "миграция Azure": создание оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/run-vm-assessment.png)

2. Чтобы просмотреть оценку, Contoso выбирает **Управление**  >  **оценками**.

Специалисты компании Contoso используют параметры оценки по умолчанию, но вы можете [настроить параметры](/azure/migrate/how-to-modify-assessment).

### <a name="analyze-the-vm-assessment"></a>Анализ оценки виртуальных машин

Оценка службы "Миграция Azure" включает информацию о локальной совместимости с Azure, правильном размере для виртуальной машины Azure, а также предполагаемые ежемесячные затраты в Azure.

![Служба "миграция Azure": отчет об оценке](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-overview.png)

#### <a name="review-confidence-rating"></a>Просмотр рейтинга достоверности

![Служба "миграция Azure": отображение оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-display.png)

Оценка имеет рейтинг достоверности от 1 до 5 звезд (1 звезда — самый низкий, а 5 звезд — самый высокий).

- Оценка достоверности назначается на основе доступности точек данных, которые необходимы для вычисления оценки.
- Это помогает оценить надежность рекомендаций по выбору размера, который предоставлен службой "Миграция Azure".
- Оценка достоверности полезна при *определении размера на основе производительности*. Служба "Миграция Azure" может иметь недостаточное количество точек данных для определения размера на основе использования. При определении размера *как для локальной виртуальной машины* значение оценки достоверности всегда равно 5 звездам, так как в службе "Миграция Azure" есть все данные для определения размера виртуальной машины.
- В зависимости от процента доступных точек данных оценка достоверности может быть такой:

    | Уровень доступности точек данных | Оценка достоверности |
    | --- | --- |
    | 0–20 % | 1 звезда |
    | 21–40 % | 2 звезды |
    | 41–60 % | 3 звезды |
    | 61–80 % | 4 звезды |
    | 81–100 % | 5 звезд |

#### <a name="verify-azure-readiness"></a>Проверка готовности к работе в Azure

![Служба "миграция Azure": готовность к оценке](../migrate/azure-best-practices/media/contoso-migration-assessment/azure-readiness.png)

В отчете об оценке представлены сведения в виде таблицы. Для отображения размера на основе производительности службе "Миграция Azure" требуются следующие сведения. Если сведения невозможно собрать, оценка размера может быть неточной.

- Данные об использовании ЦП и памяти.
- Сведения об операциях записи и чтения в секунду и пропускной способности для каждого диска, присоединенного к виртуальной машине.
- Сведения о входящем и исходящем сетевом трафике для каждого сетевого адаптера, подключенного к виртуальной машине.

| Параметр | Указание | Сведения |
| --- | --- | --- |
| **Готовность виртуальной машины Azure** | Указывает, готова ли виртуальная машина к миграции. | Возможны следующие состояния: <li> Готово к работе в Azure <li> Готовность к условиям <li> не готова к работе в Azure; <li> готовность неизвестна. <br><br> Если виртуальная машина не готова, служба "Миграция Azure" продемонстрирует шаги по устранению проблем. |
| **Размер ВМ Azure** | Для готовых виртуальных машин служба "Миграция Azure" дает рекомендацию по размеру виртуальной машины Azure. | Рекомендация по размеру зависит от свойств оценки: <li> Если вы использовали размер на основе производительности, то при изменении размера будет считаться журнал производительности виртуальных машин. <li> Если вы использовали *для изменения размера в локальной* среде, то размер зависит от размера и использования локальной виртуальной машины. <li> Данные не используются. |
| **Рекомендуемый инструмент** | Поскольку компьютеры Azure работают с агентами, служба "Миграция Azure" просматривает процессы, запущенные внутри компьютера. Она определяет, является ли он компьютером базы данных. | |
| **Сведения о виртуальной машине** | В отчете показаны параметры локальной виртуальной машины, включая операционную систему, тип загрузки и данные о диске и хранилище. | |

#### <a name="review-monthly-cost-estimates"></a>Просмотр примерной стоимости в месяц

В этом представлении отображается общая стоимость вычислений и хранения для запуска виртуальных машин в Azure. Также отображаются сведения для каждого компьютера.

![Служба "миграция Azure": затраты Azure](../migrate/azure-best-practices/media/contoso-migration-assessment/azure-costs.png)

- Ожидаемая стоимость рассчитывается с использованием рекомендаций по размеру для компьютера.
- Примерная ежемесячная стоимость вычислений и хранилища суммируется для всех виртуальных машин в группе.

## <a name="clean-up-after-assessment"></a>Очистка после оценки

- После завершения оценки Contoso сохраняет устройство службы "Миграция Azure" для будущих вычислений.
- Компания Contoso отключает виртуальную машину VMware. Компания Contoso будет использовать ее снова, когда она оценит дополнительные виртуальные машины.
- Компания Contoso сохраняет `Contoso Migration` проект в Azure. В настоящее время проект развертывается в `ContosoFailoverRG` группе ресурсов в регионе Azure "Восточная часть США".
- Оценочная лицензия сборщика виртуальных машин действует 180 дней. Если этот период истечет, компании Contoso придется снова загружать и настраивать сборщик.

## <a name="conclusion"></a>Заключение

В этом сценарии компания Contoso оценивает свою базу данных приложений SmartHotel360 с помощью средства Помощник по миграции данных. Она оценивает локальные виртуальные машины приложения с помощью службы "Миграция Azure". Специалисты компании Contoso просматривают оценки, чтобы убедиться, что локальные ресурсы готовы к миграции в Azure.

## <a name="next-steps"></a>Дальнейшие действия

Компания Contoso оценила эту рабочую нагрузку в качестве потенциального кандидата для переноса, теперь она может начать подготовку своей локальной инфраструктуры и инфраструктуры Azure к миграции. Пример того, как компания Contoso выполняет эти процессы, приведен в статье [Развертывание инфраструктуры Azure](../migrate/azure-best-practices/contoso-migration-infrastructure.md), указанной в разделе рекомендаций по переносу согласно положениям Cloud Adoption Framework.
