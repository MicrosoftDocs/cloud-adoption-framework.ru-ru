---
title: Оценка локальных рабочих нагрузок для миграции в Azure
description: Изучите пример, как оценить локальное приложение для миграции в Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 02/25/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: site-recovery
ms.openlocfilehash: 5b70980d1c8f27f286aaf1173970e2edd26f60e0
ms.sourcegitcommit: d660484d534bc61fc60470373f3fcc885a358219
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/18/2020
ms.locfileid: "79508429"
---
<!-- cSpell:ignore WEBVM SQLVM OSTICKETWEB OSTICKETMYSQL CONTOSODC contosohost vcenter prereqs ctypes ctypeslib smarthotelapp -->

# <a name="assess-on-premises-workloads-for-migration-to-azure"></a>Оценка локальных рабочих нагрузок для переноса в Azure

В этой статье показано, как вымышленная компания Contoso оценивает локальное приложение для переноса в Azure. В примере сценария локальное приложение SmartHotel360 компании Contoso в работает в VMware. Для оценки виртуальных машин приложения Contoso использует службу "Миграция Azure". Для оценки базы данных SQL Server приложения используется Помощник по миграции данных.

## <a name="overview"></a>Обзор

Компании Contoso требуется провести техническую и финансовую оценку, чтобы определить, можно ли выполнить перенос своих локальных рабочих нагрузок в облако Azure. В частности, команда компании Contoso хочет оценить совместимость компьютеров и баз данных для миграции. Компания хочет оценить производительность и затраты на запуск ресурсов компании Contoso в Azure.

Чтобы начать работу и лучше понять суть используемых технологий, компания Contoso оценивает два локальных приложения, приведенные в следующей таблице. Она оценивает сценарии миграции при перемещении и рефакторинге приложений для миграции. Узнайте больше о повторном размещении и рефакторинге, ознакомившись с [обзором примеров миграции](../migrate/azure-best-practices/contoso-migration-overview.md).

<!-- markdownlint-disable MD033 -->

Имя приложения. | Платформа | Уровни приложения | Сведения
--- | --- | --- | ---
SmartHotel360<br/><br/> (управляет требованиями к путешествиям в компании Contoso) | Работает на системе Windows с помощью базы данных SQL Server | Двухуровневое приложение. Внешний интерфейс веб-сайта ASP.NET запускается на одной виртуальной машине (**WEBVM**), а SQL Server — на другой (**SQLVM**). | Виртуальные машины — это VMware, работающие на узле ESXi, управляемом vCenter Server.<br/><br/> Пример приложения можно загрузить в репозитории [GitHub](https://github.com/Microsoft/SmartHotel360).
osTicket<br/><br/> (Приложение службы поддержки компании Contoso) | Запускается в Apache или на Linux с помощью MySQL PHP (LAMP) | Двухуровневое приложение. Внешний интерфейс веб-сайта PHP запускается на одной виртуальной машине (**OSTICKETWEB**), а база данных MySQL — на другой (**OSTICKETMYSQL**). | Приложение используется приложениями служб клиента для отслеживания проблем у внутренних сотрудников и внешних клиентов.<br/><br/> Пример можно загрузить в репозитории [GitHub](https://github.com/osTicket/osTicket).

<!-- markdownlint-enable MD033 -->

## <a name="current-architecture"></a>Текущая архитектура

Эта схема показывает текущую локальную инфраструктуру компании Contoso.

![Текущая архитектура Contoso](../migrate/azure-best-practices/media/contoso-migration-assessment/contoso-architecture.png)

- Компания Contoso имеет единственный главный центр обработки данных. Он находится в Нью-Йорке (в восточной части США).
- У компании есть еще три местных филиала в других уголках США.
- Основной центр обработки данных подключается к Интернету с помощью оптоволоконного соединения Metro Ethernet (500 Мбит/с).
- Каждый филиал подключен локально к Интернету с помощью соединений бизнес-класса и применяет VPN-туннели IPSec для передачи данных в основной центр обработки данных. Эта настройка позволяет компании Contoso обеспечивать постоянство подключения всей сети и оптимизацию подключения к Интернету.
- Основной центр обработки данных полностью виртуализирован на базе решений VMware. Компания использует два узла виртуализации ESXi 6.5 под управлением vCenter Server 6.5.
- Компания Contoso использует управление удостоверениями в Active Directory. Компания Contoso использует DNS-серверы внутренней сети.
- Контроллеры домена в центре обработки данных размещены в виртуальных машинах VMware. Контроллеры домена в местных филиалах размещены на физических серверах.

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство компании Contoso и деловые партнеры определили указанные ниже цели этой миграции.

- **Адаптация к расширению бизнеса.** Компания Contoso растет. В результате увеличилось давление на внутренние системы и инфраструктуру компании.
- **Повышение эффективности.** Компании Contoso необходимо удалить ненужные процедуры и оптимизировать процессы для разработчиков и пользователей. Бизнес нуждается в том, чтобы ИТ были быстрыми и не тратили время или деньги, поэтому компания может быстрее выполнять требования клиентов.
- **Повышение гибкости.** ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Он должен реагировать быстрее чем изменения, которые происходят на рынке, для достижение компанией успеха в глобальной экономике. ИТ-отдел в компании Contoso не должен мешать или становиться помехой для бизнеса.
- **Масштабирование.** По мере роста бизнеса компании ИТ-отдел компании Contoso должен предоставлять системы, которые могут расти с той же скоростью.

## <a name="assessment-goals"></a>Цели оценки

Команда, работающая над облачной инфраструктурой компании Contoso, определила цели оценки миграции:

- После миграции приложения Azure должны иметь те же возможности с точки зрения производительности, что и приложения в текущей локальной среде VMware компании Contoso. Переход в облако не означает, что производительность приложения сильно уменьшится.
- Компания Contoso должна понять, соответствуют ли приложения и базы данных требованиям Azure. Компания Contoso также должна понять варианты размещения в Azure.
- После перехода приложений в облако администрирование баз данных компании Contoso должно быть минимальным.
- Компании необходимо получить сведения не только о параметрах миграции, но и о стоимости инфраструктуры после перехода в облако.

## <a name="assessment-tools"></a>Средства оценки

Компания Contoso использует инструменты Майкрософт для оценки миграции. Эти средства соответствуют целям компании и должны предоставить Contoso необходимые сведения.

Технология | Description | Стоимость
--- | --- | ---
[Помощник по миграции данных](https://docs.microsoft.com/sql/dma/dma-overview?view=ssdt-18vs2017) | Компания Contoso использует Помощник по миграции данных для оценки и выявления проблем совместимости, которые могут повлиять на функциональность базы данных в Azure. Помощник по миграции данных оценивает равенство функций между источниками и целевыми объектами SQL. Он рекомендует улучшения производительности и надежности. | Помощник по миграции данных — это бесплатный загружаемый инструмент.
[Миграция Azure](https://docs.microsoft.com/azure/migrate/migrate-overview) | Компания Contoso использует службу "Миграция Azure" для оценки виртуальных машин VMware. Служба "Миграция Azure" оценивает миграционную пригодность компьютеров. Она обеспечивает оценку размера и стоимости для работы в Azure. | Начиная с мая 2018 года "Миграция Azure" — это бесплатная служба.
[Схема услуги](https://docs.microsoft.com/azure/operations-management-suite/operations-management-suite-service-map) | Служба "Миграция Azure" использует решение "Схема услуги" для отображения зависимостей между компьютерами, которые компания хочет перенести. | Сопоставление служб входит в журналы Azure Monitor. В настоящее время компания Contoso может использовать решение "Схема услуги" в течение 180 дней без каких-либо затрат.

В рамках этого сценария компания Contoso загружает и запускает Помощник по миграции данных, чтобы оценить локальную базу данных SQL Server приложения путешествий компании. Компания Contoso использует службу "Миграция Azure" с сопоставлением зависимостей для оценки виртуальных машин приложения, прежде чем переносить их в Azure.

## <a name="assessment-architecture"></a>Архитектура оценки

![Архитектура оценки миграции](../migrate/azure-best-practices/media/contoso-migration-assessment/migration-assessment-architecture.png)

- Contoso — это вымышленное название, представляющее типичную крупную организацию.
- Компания Contoso использует локальный центр обработки данных (**contoso-datacenter**) и локальные контроллеры домена (**CONTOSODC1**, **CONTOSODC2**).
- Виртуальные машины VMware находятся на узле VMware ESXI 6.5 (**contosohost1**, **contosohost2**).
- Средой VMware управляет сервер vCenter Server 6.5 (**vcenter.contoso.com**), который запущен на виртуальной машине.
- Приложение для путешествий SmartHotel360 имеет следующие характеристики:
  - Приложение разбито на уровни и находится на двух виртуальных машинах VMware (**WEBVM** и **SQLVM**).
  - Виртуальные машины расположены на узле VMware ESXi **contosohost1.contoso.com**.
  - Виртуальные машины используют центр обработки данных, для которого используется ОС Windows Server 2008 R2 с пакетом обновления 1 (SP1).
- Средой VMware управляет сервер vCenter Server (**vcenter.contoso.com**), который запущен на виртуальной машине.
- osTicket — приложение службы поддержки:
  - У приложения есть два уровня, которые размещаются на двух виртуальных машинах (**OSTICKETWEB** и **OSTICKETMYSQL**).
  - Виртуальные машины работают на ОС Ubuntu Linux Server 16.04-LTS.
  - Виртуальная машина **OSTICKETWEB** работает на Apache 2 и PHP 7.0.
  - Виртуальная машина **OSTICKETMYSQL** работает на MySQL 5.7.22.

## <a name="prerequisites"></a>предварительные требования

Компания Contoso и другие пользователи должны отвечать следующим предварительным условиям оценки:

- Разрешение на подписку Azure на уровне участника или владельца или разрешение на группу ресурсов в подписке Azure.
- Локальный сервер vCenter Server версии 6.5, 6.0 или 5.5.
- Учетная запись только для чтения на сервере vCenter Server или разрешения на ее создание.
- Разрешения на создание виртуальной машины на экземпляре сервера vCenter Server с использованием шаблона в формате OVA.
- По крайней мере один узел ESXi версии 5.5 или более поздней.
- По крайней мере две виртуальные машины VMware, на одной из который выполняется база данных SQL Server.
- Разрешения на установку агентов службы "Миграция Azure" на каждой виртуальной машине.
- Виртуальные машины должны иметь прямое подключение к Интернету.
  - Вы можете ограничить доступ к [требуемым URL-адресам](https://docs.microsoft.com/azure/migrate/concepts-collector) в Интернете.
  - Если виртуальные машины не подключены к Интернету, на них должен быть установлен [шлюз Azure Log Analytics](https://docs.microsoft.com/azure/azure-monitor/platform/gateway), через который будет направляться трафик агента.
- Полное доменное имя (FQDN) виртуальной машины, на которой работает экземпляр SQL Server, для оценки базы данных.
- Брандмауэр Windows, работающий на виртуальной машине SQL Server, должен разрешать внешние подключения по TCP-порту 1433 (по умолчанию). Эта настройка позволяет подключиться к Помощнику по миграции данных.

## <a name="assessment-overview"></a>Общие сведения об оценке

Вот как компания Contoso производит оценку:

> [!div class="checklist"]
>
> - **Шаг 1. Скачайте и установите Помощник по миграции данных.** Компания Contoso подготавливает Помощник по миграции данных для оценки локальной базы данных SQL Server.
> - **Шаг 2. Оценка базы данных с помощью Помощник по миграции данных.** Компания Contoso выполняет оценку базы данных и анализирует полученные результаты.
> - **Шаг 3. Подготовка к оценке виртуальных машин с помощью службы "миграция Azure".** Компания Contoso создает локальные учетные записи и настраивает параметры VMware.
> - **Шаг 4. обнаружение локальных виртуальных машин с помощью службы "миграция Azure".** Компания Contoso создает виртуальную машину сборщика для Миграции Azure. Затем компания запускает сборщик, чтобы обнаружить виртуальные машины для оценки.
> - **Шаг 5. Подготовка к анализу зависимостей с помощью службы "миграция Azure".** Компания Contoso устанавливает агенты Миграции Azure на виртуальных машинах, чтобы проанализировать зависимости между виртуальными машинами.
> - **Шаг 6. Оценка виртуальных машин с помощью службы "миграция Azure".** Компания Contoso проверяет зависимости, группирует виртуальные машины и выполняет оценку. Когда оценка будет выполнена, компания Contoso проанализирует ее в процессе подготовки к миграции.

    > [!NOTE]
    > Assessments shouldn't just be limited to using tooling to discover information about your environment. You should also schedule time to speak to business owners, end users, and other members of the IT department to fully understand of what is happening in the environment and understand factors that tooling cannot tell you. 

## <a name="step-1-download-and-install-data-migration-assistant"></a>Шаг 1. Загрузка и установка Помощника по миграции данных

1. Компания Contoso загружает Помощник по миграции данных из [Центра загрузки Майкрософт](https://www.microsoft.com/download/details.aspx?id=53595).
    - Помощник по миграции данных может быть установлен на любом компьютере, который может подключиться к экземпляру SQL Server. Компании Contoso не нужно запускать его на компьютере SQL Server.
    - Помощник по миграции данных не следует запускать на хост-компьютере SQL Server.
2. Чтобы начать установку, компания Contoso запускает загруженный файл (DownloadMigrationAssistant.msi).
3. Перед закрытием мастера на странице **Готово** компания Contoso выбирает **Запустить помощник по миграции данных Майкрософт**.

## <a name="step-2-run-and-analyze-the-database-assessment-for-smarthotel360"></a>Шаг 2. Запуск и анализ оценки базы данных для SmartHotel360

Теперь компания Contoso может запустить оценку анализа локального сервера базы данных SQL Server для приложения SmartHotel360.

1. В Помощнике по миграции данных компания Contoso выбирает **New** (Создать)  > **Оценка**, а затем задает оценке имя проекта.
2. Для параметра **Тип исходного сервера** специалисты Contoso выбирают **SQL Server**, а для параметра **Тип целевого сервера** — **SQL Server на виртуальных машинах Azure**.

    ![Помощник по миграции данных. Выбор источника](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-1.png)

    > [!NOTE]
    > В настоящее время Помощник по миграции данных не поддерживает оценку для миграции на Управляемый экземпляр Базы данных SQL Azure. Чтобы обойти это ограничение, компания Contoso использует SQL Server на виртуальной машине Azure в качестве предполагаемого целевого объекта оценки.

3. В поле **Выберите целевую версию** компания Contoso выбирает SQL Server 2017. Компания Contoso должна выбрать эту версию, так как она используется Управляемым экземпляром Базы данных SQL.
4. Для получения сведений о совместимости и новых функциях компания Contoso выбирает отчеты:
    - Параметр **Проблемы совместимости** позволяет выявить изменения, которые могут прервать миграцию или для которых потребуется незначительная корректировка перед миграцией. Этот отчет позволяет компании Contoso получать сведения о функциях, которые являются устаревшими, но на данный момент работают. Проблемы упорядочены по уровню совместимости.
    - Параметр **Рекомендации по новым функциям** позволяет выявить новые возможности целевой платформы SQL Server, которые можно использовать в базе данных после миграции. Рекомендации по новым функциям организованы в рубриках **Производительность**, **Безопасность** и **Хранение**.

    ![Помощник по миграции данных. Проблемы совместимости и новые функции](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-2.png)

5. На вкладке **Подключение к серверу** компания Contoso вводит имя виртуальной машины, на которой работает база данных, а также учетные данные для доступа к ней. Компания Contoso выбирает **Сертификат сервера доверия**, чтобы убедиться, что виртуальная машина может получить доступ к SQL Server. Затем компания выбирает **Подключить**.

    ![Помощник по миграции данных. Подключение к серверу](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-3.png)

6. В поле **Добавить источник** компания Contoso добавляет базу данных, которую хочет оценить, а затем выбирает **Далее**, чтобы начать оценку.
7. Оценка создана.

    ![Помощник по миграции данных. Создание оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-4.png)

8. Результаты оценки компания Contoso может увидеть в поле **Просмотр результатов**.

### <a name="analyze-the-database-assessment"></a>Анализ оценки базы данных

Как только результаты станут доступными, оны будут отображены. Если компания Contoso исправляет проблемы, для повторной оценки необходимо выбрать **Перезапустить оценку**.

1. Ошибки, находящиеся на каждом уровне совместимости, компания может проверить в поле **Проблемы совместимости**. Уровни совместимости сопоставляются с версиями SQL Server следующим образом:

    - 100: SQL Server 2008/база данных SQL Azure
    - 110: SQL Server 2012/база данных SQL Azure
    - 120: SQL Server 2014/база данных SQL Azure
    - 130: SQL Server 2016/база данных SQL Azure
    - 140: SQL Server 2017/база данных SQL Azure

    ![Помощник по миграции данных. Отчет о проблемах совместимости](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-5.png)

2. В отчете **Рекомендуемые возможности** компанией Contoso просматриваются функции для обеспечения производительности и безопасности, а также возможности хранения после миграции. Рекомендуется использовать различные функции, в том числе выполняющуюся в памяти OLTP, индексы columnstore, Stretch Database, Always Encrypted, динамическое маскирование данных и прозрачное шифрование данных.

    ![Помощник по миграции данных. Отчет о рекомендуемых возможностях](../migrate/azure-best-practices/media/contoso-migration-assessment/dma-assessment-6.png)

    > [!NOTE]
    > Компании Contoso следует [включить прозрачное шифрование данных](https://docs.microsoft.com/sql/relational-databases/security/encryption/transparent-data-encryption?view=sql-server-2017) для всех баз данных SQL Server. Это еще более важно, когда база данных находится в облаке, чем когда она размещается локально. Прозрачное шифрование данных следует включать только после миграции. Если прозрачное шифрование данных уже включено, компания Contoso должна переместить сертификат или асимметричный ключ в главную базу данных или на целевой сервер. Узнайте, как [переместить прозрачное шифрование защищенной базы данных на другой экземпляр SQL Server](https://docs.microsoft.com/sql/relational-databases/security/encryption/move-a-tde-protected-database-to-another-sql-server?view=sql-server-2017).

3. Затем компания Contoso может экспортировать оценку в формате JSON или CSV.

> [!NOTE]
> Для крупномасштабных оценок:
>
> - Одновременно выполняйте несколько оценок и просматривайте их состояние на странице **Все оценки**.
> - Консолидируйте оценки в [базе данных SQL Server](https://docs.microsoft.com/sql/dma/dma-consolidatereports?view=ssdt-18vs2017).
> - Консолидируйте оценки в [отчете Power BI](https://docs.microsoft.com/sql/dma/dma-powerbiassesreport?view=ssdt-18vs2017).

## <a name="step-3-prepare-for-vm-assessment-by-using-azure-migrate"></a>Шаг 3. Подготовка к оценке виртуальных машин с помощью службы "Миграция Azure"

Компании Contoso необходимо создать учетную запись VMware, которую служба "Миграция Azure" сможет использовать для автоматического обнаружения виртуальных машин для оценки. Также необходимо убедиться в наличии прав на создание виртуальной машины, обратить внимание на порты, которые должны быть открыты, и установить уровень параметров статистики.

### <a name="set-up-a-vmware-account"></a>Настройка учетной записи VMware

Обнаружению виртуальных машин требуется учетная запись только для чтения в vCenter Server, которая бы обладала следующими свойствами:

- **Тип пользователя:** Как минимум пользователь с правами только для чтения.
- **Разрешения:** Для объекта центр обработки данных установите флажок **распространить на дочерние объекты** . Для **роли** выберите **только для чтения**.
- **Сведения:** Пользователь назначается на уровне центра обработки данных с доступом ко всем объектам в центре обработки данных.
- Чтобы ограничить доступ, назначьте дочерним объектам (узлы vSphere, хранилища данных, виртуальные машины и сети) роль **без доступа** с параметром **распространить на дочерний** объект.

### <a name="verify-permissions-to-create-a-vm"></a>Проверка разрешений для создания виртуальной машины

Компания Contoso проверяет наличие разрешения на создание виртуальной машины путем импорта файла в формате OVA. Узнайте, как [создать и назначить роль с разрешениями](https://kb.vmware.com/s/article/1023189?other.KM_Utility.getArticleLanguage=1&r=2&other.KM_Utility.getArticleData=1&other.KM_Utility.getArticle=1&ui-comm-runtime-components-aura-components-siteforce-qb.Quarterback.validateRoute=1&other.KM_Utility.getGUser=1).

### <a name="verify-ports"></a>Проверка портов

При оценке компании Contoso используется сопоставление зависимостей. Для сопоставления зависимостей требуется, чтобы агент был установлен на виртуальных машинах, которые будут оцениваться. Агент должен иметь возможность подключиться к Azure по TCP-порту 443 на каждой виртуальной машине. Узнайте больше о [требованиях к подключению](https://docs.microsoft.com/azure/log-analytics/log-analytics-concept-hybrid).

## <a name="step-4-discover-vms"></a>Шаг 4. Обнаружение виртуальных машин

Компания Contoso создает проект службы "Миграция Azure" для обнаружения виртуальных машин. Компания Contoso загружает и устанавливает сборщик виртуальной машины. Затем компания запускает сборщик, чтобы обнаружить локальные виртуальные машины.

### <a name="create-a-project"></a>Создание проекта

Настройте новый проект службы "Миграция Azure" следующим образом.

1. На портал Azure выберите **Все службы** и найдите службу **Миграция Azure**.

1. В разделе **Службы** выберите **Миграция Azure**.

1. В разделе **Обзор** в области **Обнаружение, оценка и миграция серверов** выберите **Оценка и миграция серверов**.

    ![Миграция Azure. Создание проекта миграции](../migrate/azure-best-practices/media/contoso-migration-assessment/assess-migrate.png)

1. В разделе **Начало работы** щелкните **Добавить инструменты**.

1. В разделе **Проект миграции** выберите подписку Azure и создайте группу ресурсов, если у вас ее нет.

1. В разделе *Сведения о проекте* укажите имя проекта и регион для создания проекта. Поддерживаются США, Азия, Европа, Австралия, Великобритания, Канада, Индия и Япония.

    - Географический регион проекта используется только для хранения обнаруженных метаданных локальных виртуальных машин.
    - При выполнении миграции можно выбрать любой целевой регион.

1. Выберите **Далее**.

1. В **средстве Выбор средства оценки**выберите **Миграция Azure: Оценка сервера** > **Далее**.

    ![Миграция Azure. Средство оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-tool.png)

1. В области **Выберите инструмент миграции** выберите **Пропустить добавление инструмента миграции** > **Далее**.

1. На странице **Проверка и Добавление средств**просмотрите параметры, а затем выберите **Добавить средства**.

1. Развертывание проекта службы "Миграция Azure" может занять несколько минут. После этого откроется страница проекта. Если проект не отображается, доступ к нему можно получить в разделе **Серверы** на панели мониторинга службы "Миграция Azure".

### <a name="download-the-collector-appliance"></a>Скачивание модуля сборщика

1. В **целях миграции** > **серверы** > **службе "миграция Azure": Оценка сервера**выберите **Обнаружение**.

1. В разделе **Обнаружение компьютеров** > **виртуальные машины?** выберите **Да, с помощью VMware vSphere низкоуровневой оболочки**.

1. Щелкните **скачать** , чтобы скачать. Файл шаблона OVA.

     ![Миграция Azure. Скачивание сборщика](../migrate/azure-best-practices/media/contoso-migration-assessment/download-ova-v2.png)

### <a name="verify-the-collector-appliance"></a>Проверка модуля сборщика

Прежде чем развертывать OVA-файл, компания Contoso проверяет, что он не поврежден:

1. На компьютере, на который был загружен файл, компания Contoso открывает окно командной строки с правами администратора.

1. Чтобы создать хэш файла в формате OVA, компания Contoso выполняет следующую команду:

    `C:\>CertUtil -HashFile <file_location> [Hashing Algorithm]`

    **Пример**.

    `C:\>CertUtil -HashFile C:\AzureMigrate\AzureMigrate.ova SHA256`

1. Созданный хэш должен соответствовать хэш-значениям, указанным в разделе [Проверка безопасности](https://docs.microsoft.com/azure/migrate/tutorial-assess-vmware#verify-security) руководства по [оценке виртуальных машин VMware для миграции](https://docs.microsoft.com/azure/migrate/tutorial-assess-vmware) .

### <a name="create-the-collector-appliance"></a>Создание модуля сборщика

Теперь у компании Contoso появилась возможность импортировать скачанный файл в экземпляр vCenter Server и подготовить виртуальную машину для модуля сборщика.

1. В консоли клиента vSphere компания Contoso выбирает **Файл** > **Развернуть шаблон OVF**.

    ![Веб-клиент vSphere. Развертывание шаблона OVF](../migrate/azure-best-practices/media/contoso-migration-assessment/vcenter-wizard.png)

1. В мастере шаблонов развертывания OVF компания Contoso выбирает **Источник**, а затем указывает местоположение файла OVA.

1. В **Название и местоположение** компания Contoso указывает отображаемое имя для сборщика виртуальной машины. Затем она выбирает местоположение инвентаря для размещения виртуальной машины. Также компания Contoso указывает узел или кластер, в котором будет выполняться модуль сборщика.

1. В **Хранилище** компания Contoso задает место хранения. В **Формат диска** компания Contoso выбирает, как нужно подготовить к работе хранилище.

1. В **Сетевое сопоставление** компания Contoso задает сеть, в которой будет подключаться сборщик виртуальной машины. Этой сети требуется подключение к Интернету для отправки метаданных в Azure.

1. Компания Contoso проверяет настройки и устанавливает флажок **Включить питание после развертывания** > **Готово**. Когда устройство будет создано, появится сообщение, подтверждающее успешное завершение работы.

### <a name="run-the-collector-to-discover-vms"></a>Запуск сборщика для обнаружения виртуальных машин

Теперь компания Contoso запускает сборщик для обнаружения виртуальных машин. В настоящее время сборщик поддерживает только **английский (США)** в качестве языка операционной системы и языка интерфейса сборщика.

1. В консоли клиента vSphere компания Contoso выбирает **Открыть консоль**. Компания Contoso принимает условия лицензирования и задает параметры пароля для сборщика виртуальной машины.

1. На рабочем столе компания Contoso выбирает ярлык **Диспетчер конфигураций устройства Microsoft Azure**.

    ![Консоль клиента vSphere. Ярлык сборщика](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-shortcut-v2.png)

1. В сборщике службы "Миграция Azure" компания Contoso открывает раздел **Настройка предварительных требований**. Компания Contoso принимает условия лицензии и считывает информацию от сторонних производителей.

1. Сборщик проверяет, что виртуальная машина имеет доступ к Интернету, время синхронизировано и служба сборщика запущена. (Служба сборщика по умолчанию устанавливается на виртуальной машине.) Contoso также устанавливает пакет средств разработки VMware vSphere виртуального диска.

    > [!NOTE]
    > Предполагается, что виртуальная машина имеет прямой доступ к Интернету без использования прокси-сервера.

    ![Сборщик Миграции Azure. Проверка предварительных требований](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-verify-prereqs-v2.png)

1. Войдите в свою учетную запись **Azure** и выберите подписку и проект миграции, который вы создали ранее. Также введите имя **устройства** , чтобы его можно было найти в портал Azure.
1. На вкладке **Укажите сведения о vCenter Server** компания Contoso указывает имя (FQDN) или IP-адрес экземпляра vCenter Server, а также учетные данные только для чтения, используемые для обнаружения.
1. Компания Contoso выбирает область для обнаружения виртуальных машин. Сборщик может обнаруживать только виртуальные машины, находящиеся в указанной области. Областью может быть определенная папка, центр обработки данных или кластер.

    ![Укажите сведения о vCenter Server](../migrate/azure-best-practices/media/contoso-migration-assessment/collector-connect-vcenter.png)

1. Сборщик запустит процесс обнаружения и сбора информации о среде Contoso.

    ![Просмотр хода выполнения сбора](../migrate/azure-best-practices/media/contoso-migration-assessment/migrate-discovery.png)

### <a name="verify-vms-in-the-portal"></a>Проверка виртуальных машин на портале

После завершения сбора компания Contoso проверяет, что виртуальные машины отображаются на портале.

1. В проекте Миграции Azure компания Contoso выбирает **Серверы** > **Обнаруженные серверы**. Компания Contoso проверяет, что нужные виртуальные машины обнаружены.

    ![Миграция Azure. Обнаруженные компьютеры](../migrate/azure-best-practices/media/contoso-migration-assessment/discovery-complete.png)

1. В настоящее время на компьютерах нет установленных агентов службы "Миграция Azure". Компания Contoso должна установить агенты для просмотра зависимостей.

    ![Миграция Azure. Необходима установка агента](../migrate/azure-best-practices/media/contoso-migration-assessment/machines-no-agent.png)

## <a name="step-5-prepare-for-dependency-analysis"></a>Шаг 5. Подготовка к анализу зависимостей

Чтобы просмотреть зависимости между виртуальными машинами, которые компания Contoso хочет оценить, необходимо скачать и установить агенты на виртуальные машины приложений. Компания Contoso устанавливает агенты на всех виртуальных машинах для своих приложений, как для Windows, так и для Linux.

### <a name="take-a-snapshot"></a>Создание моментального снимка

Компания Contoso выполняет моментальный снимок виртуальной машины перед установкой агента, что позволяет сохранить ее копию перед изменением.

![Моментальный снимок компьютера](../migrate/azure-best-practices/media/contoso-migration-assessment/snapshot-vm.png)

### <a name="download-and-install-the-vm-agents"></a>Скачивание и установка агентов виртуальной машины

1. В разделе **Компьютеры** компания Contoso выбирает компьютер. В столбце **Зависимости** она выбирает **Требует установки**.

1. В области **Обнаружение компьютеров** специалист Contoso:
    - Скачивает Microsoft Monitoring Agent (MMA) и агент зависимостей Майкрософт для каждой виртуальной машины Windows.
    - Скачивает MMA и агент зависимостей для каждой виртуальной машины Linux.

1. Компания Contoso копирует идентификатор рабочей области и ключ. При установке MMA специалистам компании Contoso необходим идентификатор рабочей области и ключ.

    ![Скачивание агента](../migrate/azure-best-practices/media/contoso-migration-assessment/download-agents.png)

### <a name="install-the-agents-on-windows-vms"></a>Установите агент для виртуальных машин Windows

Компания Contoso запускает установку на каждой виртуальной машине.

#### <a name="install-the-mma-on-windows-vms"></a>Установите MMA для виртуальных машин Windows

1. Компания Contoso дважды щелкает загруженный файл агента.

1. На странице **Конечная папка** компания Contoso изменяет или оставляет папку установки по умолчанию и нажимает кнопку **Далее**.

1. В окне **Параметры установки агента** она выбирает **Подключить агент к Azure Log Analytics** > **Далее**.

    ![Установка Microsoft Monitoring Agent. Параметры установки агента](../migrate/azure-best-practices/media/contoso-migration-assessment/mma-install.png)

1. В окне **Azure Log Analytics** компания Contoso вставляет идентификатор и ключ рабочей области, скопированные на портале.

    ![Установка Microsoft Monitoring Agent. Azure Log Analytics](../migrate/azure-best-practices/media/contoso-migration-assessment/mma-install2.png)

1. В окне **Готово к установке** компания Contoso устанавливает MMA.

#### <a name="install-the-dependency-agent-on-windows-vms"></a>Установка агента зависимостей на виртуальные машины Windows

1. Компания Contoso дважды щелкает скачанный агент зависимостей.

1. Компания принимает условия лицензионного соглашения и ждет окончания установки.

    ![Установка Dependency Agent. Установка](../migrate/azure-best-practices/media/contoso-migration-assessment/dependency-agent.png)

### <a name="install-the-agents-on-linux-vms"></a>Установка агентов на виртуальные машины Linux

Компания Contoso запускает установку на каждой виртуальной машине.

#### <a name="install-the-mma-on-linux-vms"></a>Установите MMA для виртуальных машин Linux

1. Специалисты компании Contoso устанавливают библиотеку ctypes Python для каждой виртуальной машины, используя следующую команду:

    `sudo apt-get install python-ctypeslib`

1. Чтобы установить агент MMA, компания Contoso должна запустить команды от имени привилегированного пользователя. Чтобы стать привилегированным пользователем, компания Contoso выполняет команду и вводит пароль:

    `sudo -i`

1. Компания Contoso устанавливает MMA:

    - Она вводит идентификатор и ключ рабочей области в команде.
    - Команды предназначены для 64-разрядных систем.
    - Идентификатор рабочей области и первичный ключ находятся в рабочей области Log Analytics на портале Azure. Выберите **Параметры**, а затем вкладку **Подключенные источники**.
    - Выполните следующие команды для загрузки агента Log Analytics, проверки контрольной суммы, установки и подключения агента:

    `wget https://raw.githubusercontent.com/Microsoft/OMS-Agent-for-Linux/master/installer/scripts/onboard_agent.sh && sh onboard_agent.sh -w 6b7fcaff-7efb-4356-ae06-516cacf5e25d -s k7gAMAw5Bk8pFVUTZKmk2lG4eUciswzWfYLDTxGcD8pcyc4oT8c6ZRgsMy3MmsQSHuSOcmBUsCjoRiG2x9A8Mg==`

#### <a name="install-the-dependency-agent-on-linux-vms"></a>Установка агента зависимостей на виртуальные машины Linux

После установки MMA компания Contoso устанавливает агент зависимостей на виртуальных машинах Linux:

1. Агент зависимостей устанавливается на компьютеры Linux с помощью InstallDependencyAgent-Linux64. bin — сценария оболочки, который содержит самораспаковывающийся двоичный файл. Компания Contoso запускает файл с помощью команды "sh" или добавляет разрешения на выполнение в сам файл.

1. Компания Contoso устанавливает агент зависимостей Linux в качестве привилегированного пользователя:

    `wget --content-disposition https://aka.ms/dependencyagentlinux -O InstallDependencyAgent-Linux64.bin && sudo sh InstallDependencyAgent-Linux64.bin -s`

## <a name="step-6-run-and-analyze-the-vm-assessment"></a>Шаг 6. Запуск и анализ оценки виртуальных машин

Теперь компания Contoso может проверить зависимости компьютера и создать группу. Затем она запускает оценку для группы.

### <a name="verify-dependencies-and-create-a-group"></a>Проверка зависимостей и создание группы

1. Чтобы определить, какие компьютеры анализировать, Contoso выбирает **Показать зависимости**.

    ![Миграция Azure. Просмотр зависимости компьютера](../migrate/azure-best-practices/media/contoso-migration-assessment/view-machine-dependencies.png)

1. На карте зависимостей SQLVM появятся следующие сведения:

    - Группы процессов или процессы, которые имеют активные сетевые подключения, запущенные на SQLVM в течение указанного периода времени (час, по умолчанию).
    - Входящие (клиент) и исходящие (сервер) TCP-подключения всех зависимых компьютеров.
    - Зависимые компьютеры, которые имеют установленные агенты службы "Миграция Azure", показаны в виде отдельных полей.
    - Компьютеры, на которых не установлены агенты, отображают информацию о портах и ​​IP-адресах.

1. Для компьютеров, на которых установлен агент (WEBVM), компания Contoso выбирает компьютерный блок для просмотра дополнительной информации. Информация включает FQDN, операционную систему и MAC-адрес.

    ![Миграция Azure. Просмотр зависимостей группы](../migrate/azure-best-practices/media/contoso-migration-assessment/sqlvm-dependencies.png)

1. Компания Contoso выбирает виртуальные машины, которые будут добавлены в группы (SQLVM и WEBVM). Contoso содержит ключ `Ctrl`, при щелчке по нему выбирается несколько виртуальных машин.

1. Она выбирает **Создать группу**, а затем вводит имя (**smarthotelapp**).

    > [!NOTE]
    > Чтобы просмотреть более подробные зависимости, можно расширить диапазон времени. Можно выбрать конкретную продолжительность или даты начала и окончания.

### <a name="run-an-assessment"></a>Запуск оценки

1. В **группах** компания Contoso открывает группу (**smarthotelapp**), а затем выбирает **Создать оценку**.

    ![Миграция Azure. Создание оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/run-vm-assessment.png)

1. Чтобы просмотреть оценку, компания Contoso выбирает **Управление** > **Оценки**.

Специалисты компании Contoso используют параметры оценки по умолчанию, но вы можете [настроить параметры](https://docs.microsoft.com/azure/migrate/how-to-modify-assessment).

### <a name="analyze-the-vm-assessment"></a>Анализ оценки виртуальных машин

Оценка службы "Миграция Azure" включает информацию о локальной совместимости с Azure, правильном размере для виртуальной машины Azure, а также предполагаемые ежемесячные затраты в Azure.

![Миграция Azure. Отчет об оценке](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-overview.png)

#### <a name="review-confidence-rating"></a>Просмотр рейтинга достоверности

![Миграция Azure. Отображение оценки](../migrate/azure-best-practices/media/contoso-migration-assessment/assessment-display.png)

Оценка имеет рейтинг достоверности от 1 до 5 звезд (1 звезда — самый низкий, а 5 звезд — самый высокий).

- Оценка достоверности назначается на основе доступности точек данных, которые необходимы для вычисления оценки.
- Это помогает оценить надежность рекомендаций по выбору размера, который предоставлен службой "Миграция Azure".
- Оценка достоверности полезна при *определении размера на основе производительности*. Служба "Миграция Azure" может иметь недостаточное количество точек данных для определения размера на основе использования. При определении размера *как для локальной виртуальной машины* значение оценки достоверности всегда равно 5 звездам, так как в службе "Миграция Azure" есть все данные для определения размера виртуальной машины.
- В зависимости от процента доступных точек данных оценка достоверности может быть такой:

   Уровень доступности точек данных | Оценка достоверности
   --- | ---
   0–20 % | 1 звезда
   21–40 % | 2 звезды
   41–60 % | 3 звезды
   61–80 % | 4 звезды
   81–100 % | 5 звезд

#### <a name="verify-azure-readiness"></a>Проверка готовности к работе в Azure

![Миграция Azure. Оценка готовности](../migrate/azure-best-practices/media/contoso-migration-assessment/azure-readiness.png)

В отчете об оценке представлены сведения в виде таблицы. Для отображения размера на основе производительности службе "Миграция Azure" требуются следующие сведения. Если сведения невозможно собрать, оценка размера может быть неточной.

- Данные об использовании ЦП и памяти.
- Сведения об операциях записи и чтения в секунду и пропускной способности для каждого диска, присоединенного к виртуальной машине.
- Сведения о входящем и исходящем сетевом трафике для каждого сетевого адаптера, подключенного к виртуальной машине.

<!-- markdownlint-disable MD033 -->

Параметр | Указание | Сведения
--- | --- | ---
**Готовность виртуальной машины Azure** | Указывает, готова ли виртуальная машина к миграции. | Возможны следующие состояния:<br/><br/>— Ready for Azure (Готова к работе в Azure);<br/><br/>— Ready with conditions (Готова при выполнении условий); <br/><br/>— Not ready for Azure (Не готова к работе в Azure);<br/><br/>— "Уровень готовности неизвестен".<br/><br/> Если виртуальная машина не готова, служба "Миграция Azure" продемонстрирует шаги по устранению проблем.
**Размер виртуальной машины Azure** | Для готовых виртуальных машин служба "Миграция Azure" дает рекомендацию по размеру виртуальной машины Azure. | Рекомендация по размеру зависит от свойств оценки:<br/><br/>Если вы использовали размер на основе производительности, при определении размера учитывается история производительности виртуальных машин.<br/><br/>При определении размера как для *локальной виртуальной машины* учитывается размер локальной виртуальной машины, а данные об использовании — нет.
**Рекомендуемое средство** | Поскольку компьютеры Azure работают с агентами, служба "Миграция Azure" просматривает процессы, запущенные внутри компьютера. Она определяет, является ли он компьютером базы данных.
**Сведения о виртуальной машине** | В отчете показаны параметры локальной виртуальной машины, включая операционную систему, тип загрузки и данные о диске и хранилище.

<!-- markdownlint-enable MD033 -->

#### <a name="review-monthly-cost-estimates"></a>Просмотр примерной стоимости в месяц

В этом представлении отображается общая стоимость вычислений и хранения для запуска виртуальных машин в Azure. Также отображаются сведения для каждого компьютера.

![Миграция Azure — затраты Azure](../migrate/azure-best-practices/media/contoso-migration-assessment/azure-costs.png)

- Ожидаемая стоимость рассчитывается с использованием рекомендаций по размеру для компьютера.
- Примерная ежемесячная стоимость вычислений и хранилища суммируется для всех виртуальных машин в группе.

## <a name="clean-up-after-assessment"></a>Очистка после оценки

- После завершения оценки Contoso сохраняет устройство службы "Миграция Azure" для будущих вычислений.
- Компания Contoso отключает виртуальную машину VMware. Компания Contoso будет использовать ее снова, когда она оценит дополнительные виртуальные машины.
- Компания Contoso сохраняет проект **Миграция компании Contoso** в Azure. В настоящее время проект развернут в **группе ресурсов ContosoFailoverRG** в регионе Azure "Восточная часть США".
- Оценочная лицензия сборщика виртуальных машин действует 180 дней. Если этот период истечет, компании Contoso придется снова загружать и настраивать сборщик.

## <a name="conclusion"></a>Заключение

В этом случае компания Contoso оценивает базу данных приложений SmartHotel360 с помощью инструмента оценки миграции данных. Она оценивает локальные виртуальные машины приложения с помощью службы "Миграция Azure". Специалисты компании Contoso просматривают оценки, чтобы убедиться, что локальные ресурсы готовы к миграции в Azure.

## <a name="next-steps"></a>Дальнейшие действия

Компания Contoso оценила эту рабочую нагрузку в качестве потенциального кандидата для переноса, теперь она может начать подготовку своей локальной инфраструктуры и инфраструктуры Azure к миграции. Пример того, как компания Contoso выполняет эти процессы, приведен в статье [Развертывание инфраструктуры Azure](../migrate/azure-best-practices/contoso-migration-infrastructure.md), указанной в разделе рекомендаций по переносу согласно положениям Cloud Adoption Framework.
