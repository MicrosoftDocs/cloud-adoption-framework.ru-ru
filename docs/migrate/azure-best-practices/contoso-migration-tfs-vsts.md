---
title: Рефакторинг развертывания Team Foundation Server и его перенос в Azure DevOps Services
description: Используйте платформу внедрения облачных технологий для Azure, чтобы узнать, как выполнить рефакторинг локального развертывания Team Foundation Server, переменив его на Azure DevOps Services в Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: site-recovery
ms.openlocfilehash: de13c3f9ba198b7a54737bf9bd37d2affef4261b
ms.sourcegitcommit: 07d56209d56ee199dd148dbac59671cbb57880c0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88878203"
---
<!-- cSpell:ignore contosodev contosodevmigration contosomigration onmicrosoft visualstudio sourceconnectionstring smarthotelcontainer identitymaplog CONTOSOTFS DACPAC SQLDB SQLSERVERNAME INSTANCENAME sqlpackage SSDT azuredevopsmigration validateonly ImportType -->

# <a name="refactor-a-team-foundation-server-deployment-to-azure-devops-services"></a>Рефакторинг развертывания Team Foundation Server и его перенос в Azure DevOps Services

В этой статье показано, как вымышленная компания Contoso предоставляет свое локальное развертывание Visual Studio Team Foundation Server, перенося его в Azure DevOps Services в Azure. Группа разработки Contoso использовала Team Foundation Server для совместной работы группы и системы управления версиями за последние пять лет. Теперь группа хочет перейти на облачное решение для разработки и тестирования, а также для системы управления версиями. Azure DevOps Services будет играть роль, когда группа Contoso переходит на модель Azure DevOps и разрабатывает новые облачные приложения.

## <a name="business-drivers"></a>Бизнес-факторы

Группа компаний по ИТ-отделу Contoso тесно работала с деловыми партнерами для выяснения будущих целей. Эти партнеры не связаны со средствами разработки и технологиями, но группа записала следующие моменты:

- **Программное обеспечение**. Независимо от основного бизнеса, все компании теперь являются компаниями-разработчиками программного обеспечения, включая Contoso. Бизнес-лидер заинтересован в том, как он может помочь компании создать новые рабочие методики для пользователей и новые возможности для клиентов.
- **Эффективность**. компании Contoso необходимо оптимизировать процессы и удалить ненужные процедуры для разработчиков и пользователей. Это позволит компании более эффективно предоставлять требования клиентов. Бизнесу требуется быстро перемещаться, не тратя время или деньги.
- **Гибкость**. чтобы обеспечить успешное выполнение в глобальной экономике, компания Contoso должна быть в большей мере реагировать на потребности бизнеса. Она должна иметь возможность быстрее реагировать на изменения в Marketplace. Он не должен быть в том виде, в каком он был заблокирован.

## <a name="migration-goals"></a>Цели миграции

Группа разработчиков Contoso Cloud прикрепляет следующие цели для перехода на Azure DevOps Services:

- Группе требуется инструмент для переноса данных в облако. Необходимо несколько процессов, выполняемых вручную.
- Данные рабочих элементов и история за последний год должны быть перенесены.
- Команда разработчиков не хочет создавать новые имена пользователей и пароли. Все текущие системные назначения должны быть сохранены.
- Они хотят отказаться от Team Foundation Version Control (TFVC) в пользу Git для управления версиями.
- Переход в Git будет переходом TIP, который импортирует только последнюю версию исходного кода. Переход будет происходить во время простоя, когда вся работа будет остановлена по мере сдвига базы кода. Команда понимает, что после перемещения будет доступна только текущая история главной ветви.
- Группа заинтересована в изменении и хочет протестировать ее перед полным перемещением. Группа хочет хранить доступ к Team Foundation Server даже после перехода на Azure DevOps Services.
- Группа имеет несколько коллекций и, чтобы лучше понять процесс, он хочет начать с одной из нескольких проектов.
- Группа понимает, что Team Foundation Server коллекции являются связью "один к одному" с Azure DevOps Services организациями, поэтому у нее будет несколько URL-адресов. Но это соответствует текущей модели разделения для баз кода и проектов.

## <a name="proposed-architecture"></a>Предлагаемая архитектура

- Компания Contoso переместит свои Team Foundation Server проекты в облако, и она больше не будет размещать свои проекты или управление исходным кодом в локальной среде.
- Team Foundation Server будут перенесены в Azure DevOps Services.
- В настоящее время Contoso имеет одну Team Foundation Serverную коллекцию с именем `ContosoDev` , которая будет перенесена в Azure DevOps Servicesную организацию с именем `contosodevmigration.visualstudio.com` .
- Проекты, рабочие элементы, ошибки и итерации за прошлый год будут перенесены в Azure DevOps Services.
- Contoso будет использовать свой экземпляр Azure Active Directory (Azure AD), который был настроен при [развертывании инфраструктуры Azure](./contoso-migration-infrastructure.md) в начале планирования миграции.

![Схема предлагаемой архитектуры.](./media/contoso-migration-tfs-vsts/architecture.png)

## <a name="migration-process"></a>Процесс миграции

Порядок миграции в Contoso будет следующим:

1. Требуется значительная подготовка. Во-первых, компания Contoso должна обновить свою реализацию Team Foundation Server до поддерживаемого уровня. Компания Contoso в настоящее время работает под управлением Team Foundation Server 2017 с обновлением 3, но для использования миграции баз данных необходимо запустить поддерживаемую версию 2018 с последними обновлениями.
1. После обновления Contoso запустит средство Team Foundation Server Migration Tool и проверит его коллекцию.
1. Contoso создаст набор подготовительных файлов, а затем выполнит переносной прогон для тестирования.
1. Затем специалисты Contoso выполнят другой перенос, на этот раз полный, включающий рабочие элементы, ошибки, спринты и код.
1. После миграции компания Contoso переместит свой код из TFVC в Git.

![Схема процесса миграции contoso.](./media/contoso-migration-tfs-vsts/migration-process.png)

## <a name="prerequisites"></a>Предварительные требования

Для выполнения этого сценария компания Contoso должна соответствовать следующим предварительным требованиям:

| Требования | Сведения |
| --- | --- |
| **Подписка Azure.** | Специалисты Contoso создали подписки ранее в этой серии статей. Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free). <br><br> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия. <br><br> Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника. <br><br> Если требуются более детализированные разрешения, см. раздел [Управление доступом Site Recovery с помощью управления доступом на основе ролей (RBAC)](/azure/site-recovery/site-recovery-role-based-linked-access-control). |
| **Инфраструктура Azure** | Компания Contoso настроила свою инфраструктуру Azure, как описано в разделе [инфраструктура Azure для миграции](./contoso-migration-infrastructure.md). |
| **Локальный экземпляр Team Foundation Server** | Локальный экземпляр должен либо запустить Team Foundation Server 2018 обновление 2, либо обновить до него в рамках этого процесса. |

## <a name="scenario-steps"></a>Шаги выполнения сценария

Миграция в Contoso будет осуществляться следующим образом:

> [!div class="checklist"]
>
> - **Шаг 1. Создание учетной записи хранения Azure**. Эта учетная запись хранения будет использоваться во время процесса миграции.
> - **Шаг 2. обновление Team Foundation Server**. Компания Contoso обновит свое развертывание до Team Foundation Server 2018 Upgrade 2.
> - **Шаг 3. Проверка коллекции Team Foundation Server**. Contoso проверит коллекцию Team Foundation Server в процессе подготовки к миграции.
> - **Шаг 4. Создание файлов миграции**. Contoso создаст файлы миграции с помощью средства Team Foundation Server Migration Tool.

## <a name="step-1-create-an-azure-storage-account"></a>Шаг 1. Создание учетной записи хранения Azure

1. В портал Azure администраторы Contoso создают учетную запись хранения ( `contosodevmigration` ).
1. Они размещают учетную запись в дополнительном регионе, который используется для отработки отказа ( `Central US` ). Они используют стандартную учетную запись общего назначения с локально избыточным хранилищем.

    ![Снимок экрана: панель "Создание учетной записи хранения".](./media/contoso-migration-tfs-vsts/storage1.png)

**Требуется дополнительная помощь?**

- [Общие сведения о службе хранилища Azure](/azure/storage/common/storage-introduction).
- [Создание учетной записи хранения](/azure/storage/common/storage-create-storage-account).

<!-- docsTest:casing "Server Configuration Wizard" "Configure Features Wizard" "Detach Team Project Collection Wizard" -->

## <a name="step-2-upgrade-team-foundation-server"></a>Шаг 2. Обновление Team Foundation Server

Администраторы Contoso обновляют экземпляр Team Foundation Server до Team Foundation Server 2018 с обновлением 2. Прежде чем они начнут, они:

- Загрузите [Team Foundation Server 2018 с обновлением 2](https://visualstudio.microsoft.com/downloads).
- Проверьте [требования к оборудованию](/azure/devops/server/requirements).
- Ознакомьтесь с [заметками о выпуске](/visualstudio/releasenotes/tfs2018-relnotes) и [обновлениями](/azure/devops/server/upgrade/get-started#before-you-upgrade-to-tfs-2018).

Они выполняют обновление следующим образом:

1. Для начала администратор создает резервную копию своего экземпляра Team Foundation Server, который работает на виртуальной машине VMware и принимает моментальный снимок VMware.

    ![Снимок экрана: панель "начало работы" для обновления Team Foundation Server.](./media/contoso-migration-tfs-vsts/upgrade1.png)

1. Запускается установщик Team Foundation Server и выбирается расположение установки. Установщику требуется доступ к Интернету.

    ![Снимок экрана с сайтом установки Team Foundation Server в Visual Studio.](./media/contoso-migration-tfs-vsts/upgrade2.png)

1. По завершении установки запустится мастер настройки сервера.

    ![Снимок экрана мастера настройки Team Foundation Server 2018 с обновлением 2.](./media/contoso-migration-tfs-vsts/upgrade3.png)

1. После проверки мастер настройки сервера завершает обновление.

     ![Снимок экрана: панель хода выполнения обновления мастера настройки Team Foundation Server.](./media/contoso-migration-tfs-vsts/upgrade4.png)

1. Администраторы проверяют установку Team Foundation Server путем просмотра проектов, рабочих элементов и кода.

     ![Снимок экрана: область "Невыполненная работа по продукту" для проверки установки Team Foundation Server.](./media/contoso-migration-tfs-vsts/upgrade5.png)

> [!NOTE]
> Некоторые Team Foundation Server обновления должны запустить мастер настройки компонентов после завершения обновления. [Подробнее.](/azure/devops/reference/configure-features-after-upgrade?utm_campaign=vstsdataimportguide&utm_medium=guide&utm_source=ms&view=vsts)

**Требуется дополнительная помощь?**

Дополнительные сведения об [обновлении Team Foundation Server](/azure/devops/server/upgrade/get-started).

## <a name="step-3-validate-the-team-foundation-server-collection"></a>Шаг 3. Проверка коллекции Team Foundation Server

Администраторы Contoso запускают средство миграции Team Foundation Server для `contosodev` базы данных коллекции, чтобы проверить ее перед миграцией.

1. Загрузите и распакуйте [средство Team Foundation Server Migration Tool](https://www.microsoft.com/download/details.aspx?id=54274). Важно скачать версию для Team Foundation Serverного обновления. Версию можно проверить в консоли администратора.

    ![Снимок экрана Team Foundation Server панели для проверки версии продукта.](./media/contoso-migration-tfs-vsts/collection1.png)

1. Они запускают средство для выполнения проверки, указывая URL-адрес коллекции проектов, как показано в следующей команде:

    `TfsMigrator validate /collection:http://contosotfs:8080/tfs/ContosoDev`

    В средстве отображается ошибка.

    ![Снимок экрана ошибки проверки в средстве миграции Team Foundation Server.](./media/contoso-migration-tfs-vsts/collection2.png)

1. Они находят файлы журнала в `Logs` папке непосредственно перед расположением средства. Файл журнала создается для каждой основной проверки. `TfsMigration.log` содержит основную информацию.

    ![Снимок экрана: расположение файла журнала в Team Foundation Server.](./media/contoso-migration-tfs-vsts/collection3.png)

1. Они находят эту запись, связанную с удостоверением.

    ![Снимок экрана, показывающий ошибку, обнаруженную при проверке удостоверения.](./media/contoso-migration-tfs-vsts/collection4.png)

1. Они выполняются `TfsMigrator validate /help` в командной строке и видят, что команда должна `/tenantDomainName` быть необходима для проверки подлинности.

     ![Снимок экрана, на котором показана команда, необходимая для проверки подлинности.](./media/contoso-migration-tfs-vsts/collection5.png)

1. Они снова выполняют команду проверки и включают это значение и их имя Azure AD `TfsMigrator validate /collection:http://contosotfs:8080/tfs/ContosoDev /tenantDomainName:contosomigration.onmicrosoft.com` .

    ![Снимок экрана командной строки с указанием правильной команды.](./media/contoso-migration-tfs-vsts/collection7.png)

1. В открывшемся окне входа в Azure AD введите учетные данные пользователя глобального администратора.

     ![Снимок экрана: окно входа в Azure AD с учетными данными администратора.](./media/contoso-migration-tfs-vsts/collection8.png)

1. Проверка пройдена и подтверждается средством.

    ![Снимок экрана, показывающий, что проверка пройдена.](./media/contoso-migration-tfs-vsts/collection9.png)

## <a name="step-4-build-the-migration-files"></a>Шаг 4. Создание файлов миграции

После завершения проверки администраторы Contoso могут использовать средство миграции Team Foundation Server для создания файлов миграции.

1. Они запускают этап подготовки в средстве.

    `TfsMigrator prepare /collection:http://contosotfs:8080/tfs/ContosoDev /tenantDomainName:contosomigration.onmicrosoft.com /accountRegion:cus`

     ![Снимок экрана команды подготовки в средстве миграции Team Foundation Server.](./media/contoso-migration-tfs-vsts/prep1.png)

    На этапе подготовки выполняется следующее.
    - Просматривает коллекцию, чтобы найти список всех пользователей, а затем заполняет журнал сопоставлений ( `IdentityMapLog.csv` ).
    - Подготавливает подключение к Azure AD, чтобы найти соответствие для каждого удостоверения.
    - Компания Contoso уже развернула Azure AD и синхронизирует ее с помощью Azure AD Connect, поэтому команда подготовки должна иметь возможность найти совпадающие удостоверения и пометить их как **Активные**.

1. Появится экран входа в Azure AD, и администраторы вводят учетные данные глобального администратора.

    ![Снимок экрана: окно входа в Azure AD с учетными данными администратора.](./media/contoso-migration-tfs-vsts/prep2.png)

1. Подготовка завершается, и средство сообщает о том, что файлы импорта успешно созданы.

    ![Снимок экрана средства миграции, показывающего, что проверка коллекции прошла успешно.](./media/contoso-migration-tfs-vsts/prep3.png)

1. Теперь администраторы могут видеть, что файл *IdentityMapLog.csv* и *import.js* в файле были созданы в новой папке.

    ![Подготовка](./media/contoso-migration-tfs-vsts/prep4.png)

1. `import.json`Файл содержит параметры импорта. Он содержит такие сведения, как имя нужной организации и сведения об учетной записи хранения. Большинство полей заполнены автоматически. Для некоторых полей требуется ввод данных пользователем. Администраторы открывают файл и добавляют имя создаваемой Azure DevOps Services организации `contosodevmigration` . С таким именем URL-адрес contoso Azure DevOps Services будет иметь значение `contosodevmigration.visualstudio.com` .

    ![Снимок экрана, показывающий Azure DevOps Services название организации.](./media/contoso-migration-tfs-vsts/prep5.png)

    > [!NOTE]
    > Перед началом миграции необходимо создать организацию. После завершения миграции его можно изменить.

1. Администраторы просматривают файл отображения журнала удостоверений, в котором отображаются учетные записи, которые будут перенесены в Azure DevOps Services во время импорта.

    - Активные идентификаторы станут пользователями в Azure DevOps Services после импорта.
    - В Azure DevOps Services эти удостоверения будут лицензированы и отображены в качестве пользователей в Организации после миграции.
    - Удостоверения помечаются как **Активные** в столбце **состояние импорта** в файле.

    ![Снимок экрана с файлом схемы журнала удостоверений, в котором показаны учетные записи, которые будут добавлены в Azure DevOps Services.](./media/contoso-migration-tfs-vsts/prep6.png)

## <a name="step-5-migrate-to-azure-devops-services"></a>Шаг 5. Миграция в Azure DevOps Services

После завершения подготовки администраторы Contoso могут сосредоточиться на миграции. После выполнения миграции они переключаются с использования TFVC в Git для управления версиями.

Прежде чем начать, администраторы запланируют время простоя с помощью команды разработчиков, чтобы они могли запланировать автономный сбор для миграции.

Ниже приведен процесс миграции.

1. **Отсоедините коллекцию**. Данные идентификации для коллекции размещаются в базе данных конфигурации для экземпляра Team Foundation Server, когда коллекция подключена и находится в сети.

    Когда коллекция отсоединяется от Team Foundation Server экземпляра, создается копия этих данных удостоверений, которая затем упаковывается в коллекцию для передачи. Без этих данных не удается выполнить часть идентификатора импорта.

    Мы рекомендуем отсоединить коллекцию до завершения импорта, так как изменения, происходящие во время импорта, не могут быть импортированы.

1. **Создайте резервную копию**. Следующим шагом является создание резервной копии, которую можно импортировать в Azure DevOps Services. Пакет компонентов приложения уровня данных (DACPAC) — это SQL Server функция, которая позволяет упаковывать изменения базы данных в один файл и затем развертываться в других экземплярах SQL.

    Резервную копию можно также восстановить непосредственно в Azure DevOps Services и использовать в качестве метода упаковки для получения данных коллекции в облако. Contoso будет использовать это `sqlpackage.exe` средство для создания пакета DACPAC. Это средство включено в средства SQL Server Data Tools.

1. **Отправка в хранилище**. После создания DACPAC администраторы передают его в службу хранилища Azure. После отправки они получают подписанный URL-адрес (SAS), чтобы разрешить средству миграции Team Foundation Server доступ к хранилищу.
1. **Заполните импорт**. Затем компания Contoso может завершить отсутствующие поля в файле импорта, включая параметр DACPAC. Чтобы убедиться, что все работает правильно перед полной миграцией, администраторы указали, что им нужно выполнить _процесс импорта сухой_ .
1. **Выполните импорт с помощью пробного выполнения**. Импорт с помощью пробного выполнения помогает им протестировать миграцию коллекции. В прогонах сухой действует ограниченный срок жизни, поэтому они удаляются до запуска рабочей миграции. Их данные автоматически удаляются через заданный период времени. Обратите внимание, что уведомляет Contoso о том, что в сообщении об успешном завершении процесса, отправленном после завершения импорта, содержится сообщение о том, что закончится его удаление. Команда берет Примечание и планируется соответствующим образом.
1. **Завершите рабочую миграцию**. При завершении миграции с сухой заработкой администратор Contoso выполняет окончательную миграцию, обновляя `import.json` файл, а затем снова выполняя импорт.

<!-- docsTest:casing "Team Foundation Server Administration Console" -->

### <a name="detach-the-collection"></a>Отключение коллекции

Перед отсоединением коллекции администраторы Contoso принимают локальную резервную копию экземпляра SQL Server и моментальный снимок VMware экземпляра Team Foundation Server.

1. В Консоль администрирования Team Foundation Server администраторы выбирают коллекцию, которую нужно отсоединить, **контосодев**.

    ![Снимок экрана с разделом "коллекции командных проектов" консоли администрирования Foundation Server.](./media/contoso-migration-tfs-vsts/migrate1.png)

1. На вкладке **Общие** выберите **отсоединить коллекцию**.

    ![Снимок экрана со ссылкой "Отсоединение коллекции" в консоли администрирования Foundation Server.](./media/contoso-migration-tfs-vsts/migrate2.png)

1. В мастере **отсоединения коллекции командных проектов** на панели **служебных сообщений** администраторы предоставляют сообщение для пользователей, которые могут попытаться подключиться к проектам в коллекции.

    ![Снимок экрана: панель "сообщение обслуживания" в мастере "отсоединить коллекцию командных проектов".](./media/contoso-migration-tfs-vsts/migrate3.png)

1. На панели « **ход отсоединения** » отслеживаются ход выполнения. По завершении процесса он наберет кнопку **Далее**.

    ![Снимок экрана: область "ход отсоединения" в мастере "Отсоединение коллекции командных проектов".](./media/contoso-migration-tfs-vsts/migrate5.png)

1. На панели **проверки готовности** после завершения проверок выберите **отсоединить**.

    ![Снимок экрана: область "проверки готовности" в мастере отсоединения коллекции командных проектов.](./media/contoso-migration-tfs-vsts/migrate4.png)

1. После того как коллекция успешно отсоединена, она наберет кнопку **Закрыть** , чтобы завершить работу.

    ![Снимок экрана с областью "завершено" в мастере "отсоединить коллекцию командных проектов".](./media/contoso-migration-tfs-vsts/migrate6.png)

    В Консоль администрирования Team Foundation Server больше не упоминается ссылка на коллекцию.

    ![Снимок экрана Консоль администрирования Team Foundation Server, показывающий, что коллекция больше не отображается.](./media/contoso-migration-tfs-vsts/migrate7.png)

### <a name="generate-a-dacpac"></a>Создание пакета DACPAC

Администраторы Contoso создают резервную копию или DACPAC-файлы для импорта в Azure DevOps Services.

- Администраторы используют `sqlpackage.exe` программу в SQL Server Data Tools (SSDT) для создания пакета DACPAC. Существует несколько версий `sqlpackage.exe` , установленных с SQL Server Data Tools, которые находятся в папках с такими именами, как `120` , `130` и `140` . Для подготовки DACPAC важно использовать правильную версию.

- Team Foundation Server 2018 Imports необходимо использовать *sqlpackage.exe* из папки *140* или выше. Для `CONTOSOTFS` этот файл находится в папке `C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\Common7\IDE\Extensions\Microsoft\SQLDB\DAC\140` .

Администраторы Contoso создают DACPAC следующим образом:

1. Они открывают командную строку и заходят в `sqlpackage.exe` расположение. Чтобы создать DACPAC, выполните следующую команду:

    `SqlPackage.exe /sourceconnectionstring:"Data Source=SQLSERVERNAME\INSTANCENAME;Initial Catalog=Tfs_ContosoDev;Integrated Security=True" /targetFile:C:\TFSMigrator\Tfs_ContosoDev.dacpac /action:extract /p:ExtractAllTableData=true /p:IgnoreUserLoginMappings=true /p:IgnorePermissions=true /p:Storage=Memory`

    ![Снимок экрана командной строки с командой для создания пакета DACPAC.](./media/contoso-migration-tfs-vsts/backup1.png)

    Отобразится следующее сообщение:

    ![Снимок экрана командной строки с сообщением о том, что база данных была успешно извлечена и сохранена в DACPAC-файле.](./media/contoso-migration-tfs-vsts/backup2.png)

1. Они проверяют свойства DACPAC файла.

    ![Снимок экрана, отображающий свойства файла DACPAC для проверки.](./media/contoso-migration-tfs-vsts/backup3.png)

### <a name="upload-the-file-to-storage"></a>Отправка файла в хранилище

После того как администраторы создают DACPAC, они передают их в учетную запись хранения Azure.

1. Они скачивают и устанавливают [Обозреватель службы хранилища Azure](https://azure.microsoft.com/features/storage-explorer).

    ![Снимок экрана: "скачать Обозреватель службы хранилища бесплатно".](./media/contoso-migration-tfs-vsts/backup5.png)

1. В Обозреватель службы хранилища администраторы подключаются к своей подписке, а затем выполняют поиск и выбирают учетную запись хранения, созданную для миграции ( `contosodevmigration` ). Они создают новый контейнер больших двоичных объектов, `azuredevopsmigration` .

    ![Снимок экрана: ссылка "создать контейнер больших двоичных объектов" в Обозреватель службы хранилища.](./media/contoso-migration-tfs-vsts/backup6.png)

1. В области **Передача файлов** в раскрывающемся списке **Тип большого двоичного объекта** администраторы указывают **блочный BLOB-объект** для передачи DACPAC-файла.

    ![Снимок экрана: панель "Передача файлов" в Обозреватель службы хранилища.](./media/contoso-migration-tfs-vsts/backup7.png)

1. После отправки файла он выбирает имя файла, а затем выберите **создать SAS**. Они расширяют список **контейнеров больших двоичных объектов** в учетной записи хранения, выбирают контейнер с файлами импорта, а затем выбирают команду **получить подпись общего доступа**.

    ![Снимок экрана со ссылкой "получение подписи общего доступа" в Обозреватель службы хранилища.](./media/contoso-migration-tfs-vsts/backup8.png)

1. В области **подписанный URL (общий доступ** ) они принимают параметры по умолчанию, а затем нажмите кнопку **создать**. Таким образом они получают доступ на 24 часа.

    ![Снимок экрана: область "подпись общего доступа" в Обозреватель службы хранилища.](./media/contoso-migration-tfs-vsts/backup9.png)

1. Они копируют URL-адрес подписи общего доступа, чтобы его можно было использовать в средстве миграции Team Foundation Server.

    ![Снимок экрана URL-адреса подписи общего доступа в Обозреватель службы хранилища.](./media/contoso-migration-tfs-vsts/backup10.png)

> [!NOTE]
> Миграция должна быть выполнена в течение допустимого периода времени, или срок действия разрешений истечет. *Не* Создавайте ключ SAS из портал Azure. Ключи, созданные на портале, задаются в области действия учетной записи и не будут работать с импортом.

### <a name="fill-in-the-import-settings"></a>Заполнение параметров импорта

Ранее администраторы Contoso полностью заполнили файл спецификации импорта, *import.jsна*. Теперь нужно добавить остальные параметры.

Они открывают *import.jsв* файле и заполнять следующие поля:

- **Расположение**. они вводят расположение созданного ранее ключа SAS.
- **DACPAC**: они ВВОДЯТ имя DACPAC файла, отправленного ранее в учетную запись хранения, убедившись, что включено расширение *DACPAC* .
- **ImportType**: теперь они вводят **дрирун** .

![Снимок экрана файла "import.js" с заполненными полями.](./media/contoso-migration-tfs-vsts/import1.png)

### <a name="perform-a-dry-run-migration"></a>Выполнение миграции на сухой основе

Администраторы Contoso выполняют перенос сухой, чтобы убедиться, что все работает правильно.

1. Они открывают командную строку, а затем заходят в `TfsMigrator` расположение ( `C:\TFSMigrator` ).
1. Они хотят убедиться, что файл отформатирован правильно и ключ SAS работает. Они проверяют файл импорта, выполнив следующую команду:

    `TfsMigrator import /importFile:C:\TFSMigrator\import.json /validateonly`

    Проверка возвращает ошибку, сообщающую, что ключ SAS нуждается в более длительном периоде до истечения срока его действия.

    ![Снимок экрана командной строки с отображением ошибки проверки.](./media/contoso-migration-tfs-vsts/test1.png)

1. Они используют Обозреватель службы хранилища Azure для создания нового ключа SAS с периодом до истечения срока действия семь дней.

    ![Снимок экрана: область Обозреватель службы хранилища "подписанный URL", в которой отображается дата окончания срока действия.](./media/contoso-migration-tfs-vsts/test2.png)

1. Они обновляют `import.json` файл и повторно выполняют команду. На этот раз проверка успешно завершена.

    `TfsMigrator import /importFile:C:\TFSMigrator\import.json /validateonly`

    ![Снимок экрана: Командная строка, отображающая сообщение "Проверка завершена успешно".](./media/contoso-migration-tfs-vsts/test3.png)

1. Они запускают пробное выполнение, выполнив следующую команду:

    `TfsMigrator import /importFile:C:\TFSMigrator\import.json`

    Появится сообщение с просьбой подтвердить, что они хотят продолжить миграцию. Обратите внимание на семь дней после выполнения сухой, в течение которого будут храниться промежуточные данные.

    ![Снимок экрана сообщения с запросом Contoso подтвердить, что он желает продолжить миграцию.](./media/contoso-migration-tfs-vsts/test4.png)

1. Откроется окно входа в Azure AD. Администраторы Contoso входят в Azure AD с разрешениями администратора.

    ![Снимок экрана: окно входа в Azure AD в Visual Studio.](./media/contoso-migration-tfs-vsts/test5.png)

    Появится сообщение с подтверждением успешного запуска импорта.

    ![Снимок экрана, показывающий, что импорт успешно запущен.](./media/contoso-migration-tfs-vsts/test6.png)

1. Через 15 минут администраторы переходят на веб-сайт и увидят следующие сведения:

     ![Снимок экрана, показывающий, что коллекция восстанавливается.](./media/contoso-migration-tfs-vsts/test7.png)

1. После завершения миграции ведущий специалист Contoso выполняет вход в Azure DevOps Services, чтобы убедиться в том, что пробное выполнение работало нормально. После проверки подлинности Azure DevOps Services необходимы некоторые сведения для подтверждения организации.

    ![Снимок экрана Azure DevOps Services окна, запрашивающего дополнительные сведения от группы Contoso.](./media/contoso-migration-tfs-vsts/test8.png)

    Руководитель разработки может видеть, что проекты успешно перенесены. Уведомление в верхней части страницы предупреждает о том, что учетная запись запуска сухой будет удалена через 15 дней.

    ![Снимок экрана интерфейса Azure DevOps Services с сообщением о том, что учетная запись запуска сухой будет удалена через 15 дней.](./media/contoso-migration-tfs-vsts/test9.png)

1. Руководитель dev открывает один из проектов, а затем выбирает **рабочие элементы**,  >  **назначенные мне**. На этой странице проверяется успешность переноса данных рабочих элементов вместе с удостоверением.

    ![Снимок экрана Azure DevOps Services панели "рабочие элементы" с отображением всех перенесенных проектов.](./media/contoso-migration-tfs-vsts/test10.png)

1. Чтобы убедиться в том, что исходный код и журнал были перенесены, руководитель разработки проверяет другие проекты и код.

    ![Снимок экрана Azure DevOps Services области "журнал", показывающей, что весь код и журнал были перенесены.](./media/contoso-migration-tfs-vsts/test11.png)

### <a name="run-the-production-migration"></a>Выполнение миграции рабочей среды

Теперь, когда пробное выполнение завершено, администраторы Contoso переходят на рабочую миграцию. Они удаляют данные пробного выполнения, обновляют параметры импорта и снова запускают импорт.

1. На портале Azure DevOps Services они удаляют организацию, которая будет выполняться сухой.
1. Они обновляют `import.json` файл, чтобы установить для **ImportType** значение **продуктионрун**.

    ![Снимок экрана портала Azure DevOps Services с полем ImportType, для которого задано значение Продуктионрун.](./media/contoso-migration-tfs-vsts/full1.png)

1. Как и в случае с сухой загрузкой, они начинают миграцию, выполнив следующую команду:

    `TfsMigrator import /importFile:C:\TFSMigrator\import.json`.

    Появится сообщение, предлагающее администраторам подтвердить миграцию. Она предупреждает о том, что данные могут храниться в безопасном месте в виде промежуточной области до семи дней.

    ![Снимок экрана Azure DevOps Services сообщения с предупреждением о том, что перенесенные данные могут храниться не более семи дней.](./media/contoso-migration-tfs-vsts/full2.png)

1. В окне входа в Azure AD укажите вход администратора Contoso.

    ![Снимок экрана: окно входа в Azure AD в Visual Studio.](./media/contoso-migration-tfs-vsts/full3.png)

    Появится сообщение о том, что импорт успешно запущен.

    ![Снимок экрана Azure DevOps Services сообщения о том, что импорт был успешно запущен.](./media/contoso-migration-tfs-vsts/full4.png)

1. Через 15 минут администраторы переходят на веб-сайт и увидят следующие сведения:

    ![Снимок экрана, показывающий, что данные копируются в облако.](./media/contoso-migration-tfs-vsts/full5.png)

1. После завершения миграции руководитель разработчика подписывается на Azure DevOps Services, чтобы убедиться в том, что миграция работала правильно. После входа руководитель разработки может видеть, что проекты были перенесены.

    ![Снимок экрана, показывающий, что проекты были перенесены.](./media/contoso-migration-tfs-vsts/full6.png)

1. Руководитель dev открывает один из проектов и выбирает **рабочие элементы**,  >  **назначенные мне**. Это показывает, что данные рабочего элемента были перенесены вместе с удостоверением.

    ![Снимок экрана, показывающий, что данные и удостоверение рабочего элемента были перенесены.](./media/contoso-migration-tfs-vsts/full7.png)

1. Руководитель разработки проверяет, перенесены ли другие данные рабочих элементов.

    ![Снимок экрана с перечнем дополнительных данных рабочего элемента для подтверждения.](./media/contoso-migration-tfs-vsts/full8.png)

1. Чтобы убедиться в том, что исходный код и журнал были перенесены, руководитель разработки проверяет другие проекты и код.

    ![Снимок экрана с перечнем дополнительного переноса проекта и исходного кода для подтверждения.](./media/contoso-migration-tfs-vsts/full9.png)

### <a name="move-source-control-from-tfvc-to-git"></a>Перемещение системы управления версиями из TFVC в Git

После завершения миграции администраторы компании Contoso хотят переместить управление исходным кодом из TFVC в Git. Администраторы должны импортировать исходный код, который в настоящее время находится в своей Azure DevOps Services Организации, как git репозиториев в той же организации.

1. На портале Azure DevOps Services они открывают один из репозиториевов TFVC, `$/PolicyConnect` и изучите его.

    ![Снимок экрана репозитория "$/Полициконнект" на портале Azure DevOps Services.](./media/contoso-migration-tfs-vsts/git1.png)

1. В раскрывающемся списке Источник **$/полициконнект** выберите **Импорт репозитория**.

    ![Снимок экрана со ссылкой "Импорт репозитория" на портале Azure DevOps Services.](./media/contoso-migration-tfs-vsts/git2.png)

1. В раскрывающемся списке **тип источника** выберите **TFVC**. В поле **путь** укажите путь к репозиторию, а затем выберите **Импорт**. Они решили оставить флажок " **Журнал миграции** " снятым.

    ![Снимок экрана: панель "Импорт из TFVC".](./media/contoso-migration-tfs-vsts/git3.png)

    > [!NOTE]
    > Так как сведения о системе управления версиями хранилища TFVC и Git по-разному не рекомендуются, Корпорация Contoso рекомендует *не* переносить журнал своего репозитория. Это подход, который корпорация Майкрософт предпринимает при переносе Windows и других продуктов из централизованного управления версиями в Git.

1. После завершения импорта администраторы просматривают код.

    ![Снимок экрана с подтверждением успешного завершения импорта.](./media/contoso-migration-tfs-vsts/git4.png)

1. Они повторяют процесс для второго репозитория `$/smarthotelcontainer` .

    ![Снимок экрана с панелью "Импорт из TFVC" для второго репозитория.](./media/contoso-migration-tfs-vsts/git5.png)

1. После того, как руководитель разработчика проверит источник, он согласен, что миграция на Azure DevOps Services выполнена. Azure DevOps Services теперь становится источником для всех этапов разработки в группах, участвующих в миграции.

    ![Снимок экрана, показывающий, что миграция на Azure DevOps Services завершена.](./media/contoso-migration-tfs-vsts/git6.png)

**Требуется дополнительная помощь?**

Дополнительные сведения см. [в статье Импорт репозиториев из TFVC в Git](/azure/devops/repos/git/import-from-TFVC?view=vsts).

## <a name="clean-up-after-migration"></a>Очистка после миграции

После завершения миграции группе Contoso необходимо выполнить следующие действия:

- Ознакомиться со сведениями о дополнительных операциях [после импорта](/azure/devops/articles/migration-post-import?view=vsts).
- Либо удалите TFVC репозиториев, либо поместите их в режиме только для чтения. Не следует использовать основанные на коде базы кода, но на них можно ссылаться в журнале.

## <a name="post-migration-training"></a>Обучение после переноса данных

Группе Contoso потребуется предоставить Azure DevOps Services и обучение Git для соответствующих участников команды.
