---
title: Миграция баз данных MariaDB в Azure
description: Узнайте, как компания Contoso перенеса свои локальные базы данных MariaDB в Azure.
author: deltadan
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.openlocfilehash: 650b41a6f27c4343422f0d185f2f3255b5f7a42d
ms.sourcegitcommit: 8b82889dca0091f3cc64116f998a3a878943c6a1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/09/2020
ms.locfileid: "89605028"
---
<!-- cSpell:ignore  mysqldump Navicat phpMyAdmin -->

# <a name="migrate-mariadb-databases-to-azure"></a>Миграция баз данных MariaDB в Azure

В этой статье показано, как вымышленная компания Contoso планирует и перенеса свою локальную платформу базы данных MariaDB с открытым кодом в Azure.

Contoso использует MariaDB вместо MySQL из-за:

- Множество ядер хранилища.
- Производительность кэша и индекса.
- Поддержка открытого кода с функциями и расширениями.
- Поддержка аналитики ColumnStore.

Цель миграции компании — продолжить использовать MariaDB, но не беспокоиться об управлении средой, необходимой для ее поддержки.

## <a name="business-drivers"></a>Бизнес-факторы

Группа специалистов по ИТ тесно работала с бизнес-партнерами, чтобы понять, что они хотят достичь при миграции. Они хотят:

- **Повышение доступности.** Компания Contoso получила проблемы с доступностью к локальной среде MariaDB. Для бизнеса требуются более надежные приложения, использующие это хранилище данных.
- **Повышение эффективности.** Компании Contoso необходимо удалить ненужные процедуры и упростить процессы для разработчиков и пользователей. Бизнес требует, чтобы он был быстрым и не тратит время или деньги, чтобы ускорить выполнение требований клиентов.
- **Повышение гибкости.** ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Он должен реагировать быстрее, чем изменения в Marketplace, чтобы обеспечить успешную работу в глобальной экономике. ИТ-не должныся как или стать заблокированным.
- **Измените.** По мере успешного развития бизнеса компания Contoso должна предоставлять системы, которые увеличиваются в том же темпе.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции. Эти цели использовались для определения оптимального метода миграции.

| Требования | Сведения |
| --- | --- |
| **Доступность** | В настоящее время внутренний персонал имеет Нежесткое время в среде размещения для экземпляра MariaDB. Компания Contoso хочет получить доступ к 99,99% уровня базы данных. |
| **Масштабируемость** | Недостаточная емкость локального узла базы данных. Компании Contoso требуется способ масштабировать свои экземпляры за последние ограничения или уменьшать масштаб, если бизнес-среда изменяется для экономии затрат. |
| **Производительность** | Отдел кадров компании Contoso имеет несколько отчетов, которые он выполняет на ежедневной, еженедельной и ежемесячной основе. При выполнении этих отчетов они заметят значительные проблемы с производительностью приложения, доступного для сотрудников. Он должен запускать отчеты, не влияя на производительность приложения. |
| **Безопасность** | Contoso должен быть уверен, что база данных доступна только для внутренних приложений и недоступна или не доступна через Интернет. |
| **Мониторинг** | В настоящее время компания Contoso использует средства для мониторинга метрик базы данных MariaDB и предоставления уведомлений при возникновении проблем с ЦП, памятью или хранилищем. Компания должна иметь такую же возможность в Azure. |
| **Непрерывность бизнес-процессов** | Хранилище данных HR является важной частью ежедневных операций contoso. Если она повреждена или ее требуется восстановить, компания хочет сократить время простоя. |
| **Azure** | Компания Contoso хочет переместить приложение в Azure, не запуская его на виртуальных машинах. Требования Contoso к использованию служб платформы Azure как услуги (PaaS) для уровня данных. |

## <a name="solution-design"></a>Архитектура решения

После фиксации целей и требований компания Contoso проектирует и изучает решение для развертывания и определяет процесс миграции. Также определяются средства и службы, которые будут использоваться для миграции.

### <a name="current-application"></a>Текущее приложение

В базе данных MariaDB размещаются данные о сотрудниках, используемые для всех аспектов отдела кадров компании. В качестве внешнего интерфейса для обработки запросов сотрудников отдела кадров используется приложение [на основе лампы](https://wikipedia.org/wiki/LAMP_(software_bundle)) . Компания Contoso имеет 100 000 сотрудников по всему миру, поэтому для своих баз данных важно время простоя.

### <a name="proposed-solution"></a>Предлагаемое решение

- Оцените среды для совместимости с миграцией.
- Используйте общие средства с открытым кодом для переноса баз данных в экземпляр базы данных Azure для MariaDB.
- Измените все приложения и процессы, чтобы они использовали новый экземпляр базы данных Azure для MariaDB.

### <a name="database-considerations"></a>Рекомендации по базе данных

В рамках процесса разработки решения компания Contoso проверила возможности в Azure для размещения своих баз данных MariaDB. Следующие рекомендации помогли компании принять решение об использовании Azure.

- Как и база данных SQL Azure, база данных Azure для MariaDB позволяет создавать [правила брандмауэра](/azure/mariadb/concepts-firewall-rules).
- Базу данных Azure для MariaDB можно использовать с [виртуальной сетью Azure](/azure/mariadb/concepts-data-access-security-vnet) , чтобы запретить доступ к экземпляру.
- Служба "база данных Azure для MariaDB" имеет необходимые сертификаты соответствия требованиям и конфиденциальности, которые должны соответствовать компании Contoso для аудиторов.
- Производительность отчетов и обработки приложений будет улучшена с помощью считывания реплик.
- Возможность предоставлять доступ к службе только для внутреннего сетевого трафика (без общего доступа) с помощью [частной связи Azure](/azure/mariadb/concepts-data-access-security-private-link).
- Компания Contoso решила не переходить на базу данных Azure для MySQL, так как в будущем она ищет потенциально использование MariaDB ColumnStore и модели базы данных Графдбмс.
- [Пропускная способность и задержка](/azure/vpn-gateway/vpn-gateway-about-vpngateways) от приложения к базе данных достаточно достаточны на основе выбранного шлюза (Azure ExpressRoute или VPN типа "сеть — сеть").

### <a name="solution-review"></a>Проверка решения

Специалисты Contoso оценивают предлагаемый дизайн, составляя список плюсов и минусов.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Служба "база данных Azure для MariaDB" предлагает соглашение об уровне обслуживания с финансовыми гарантиями на 99,99% для обеспечения [высокого уровня доступности](/azure/mariadb/concepts-high-availability). <br><br> Azure предлагает возможность увеличения или уменьшения масштаба в течение пиковых нагрузок в каждом квартале. Компания Contoso может сэкономить еще больше, приобретя [зарезервированную емкость](/azure/mariadb/concept-reserved-pricing). <br><br> Azure предоставляет возможности восстановления на момент времени и геовосстановление для базы данных Azure для MariaDB. <br><br> |
| **Недостатки** | Компания Contoso ограничена версиями выпуска MariaDB, которые поддерживаются в Azure, в настоящее время 10,2 и 10,3. <br><br> У базы данных Azure для MariaDB есть некоторые [ограничения](/azure/mariadb/concepts-limits), например масштабирование хранилища. |

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![На схеме показана архитектура сценария. ](./media/contoso-migration-mariadb-to-azure/architecture.png)
 _Рис. 1. Архитектура сценария._

### <a name="migration-process"></a>Процесс миграции

#### <a name="preparation"></a>Подготовка

Прежде чем можно будет перенести базы данных MariaDB, необходимо убедиться, что эти экземпляры соответствуют всем предварительным требованиям Azure для успешной миграции.

Поддерживаемые версии:

- MariaDB использует схему именования x. y. z. Например, x — основная версия, y — дополнительный номер версии, а z — версия исправления.
- Сейчас Azure поддерживает 10.2.25 и 10.3.16.
- Azure автоматически управляет обновлениями для обновлений исправлений. Примеры — 10.2.21 10.2.23. Дополнительные и основные обновления версий не поддерживаются. Например, обновление с версии MariaDB 10.2 до MariaDB 10.3 не поддерживается. Если вы хотите выполнить обновление с 10,2 до 10,3, сделайте дамп базы данных и восстановите его на сервере, созданном с использованием целевой версии подсистемы.

Сеть:

Contoso необходимо настроить подключение шлюза виртуальной сети из локальной среды к виртуальной сети, в которой находится база данных MariaDB. Это подключение позволяет локальному приложению получать доступ к базе данных через шлюз при обновлении строк подключения.

  ![На схеме показан процесс миграции.](./media/contoso-migration-mariadb-to-azure/migration-process.png)
  _Рис. 2. процесс миграции._

#### <a name="migration"></a>Миграция

Так как MariaDB похож на MySQL, Contoso может использовать те же самые распространенные служебные программы и средства, как MySQL Workbench, mysqldump, Toad или Navicat, для подключения и переноса данных в базу данных Azure для MariaDB.

Для переноса баз данных компания Contoso использовала следующие шаги.

- Определите локальную версию MariaDB, выполнив следующие команды и просматривая выходные данные. В большинстве случаев ваша версия не имеет большого значения для схемы и дампа данных. Если вы используете функции на уровне приложения, убедитесь, что эти приложения совместимы с целевой версией в Azure.

  ```cmd
    mysql -h localhost -u root -P
  ```

  ![На снимке экрана показано, как определить локальную версию MariaDB. ](./media/contoso-migration-mariadb-to-azure/mariadb_version.png)
   _Рис. 3. Определение локальной версии MariaDB._

- Создайте новый экземпляр MariaDB в Azure:

  - Откройте [портал Azure](https://portal.azure.com).
  - Выберите **Добавить ресурс**.
  - Найдите `MariaDB`.

    ![На снимке экрана показан новый экземпляр MariaDB в Azure. ](./media/contoso-migration-mariadb-to-azure/azure-mariadb-create.png)
     _Рис. 4. новый экземпляр MariaDB в Azure._

  - Нажмите кнопку **создания**.
  - Выберите подписку и группу ресурсов.
  - Выберите имя и расположение сервера.
  - Выберите целевую версию (10,2 или 10,3).
  - Выберите ресурсы для вычислений и хранилища.
  - Введите имя пользователя и пароль администратора.
  - Выберите **Review + create** (Просмотреть и создать).

    ![На снимке экрана показан экран Создание сервера MariaDB. ](./media/contoso-migration-mariadb-to-azure/azure_mariadb_create.png)
     _Рис. 5. Проверка и создание._

  - Нажмите кнопку **создания**.
  - Запишите имя узла, имя пользователя и пароль сервера.
  - Выберите **Безопасность подключения**.
  - Выберите **Добавить IP-адрес клиента** (IP-адрес, с которого будет восстанавливаться база данных).
  - Щелкните **Сохранить**.

- Выполните следующие команды, чтобы экспортировать базу данных с именем `Employees` . Повторите эти действия для каждой базы данных:

    ```cmd
    mysqldump -h localhost -u root -p -–skip-triggers -–single-transaction –-extended-insert -–order-by-primary -–disable-keys Employees > Employees.sql
    ```

- восстановить базу данных. Замените на конечную точку для экземпляра базы данных Azure для MariaDB и имя пользователя:

  ```cmd
  mysql -h {name}.mariadb.database.azure.com -u user@{name} -p –ssl
  create database employees;
  use database employees;
  source employees.sql;
  ```

- Используйте phpMyAdmin или аналогичное средство, например MySQL Workbench, Toad и Navicat, для проверки восстановления путем проверки счетчиков записей в каждой таблице.
- Обновите все строки подключения приложения, чтобы они указывали на перенесенную базу данных.
- Протестируйте все приложения для правильной работы.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После проверенной успешной миграции Contoso необходимо выполнить резервное копирование и сохранить локальные файлы резервной копии базы данных для хранения. Снимите с учета локальный сервер MariaDB.

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда выполняется миграция ресурсов в Azure, компании Contoso необходимо полностью ввести в эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

Компания Contoso должна:

- Убедитесь, что его новая база данных Azure для экземпляра MariaDB и базы данных защищены. Дополнительные сведения см. [в статье безопасность в базе данных Azure для MariaDB](/azure/mariadb/concepts-security).
- Проверьте [правила брандмауэра](/azure/mariadb/concepts-firewall-rules) и конфигурации виртуальной сети, чтобы убедиться, что подключения ограничены только приложениями, которые им требуются.
- Настройте любые исходящие требования IP-адресов, чтобы разрешить подключения к [IP-адресам шлюза](/azure/mariadb/concepts-connectivity-architecture)MariaDB.
- Обновите все приложения, чтобы они [затребовали SSL](/azure/mariadb/concepts-ssl-connection-security) -соединения с базами данных.
- Настройте [частную ссылку](/azure/mariadb/concepts-data-access-security-private-link) , чтобы весь трафик базы данных хранился в Azure и локальной сети.
- Включите [Azure Advanced Threat protection (ATP)](/azure/mariadb/concepts-data-access-and-security-threat-protection).
- Настройка Log Analytics для отслеживания и отправки оповещений о безопасности и важных записях журнала.

### <a name="backups"></a>Резервные копии

Убедитесь, что резервное копирование баз данных Azure для баз данных MariaDB выполняется с помощью геовосстановления. Таким образом, резервные копии можно использовать в парном регионе, если происходит региональный сбой.

> [!IMPORTANT]
> Убедитесь, что ресурс "база данных Azure для MariaDB" имеет [блокировку ресурсов](/azure/azure-resource-manager/management/lock-resources) , чтобы предотвратить удаление. Невозможно восстановить удаленные серверы.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- Можно масштабировать базу данных Azure для MariaDB. Наблюдение за производительностью сервера и баз данных важно, чтобы обеспечить соответствие вашим потребностям, а также свести к минимуму затраты.
- Ресурсы ЦП и хранилища связаны с затратами. Для выбора доступны несколько ценовых категорий. Убедитесь, что для рабочих нагрузок данных выбран соответствующий ценовой план.
- Счета за каждую реплику чтения выставляются на основе выбранных вычислений и хранилища.
- Используйте зарезервированную емкость, чтобы сэкономить на затратах.

## <a name="conclusion"></a>Заключение

В этой статье компания Contoso перенеса свои базы данных MariaDB в экземпляр базы данных Azure для MariaDB.
