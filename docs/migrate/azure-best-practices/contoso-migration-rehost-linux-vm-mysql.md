---
title: Повторное размещение локального приложения Linux на виртуальных машинах Azure и базе данных Azure для MySQL
description: Узнайте, как компания Contoso повторно размещает приложение Linux, перенеся его на виртуальные машины Azure и в Базу данных Azure для MySQL.
author: givenscj
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: d5c511d1e32ae57679157a2baf28efc75a7cb4c3
ms.sourcegitcommit: bcc73d194c6d00c16ae2e3c7fb2453ac7dbf2526
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86192255"
---
<!-- cSpell:ignore givenscj OSTICKETWEB OSTICKETMYSQL contosohost vcenter contosodc contosoosticket osticket InnoDB binlog systemctl NSGs -->

# <a name="rehost-an-on-premises-linux-application-to-azure-vms-and-azure-database-for-mysql"></a>Повторное размещение локального приложения Linux на виртуальных машинах Azure и базе данных Azure для MySQL

В этой статье показано, как вымышленная компания Contoso выполняет повторное размещение трехуровневого приложения на [основе лампы](https://wikipedia.org/wiki/LAMP_(software_bundle)) , перенося его из локальной среды в Azure с помощью виртуальных машин Azure и базы данных Azure для MySQL.

Остиккет, используемое в этом примере приложение службы поддержки, предоставляется в виде открытого кода. Если вы хотите использовать его для тестирования, то можете скачать это приложение с сайта [GitHub](https://github.com/osTicket/osTicket).

## <a name="business-drivers"></a>Бизнес-факторы

Группа специалистов по ИТ тесно работала с бизнес-партнерами, чтобы понять, что они хотят достичь:

- **Устраните бизнес-рост.** По мере развития компании Contoso растет нагрузка на локальные системы и инфраструктуру.
- **Ограничение риска.** Приложение службы поддержки является критически важным для бизнеса. Поэтому компания Contoso хочет переместить его в Azure с минимальными рисками.
- **Расширений.** Contoso не хочет изменять приложение прямо сейчас. Он просто хочет, чтобы приложение было стабильным.

## <a name="migration-goals"></a>Цели миграции

Для определения наилучшего способа миграции команда Contoso по работе в облаке определила ее цели.

- После миграции приложение в Azure должно иметь те же возможности производительности, что и сегодня в локальной среде VMware. Приложение будет оставаться критически важным в облаке, как и локально.
- Компания Contoso не хочет вкладываться в это приложение. Оно очень важно для бизнеса, но компании просто нужно безопасно переместить его в облако в его текущей форме.
- Если вы выполнили несколько миграций приложений Windows, компания Contoso хочет узнать, как использовать инфраструктуру на основе Linux в Azure.
- Компании необходимо свести к минимуму задачи администрирования баз данных после переноса приложения в облако.

## <a name="proposed-architecture"></a>Предлагаемая архитектура

В этом сценарии:

- В настоящее время приложение распределено между двумя виртуальными машинами ( `OSTICKETWEB` и `OSTICKETMYSQL` ).
- Виртуальные машины расположены на узле VMware ESXi `contosohost1.contoso.com` (версии 6.5).
- Среда VMware находится под управлением сервера vCenter Server 6.5 (`vcenter.contoso.com`), запущенного на виртуальной машине.
- Компания Contoso использует локальный центр обработки данных (`contoso-datacenter`) с локальным контроллером домена (`contosodc1`).
- Веб-приложение в `OSTICKETWEB` будет перенесено на виртуальную машину Azure IaaS.
- База данных приложения будет перенесена в службу PaaS базы данных Azure для MySQL.
- Так как миграция в компании Contoso выполняется для рабочей нагрузки в рабочей среде, ресурсы будут находиться в рабочей группе ресурсов `ContosoRG`.
- `OSTICKETWEB`Ресурс будет реплицирован в основной регион (Восточная часть США 2) и помещен в производственную сеть ( `VNET-PROD-EUS2` ):
  - Виртуальная машина веб-уровня будет находиться в интерфейсной подсети (`PROD-FE-EUS2`).
- База данных приложения будет перенесена в базу данных Azure для MySQL с помощью [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).
- После завершения миграции локальные виртуальные машины в центре обработки данных Contoso будут выведены из эксплуатации.

    ![Архитектура сценария](./media/contoso-migration-rehost-linux-vm-mysql/architecture.png)

## <a name="migration-process"></a>Процесс миграции

Порядок миграции в Contoso будет следующим:

Миграция виртуальной машины веб-уровня

- В качестве первого шага компания Contoso настраивает Azure и локальную инфраструктуру, необходимую для развертывания службы "миграция Azure".
- У них уже есть [инфраструктура Azure](./contoso-migration-infrastructure.md) , поэтому Contoso нужно только добавить и настроить репликацию виртуальных машин с помощью средства миграции Azure: сервер.
- Когда все подготовлено, компания Contoso может начать репликацию виртуальной машины.
- После включения и работы репликации компания Contoso завершит перемещение с помощью службы "миграция Azure".

Миграция базы данных

1. Contoso подготовит экземпляр MySQL в Azure.
2. Компания Contoso настраивает Azure Database Migration Service, обеспечивая доступ к локальному серверу базы данных.
3. Компания Contoso переносит базу данных в базу данных Azure для MySQL.

    ![Процесс миграции](./media/contoso-migration-rehost-linux-vm-mysql/migration-process.png)

### <a name="azure-services"></a>Службы Azure

| Служба | Описание | Стоимость |
| --- | --- | --- |
| [Миграция Azure](https://docs.microsoft.com/azure/migrate/migrate-services-overview) | Компания Contoso использует службу "Миграция Azure" для оценки виртуальных машин VMware. Служба "Миграция Azure" оценивает миграционную пригодность компьютеров. Она обеспечивает оценку размера и стоимости для работы в Azure. | Служба " [Миграция Azure](https://azure.microsoft.com/pricing/details/azure-migrate) " доступна без дополнительной платы. Однако оплата может взиматься в зависимости от средств (первой стороны или ISV), которые вы решили использовать для оценки и миграции. |
| [Миграция баз данных Azure](https://docs.microsoft.com/azure/dms/dms-overview) | Azure Database Migration Service обеспечивает простой перенос из нескольких источников базы данных в платформы данных Azure с минимальным временем простоя. | Узнайте о [поддерживаемых регионах](https://docs.microsoft.com/azure/dms/dms-overview#regional-availability) и [ценах на Azure Database Migration Service](https://azure.microsoft.com/pricing/details/database-migration). |
| [База данных Azure для MySQL](https://docs.microsoft.com/azure/mysql) | База данных основана на ядре СУБД MySQL с открытым исходным кодом. Она предоставляет полностью управляемую корпоративную базу данных MySQL, готовую для разработки и развертывания приложений. | Узнайте больше о [ценах](https://azure.microsoft.com/pricing/details/mysql) и параметрах масштабируемости базы данных Azure для MySQL. |

## <a name="prerequisites"></a>Предварительные требования

Ниже приведены действия компании Contoso, необходимые для этого сценария.

| Требования | Сведения |
| --- | --- |
| **Подписка Azure.** | Компания Contoso уже создала подписки (это описывается в одной из предыдущих статей этой серии). Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free). <br><br> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия. <br><br> Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника. <br><br> Если вам требуются более детализированные разрешения, ознакомьтесь с [этой статьей](https://docs.microsoft.com/azure/site-recovery/site-recovery-role-based-linked-access-control). |
| **Инфраструктура Azure** | Компания Contoso настраивает инфраструктуру Azure, как описано в статье [Развертывание инфраструктуры Azure для миграции в Contoso](./contoso-migration-infrastructure.md). |
| **Локальные серверы** | Локальная vCenter Server должна работать под управлением версии 5,5, 6,0, 6,5 или 6,7. <br><br> Узел ESXi с версией 5,5, 6,0, 6,5 или 6,7. <br><br> Одна или несколько виртуальных машин VMware, которые выполняются на узле ESXi. |
| **Локальные виртуальные машины** | [Ознакомьтесь со списком виртуальных машин Linux](https://docs.microsoft.com/azure/virtual-machines/linux/endorsed-distros), которые рекомендованы к использованию в Azure. |

## <a name="scenario-steps"></a>Шаги выполнения сценария

Администраторы компании Contoso будут осуществлять миграцию следующим образом:

> [!div class="checklist"]
>
> - **Шаг 1. Подготовка Azure для миграции Azure: миграция сервера.** Они добавляют средство миграции сервера в проект службы "миграция Azure".
> - **Шаг 2. Подготовка локальной среды VMware для миграции в Azure: миграция сервера.** Они подготавливают учетные записи для обнаружения ВМ и подготавливают подключение к виртуальной машине Azure после переноса.
> - **Шаг 3. репликация виртуальных машин.** Они настроили репликацию и начинают репликацию виртуальных машин в службу хранилища Azure.
> - **Шаг 4. Миграция виртуальной машины приложения с помощью службы "миграция Azure": миграция сервера.** Они выполняют тестовую миграцию, чтобы убедиться, что все работает, а затем выполните полную миграцию, чтобы переместить виртуальную машину в Azure.
> - **Шаг 5. Перенос базы данных.** Они настроили миграцию с помощью Azure Database Migration Service.

## <a name="step-1-prepare-azure-for-the-azure-migrate-server-migration-tool"></a>Шаг 1. Подготовка Azure к работе с миграцией Azure: средство миграции сервера

Ниже перечислены компоненты Azure, которые необходимы для миграции виртуальных машин компании Contoso в Azure.

- Виртуальная сеть, в которой будут находиться виртуальные машины Azure при их создании во время миграции.
- Подготовка и Настройка средства миграции сервера Azure (OVA).

Специалисты компании Contoso настроили их указанным ниже образом.

1. Настройка сети — Contoso уже настроена сеть, которая может быть для службы "миграция Azure": миграция сервера при [развертывании инфраструктуры Azure](./contoso-migration-infrastructure.md)

2. Выполните подготовку к работе средства миграции Azure: Server Migration Tool.

    - В службе "миграция Azure" Скачайте образ OVA и импортируйте его в VMware.

        ![Скачивание файла OVA](./media/contoso-migration-rehost-vm/migration-download-ova.png)

    - Запустите импортированное изображение и настройте средство, включая следующие шаги:

      - Настройте необходимые компоненты.

        ![Настройка средства](./media/contoso-migration-rehost-vm/migration-setup-prerequisites.png)

      - Наведите указатель на инструмент на подписку Azure.

        ![Настройка средства](./media/contoso-migration-rehost-vm/migration-register-azure.png)

      - Задайте учетные данные VMware vCenter.

        ![Настройка средства](./media/contoso-migration-rehost-vm/migration-vcenter-server.png)

      - Добавьте все учетные данные на основе Linux для обнаружения.

        ![Настройка средства](./media/contoso-migration-rehost-vm/migration-credentials.png)

3. После настройки для этого средства потребуется некоторое время для перечисления всех виртуальных машин. После завершения вы увидите, что они заполняются в средстве миграции Azure в Azure.

**Требуется дополнительная помощь?**

Дополнительные сведения о настройке [средства миграции Azure: Server Migration Tool](https://docs.microsoft.com/azure/migrate/migrate-services-overview#azure-migrate-server-migration-tool).

## <a name="step-2-prepare-on-premises-vmware-for-azure-migrate-server-migration"></a>Шаг 2. Подготовка локальной среды VMware для миграции Azure: миграция сервера

После миграции в Azure компания Contoso хочет иметь возможность подключиться к реплицированным виртуальным машинам в Azure. Для этого администраторы Contoso должны предпринять ряд действий.

- Чтобы получить доступ к виртуальной машине Azure, перед миграцией включите SSH на локальной виртуальной машине Linux. Для Ubuntu это можно выполнить с помощью следующей команды: `sudo apt-get ssh install -y` .

- После выполнения миграции они могут проверить **диагностику загрузки** , чтобы просмотреть снимок экрана виртуальной машины.

- Если не удается сделать это, необходимо проверить, работает ли виртуальная машина, и изучить [советы по устранению неполадок](https://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).

- Установите [Агент Linux для Azure](https://docs.microsoft.com/azure/virtual-machines/extensions/agent-linux).

**Требуется дополнительная помощь?**

- Дополнительные сведения о [подготовке виртуальных машин к миграции](https://docs.microsoft.com/azure/migrate/prepare-for-migration).

## <a name="step-3-replicate-vm"></a>Шаг 3. репликация виртуальной машины

Чтобы можно было запустить миграцию в Azure, администраторам компании Contoso потребуется настроить и включить репликацию.

После завершения обнаружения они могут начать репликацию виртуальной машины приложения в Azure.

1. В проекте "миграция Azure" > " **серверы**  >  **Azure: миграция сервера"** выберите **репликация**.

    ![Репликация виртуальных машин](./media/contoso-migration-rehost-linux-vm/select-replicate.png)

2. В разделе Параметры **репликации**  >  **источника**  >  **виртуальные машины виртуализированы?** выберите **Да, с VMware vSphere**.

3. В разделе **Локальное устройство** выберите имя устройства Миграции Azure, которое вы настроили, и нажмите кнопку **ОК**.

    ![Параметры источника](./media/contoso-migration-rehost-linux-vm/source-settings.png)

4. В разделе **Виртуальные машины** выберите виртуальные машины, которые необходимо реплицировать.
    - Если вы выполнили оценку для виртуальных машин, вы можете применить рекомендации по выбору размера виртуальной машины и типу диска ("Премиум" или "Стандарт") из результатов оценки. Для этого в поле **Импортировать параметры миграции из средства оценки Миграции Azure?** выберите вариант **Да**.
    - Если вы не выполняли оценку или вы не хотите использовать параметры оценки, выберите параметр **нет** .
    - Если вы решили использовать оценку, выберите группу виртуальных машин и имя оценки.

    ![Выбор оценки](./media/contoso-migration-rehost-linux-vm/select-assessment.png)

5. В разделе **Виртуальные машины** найдите виртуальные машины и отметьте каждую виртуальную машину, которую вы хотите перенести. Затем нажмите кнопку **Далее: целевые параметры**.

6. В разделе **Целевые параметры** выберите подписку и целевой регион, в который вы хотите выполнить миграцию, а также укажите группу ресурсов, в которой будут находиться виртуальные машины Azure после миграции. В разделе **Виртуальная сеть** выберите виртуальную сеть или подсеть Azure, к которой будут подключены виртуальные машины Azure после миграции.

7. В **преимущество гибридного использования Azure**выберите следующее:

    - выберите вариант **Нет**, если вы не хотите применять Преимущество гибридного использования Azure. Затем нажмите кнопку **Далее**.

8. В разделе **Вычисления** просмотрите имя виртуальной машины, размер, тип диска ОС и группу доступности. Виртуальные машины должны соответствовать [требованиям Azure](https://docs.microsoft.com/azure/migrate/migrate-support-matrix-vmware#vmware-requirements).

    - **Размер виртуальной машины:** Если вы используете рекомендации по оценке, раскрывающийся список размер виртуальной машины будет содержать рекомендуемый размер. В противном случае Миграция Azure выбирает размер в зависимости от ближайшего совпадения в подписке Azure. Кроме того, можно выбрать размер вручную в качестве **размера виртуальной машины Azure.**
    - **Диск ОС:** Укажите диск операционной системы (загрузочный) для виртуальной машины. Диск ОС — это диск с загрузчиком операционной системы и установщиком.
    - **Группа доступности:** Если после миграции виртуальная машина должна находиться в группе доступности Azure, укажите набор. Группа должна находиться в целевой группе ресурсов, которую вы указываете для миграции.

9. В разделе **Диски** укажите, следует ли реплицировать диски виртуальных машин в Azure, и выберите тип диска (SSD или HDD (цен. категория "Стандартный") или управляемые диски (цен. категория "Премиум")) в Azure. Затем нажмите кнопку **Далее**.
    - Диски можно исключить из репликации.
    - Если вы исключите диски, они не будут присутствовать на виртуальной машине Azure после миграции.

10. В окне **Проверка и запуск репликации**просмотрите параметры, а затем выберите **репликация** , чтобы запустить начальную репликацию для серверов.

> [!NOTE]
> Вы можете обновить параметры репликации в любое время до начала репликации в разделе **Управление** > **Репликация компьютеров**. Настройки невозможно изменить после начала репликации.

## <a name="step-4-migrate-the-vm-with-azure-migrate-server-migration"></a>Шаг 4. Миграция виртуальной машины с помощью службы "миграция Azure": миграция сервера

Администраторы Contoso выполняют быструю тестовую миграцию, а затем полную миграцию для перемещения веб-виртуальной машины.

### <a name="run-a-test-migration"></a>Выполнение тестовой миграции

1. В списке **цели миграции**  >  **серверы**  >  **Миграция Azure: миграция сервера**выберите **тестировать перенесенные серверы**.

     ![Тестовая миграция серверов](./media/contoso-migration-rehost-linux-vm/test-migrated-servers.png)

2. Выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину для тестирования, а затем выберите пункт **Тестовая миграция**.

    ![Тестовая миграция](./media/contoso-migration-rehost-linux-vm/test-migrate.png)

3. В разделе **Тестовая миграция** выберите виртуальную сеть Azure, в которой будет находиться виртуальная машина Azure после миграции. Мы рекомендуем использовать непродукцию-виртуальную сеть.
4. Запустится задание **Тестовая миграция**. Отслеживайте задание и уведомления на портале.
5. После завершения миграции просмотрите перенастроенную виртуальную машину Azure в разделе **Виртуальные машины** на портале Azure. Имя машины содержит суффикс **-Test**.
6. После завершения теста выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину Azure на странице **репликация компьютеров**, а затем выберите **очистить тестовую миграцию**.

    ![Очистка миграции](./media/contoso-migration-rehost-linux-vm/clean-up.png)

### <a name="migrate-the-vm"></a>Миграция виртуальной машины

Теперь администраторы Contoso выполняют полную миграцию для завершения перемещения.

1. В проекте "миграция Azure" > **серверы**  >  **Миграция Azure: миграция сервера**выберите **репликация серверов**.

    ![Репликация серверов](./media/contoso-migration-rehost-linux-vm/replicating-servers.png)

2. В области **репликация компьютеров**выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину, > **выполнить миграцию**.
3. В разделе **Миграция** > **Shut down virtual machines and perform a planned migration with no data loss** (Завершить работу виртуальных машин и выполнить запланированную миграцию без потери данных?) выберите вариант **Да** > **ОК**.
    - По умолчанию Миграция Azure выключает локальную виртуальную машину и запускает репликацию по требованию для синхронизации любых изменений виртуальной машины, которые произошли с момента последней репликации. Это гарантирует отсутствие потери данных.
    - Если вы не хотите выключать виртуальную машину, выберите вариант **Нет**.
4. Запустится задание миграции виртуальной машины. Отслеживайте задание в уведомлениях Azure.
5. После завершения работы вы можете просматривать виртуальную машину и управлять ею на странице **Виртуальные машины**.

## <a name="step-5-provision-azure-database-for-mysql"></a>Шаг 5. предоставление базы данных Azure для MySQL

Администраторы Contoso подготавливают экземпляр базы данных MySQL в основном регионе ( `East US 2` ).

1. Специалисты компании создают Базу данных Azure для ресурса MySQL на портале Azure.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/mysql-1.png)

2. Они добавляют имя `contosoosticket` для базы данных Azure. Они добавляют базу данных в рабочую группу ресурсов `ContosoRG` и указывают для нее учетные данные.
3. В локальной среде используется база данных MySQL 5.7, поэтому для обеспечения совместимости выбрана именно эта версия. Для размера они выбирают значение по умолчанию, соответствующее требованиям компании для базы данных.

     ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/mysql-2.png)

4. В разделе **Варианты резервирования для архивации** специалисты выбирают **Геоизбыточное**. Этот параметр позволяет восстановить базу данных в дополнительном регионе ( `Central US` ) при возникновении сбоя. Данный параметр можно настроить только при подготовке базы данных.

     ![Избыточность](./media/contoso-migration-rehost-linux-vm-mysql/db-redundancy.png)

5. В `VNET-PROD-EUS2` **конечных точках службы**Network > они добавляют конечную точку службы (подсеть базы данных) для службы SQL.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/mysql-3.png)

6. После добавления подсети они создают правило виртуальной сети, обеспечивающее доступ из подсети базы данных в рабочей сети.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/mysql-4.png)

## <a name="step-6-migrate-the-database"></a>Шаг 6. Миграция базы данных

Существует несколько способов перемещения базы данных MySQL. Для каждого варианта требуется создать экземпляр базы данных Azure для MySQL для целевого объекта. После создания можно выполнить миграцию, используя два пути:

- 6A: Azure Database Migration Service
- 6b: резервное копирование и восстановление MySQL Workbench

### <a name="step-6a-migrate-the-database-via-azure-database-migration-service"></a>Шаг 6a. Перенос базы данных с помощью Azure Database Migration Service

Администраторы Contoso переходят базу данных с помощью Azure Database Migration Service, выполнив пошаговое [руководство по миграции](https://docs.microsoft.com/azure/dms/tutorial-mysql-azure-mysql-online). Они могут выполнять миграцию как в сети, так и в режиме гибридного использования (Предварительная версия) с помощью MySQL 5,6 или 5,7.

> [!NOTE]
> MySQL 8,0 поддерживается в базе данных Azure для MySQL, но средство Database Migration Service еще не поддерживает эту версию.

В качестве сводки необходимо выполнить следующие действия.

- Убедитесь, что выполнены все необходимые условия для миграции.

  - Источник базы данных MySQL Server должен соответствовать версии, поддерживаемой базой данных Azure для MySQL. База данных Azure для MySQL поддерживает выпуск MySQL Community, подсистему хранилища InnoDB и миграцию на исходном и целевом компьютерах с одинаковыми версиями.
  - Включение двоичного входа в систему `my.ini` (Windows) или `my.cnf` (UNIX). Невыполнение этого действия вызовет следующую ошибку: `error in binary logging. Variable binlog_row_image has value 'minimal'. Please change it to 'full. For more information, see https://go.microsoft.com/fwlink/?linkid=873009` Ошибка во время работы мастера миграции.
  - Пользователь должен иметь `ReplicationAdmin` роль.
  - Перенесите схемы базы данных без внешних ключей и триггеров.

- Создайте виртуальную сеть, которая подключается через ExpressRoute или VPN к локальной сети.

- Создайте экземпляр Azure Database Migration Service с помощью `Premium` номера SKU, подключенного к виртуальной сети.

- Убедитесь, что экземпляр может получить доступ к базе данных MySQL через виртуальную сеть. Это гарантирует, что все входящие порты будут разрешены из Azure в MySQL на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается MySQL.

- Запустите средство Database Migration Service:

  - Создайте проект миграции.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-new-project.png)

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-new-project-02.png)

  - Добавьте источник (локальная база данных).

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-source.png)

  - Выберите целевой объект.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-target.png)

  - Выберите базы данных для миграции.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-databases.png)

  - Настройка дополнительных параметров.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-settings.png)

  - Запустите репликацию и устраните все ошибки.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-monitor.png)

  - Выполните окончательный прямую миграцию. ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover.png)

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-complete.png)

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-complete-02.png)

  - Возобновите использование внешних ключей и триггеров.

  - Измените приложения для использования новой базы данных.

    ![MySQL](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-apps.png)

### <a name="step-6b-migrate-the-database-mysql-workbench"></a>Шаг 6B. Миграция базы данных (MySQL Workbench)

Администраторы компании Contoso выполняют миграцию базы данных с помощью функции резервного копирования и восстановления в инструментах MySQL. Они устанавливают MySQL Workbench, зарезервировать базу данных из `OSTICKETMYSQL` , а затем восстанавливают ее в базе данных Azure для MySQL.

### <a name="install-mysql-workbench"></a>Установка MySQL Workbench

1. Специалисты компании проверяют [предварительные условия и загружают MySQL Workbench](https://dev.mysql.com/downloads/workbench/?utm_source=tuicool).

2. Специалисты компании устанавливают MySQL Workbench для Windows в соответствии с [инструкциями по установке](https://dev.mysql.com/doc/workbench/en/wb-installing.html).

3. Они создают в среде MySQL Workbench подключение MySQL к OSTICKETMYSQL.

    ![MySQL Workbench](./media/contoso-migration-rehost-linux-vm-mysql/workbench1.png)

4. Они экспортируют базу данных `osticket` в локальный автономный файл.

    ![MySQL Workbench](./media/contoso-migration-rehost-linux-vm-mysql/workbench2.png)

5. После локальной архивации базы данных они создают подключения к Базе данных Azure для экземпляра MySQL.

    ![MySQL Workbench](./media/contoso-migration-rehost-linux-vm-mysql/workbench3.png)

6. Теперь специалисты компании могут импортировать (восстановить) базу данных в экземпляре Azure MySQL из автономного файла. `osticket`Для экземпляра создается новая схема ().

    ![MySQL Workbench](./media/contoso-migration-rehost-linux-vm-mysql/workbench4.png)

### <a name="connect-the-vm-to-the-database"></a>Подключение виртуальной машины к базе данных

В качестве последнего шага процесса миграции администраторы Contoso обновляют строку подключения приложения, чтобы она указывала на базу данных приложения, работающую на `OSTICKETMYSQL` виртуальной машине.

1. Они выполняют SSH-подключение к `OSTICKETWEB` виртуальной машине с помощью выводимого или другого клиента SSH. Виртуальная машина частная, поэтому для подключения к ней используется частный IP-адрес.

    ![Подключение к базе данных](./media/contoso-migration-rehost-linux-vm/db-connect.png)

    ![Подключение к базе данных](./media/contoso-migration-rehost-linux-vm/db-connect2.png)

2. Они должны убедиться, что `OSTICKETWEB` Виртуальная машина может обмениваться данными с `OSTICKETMYSQL` виртуальной машиной. В настоящее время Конфигурация жестко закодирована локальным IP-адресом `172.16.0.43` .

    **Перед обновлением:**

    ![Обновление IP-адреса](./media/contoso-migration-rehost-linux-vm/update-ip1.png)

    **После обновления:**

    ![Обновление IP-адреса](./media/contoso-migration-rehost-linux-vm/update-ip2.png)

3. Они перезапускают службу с помощью `systemctl restart apache2` .

    ![Перезагрузить](./media/contoso-migration-rehost-linux-vm/restart.png)

4. Наконец, они обновляют записи DNS для `OSTICKETWEB` и `OSTICKETMYSQL` на одном из контроллеров домена contoso.

    ![Обновление DNS](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png)

    ![Обновление DNS](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png)

**Требуется дополнительная помощь?**

- Дополнительные сведения о [выполнении тестовой миграции](https://docs.microsoft.com/azure/migrate/tutorial-migrate-vmware#run-a-test-migration).
- Сведения о [миграции виртуальных машин в Azure](https://docs.microsoft.com/azure/migrate/tutorial-migrate-vmware#migrate-vms).

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда приложение работает, компания Contoso должна полностью эксплуатацию и защитить свою новую инфраструктуру.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После завершения миграции уровни приложений Остиккет выполняются на виртуальных машинах Azure.

Для этого Contoso потребуется предпринять следующее:

- Удалить виртуальную машину VMware из перечня в vCenter.
- Удалить локальные виртуальные машины из локальных заданий резервного копирования.
- Обновить внутренние документы и указать в них новые расположения и IP-адреса.
- Проверить все ресурсы, взаимодействующие с локальными виртуальными машинами, и обновить все соответствующие параметры или документы согласно новой конфигурации.
- Contoso использовал службу "миграция Azure" с сопоставлением зависимостей для оценки `OSTICKETWEB` виртуальной машины для миграции.

### <a name="security"></a>Безопасность

Специалисты по безопасности компании Contoso проверяют виртуальную машину и базу данных на наличие любых проблем с безопасностью.

- Чтобы оценить возможность управления доступом, они проверяют группы безопасности сети (NSG) для виртуальной машины. NSG позволяют пропускать только разрешенный для приложения трафик.
- Они учитывают безопасность данных на дисках виртуальной машины с помощью шифрования дисков Azure и Azure Key Vault.
- Поддержка SSL для обмена данными между экземпляром виртуальной машины и базой данных не настроена. Поэтому им необходимо будет сделать это, чтобы предотвратить взлом трафика, базы данных.

Дополнительные сведения см. в статье рекомендации [по обеспечению безопасности для рабочих нагрузок IaaS в Azure](https://docs.microsoft.com/azure/security/fundamentals/iaas).

### <a name="bcdr"></a>Непрерывность бизнес-процессов и аварийное восстановление

Чтобы обеспечить непрерывность бизнес-процессов и аварийное восстановление, специалисты компании Contoso выполняют указанные ниже действия.

- **Обеспечьте безопасность данных.** Contoso создает резервную копию данных на виртуальной машине приложения с помощью [резервного копирования виртуальных машин Azure](https://docs.microsoft.com/azure/backup/backup-azure-vms-introduction). Ее специалистам нет необходимости настраивать резервное копирование для базы данных. В службе "База данных Azure для MySQL" для сервера автоматически создаются и сохраняются резервные копии. Они решили использовать для базы данных геоизбыточное хранилище, поэтому она отказоустойчива и готова к внедрению в рабочую среду.

- **Обеспечьте работоспособность приложений.** Contoso реплицирует виртуальные машины приложений в Azure в дополнительный регион с помощью Site Recovery. Дополнительные сведения см. [в разделе Краткое руководство. Настройка аварийного восстановления в дополнительном регионе Azure для виртуальной машины Azure](https://docs.microsoft.com/azure/site-recovery/azure-to-azure-quickstart).

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- После развертывания ресурсов Contoso назначает теги Azure в соответствии с решениями, принятыми на этапе развертывания [инфраструктуры Azure](./contoso-migration-infrastructure.md#set-up-tagging).
- У Contoso нет проблем с лицензированием серверов Ubuntu.
- Компания Contoso будет использовать службу " [Управление затратами Azure" и выставление счетов](https://docs.microsoft.com/azure/cost-management-billing/cost-management-billing-overview) , чтобы гарантировать, что они останутся в бюджетах, установленных по ИТ.
