---
title: Повторное размещение локального приложения Linux на виртуальных машинах Azure и базе данных Azure для MySQL
description: Узнайте, как компания Contoso повторно размещает приложение Linux, перенеся его на виртуальные машины Azure и в Базу данных Azure для MySQL.
author: givenscj
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: 86feba84b8bec522d887c788f4942492ffa8dce8
ms.sourcegitcommit: 011525720bd9e2d9bcf03a76f371c4fc68092c45
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/18/2020
ms.locfileid: "88567348"
---
<!-- cSpell:ignore givenscj OSTICKETWEB OSTICKETMYSQL contosohost vcenter contosodc contosoosticket osticket InnoDB binlog systemctl NSGs -->

# <a name="rehost-an-on-premises-linux-application-to-azure-vms-and-azure-database-for-mysql"></a>Повторное размещение локального приложения Linux на виртуальных машинах Azure и базе данных Azure для MySQL

В этой статье показано, как вымышленная компания Contoso повторно размещает двухуровневый приложение на [основе лампы](https://wikipedia.org/wiki/LAMP_(software_bundle)) и переносит его из локальной среды в Azure с помощью виртуальных машин Azure и базы данных Azure для MySQL.

Приложение службы поддержки, используемое в этом примере, Остиккет, предоставляется в виде открытого кода. Если вы хотите использовать его для тестирования, его можно скачать с сайта [GitHub](https://github.com/osTicket/osTicket).

## <a name="business-drivers"></a>Бизнес-факторы

Группа специалистов по ИТ тесно работала с бизнес-партнерами, чтобы понять, что они хотят достичь:

- **Устраните бизнес-рост.** По мере развития компании Contoso растет нагрузка на локальные системы и инфраструктуру.
- **Ограничение риска.** Приложение службы поддержки является критически важным для бизнеса. Поэтому компания Contoso хочет переместить его в Azure с минимальными рисками.
- **Расширений.** Contoso не хочет изменять приложение прямо сейчас. Компания хочет, чтобы приложение оставалось стабильным.

## <a name="migration-goals"></a>Цели миграции

Группа Contoso Cloud заблокировала цели этой миграции, чтобы определить наилучший способ переноса:

- После миграции приложение в Azure должно иметь те же возможности производительности, что и сегодня в локальной среде VMware компании. Приложение будет оставаться критически важным в облаке, как и локально.
- Компания Contoso не хочет вкладываться в это приложение. Это важно для бизнеса, но в его текущей форме Contoso просто хочет безопасно переместить его в облако.
- Если вы выполнили несколько миграций приложений Windows, компания Contoso хочет узнать, как использовать инфраструктуру на основе Linux в Azure.
- Компании необходимо свести к минимуму задачи администрирования баз данных после переноса приложения в облако.

## <a name="proposed-architecture"></a>Предлагаемая архитектура

В этом сценарии:

- В настоящее время приложение распределено между двумя виртуальными машинами ( `OSTICKETWEB` и `OSTICKETMYSQL` ).
- Виртуальные машины расположены на узле VMware ESXi `contosohost1.contoso.com` (версии 6.5).
- Управление средой VMware осуществляется vCenter Server 6,5 ( `vcenter.contoso.com` ) и выполняется на виртуальной машине.
- Компания Contoso использует локальный центр обработки данных (`contoso-datacenter`) с локальным контроллером домена (`contosodc1`).
- Веб-приложение в `OSTICKETWEB` будет перенесено на виртуальную машину Azure "инфраструктура как услуга" (IaaS).
- База данных приложения будет перенесена на платформу базы данных Azure для MySQL в качестве службы.
- Поскольку компания Contoso выполняет миграцию рабочей нагрузки, ресурсы будут находиться в Рабочей группе ресурсов `ContosoRG` .
- `OSTICKETWEB`Ресурс будет реплицирован в основной регион (Восточная часть США 2) и помещен в производственную сеть ( `VNET-PROD-EUS2` ):
  - Виртуальная машина веб-уровня будет находиться в интерфейсной подсети (`PROD-FE-EUS2`).
- База данных приложения будет перенесена в базу данных Azure для MySQL с помощью [Azure Database Migration Service](/azure/dms/dms-overview).
- После завершения миграции локальные виртуальные машины в центре обработки данных Contoso будут выведены из эксплуатации.

    ![Схема архитектуры сценария.](./media/contoso-migration-rehost-linux-vm-mysql/architecture.png)

## <a name="migration-process"></a>Процесс миграции

Порядок миграции в Contoso будет следующим:

Миграция виртуальной машины веб-уровня

- В качестве первого шага компания Contoso настраивает Azure и локальную инфраструктуру, необходимую для развертывания службы "миграция Azure".
- В компании уже есть [инфраструктура Azure](./contoso-migration-infrastructure.md) , поэтому необходимо только добавить и настроить репликацию виртуальных машин с помощью средства миграции Azure Migration: сервер.
- Когда все подготовлено, компания Contoso может начать репликацию виртуальной машины.
- После включения и работы репликации компания Contoso завершит перемещение с помощью службы "миграция Azure".

Миграция базы данных

1. Contoso подготовит экземпляр MySQL в Azure.
1. Компания Contoso настраивает Database Migration Service, обеспечивая доступ к локальному серверу базы данных.
1. Компания Contoso переносит базу данных в базу данных Azure для MySQL.

    ![Схема процесса миграции.](./media/contoso-migration-rehost-linux-vm-mysql/migration-process.png)

### <a name="azure-services"></a>Службы Azure

| Служба | Описание | Стоимость |
| --- | --- | --- |
| [Миграция Azure](/azure/migrate/migrate-services-overview) | Contoso использует службу "миграция Azure" для оценки виртуальных машин VMware. Служба "Миграция Azure" оценивает миграционную пригодность компьютеров. Она обеспечивает оценку размера и стоимости для работы в Azure. | Служба " [Миграция Azure](https://azure.microsoft.com/pricing/details/azure-migrate) " доступна без дополнительной платы. Плата может взиматься в зависимости от средств (от первой стороны или ISV), которые вы решили использовать для оценки и миграции. |
| [Azure Database Migration Service](/azure/dms/dms-overview) | Database Migration Service обеспечивает простой перенос из нескольких источников базы данных в платформы данных Azure с минимальным временем простоя. | Дополнительные сведения о [поддерживаемых регионах](/azure/dms/dms-overview#regional-availability) см. на странице [цен на Database Migration Service](https://azure.microsoft.com/pricing/details/database-migration). |
| [База данных Azure для MySQL](/azure/mysql) | База данных основана на ядре СУБД MySQL с открытым исходным кодом. Она предоставляет полностью управляемую корпоративную базу данных MySQL, готовую для разработки и развертывания приложений. | Узнайте больше о [ценах](https://azure.microsoft.com/pricing/details/mysql) и параметрах масштабируемости базы данных Azure для MySQL. |

## <a name="prerequisites"></a>Предварительные требования

Ниже приведены действия компании Contoso, необходимые для этого сценария.

| Требования | Сведения |
| --- | --- |
| **Подписка Azure.** | Компания Contoso уже создала подписки (это описывается в одной из предыдущих статей этой серии). Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free). <br><br> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия. <br><br> Если вы используете существующую подписку и вы не являетесь администратором, обратитесь к администратору, чтобы назначить вам разрешения владельца или участника. <br><br> Если требуются более детализированные разрешения, см. раздел [Управление доступом Azure Site Recovery с помощью управления доступом на основе ролей (RBAC)](/azure/site-recovery/site-recovery-role-based-linked-access-control). |
| **Инфраструктура Azure** | Компания Contoso настраивает инфраструктуру Azure, как описано в статье [Развертывание инфраструктуры Azure для миграции в Contoso](./contoso-migration-infrastructure.md). |
| **Локальные серверы** | Локальная vCenter Server должна работать под управлением версии 5,5, 6,0, 6,5 или 6,7. <br><br> Узел ESXi с версией 5,5, 6,0, 6,5 или 6,7. <br><br> Одна или несколько виртуальных машин VMware, которые выполняются на узле ESXi. |
| **Локальные виртуальные машины** | [Ознакомьтесь со списком виртуальных машин Linux](/azure/virtual-machines/linux/endorsed-distros), которые рекомендованы к использованию в Azure. |

## <a name="scenario-steps"></a>Шаги выполнения сценария

Администраторы компании Contoso будут осуществлять миграцию следующим образом:

> [!div class="checklist"]
>
> - **Шаг 1. Подготовка Azure для миграции Azure: миграция сервера.** Добавьте средство миграции сервера в проект службы "миграция Azure".
> - **Шаг 2. Подготовка локальной среды VMware для миграции в Azure: миграция сервера.** Подготовка учетных записей для обнаружения ВИРТУАЛЬНЫХ машин и подготовка к подключению к виртуальным машинам Azure после переноса.
> - **Шаг 3. репликация виртуальных машин.** Настройте репликацию и начните репликацию виртуальных машин в службу хранилища Azure.
> - **Шаг 4. Миграция виртуальной машины приложения с помощью службы "миграция Azure": миграция сервера.** Выполните тестовую миграцию, чтобы убедиться, что все работает, а затем выполните полную миграцию, чтобы переместить виртуальную машину в Azure.
> - **Шаг 5. Перенос базы данных.** Настройка миграции с помощью Azure Database Migration Service.

## <a name="step-1-prepare-azure-for-the-azure-migrate-server-migration-tool"></a>Шаг 1. Подготовка Azure к работе с миграцией Azure: средство миграции сервера

Ниже перечислены компоненты Azure, которые необходимы для миграции виртуальных машин компании Contoso в Azure.

- Виртуальная сеть, в которой будут находиться виртуальные машины Azure при их создании во время миграции.
- Подготовка и Настройка средства миграции сервера Azure (OVA).

Чтобы настроить компоненты, администраторы Contoso должны выполнить следующие действия:

1. Настройте сеть. Компания Contoso уже настроила сеть, которую можно использовать для миграции Azure: миграция сервера при [развертывании инфраструктуры Azure](./contoso-migration-infrastructure.md).

1. Выполните подготовку к работе средства миграции Azure: Server Migration Tool.

    1. В службе "миграция Azure" Скачайте образ OVA и импортируйте его в VMware.

        ![Снимок экрана, на котором показана загрузка файла OVA.](./media/contoso-migration-rehost-vm/migration-download-ova.png)

    1. Запустите импортированное изображение и настройте средство, выполнив следующие действия.

       1. Настройте необходимые компоненты.

          ![Снимок экрана, на котором показан экран настройки предварительных требований.](./media/contoso-migration-rehost-vm/migration-setup-prerequisites.png)

       1. Наведите указатель на инструмент на подписку Azure.

          ![Снимок экрана, показывающий настройку подписки](./media/contoso-migration-rehost-vm/migration-register-azure.png)

       1. Задайте учетные данные VMware vCenter.

          ![Снимок экрана, показывающий настройку учетных данных.](./media/contoso-migration-rehost-vm/migration-vcenter-server.png)

       1. Добавьте все учетные данные на основе Linux для обнаружения.

          ![Снимок экрана, на котором показана настройка учетных данных на основе Linux.](./media/contoso-migration-rehost-vm/migration-credentials.png)

1. После настройки средства потребуется некоторое время, чтобы средство перечислило все виртуальные машины. После завершения процесса виртуальные машины заполняются в средстве миграции Azure в Azure.

**Требуется дополнительная помощь?**

Узнайте, как настроить [средство миграции для Azure Migration](/azure/migrate/migrate-services-overview#azure-migrate-server-migration-tool).

## <a name="step-2-prepare-on-premises-vmware-for-azure-migrate-server-migration"></a>Шаг 2. Подготовка локальной среды VMware для миграции Azure: миграция сервера

После миграции в Azure компания Contoso хочет иметь возможность подключиться к реплицированным виртуальным машинам в Azure. Есть несколько вещей, которые требуются администраторам Contoso:

- Чтобы получить доступ к виртуальным машинам Azure, перед миграцией включите SSH на локальной виртуальной машине Linux. Для Ubuntu этот шаг можно выполнить с помощью следующей команды: `sudo apt-get ssh install -y` .
- После того как администраторы запускают миграцию, они могут проверить **диагностику загрузки** , чтобы просмотреть снимок экрана виртуальной машины.
- Если она не работает, необходимо проверить, работает ли виртуальная машина, и ознакомиться с [рекомендациями по устранению неполадок](https://social.technet.microsoft.com/wiki/contents/articles/31666.troubleshooting-remote-desktop-connection-after-failover-using-asr.aspx).
- Установите [Агент Linux для Azure](/azure/virtual-machines/extensions/agent-linux).

**Требуется дополнительная помощь?**

Узнайте, как [подготовить виртуальные машины для миграции](/azure/migrate/prepare-for-migration).

## <a name="step-3-replicate-vms"></a>Шаг 3. репликация виртуальных машин

Чтобы можно было запустить миграцию в Azure, администраторам компании Contoso потребуется настроить и включить репликацию.

После завершения обнаружения они могут начать репликацию виртуальной машины приложения в Azure.

1. В проекте службы "миграция Azure" перейдите в раздел **серверы**  >  **Миграция Azure: миграция сервера**и выберите **репликация**.

    ![Снимок экрана, на котором показан параметр репликации.](./media/contoso-migration-rehost-linux-vm/select-replicate.png)

1. В разделе Параметры **репликации**  >  **источника**  >  **виртуальные машины виртуализированы?** выберите **Да, с VMware vSphere**.

1. В поле **локальное устройство**выберите имя настроенного устройства для миграции Azure и нажмите кнопку **ОК**.

    ![Снимок экрана, на котором показана вкладка "Параметры источника".](./media/contoso-migration-rehost-linux-vm/source-settings.png)

1. В области **виртуальные машины**выберите компьютеры, которые необходимо реплицировать.
    - Если вы выполнили оценку для виртуальных машин, вы можете применить рекомендации по выбору размера виртуальной машины и типу диска ("Премиум" или "Стандарт") из результатов оценки. В разделе **Импорт параметров миграции из оценки миграции Azure**выберите параметр **Да** .
    - Если вы не выполняли оценку или вы не хотите использовать параметры оценки, выберите параметр **нет** .
    - Если выбрано использование оценки, выберите группу виртуальных машин и имя оценки.

    ![Снимок экрана, показывающий выбор оценок.](./media/contoso-migration-rehost-linux-vm/select-assessment.png)

1. В окне **виртуальные машины**выполните поиск виртуальных машин по мере необходимости и выберите каждую виртуальную машину, которую требуется перенести. Затем нажмите кнопку **Далее: целевые параметры**.

1. В поле **целевые параметры**выберите подписку и целевой регион для переноса. Укажите группу ресурсов, в которой будут размещаться виртуальные машины Azure после миграции. В поле **Виртуальная сеть**выберите виртуальную сеть или подсеть Azure, к которой будут присоединены виртуальные машины Azure после миграции.

1. Для параметра **Преимущество гибридного использования Azure**

    - выберите вариант **Нет**, если вы не хотите применять Преимущество гибридного использования Azure. Выберите **Далее**.

1. В разделе **Вычисления** просмотрите имя виртуальной машины, размер, тип диска ОС и группу доступности. Виртуальные машины должны соответствовать [требованиям Azure](/azure/migrate/migrate-support-matrix-vmware#vmware-requirements).

    - **Размер виртуальной машины:** Если вы используете рекомендации по оценке, раскрывающийся список размер виртуальной машины содержит рекомендуемый размер. В противном случае служба "миграция Azure" выбирает размер на основе ближайшей соответствия в подписке Azure. В качестве альтернативы выберите размер вручную в разделе **Размер виртуальной машины Azure**.
    - **Диск ОС:** Укажите диск операционной системы (загрузочный) для виртуальной машины. Диск ОС — это диск с загрузчиком операционной системы и установщиком.
    - **Группа доступности:** Если после миграции виртуальная машина должна находиться в группе доступности Azure, укажите набор. Группа должна находиться в целевой группе ресурсов, которую вы указываете для миграции.

1. В поле **диски**укажите, следует ли реплицировать диски виртуальной машины в Azure. Затем выберите тип диска (стандартный SSD/HDD или управляемые диски уровня "Премиум") в Azure и нажмите кнопку **Далее**.
    - Диски можно исключить из репликации.
    - Если вы исключите диски, они не будут присутствовать на виртуальной машине Azure после миграции.

1. На странице **Проверка и запуск репликации**проверьте параметры. Затем выберите **репликация** , чтобы запустить начальную репликацию для серверов.

> [!NOTE]
> Вы можете обновить параметры репликации в любое время, прежде чем репликация начнется в **управлении**  >  **реплицируемыми компьютерами**. Настройки невозможно изменить после начала репликации.

## <a name="step-4-migrate-the-vm-with-azure-migrate-server-migration"></a>Шаг 4. Миграция виртуальной машины с помощью службы "миграция Azure": миграция сервера

Администраторы Contoso выполняют быструю миграцию, а затем полную миграцию для перемещения веб-виртуальной машины.

### <a name="run-a-test-migration"></a>Выполнение тестовой миграции

1. В списке **цели миграции**  >  **серверы**  >  **Миграция Azure: миграция сервера**выберите **тестировать перенесенные серверы**.

     ![Снимок экрана, на котором показан параметр "тестировать перенесенные серверы".](./media/contoso-migration-rehost-linux-vm/test-migrated-servers.png)

1. Выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину для тестирования, а затем выберите пункт **Тестовая миграция**.

    ![Снимок экрана, на котором показан элемент "Тестовая миграция".](./media/contoso-migration-rehost-linux-vm/test-migrate.png)

1. В разделе **Тестовая миграция** выберите виртуальную сеть Azure, в которой будет находиться виртуальная машина Azure после миграции. Рекомендуется использовать виртуальную сеть непроизводства.
1. Запустится задание **Тестовая миграция**. Отслеживайте задание и уведомления на портале.
1. После завершения миграции просмотрите перенастроенную виртуальную машину Azure в разделе **Виртуальные машины** на портале Azure. Имя машины содержит суффикс **-Test**.
1. После завершения теста выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину Azure на странице **репликация компьютеров**. Затем выберите **очистить тестовую миграцию**.

    ![Снимок экрана, на котором показан элемент "Очистка тестовой миграции".](./media/contoso-migration-rehost-linux-vm/clean-up.png)

### <a name="migrate-the-vm"></a>Миграция виртуальной машины

Теперь администраторы Contoso выполняют полную миграцию для завершения перемещения.

1. В проекте службы "миграция Azure" перейдите в раздел **серверы**  >  **Миграция Azure: миграция сервера**и выберите **репликация серверов**.

    ![Снимок экрана, на котором показан параметр "Репликация серверов".](./media/contoso-migration-rehost-linux-vm/replicating-servers.png)

1. В области **репликация компьютеров**выберите и удерживайте (или щелкните правой кнопкой мыши) виртуальную машину, а затем выберите **Миграция**.
1. В разделе **Миграция** > **Shut down virtual machines and perform a planned migration with no data loss** (Завершить работу виртуальных машин и выполнить запланированную миграцию без потери данных?) выберите вариант **Да** > **ОК**.
    - По умолчанию служба "миграция Azure" завершает работу локальной виртуальной машины и выполняет репликацию по требованию для синхронизации любых изменений виртуальной машины, произошедших с момента последней репликации. Это действие гарантирует отсутствие потери данных.
    - Если вы не хотите выключать виртуальную машину, выберите вариант **Нет**.
1. Запустится задание миграции виртуальной машины. Отслеживайте задание в уведомлениях Azure.
1. После завершения работы вы можете просматривать виртуальную машину и управлять ею на странице **Виртуальные машины**.

## <a name="step-5-provision-azure-database-for-mysql"></a>Шаг 5. предоставление базы данных Azure для MySQL

Администраторы Contoso подготавливают экземпляр базы данных MySQL в основном регионе ( `East US 2` ).

1. В портал Azure создайте ресурс базы данных Azure для MySQL.

    ![Снимок экрана, показывающий параметр "база данных Azure для MySQL".](./media/contoso-migration-rehost-linux-vm-mysql/mysql-1.png)

1. Добавьте имя `contosoosticket` для базы данных Azure. Добавьте базу данных в рабочую группу ресурсов `ContosoRG` и укажите для нее учетные данные.
1. Локальная база данных MySQL имеет версию 5,7, поэтому выберите эту версию для обеспечения совместимости. Используйте размеры по умолчанию, соответствующие требованиям к базе данных.

     ![Снимок экрана, на котором показаны учетные данные MySQL.](./media/contoso-migration-rehost-linux-vm-mysql/mysql-2.png)

1. Для **параметра избыточность резервного копирования**выберите **геоизбыточное**. Этот параметр позволяет восстановить базу данных в дополнительном регионе ( `Central US` ) при возникновении сбоя. Этот параметр можно настроить только при подготовке базы данных.

     ![Снимок экрана, на котором показан параметр геоизбыточности.](./media/contoso-migration-rehost-linux-vm-mysql/db-redundancy.png)

1. В `VNET-PROD-EUS2` сети перейдите к **конечным точкам службы**и добавьте конечную точку службы (подсеть базы данных) для службы SQL.

    ![Снимок экрана, показывающий Добавление конечных точек службы.](./media/contoso-migration-rehost-linux-vm-mysql/mysql-3.png)

1. После добавления подсети создайте правило виртуальной сети, разрешающее доступ из подсети базы данных в рабочей сети.

    ![Снимок экрана, показывающий создание правила виртуальной сети.](./media/contoso-migration-rehost-linux-vm-mysql/mysql-4.png)

## <a name="step-6-migrate-the-database"></a>Шаг 6. Миграция базы данных

Существует несколько способов перемещения базы данных MySQL. Каждый вариант требует, чтобы администраторы Contoso создали экземпляр базы данных Azure для MySQL для целевого объекта. После создания они могут выполнить миграцию с помощью двух путей, описанных в следующих шагах.

- 6a: Database Migration Service
- 6b: резервное копирование и восстановление MySQL Workbench

### <a name="step-6a-migrate-the-database-via-database-migration-service"></a>Шаг 6a. Перенос базы данных с помощью Database Migration Service

Администраторы Contoso переходят базу данных с помощью Database Migration Service, выполнив пошаговое [руководство по миграции](/azure/dms/tutorial-mysql-azure-mysql-online). Они могут выполнять миграцию через Интернет, автономный и гибридный (Предварительная версия) с помощью MySQL 5,6 или 5,7.

> [!NOTE]
> MySQL 8,0 поддерживается в базе данных Azure для MySQL, но средство Database Migration Service еще не поддерживает эту версию.

В качестве сводки администраторы Contoso должны выполнять следующие задачи:

- Убедитесь, что выполнены все необходимые условия для миграции.
  - Источник базы данных MySQL Server должен соответствовать версии, поддерживаемой базой данных Azure для MySQL. База данных Azure для MySQL поддерживает выпуск MySQL Community Edition, подсистему хранилища InnoDB и миграцию в исходном и целевом версиях с теми же версиями.
  - Включение двоичного входа в систему `my.ini` (Windows) или `my.cnf` (UNIX). Если этого не сделать, в мастере миграции будет вызвана следующая ошибка: "ошибка при ведении журнала в двоичном коде. Переменная binlog_row_image имеет значение "минимальный". Измените его на "Full". Дополнительные сведения см. на [веб-сайте MySQL](https://go.microsoft.com/fwlink/?linkid=873009`).
  - Пользователь должен иметь `ReplicationAdmin` роль.
  - Перенесите схемы базы данных без внешних ключей и триггеров.
- Создайте виртуальную сеть, которая подключается через Azure ExpressRoute или VPN-подключение к локальной сети.
- Создайте экземпляр Database Migration Service с помощью `Premium` номера SKU, подключенного к виртуальной сети.
- Убедитесь, что экземпляр может получить доступ к базе данных MySQL через виртуальную сеть. Убедитесь, что все входящие порты разрешены из Azure в MySQL на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается MySQL.
- Запустите средство Database Migration Service:
  - Создайте проект миграции.

    ![Снимок экрана, показывающий создание проекта миграции.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-new-project.png)

    ![Снимок экрана, на котором показана панель "новый проект миграции".](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-new-project-02.png)

  - Добавьте источник (локальная база данных).

    ![Снимок экрана, на котором показана панель "Добавление сведений об источнике".](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-source.png)

  - Выберите целевой объект.

    ![Снимок экрана, на котором показана Целевая область сведений.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-target.png)

  - Выберите базы данных для миграции.

    ![Снимок экрана, на котором показана панель "Map to Target Databases".](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-databases.png)

  - Настройка дополнительных параметров.

    ![Снимок экрана, на котором показана панель параметров миграции.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-settings.png)

  - Запустите репликацию и устраните все ошибки.

    ![Снимок экрана, показывающий разрешение ошибок.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-monitor.png)

  - Выполните окончательный прямую миграцию. ![Снимок экрана, на котором показан окончательный прямую миграцию.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover.png)

    ![Снимок экрана, на котором показана полная область прямую миграцию.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-complete.png)

    ![Снимок экрана, на котором показан список действий миграции.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-complete-02.png)

  - Возобновите использование внешних ключей и триггеров.
  - Измените приложения для использования новой базы данных.

    ![Снимок экрана, на котором показано изменение приложений для использования новой базы данных.](./media/contoso-migration-rehost-linux-vm-mysql/migration-dms-cutover-apps.png)

### <a name="step-6b-migrate-the-database-mysql-workbench"></a>Шаг 6B. Миграция базы данных (MySQL Workbench)

Администраторы Contoso переходят базу данных с помощью средств резервного копирования и восстановления с помощью инструментов MySQL. Они устанавливают MySQL Workbench, зарезервировать базу данных из `OSTICKETMYSQL` , а затем восстанавливают ее в базе данных Azure для MySQL.

### <a name="install-mysql-workbench"></a>Установка MySQL Workbench

1. Проверьте [Предварительные требования и скачайте MySQL Workbench](https://dev.mysql.com/downloads/workbench/?utm_source=tuicool).

1. Установите MySQL Workbench для Windows, следуя [инструкциям по установке](https://dev.mysql.com/doc/workbench/en/wb-installing.html).

1. В MySQL Workbench создайте подключение MySQL к ОСТИККЕТМИСКЛ.

    ![Снимок экрана, на котором показана вкладка "подключение".](./media/contoso-migration-rehost-linux-vm-mysql/workbench1.png)

1. Экспортировать базу данных как `osticket` в локальный автономный файл.

    ![Снимок экрана, на котором показан экран экспорта данных.](./media/contoso-migration-rehost-linux-vm-mysql/workbench2.png)

1. После того как база данных будет создана локально, создайте подключение к экземпляру базы данных Azure для MySQL.

    ![Снимок экрана, на котором отображается всплывающее сообщение об успешном подключении.](./media/contoso-migration-rehost-linux-vm-mysql/workbench3.png)

1. Теперь импортируйте (восстановите) базу данных в экземпляре базы данных Azure для MySQL из автономного файла. `osticket`Для экземпляра создается новая схема ().

    ![Снимок экрана, на котором показан параметр импорта из автономного файла.](./media/contoso-migration-rehost-linux-vm-mysql/workbench4.png)

### <a name="connect-the-vm-to-the-database"></a>Подключение виртуальной машины к базе данных

В качестве последнего шага процесса миграции администраторы Contoso обновляют строку подключения приложения, чтобы она указывала на базу данных приложения, работающую на `OSTICKETMYSQL` виртуальной машине.

1. Установите SSH-подключение к виртуальной машине с помощью выводимого `OSTICKETWEB` или другого клиента SSH. Виртуальная машина является частной, поэтому подключитесь с помощью частного IP-адреса.

    ![Снимок экрана, показывающий область подключения к виртуальной машине.](./media/contoso-migration-rehost-linux-vm/db-connect.png)

    ![Снимок экрана, на котором показано соединение с базой данных.](./media/contoso-migration-rehost-linux-vm/db-connect2.png)

1. Убедитесь, что `OSTICKETWEB` Виртуальная машина может обмениваться данными с `OSTICKETMYSQL` виртуальной машиной. В настоящее время Конфигурация жестко закодирована локальным IP-адресом `172.16.0.43` .

    **Перед обновлением:**

    ![Снимок экрана, показывающий IP-адрес перед обновлением.](./media/contoso-migration-rehost-linux-vm/update-ip1.png)

    **После обновления:**

    ![Снимок экрана, показывающий IP-адрес после обновления.](./media/contoso-migration-rehost-linux-vm/update-ip2.png)

1. Перезапустите службу с помощью `systemctl restart apache2` .

    ![Снимок экрана, на котором показан перезапуск службы.](./media/contoso-migration-rehost-linux-vm/restart.png)

1. Наконец, обновите записи DNS для `OSTICKETWEB` и `OSTICKETMYSQL` на одном из контроллеров домена contoso.

    ![Снимок экрана, на котором показано обновление записи DNS.](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png)

    ![Снимок экрана, на котором показано обновление записи DNS.](./media/contoso-migration-rehost-linux-vm-mysql/update-dns.png)

**Требуется дополнительная помощь?**

- Узнайте, как [выполнить тестовую миграцию](/azure/migrate/tutorial-migrate-vmware#run-a-test-migration).
- Узнайте, как [выполнить миграцию виртуальных машин в Azure](/azure/migrate/tutorial-migrate-vmware#migrate-vms).

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда приложение работает, компания Contoso должна полностью эксплуатацию и защитить свою новую инфраструктуру.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После завершения миграции уровни приложений Остиккет выполняются на виртуальных машинах Azure.

Теперь компания Contoso должна выполнить следующие задачи:

- Удалить виртуальную машину VMware из перечня в vCenter.
- Удалить локальные виртуальные машины из локальных заданий резервного копирования.
- Обновите внутреннюю документацию, чтобы отобразить новые расположения и IP-адреса.
- Проверьте все ресурсы, которые взаимодействуют с локальными виртуальными машинами. Обновить все соответствующие параметры или документы согласно новой конфигурации.
- Компания Contoso использовала миграцию Azure с сопоставлением зависимостей для оценки `OSTICKETWEB` виртуальной машины для миграции.

### <a name="security"></a>Безопасность

Группа безопасности Contoso рассматривает виртуальную машину и базу данных, чтобы определить проблемы безопасности.

- Они просматривают группы безопасности сети (группы безопасности сети) для виртуальной машины, чтобы управлять доступом. NSG позволяют пропускать только разрешенный для приложения трафик.
- Они рассматривайте безопасность данных на дисках виртуальной машины с помощью шифрования дисков Azure и Azure Key Vault.
- Поддержка SSL для обмена данными между экземпляром виртуальной машины и базой данных не настроена. Необходимо настроить протокол SSL, чтобы предотвратить взлом трафика базы данных.

Дополнительные сведения см. в статье рекомендации [по обеспечению безопасности для рабочих нагрузок IaaS в Azure](/azure/security/fundamentals/iaas).

<!-- docsTest:ignore "Quickstart: Set" -->

### <a name="business-continuity-and-disaster-recovery"></a>Непрерывность бизнес-процессов и аварийное восстановление

Чтобы обеспечить непрерывность бизнес-процессов и аварийное восстановление, специалисты компании Contoso выполняют указанные ниже действия.

- **Обеспечьте безопасность данных.** Contoso создает резервную копию данных на виртуальной машине приложения с помощью [резервного копирования виртуальных машин Azure](/azure/backup/backup-azure-vms-introduction). Компании не нужно настраивать резервное копирование для базы данных. В службе "База данных Azure для MySQL" для сервера автоматически создаются и сохраняются резервные копии. Компания Contoso выбрала геоизбыточность для базы данных, чтобы она была устойчивой и готовой к эксплуатации.
- **Обеспечьте работоспособность приложений.** Contoso реплицирует виртуальные машины приложений в Azure в дополнительный регион с помощью Site Recovery. Дополнительные сведения см. [в разделе Краткое руководство. Настройка аварийного восстановления в дополнительном регионе Azure для виртуальной машины Azure](/azure/site-recovery/azure-to-azure-quickstart).

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- После развертывания ресурсов компания Contoso назначает Теги Azure в соответствии с определением в развертывании [инфраструктуры Azure](./contoso-migration-infrastructure.md#set-up-tagging) .
- У Contoso нет проблем с лицензированием серверов Ubuntu.
- Contoso будет использовать службу [управления затратами Azure и выставления счетов](/azure/cost-management-billing/cost-management-billing-overview) , чтобы гарантировать, что компания останется в бюджете, установленном ИТ – лидером.
