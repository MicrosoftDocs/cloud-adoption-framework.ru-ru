---
title: Решения аналитики для Netezza
description: Используйте инфраструктуру внедрения в облаке для Azure, чтобы узнать о аналитических решениях с помощью Netezza.
author: v-hanki
ms.author: brblanch
ms.date: 07/14/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.openlocfilehash: 4de63bd39c9b5e22d5848532aef956374fa32414
ms.sourcegitcommit: 9163a60a28ffce78ceb5dc8dc4fa1b83d7f56e6d
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/17/2020
ms.locfileid: "86452141"
---
<!-- cSpell:ignore Netezza Informatica Talend InMon zonemap CBTs Attunity Wherescape nzlua CBT NZPLSQL DELIM TABLENAME ORC Parquet nzsql nzunload mpp -->

# <a name="analytics-solutions-for-netezza"></a>Решения аналитики для Netezza

Учитывая окончание поддержки IBM, многие существующие пользователи систем хранилища данных Netezza теперь ищут преимущества новейших сред (таких как Cloud, IaaS или PaaS) и делегирования задач, таких как обслуживание инфраструктуры и разработка платформ, поставщику облачных услуг.

Хотя существуют сходства между Netezza и Azure синапсе Analytics в том, что оба являются базами данных SQL, предназначенными для использования методов массовой параллельной обработки (MPP) для достижения высокой производительности запросов на очень больших объемах данных, есть и некоторые базовые отличия в подходе:

- Устаревшие системы Netezza устанавливаются локально, используя собственное оборудование, в то время как Azure синапсе Analytics — это облачная служба, использующая хранилище Azure и ресурсы для вычислений.
- Обновление конфигурации Netezza — это основная задача, включающая в себя дополнительное физическое оборудование и потенциально длительную перенастройку базы данных, а также выгрузку и перезагрузку. Так как ресурсы хранения и вычислительных ресурсов являются отдельными в среде Azure, их можно легко масштабировать (вверх и вниз) независимо, используя возможность эластичной масштабируемости.
- Аналитика Azure синапсе может быть приостановлена или изменена по мере необходимости, чтобы сократить использование ресурсов и, следовательно, стоимость. Microsoft Azure — это глобально доступная, высокобезопасная, масштабируемая облачная среда, которая включает Azure синапсе в экосистему поддерживаемых средств и возможностей.

Ниже рассматривается миграция схемы с представлением для получения эквивалентной или лучшей производительности перенесенного хранилища данных Netezza и киосков данных в Azure синапсе. Разделы, содержащиеся в этом документе, относятся к миграции из существующей среды Netezza.

## <a name="design-considerations"></a>Рекомендации по проектированию

### <a name="migration-scope"></a>Область миграции

### <a name="preparation-for-migration"></a>Подготовка к миграции

При миграции из среды Netezza необходимо учитывать некоторые разделы, которые следует учитывать в дополнение к более общим темам, описанным в документе «раздел 1: проектирование и производительность».

### <a name="choosing-the-workload-for-the-initial-migration"></a>Выбор рабочей нагрузки для первоначальной миграции

Устаревшие среды Netezza, как правило, развиваются с течением времени, чтобы охватывать несколько областей субъектов и смешанных рабочих нагрузок. Принимая решение о том, где начать с первоначального проекта миграции, имеет смысл выбрать область, которая будет иметь следующие возможности:

- Вы можете доказать жизнеспособность перехода на Azure синапсе, быстро предоставляя преимущества новой среды.
- Разрешите внутренним техническим сотрудникам получить соответствующие возможности процессов и средств, которые можно использовать при миграции других областей.
- Создайте шаблон для дальнейших упражнений по миграции, которые относятся к исходной среде Netezza, а также к текущим средствам и процессам, которые уже находятся на месте.

Хорошим кандидатом для первоначальной миграции из среды Netezza, которая позволила бы использовать перечисленные выше элементы, обычно является реализация рабочей нагрузки бизнес-аналитики, а не рабочей нагрузки OLTP, с моделью данных, которая может быть перенесена с минимальными изменениями — обычно схемой запуска или снежинки.

В плане размера важно, чтобы объем данных, который должен быть перенесен в начальном упражнении, был достаточно большим, чтобы продемонстрировать возможности и преимущества среды Azure синапсе, сохранив время для демонстрации коротких значений, обычно в диапазоне 1-10 ТБ.

Один из возможных подходов к первоначальному проекту миграции, который позволит свести к минимуму риск и сократить время реализации начального проекта, ограничивать область миграции на только киоски данных. Этот подход, по определению, ограничивает область миграции и обычно может быть достигнут в течение короткого промежутка времени, и поэтому может быть хорошей отправной точкой. Однако это не будет решать такие более обширные темы, как миграция ETL и миграция исторических данных в рамках первоначального проекта миграции. Эти разделы должны быть решены на последующих стадиях проекта, так как перенесенный слой киоска данных заполнен данными и процессами, необходимыми для их построения.

### <a name="lift-and-shift-as-is-versus-a-phased-approach-incorporating-changes"></a>Приближение и сдвиг как есть по сравнению с поэтапным подходом, включающим изменения

Независимо от драйверов и области действия предполагаемой миграции, обычно существует два типа миграции:

- **Поднять и сдвинуть:** В этом случае существующая модель данных (например, схема "звезда") переносится в новую платформу Azure синапсе без изменений. Здесь основное внимание уделяется минимизации риска и времени, затрачиваемого на миграцию, уменьшая объем работ, которые необходимо выполнить для достижения преимуществ перехода в облачную среду Azure.

  Этот подход хорошо подходит для существующих сред Netezza, в которых предполагается перенос одного киоска данных, или если данные уже находятся в хорошо спроектированной схеме типа «звезда» или «снежинка», либо есть затраты времени и затрат на переход на более современные облачные среды.

- **Поэтапный подход, включающий изменения:** Если хранилище прежних версий изменилось со временем, может потребоваться ее повторное проектирование для поддержания необходимой производительности или поддержки новых источников данных, таких как потоки IoT. Переход на Azure синапсе для широко известных преимуществ масштабируемой облачной среды может рассматриваться как часть процесса повторной разработки. Этот процесс может включать изменение базовой модели данных, например переход с модели Inmon на хранилище данных Azure.

  Рекомендуется сначала переместить существующую модель данных как есть в Azure, а затем воспользоваться преимуществами производительности и гибкости Azure, чтобы применить изменения, внесенные повторно, с помощью возможностей Azure, чтобы внести изменения, не затрагивая существующую исходную систему.

### <a name="use-azure-data-factory-to-implement-a-metadata-driven-migration"></a>Использование фабрики данных Azure для реализации миграции на основе метаданных

Это имеет смысл автоматизировать и управлять процессом миграции, используя возможности среды Azure. Такой подход также уменьшает влияние на существующую среду Netezza (которая, возможно, уже работает, близко к полной емкости).

Фабрика данных Azure — это облачная служба интеграции данных, которая позволяет создавать управляемые данными рабочие процессы в облаке для оркестрации и автоматизации перемещения и преобразования данных. С помощью фабрики данных Azure можно создавать и включать в расписание управляемые данными рабочие процессы (конвейеры), которые могут принимать данные из разнородных хранилищ данных, обрабатывать и преобразовывать эти данные с помощью служб вычислений (например, Azure HDInsight Hadoop, Spark, Azure Data Lake Analytics и машинного обучения Azure),

Создавая метаданные для перечисления перемещаемых таблиц данных и их расположения, можно использовать возможности фабрики данных Azure для управления процессом миграции.

### <a name="design-differences-between-netezza-and-azure-synapse"></a>Различия в проектировании между Netezza и Azure синапсе

**Несколько баз данных и одна база данных и схемы:**

В среде Netezza иногда существует несколько отдельных баз данных для отдельных частей общей среды. Например, может существовать отдельная база данных для приема данных и промежуточных таблиц, база данных для базовых таблиц хранилища и другая база данных для киосков данных (иногда называемых семантическим слоем). Такие процессы, как конвейеры ETL/ELT, могут реализовывать межбазовые подключения между базами данных и перемещать данные между этими отдельными базами данных.

Среда Azure синапсе имеет одну базу данных, а схемы используются для разделения таблиц на логически разделенные группы. Поэтому рекомендуется использовать серию схем в целевом Синапсее Azure, чтобы имитировать любые отдельные базы данных, которые будут перенесены из среды Netezza. Если схемы используются в среде Netezza, то может потребоваться использовать новое соглашение об именовании для перемещения существующих таблиц и представлений Netezza в новую среду (например, объединение существующих имен схем Netezza и таблиц в новое имя таблицы Azure синапсе и использование имен схем в новой среде для сохранения исходных имен отдельных баз данных). Другим вариантом является использование представлений SQL в базовых таблицах для поддержки логических структур, но некоторые потенциальные недостатки этого подхода:

- Представления в Azure синапсе доступны только для чтения, поэтому все обновления данных должны выполняться в базовых таблицах.
- Возможно, слой (или уровни) существующих представлений уже существует, а добавление дополнительного уровня представлений может повлиять на производительность.

**Рекомендации по таблицам:**

При переносе таблиц между различными технологиями обычно это только необработанные данные (и метаданные, описывающие ее), которые физически перемещаются между двумя средами. Другие элементы базы данных из исходной системы, такие как индексы, не переносятся, так как они могут не потребоваться или могут быть реализованы по-разному в новой целевой среде.

Однако важно понимать, где в исходной среде используются такие оптимизации производительности, как индексы, так как эти сведения могут быть полезны для определения того, где можно добавить оптимизацию производительности в новую целевую среду. Например, если карты зон часто используются запросами в исходной среде Netezza, это может указывать на то, что в перенесенном синапсе Azure должен быть создан некластеризованный индекс, но другие методы оптимизации производительности, такие как репликация таблиц, могут быть более применимы, так как создание индексов выполняется по принципу "как есть".

<!-- docsTest:ignore "NZ Toolkit" -->

**Неподдерживаемые типы объектов базы данных Netezza:**

Netezza реализует некоторые объекты базы данных, которые не поддерживаются напрямую в Azure синапсе, но обычно существуют методы для достижения одной и той же функциональности в новой среде:

- **Карты зон:** В Netezza карты зон создаются автоматически и поддерживаются для некоторых типов столбцов и используются во время запроса, чтобы ограничить объем данных для сканирования. Они создаются в следующих типах столбцов:

  - `INTEGER`столбцы длиной 8 байт или меньше.
  - Временные столбцы (например `DATE` ,, `TIME` и `TIMESTAMP` ).
  - `CHAR`столбцы, если они являются частью материализованных представлений и упоминаются в `ORDER BY` предложении. Определить, какие столбцы имеют карты зон, можно с помощью служебной программы nz_zonemap (часть набора средств NZ).

  Azure синапсе не включает карты зон, но аналогичные результаты можно получить с помощью других (определяемых пользователем) типов индексов или секционирования.

- **Кластеризованные базовые таблицы (CBT):** В Netezza КБТС чаще всего используются для таблицы фактов, которая содержит миллиарды записей. Для сканирования такой большой таблицы требуется много времени на обработку, так как для получения нужных записей может потребоваться полное сканирование таблицы. Организация записей в ограниченном CBT с помощью позволяет Netezza группировать записи в тех же или ближайших экстентах, и этот процесс также создаст карты зон, повышающие производительность, уменьшая объем данных, которые необходимо просканировать.

  В Azure синапсе аналогичный результат может быть достигнут с помощью секционирования или использования других индексов.

- **Материализованные представления:** Netezza поддерживает материализованные представления и рекомендует, чтобы один или несколько из них создавались в больших таблицах, имеющих много столбцов, в которых в запросах регулярно используются только некоторые из этих столбцов. Материализованные представления автоматически обслуживаются системой, когда данные в базовой таблице обновляются. Начиная с мая 2019 Корпорация Майкрософт объявила о том, что Azure синапсе будет поддерживать материализованные представления с теми же функциями, что и Netezza. Теперь эта функция доступна в предварительной версии.

- **Сопоставление типов данных Netezza:** Большинство типов данных Netezza имеют прямой эквивалент в Синапсее Azure. Ниже приведена таблица, которая показывает эти типы данных вместе с рекомендуемым подходом для их сопоставления.

  Существуют сторонние поставщики, предлагающие средства и службы для автоматизации миграции, включая сопоставление типов данных, как описано выше. Кроме того, если средство ETL стороннего производителя, например Informatica или Таленд, уже используется в среде Netezza, они могут реализовать все необходимые преобразования данных.

- **Отличия синтаксиса SQL DML:** Существует несколько отличий синтаксиса языка обработки данных SQL (DML) между Netezza SQL и Azure синапсе, которые следует учитывать при миграции:

  <!-- TODO: This query should probably be a code snippet that the user can copy and use. -->

  ![SQL-запрос](../../../_images/analytics/sql-query-netezza.png)

### <a name="functions-stored-procedures-and-sequences"></a>Функции, хранимые процедуры и последовательности

При миграции из устаревшей среды хранилища данных, такой как Netezza, часто бывают элементы, отличные от простых таблиц и представлений, которые необходимо перенести в новую целевую среду. Примерами этого в Netezza являются функции, хранимые процедуры и последовательности. В рамках этапа подготовки необходимо создать инвентаризацию этих объектов, которые должны быть перенесены, и метод их обработки с соответствующим выделением ресурсов, назначенных в плане проекта.

Возможно, в среде Azure есть средства, которые заменяют функциональные возможности, реализованные в виде функций или хранимых процедур в среде Netezza. В этом случае, как правило, более эффективно использовать встроенные средства Azure вместо перекодирования функций Netezza.

Сторонние поставщики предлагают средства и службы, которые могут автоматизировать перенос этих приложений (см. примеры продуктов для миграции Attunity или Вхерескапе).

- **Функции:** Как правило, для большинства продуктов баз данных Netezza поддерживает системные функции, а также определяемые пользователем функции в реализации SQL. При переходе на другую платформу баз данных, например Azure синапсе, общие системные функции общедоступны и могут быть перенесены без изменений. Некоторые системные функции могут иметь немного другой синтаксис, но в этом случае необходимо автоматизировать все необходимые изменения.

  Для системных функций, для которых не существует эквивалента, для произвольных определяемых пользователем функций их может потребоваться перекодировать с использованием языков, доступных в целевой среде. Netezza определяемые пользователем функции кодируются в языках нзлуа или C++, а Azure синапсе использует популярный язык Transact-SQL для реализации определяемых пользователем функций.

- **Хранимые процедуры:** Большинство современных продуктов баз данных позволяют хранить процедуры в базе данных. Для этой цели Netezza предоставляет язык НЗПЛСКЛ. НЗПЛСКЛ основан на PostgreSQL PL/pgSQL. Хранимая процедура обычно содержит инструкции SQL и определенную логику и может возвращать данные или состояние.

  Хранилище данных SQL Azure также поддерживает хранимые процедуры с помощью T-SQL, поэтому при миграции хранимых процедур они должны быть перекодированы соответствующим образом.

- **Последовательности:** В Netezza последовательность — это именованный объект базы данных, созданный с помощью CREATE Sequence, который может предоставить уникальное значение с помощью следующего значения метода. Их можно использовать для создания уникальных чисел, которые можно использовать в качестве значений суррогатных ключей для значений первичного ключа.

  В Azure синапсе нет `CREATE SEQUENCE` , поэтому последовательности обрабатываются посредством использования столбцов идентификаторов или с помощью кода SQL для создания следующего порядкового номера в ряде.

### <a name="extracting-metadata-and-data-from-a-netezza-environment"></a>Извлечение метаданных и данных из среды Netezza

- **Создание DDL:** Можно изменить существующую Netezza CREATE TABLE и создать скрипты представления, чтобы создать эквивалентные определения (с измененными типами данных, как описано выше). Как правило, это подразумевает удаление или изменение любых дополнительных предложений Netezza (таких как `ORGANIZE ON` ).

  Однако все сведения, указывающие текущие определения таблиц и представлений в существующей среде Netezza, сохраняются в системных таблицах каталога. Это лучший источник этих сведений, так как он привязан к актуальному и завершенному. Возможно, документация, обслуживаемая пользователем, не синхронизирована с текущими определениями таблиц.

  Доступ к этим сведениям можно получить с помощью таких служебных программ, как nz_ddl_table и можно использовать для создания инструкций CREATE TABLE DDL, которые затем можно изменить для эквивалентных таблиц в Azure синапсе.

  Средства миграции и извлечения, используемые сторонними производителями, также используют сведения о каталоге для достижения того же результата.

- **Извлечение данных из Netezza:** Необработанные данные, которые необходимо перенести из существующих таблиц Netezza, можно извлечь в плоские файлы с разделителями, используя стандартные служебные программы Netezza, такие как нзскл, нзунлоад и с помощью внешних таблиц. Эти файлы можно сжать с помощью gzip и передать в хранилище BLOB-объектов Azure через AzCopy или с помощью средств транспорта данных Azure, таких как Azure Data Box.

  Во время миграции важно как можно более эффективно извлекать данные. Рекомендуемый подход для Netezza — использование внешних таблиц, что является самым быстрым методом. Несколько извлечений можно выполнить параллельно, чтобы увеличить пропускную способность для извлечения данных. Простой пример извлечения внешней таблицы приведен ниже.

  `CREATE EXTERNAL TABLE '/tmp/export_tab1.CSV' USING (DELIM ',') AS SELECT * from <TABLENAME>;`

Если существует достаточная пропускная способность сети, данные могут быть извлечены непосредственно из локальной системы Netezza в таблицы синапсе Azure или в хранилище данных Azure с помощью процессов фабрики данных Azure, переноса данных сторонних производителей или продуктов ETL.

Рекомендуемые форматы данных для извлеченных данных — это текстовые файлы с разделителями-запятыми или схожими, а также оптимизированные (ORC) или Parquet файлы в столбцах.

Более подробные сведения о процессе переноса данных и ETL из среды Netezza см. в соответствующем документе "раздел 2,1. Перенос данных ETL и Load" из Netezza.

### <a name="performance-recommendations-for-netezza-migrations"></a>Рекомендации по повышению производительности для Netezza миграции

- **Сходство с принципами настройки производительности:** При переходе из среды Netezza многие из концепций настройки производительности для хранилища данных SQL Azure будут знакомы. Пример.

  - Использование распределения данных для совместного размещения данных, объединяемых на один и тот же узел обработки.
  - Использование наименьшего типа данных для данного столбца позволит сэкономить место в хранилище и ускорить обработку запросов.
  - Обеспечение идентичности типов данных соединяемых столбцов позволит оптимизировать обработку соединения, уменьшая необходимость преобразования данных для сопоставления.
  - Обеспечение актуальности статистики поможет оптимизатору создать наилучший план выполнения.

- **Различия в подходе к настройке производительности:** В этом разделе описываются различия в реализации более низкого уровня между Netezza и Azure синапсе для настройки производительности.

- **Варианты распространения данных:** `CREATE TABLE` инструкции в Netezza и Azure синапсе позволяют определить определение распространения с помощью `DISTRIBUTE ON` для Netezza и `DISTRIBUTION =` в синапсе Azure.

  По сравнению с Netezza, Azure синапсе предоставляет дополнительный способ достижения локальных соединений для небольших табличных соединений таблиц (обычно таблицы измерений и таблицы фактов в модели начальной схемы) — это репликация таблицы измерения меньшего размера на все узлы. Таким образом, для любого значения ключа объединения в таблице большего размера будет доступна локальная строка измерения. Затраты на репликацию таблиц измерений относительно низкие, если таблицы не велики. В этом случае лучше подходит подход к распространению хэш-кода, как описано выше.

- **Индексирование данных:** Azure синапсе предоставляет ряд параметров индексирования, определяемых пользователем, но они отличаются в работе и использовании с управляемыми системой картами зон в Netezza. Изучите различные параметры индексирования, как описано в разделе. <!-- TODO verify link: https://docs.microsoft.com/en-us/azure/sql-data-warehouse/sql-datawarehouse-tables-index -->

  Существующие схемы зон, управляемые системой в исходной среде Netezza, тем не менее, могут указывать, как данные в настоящее время используются, и указывать столбцы кандидатов для индексирования в среде Azure синапсе.

- **Секционирование данных:** В хранилище данных предприятия таблицы фактов могут содержать много миллиардов строк и секционирования — это способ оптимизации обслуживания и выполнения запросов к этим таблицам путем разбиения их на отдельные части для уменьшения объема обрабатываемых данных. Спецификация секционирования для таблицы определена в инструкции CREATE TABLE.

  Для секционирования можно использовать только одно поле на таблицу, и это поле даты, которое будет использоваться для фильтрации нескольких запросов по датам или диапазонам дат. При необходимости можно изменить секционирование таблицы после начальной загрузки, повторно создав таблицу с новым распределением с помощью `CREATE TABLE AS SELECT` инструкции. См. <!-- TODO verify link https://docs.microsoft.com/en-us/azure/sql-datawarehouse/sql-data-warehouse-tables-partition --> Подробное описание секционирования в Azure синапсе.

- **Polybase для загрузки данных:** Polybase является наиболее эффективным способом загрузки больших объемов данных в хранилище, так как он может использовать параллельную загрузку потоков.

- **Используйте классы ресурсов для управления рабочей нагрузкой:** Azure синапсе использует классы ресурсов для управления рабочими нагрузками. Как правило, крупные классы ресурсов обеспечивают лучшую производительность отдельных запросов, а небольшие классы ресурсов обеспечивают более высокие уровни параллелизма. Использование можно отслеживать с помощью динамических административных представлений, чтобы обеспечить эффективное использование соответствующих ресурсов.

## <a name="next-steps"></a>Дальнейшие действия

Дополнительные сведения о реализации Netezza миграции см. в подучетная запись Майкрософт представителя по локальным предложениям миграции.
