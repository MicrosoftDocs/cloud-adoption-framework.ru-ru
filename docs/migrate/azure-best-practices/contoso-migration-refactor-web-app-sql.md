---
title: Перенос приложения в службу приложений Azure и базу данных SQL
description: Используйте платформу внедрения облаков для Azure, чтобы узнать, как выполнить рефакторинг приложения, переполнив его в службу приложений Azure и базу данных SQL Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: a3b3acd34131a9974703619fdea7bb55c3d9be6e
ms.sourcegitcommit: bcc73d194c6d00c16ae2e3c7fb2453ac7dbf2526
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86192340"
---
<!-- cSpell:ignore WEBVM SQLVM contosohost vcenter contosodc smarthotel SHWEB SHWCF -->

# <a name="migrate-an-application-to-azure-app-service-and-sql-database"></a>Перенос приложения в службу приложений Azure и базу данных SQL

В этой статье показано, как вымышленная компания Contoso представляет собой двухстороннее приложение Windows .NET, работающее на виртуальных машинах VMware, в рамках миграции в Azure. Они переносят клиентскую виртуальную машину приложения в веб-приложение службы приложений Azure и базу данных приложения в базу данных SQL Azure.

Приложение SmartHotel360, используемое в этом примере, предоставляется в виде открытого кода. Если вы хотите использовать его для тестирования, то можете скачать это приложение с сайта [GitHub](https://github.com/Microsoft/SmartHotel360).

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство и деловые партнеры определили указанные ниже цели этой миграции.

- **Устраните бизнес-рост.** По мере развития компании Contoso растет нагрузка на локальные системы и инфраструктуру.
- **Повышение эффективности.** Contoso необходимо удалить ненужные процедуры и оптимизировать процессы для разработчиков и пользователей. Бизнес нуждается в том, чтобы ИТ были быстрыми и чтобы не тратить время или деньги, обеспечивая более высокие требования клиентов.
- **Повышение гибкости.**  ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Должна реагировать быстрее, чем изменения на рынке, чтобы включить успех в глобальную экономику реагирования. Он не должен мешать или становиться помехой для бизнеса.
- **Измените.** По мере успешного развития бизнеса компания Contoso должна предоставлять системы, которые могут расти в том же темпе.
- **Сократите затраты.** Компании Contoso требуется минимизировать затраты на лицензирование.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции. Эти цели использовались для определения оптимального метода миграции.

| Требования | Сведения |
| --- | --- |
| **Приложения** | Приложение в Azure будет оставаться критически важным, как сегодня. <br><br> Должны быть доступны те же возможности производительности, что и в настоящее время в VMware. <br><br> Группа не хочет вкладываться в приложение. Сейчас администраторы будут безопасно перемещать приложение в облако. <br><br> Команда должна прерывать поддержку Windows Server 2008 R2, на котором приложение выполняется в данный момент. <br><br> Группа также хочет перейти от SQL Server 2008 R2 к современной платформе базы данных PaaS, что снизит потребность в управлении. <br><br> Contoso хочет использовать преимущества своих инвестиций в лицензирование SQL Server и Software Assurance по мере возможности. <br><br> Кроме того, компания Contoso хочет перенести единую точку отказа на веб-уровень. |
| **Ограничения** | Приложение состоит из приложения ASP.NET и службы WCF, работающей на одной виртуальной машине. Они хотят распространить эти компоненты между двумя веб-приложениями с помощью службы приложений Azure. |
| **Azure** | Компания Contoso хочет переместить приложение в Azure, но не хочет его запускать на виртуальных машинах. Компания хочет использовать службы PaaS Azure и для уровня данных, и для веб-уровня. |
| **DevOps** | Contoso хочет перейти на модель DevOps, используя Azure DevOps для конвейеров сборки и выпуска. |

## <a name="solution-design"></a>Архитектура решения

Определив цели и требования, специалисты Contoso начинают разработку и анализ решения развертывания и идентифицируют процесс миграции, включая службы Azure, которые будут использоваться при миграции.

### <a name="current-application"></a>Текущее приложение

- Локальное приложение SmartHotel360 распределено между двумя виртуальными машинами ( `WEBVM` и `SQLVM` ).
- Виртуальные машины расположены на узле VMware ESXi `contosohost1.contoso.com` (версии 6.5).
- Среда VMware находится под управлением сервера vCenter Server 6.5 (`vcenter.contoso.com`), запущенного на виртуальной машине.
- Компания Contoso использует локальный центр обработки данных (`contoso-datacenter`) с локальным контроллером домена (`contosodc1`).
- После завершения миграции локальные виртуальные машины в центре обработки данных Contoso будут выведены из эксплуатации.

### <a name="proposed-solution"></a>Предлагаемое решение

- Для уровня базы данных приложения компания Contoso сравнивала базу данных SQL Azure с SQL Server, используя [эту статью](https://docs.microsoft.com/azure/sql-database/sql-database-features). Компания Contoso решила использовать базу данных SQL Azure по нескольким причинам:
  - База данных SQL Azure — это служба управляемой реляционной базы данных. Она обеспечивает прогнозируемую производительность на нескольких уровнях обслуживания с почти нулевым администрированием. Среди преимуществ: динамическая масштабируемость без простоя, встроенная интеллектуальная оптимизация, глобальная масштабируемость и доступность.
  - Компания Contoso может использовать упрощенный Помощник по миграции данных (DMA) для оценки локальной базы данных в Azure SQL.
  - Contoso может использовать Azure Database Migration Service для переноса локальной базы данных в SQL Azure.
  - Software Assurance позволит Contoso приобрести Базу данных SQL по сниженной цене, воспользовавшись предложением "Преимущество гибридного использования Azure" для SQL Server. Это может обеспечить экономию до 30 %.
  - База данных SQL предоставляет такие функции безопасности, как Always Encrypted, динамическое Маскирование данных, безопасность на уровне строк и обнаружение угроз SQL.
- Для веб-уровня приложения компания Contoso решила использовать службу приложений Azure. Эта служба PaaS позволяет развернуть приложение, используя лишь несколько изменений конфигурации. Contoso хочет использовать Visual Studio для внесения изменений и развертывания двух веб-приложений. Одно для веб-сайта, а другое для службы приложения WCF.
- Для удовлетворения требований к DevOps конвейеру компания Contoso выбрала использование Azure DevOps для управления исходным кодом (SCM) с помощью git репозиториев. Автоматические сборки и выпуски будут использоваться для компиляции кода и развертывания его в Службе приложений Azure.

### <a name="solution-review"></a>Проверка решения

Contoso оценивает предлагаемый дизайн, составляя список плюсов и минусов.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Код приложения SmartHotel360 не требует изменений для миграции в Azure. <br><br> Contoso может использовать преимущества своих инвестиций в программу Software Assurance, используя Преимущество гибридного использования Azure для SQL Server и Windows Server. <br><br> После переноса не потребуется поддерживать Windows Server 2008 R2. Дополнительные сведения см. в статье [Политика жизненного цикла Майкрософт](https://aka.ms/lifecycle). <br><br> Компания Contoso может настроить веб-уровень приложения с несколькими экземплярами, чтобы он больше не был единой точкой отказа. <br><br> Исчезнет зависимость базы данных от устаревающей платформы SQL Server 2008 R2. <br><br> База данных SQL поддерживает технические требования. Компания Contoso оценивает локальную базу данных с помощью Помощник по миграции данных и обнаружила, что она совместима. <br><br> База данных SQL Azure имеет встроенную отказоустойчивость, которую не нужно настраивать компании Contoso. Это гарантия того, что уровень данных больше не является единой точкой отказа. <br><br> Если компания Contoso использует Azure Database Migration Service для переноса базы данных, инфраструктура будет готова к миграции баз данных в нужном масштабе. |
| **Недостатки** | Служба приложений Azure поддерживает только одно развертывание приложений для каждого веб-приложения. Это означает, что необходимо подготовить два веб-приложения (одно для веб-сайта, а другое для службы WCF). |

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![Архитектура сценария](./media/contoso-migration-refactor-web-app-sql/architecture.png)

### <a name="migration-process"></a>Процесс миграции

1. Компания Contoso подготавливает экземпляр SQL Azure и переносит на него базу данных SmartHotel360 с помощью Azure Database Migration Service.
2. Компания Contoso подготавливает и настраивает веб-приложения, а также развертывает в них приложение SmartHotel360.

    ![Процесс миграции](./media/contoso-migration-refactor-web-app-sql/migration-process.png)

### <a name="azure-services"></a>Службы Azure

| Служба | Описание | Стоимость |
| --- | --- | --- |
| [Помощник по миграции данных (DMA)](https://docs.microsoft.com/sql/dma/dma-overview?view=ssdt-18vs2017) | DMA используется специалистами Contoso для оценки и выявления проблем совместимости, которые могут повлиять на функциональность базы данных в Azure. Помощник оценивает соотношение характеристик между источниками и целями SQL и предоставляет рекомендации по улучшению производительности и надежности. | Это средство можно загрузить бесплатно. |
| [Миграция баз данных Azure](https://docs.microsoft.com/azure/dms/dms-overview) | Azure Database Migration Service обеспечивает простой перенос из нескольких источников базы данных в платформы данных Azure с минимальным временем простоя. | Дополнительные сведения о [поддерживаемых регионах](https://docs.microsoft.com/azure/dms/dms-overview#regional-availability) см. на странице [цен на Database Migration Service](https://azure.microsoft.com/pricing/details/database-migration). |
| [База данных SQL Azure](https://docs.microsoft.com/azure/azure-sql/database/sql-database-paas-overview) | Интеллектуальная полностью управляемая реляционная служба облачной базы данных. | Стоимость зависит от функций, пропускной способности и размера. [Подробнее](https://azure.microsoft.com/pricing/details/sql-database/managed). |
| [Служба приложений Azure](https://docs.microsoft.com/azure/app-service/overview) | Создание мощных облачных приложений с помощью полностью управляемой платформы | Стоимость зависит от размера, расположения и длительности использования. [Подробнее](https://azure.microsoft.com/pricing/details/app-service/windows). |
| [Azure DevOps](https://docs.microsoft.com/azure/azure-portal/tutorial-azureportal-devops) | Предоставляет конвейер непрерывной интеграции и непрерывного развертывания (CI/CD) для разработки приложений. Конвейер начинается с репозитория Git для управления кодом приложения, системы сборки для создания пакетов и других артефактов сборки, а также системы управления выпусками для развертывания изменений в средах разработки, тестирования и рабочей среде. |

## <a name="prerequisites"></a>Предварительные требования

Ниже показано, что необходимо сделать специалистам компании Contoso, чтобы реализовать этот сценарий.

| Требования | Сведения |
| --- | --- |
| **Подписка Azure.** | Компания Contoso уже создала подписки (это описывается в одной из предыдущих статей этой серии). Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись](https://azure.microsoft.com/free). <br><br> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия. <br><br> Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника. |
| **Инфраструктура Azure** | [Узнайте, как](./contoso-migration-infrastructure.md) компания Contoso настраивает инфраструктуру Azure. |

## <a name="scenario-steps"></a>Шаги выполнения сценария

Ниже рассказывается, как компания Contoso выполняет миграцию.

> [!div class="checklist"]
>
> - **Шаг 1. подготавливает экземпляр базы данных SQL в Azure.** Специалисты компании Contoso выполняют подготовку экземпляра SQL в Azure. После миграции веб-сайта приложения в Azure веб-приложение службы WCF будет указывать на этот экземпляр.
> - **Шаг 2. Оценка базы данных с помощью Azure Помощник по миграции данных (DMA) и перенос ее с помощью Azure Database Migration Service.** Компания Contoso оценивает базу данных для миграции, а затем переносит базу данных приложения с помощью Azure Database Migration Service.
> - **Шаг 3. предоставление веб-приложений.** Специалисты компании Contoso выполняют подготовку двух веб-приложений.
> - **Шаг 4. Настройка Azure DevOps.** Специалисты компании Contoso создают новый проект Azure DevOps и импортируют репозитории Git.
> - **Шаг 5. Настройка строк подключения.** Специалисты компании Contoso настраивают строки подключения для обеспечения взаимодействия веб-приложения веб-уровня, веб-приложения службы WCF и экземпляра SQL.
> - **Шаг 6. Настройка конвейеров сборки и выпуска.** В качестве последнего шага компания Contoso настраивает конвейеры сборки и выпуска для создания приложения и развертывает их в двух отдельных веб-приложениях.

## <a name="step-1-provision-azure-sql-database"></a>Шаг 1. Инициализация базы данных SQL Azure

1. Администраторы Contoso выбирают создание экземпляра базы данных SQL Azure.

    ![Подготовка SQL](./media/contoso-migration-refactor-web-app-sql/provision-sql1.png)

2. Они указывают имя базы данных в соответствии с базой данных, работающей на локальной виртуальной машине ( `SmartHotel.Registration` ). Они размещают базу данных в `ContosoRG` группе ресурсов. Это группа ресурсов, которую специалисты компании используют для рабочих ресурсов в Azure.

    ![Подготавливает экземпляр базы данных SQL Azure](./media/contoso-migration-refactor-web-app-sql/provision-sql2.png)

3. Они настроили новый экземпляр SQL Server ( `sql-smarthotel-eus2` ) в основном регионе.

    ![Подготовка SQL](./media/contoso-migration-refactor-web-app-sql/provision-sql3.png)

4. Они задают ценовую категорию в соответствии с потребностями своего сервера и базы данных, а также предпочитают сэкономить с помощью предложения "Преимущество гибридного использования Azure", так как у них уже есть лицензия SQL Server.
5. Для изменения размера они используют виртуальное ядроное приобретение и устанавливают ограничения для ожидаемых требований.

    ![Подготовка SQL](./media/contoso-migration-refactor-web-app-sql/provision-sql4.png)

6. Затем они создают экземпляр базы данных.

    ![Подготовка SQL](./media/contoso-migration-refactor-web-app-sql/provision-sql5.png)

7. После создания экземпляра он откроет базу данных и запомните сведения, необходимые при использовании Помощник по миграции данных для миграции.

    ![Подготовка SQL](./media/contoso-migration-refactor-web-app-sql/provision-sql6.png)

**Требуется дополнительная помощь?**

- [Получение справки](https://docs.microsoft.com/azure/sql-database/sql-database-get-started-portal) о подготовке Базы данных SQL.
- Дополнительные сведения об [ограничениях ресурсов Виртуальное ядро](https://docs.microsoft.com/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools).

## <a name="step-2-assess-the-database-using-data-migration-assistant-dma-and-migrate-it-using-azure-database-migration-service"></a>Шаг 2. Оценка базы данных с помощью Помощник по миграции данных (DMA) и перенос ее с помощью Azure Database Migration Service

Администраторы Contoso оценивают базу данных с помощью Помощник по миграции данных (DMA), а затем переносят ее с помощью Azure Database Migration Service используя пошаговое [руководство по миграции](https://docs.microsoft.com/azure/dms/tutorial-sql-server-azure-sql-online). Они могут выполнять интерактивные, автономные и гибридные (предварительные) миграции.

В качестве сводки необходимо выполнить следующие действия.

- Используйте Помощник по миграции данных (DMA) для обнаружения и устранения любых проблем, связанных с миграцией базы данных.
- Создайте экземпляр Azure Database Migration Service с `Premium` номером SKU, подключенным к виртуальной сети.
- Убедитесь, что экземпляр может получить доступ к удаленным SQL Server через виртуальную сеть. Это гарантирует, что все входящие порты будут разрешены в Azure для SQL Server на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается SQL Server.
- Настройте экземпляр:
  - Создайте проект миграции.
  - Добавьте источник (локальная база данных).
  - Выберите целевой объект.
  - Выберите базы данных для миграции.
  - Настройка дополнительных параметров.
  - Запустите репликацию.
  - Устраните возможные ошибки.
  - Выполните окончательный прямую миграцию.

## <a name="step-3-provision-web-apps"></a>Шаг 3. предоставление веб-приложений

Сейчас, когда база данных уже перенесена, администраторы Contoso могут подготовить два веб-приложения.

1. На портале специалисты компании выбирают **Веб-приложение**.

    ![Веб-приложение](./media/contoso-migration-refactor-web-app-sql/web-app1.png)

2. Они предоставляют имя для веб-приложения ( `SHWEB-EUS2` ), запускайте его в Windows и размещают в Рабочей группе ресурсов `ContosoRG` . Специалисты компании создают веб-приложение и план службы приложений Azure.

    ![Веб-приложение](./media/contoso-migration-refactor-web-app-sql/web-app2.png)

3. После подготовки веб-приложения он повторяет процесс создания веб-приложения для службы WCF ( `SHWCF-EUS2` ).

    ![Веб-приложение](./media/contoso-migration-refactor-web-app-sql/web-app3.png)

4. После этого они будут просматривать адреса приложений, чтобы убедиться, что они были успешно созданы.

## <a name="step-4-set-up-azure-devops"></a>Шаг 4. Настройка Azure DevOps

Компании Contoso необходимо создать инфраструктуру DevOps и конвейеры для приложения. Для этого администраторы Contoso создают проект DevOps, импортируют код, а затем настраивают конвейеры сборки и выпуска.

1. В организации Contoso Azure DevOps создайте новый проект ( `ContosoSmartHotelRefactor` ), а затем выберите **Git** для управления версиями.

    ![Новый проект](./media/contoso-migration-refactor-web-app-sql/vsts1.png)

2. Они импортируют репозиторий Git, в настоящее время содержащий код приложения. Он находится в [общедоступном репозитории GitHub](https://github.com/Microsoft/SmartHotel360-Registration) , и его можно скачать.

    ![Скачивание кода приложения](./media/contoso-migration-refactor-web-app-sql/vsts2.png)

3. После импорта кода они подключают Visual Studio к репозиторию и клонируют код с помощью Team Explorer.

    ![Подключение к проекту](./media/contoso-migration-refactor-web-app-sql/devops1.png)

4. После клонирования репозитория на компьютер разработчика он открывает файл решения для приложения. Веб-приложение и служба WCF имеют отдельный проект в файле.

    ![Файл решения](./media/contoso-migration-refactor-web-app-sql/vsts4.png)

## <a name="step-5-configure-connection-strings"></a>Шаг 5. Настройка строк подключения

Администраторы компании Contoso должны убедиться, что веб-приложения и база данных могут взаимодействовать. Чтобы сделать это, они настраивают строки подключения в коде и в веб-приложениях.

1. В веб-приложении для службы WCF ( `SHWCF-EUS2` ) > **Параметры**параметры  >  **приложения**, они добавляют новую строку подключения с именем `DefaultConnection` .
2. Строка подключения извлекается из `SmartHotel-Registration` базы данных и должна быть обновлена с использованием правильных учетных данных.

    ![Строка подключения](./media/contoso-migration-refactor-web-app-sql/string1.png)

3. С помощью Visual Studio они открывают `SmartHotel.Registration.wcf` проект из файла решения. `connectionStrings`Раздел `web.config` файла для службы WCF `SmartHotel.Registration.wcf` должен быть обновлен с помощью строки подключения.

     ![Строка подключения](./media/contoso-migration-refactor-web-app-sql/string2.png)

4. `client`Раздел `web.config` файла для `SmartHotel.registration.web` должен быть изменен, чтобы он указывал на новое расположение службы WCF. Это URL-адрес веб-приложения WCF, на котором размещена конечная точка службы.

    ![Строка подключения](./media/contoso-migration-refactor-web-app-sql/strings3.png)

5. После внесения изменений в код администраторам необходимо зафиксировать их. С помощью Team Explorer в Visual Studio они выполняют фиксацию и синхронизацию.

## <a name="step-6-set-up-build-and-release-pipelines-in-azure-devops"></a>Шаг 6. Настройка конвейеров сборки и выпуска в Azure DevOps

Теперь администраторы Contoso настраивают Azure DevOps для сборки и выпуска.

1. В Azure DevOps выберите **Сборка и выпуск**  >  **нового конвейера**.

    ![Новый конвейер](./media/contoso-migration-refactor-web-app-sql/pipeline1.png)

2. Они выбирают **Azure Repos Git** и соответствующий репозиторий.

    ![Git и репозиторий](./media/contoso-migration-refactor-web-app-sql/pipeline2.png)

3. В разделе **Выбор шаблона** они выбирают шаблон ASP.NET для сборки.

     ![Шаблон ASP.NET](./media/contoso-migration-refactor-web-app-sql/pipeline3.png)

4. Имя `ContosoSmartHotelRefactor-ASP.NET-CI` используется для сборки. Администраторы выбирают **Сохранить и поместить в очередь**.

     ![Сохранение и помещение в очередь](./media/contoso-migration-refactor-web-app-sql/pipeline4.png)

5. После этого запускается их первая сборка. Они выбирают номер сборки для просмотра процесса. После его завершения можно увидеть отзыв о процессе, а затем выбрать **артефакты** для просмотра результатов сборки.

    ![Проверка](./media/contoso-migration-refactor-web-app-sql/pipeline5.png)

6. Результаты сборки находятся в папке **Drop**.

    - Два ZIP-файла — это пакеты, содержащие приложения.
    - Эти файлы используются в конвейере выпуска для развертывания в Службе приложений Azure.

     ![Артефакт](./media/contoso-migration-refactor-web-app-sql/pipeline6.png)

7. Они выбирают **выпуски**  >  **+ Новый конвейер**.

    ![Новый конвейер](./media/contoso-migration-refactor-web-app-sql/pipeline7.png)

8. Они выбирают шаблон развертывания Службы приложений Azure.

    ![Шаблон развертывания для Службы приложений Azure](./media/contoso-migration-refactor-web-app-sql/pipeline8.png)

9. Они задают имя конвейера выпуска `ContosoSmartHotel360Refactor` и указывают имя веб-приложения WCF ( `SHWCF-EUS2` ) для имени **этапа** .

    ![Environment](./media/contoso-migration-refactor-web-app-sql/pipeline9.png)

10. В разделе этапов они выбирают **1 задание, 1 задача**, чтобы настроить развертывание службы приложения WCF.

    ![Развертывание WCF](./media/contoso-migration-refactor-web-app-sql/pipeline10.png)

11. Они подтверждают, что подписка выбрана и авторизация, и выбирает **имя службы приложений**.

     ![Выбор имени службы приложений](./media/contoso-migration-refactor-web-app-sql/pipeline11.png)

12. В конвейере > **артефакты**выберите **+ Добавить артефакт**, а затем выберите для построения с помощью `ContosoSmarthotel360Refactor` конвейера.

     ![Построение](./media/contoso-migration-refactor-web-app-sql/pipeline12.png)

13. Они проверяют, что артефакт включен, чтобы включить триггер непрерывного развертывания.

     ![Молния](./media/contoso-migration-refactor-web-app-sql/pipeline13.png)

14. Триггер непрерывного развертывания должен быть в положении **Включено**.

    ![Непрерывное развертывание включено](./media/contoso-migration-refactor-web-app-sql/pipeline14.png)

15. Теперь они переходят на **Задание этапа 1, 1 задачу**, а затем выберите пункт **развернуть службу приложений Azure**.

    ![развертывание Службы приложений Azure;](./media/contoso-migration-refactor-web-app-sql/pipeline15.png)

16. В окне **Выбор файла или папки**они находят `SmartHotel.Registration.Wcf.zip` файл, который был создан во время сборки, а затем нажмите кнопку **сохранить**.

    ![Сохранение WCF](./media/contoso-migration-refactor-web-app-sql/pipeline16.png)

17. Они выбирают **Этапы конвейера**  >  **Stages**, **+ Добавить** , чтобы добавить среду для `SHWEB-EUS2` . Они выбирают другое развертывание Службы приложений Azure.

    ![Добавление среды](./media/contoso-migration-refactor-web-app-sql/pipeline17.png)

18. Они повторяют процесс, чтобы опубликовать файл веб-приложения ( `SmartHotel.Registration.Web.zip` ) в нужном веб-приложении.

    ![Публикация веб-приложения](./media/contoso-migration-refactor-web-app-sql/pipeline18.png)

19. После сохранения конвейер выпуска будет отображаться следующим образом.

     ![Итоговое представление конвейера выпуска](./media/contoso-migration-refactor-web-app-sql/pipeline19.png)

20. Они переходят на **сборку**, а затем выберите **триггеры**  >  **включить непрерывную интеграцию**. Это активирует конвейер, чтобы во время фиксации изменений в коде, происходили полная сборка и выпуск.

    ![Включение непрерывной интеграции](./media/contoso-migration-refactor-web-app-sql/pipeline20.png)

21. Они выбирают **Сохранить и поместить в очередь** для выполнения всего конвейера. Будет активирована новая сборка, которая, в свою очередь, создает первый выпуск приложения в службе приложений Azure.

    ![Сохранение конвейера](./media/contoso-migration-refactor-web-app-sql/pipeline21.png)

22. Администраторы компании Contoso могут выполнить конвейер сборки и выпуска из Azure DevOps. После завершения сборки начнется выпуск.

    ![Сборка и выпуск приложения](./media/contoso-migration-refactor-web-app-sql/pipeline22.png)

23. После завершения конвейера разворачиваются оба сайта, и приложение работает и запускается в режиме «в сети».

    ![Завершение выпуска](./media/contoso-migration-refactor-web-app-sql/pipeline23.png)

На этом этапе приложение успешно перенесено в Azure.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После миграции специалистам компании Contoso необходимо выполнить указанные ниже действия по очистке.

- Удалите локальные виртуальные машины из перечня в vCenter.
- Удалить виртуальные машины из локальных заданий резервного копирования.
- Обновите внутреннюю документацию, чтобы отобразить новые расположения для приложения SmartHotel360. Отображение базы данных в качестве выполняемой в базе данных SQL Azure, а также внешнего интерфейса в двух веб-приложениях.
- Проверить все ресурсы, взаимодействующие с резервными виртуальными машинами, и обновить все соответствующие параметры или документы согласно новой конфигурации.

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда выполняется миграция ресурсов в Azure, компании Contoso необходимо полностью ввести его в эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

- Компания Contoso должна обеспечить `SmartHotel-Registration` безопасность новой базы данных. [Подробнее](https://docs.microsoft.com/azure/sql-database/sql-database-security-overview).
- В частности, компании Contoso нужно обновить веб-приложения для использования SSL с сертификатами.

### <a name="backups"></a>Резервные копии

- Contoso следует рассмотреть требования резервного копирования для базы данных SQL Azure. [Подробнее](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups).
- Contoso также потребуются дополнительные сведения об управлении резервным копированием и восстановлением Базы данных SQL. См. [дополнительные сведения](https://docs.microsoft.com/azure/sql-database/sql-database-automated-backups) об автоматическом резервном копировании.
- Компании Contoso нужно рассмотреть реализацию групп отработки отказа для обеспечения отказоустойчивости в регионе для базы данных. [Подробнее](https://docs.microsoft.com/azure/sql-database/sql-database-geo-replication-overview).
- Компания Contoso должна рассмотреть возможность развертывания веб-приложения в основном регионе ( `East US 2` ) и в регионе дополнительного региона ( `Central US` ) для обеспечения устойчивости. Компания Contoso может настроить диспетчер трафика, чтобы обеспечить отработку отказа во время региональных сбоев.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- После развертывания всех ресурсов специалисты компании Contoso должны назначить теги Azure в соответствии со своим [планированием инфраструктуры](./contoso-migration-infrastructure.md#set-up-tagging).
- Полное лицензирование входит в стоимость служб PaaS, которые использует Contoso. Это будет вычтено из EA.
- Компания Contoso будет использовать службу " [Управление затратами Azure" и выставление счетов](https://docs.microsoft.com/azure/cost-management-billing/cost-management-billing-overview) , чтобы гарантировать, что они останутся в бюджетах, установленных по ИТ.

## <a name="conclusion"></a>Заключение

В этой статье компания Contoso выполнила рефакторинг приложения SmartHotel360 в Azure путем переноса клиентской виртуальной машины приложения в два веб-приложения службы приложений Azure. База данных приложения была перенесена в базу данных SQL Azure.
