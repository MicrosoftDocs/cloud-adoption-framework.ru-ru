---
title: Перенос приложения в службу приложений Azure и базу данных SQL
description: Используйте платформу внедрения облаков для Azure, чтобы узнать, как выполнить рефакторинг приложения, переполнив его в службу приложений Azure и базу данных SQL Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: eebdbb5db757cb498b77aceaec724437c451080a
ms.sourcegitcommit: 917188fa930cadddb03f9e9bbcdd7b630e4ee33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88282282"
---
<!-- cSpell:ignore WEBVM SQLVM contosohost vcenter contosodc smarthotel SHWEB SHWCF -->

# <a name="migrate-an-application-to-azure-app-service-and-sql-database"></a>Перенос приложения в службу приложений Azure и базу данных SQL

В этой статье показано, как вымышленная компания Contoso представляет собой двухстороннее приложение Windows .NET, которое работает на виртуальных машинах VMware в процессе миграции в Azure. Группа Contoso переносит клиентскую виртуальную машину приложения в веб-приложение службы приложений Azure и базу данных приложения в базу данных SQL Azure.

Приложение SmartHotel360, используемое в этом примере, предоставляется в виде открытого кода. Если вы хотите использовать его для тестирования, вы можете скачать его с сайта [GitHub](https://github.com/Microsoft/SmartHotel360).

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство Contoso и деловые партнеры определили указанные ниже цели этой миграции.

- **Устраните бизнес-рост**. Компания Contoso растет, и на локальных системах и в инфраструктуре возникает давление.
- **Повышение эффективности**. Компании Contoso необходимо удалить ненужные процедуры и упростить процессы для разработчиков и пользователей. Бизнес нуждается в том, чтобы ИТ были быстрыми и чтобы не тратить время или деньги, обеспечивая более высокие требования клиентов.
- **Повышение гибкости**. Чтобы обеспечить успешную работу в глобальной экономике, компания Contoso должна быть в большей мере реагировать на потребности бизнеса. Она должна иметь возможность быстрее реагировать на изменения в Marketplace. Он не должен быть в том виде, в каком он был заблокирован.
- **Масштабирование**. По мере успешного роста бизнеса ИТ-отдел компании Contoso должен предоставлять системы, способные расти в том же темпе.
- **Сокращение затрат**. Компании Contoso требуется минимизировать затраты на лицензирование.

## <a name="migration-goals"></a>Цели миграции

Чтобы определить наилучший способ переноса, группа Contoso Cloud закрепляет следующие цели:

| Требования | Сведения |
| --- | --- |
| **Приложение** | Приложение в Azure будет по-прежнему иметь важное значение, так как сегодня локально. <br><br> Должны быть доступны те же возможности производительности, что и в настоящее время в VMware. <br><br> Группа не хочет вкладываться в приложение. Сейчас администраторы будут просто перемещать приложение в облако. <br><br> Группа хочет прерывать поддержку Windows Server 2008 R2, на которой запущено приложение. <br><br> Группа также хочет перейти от SQL Server 2008 R2 к современной базе данных платформы как услуги (PaaS), что снизит потребность в управлении. <br><br> Contoso хочет использовать преимущества своих инвестиций в лицензирование SQL Server и Software Assurance по мере возможности. <br><br> Кроме того, компания Contoso хочет перенести единую точку отказа на веб-уровень. |
| **Ограничения** | Приложение состоит из приложения ASP.NET и службы Windows Communication Foundation (WCF), работающей на одной виртуальной машине. Они хотят распространить эти компоненты между двумя веб-приложениями с помощью службы приложений Azure. |
| **Azure** | Компания Contoso хочет переместить приложение в Azure, но не захочет его запускать на виртуальных машинах. Компания хочет использовать службы PaaS Azure и для уровня данных, и для веб-уровня. |
| **DevOps** | Contoso хочет перейти на модель DevOps, которая использует Azure DevOps для своих сборок и конвейеров выпуска. |

## <a name="solution-design"></a>Архитектура решения

После фиксации их целей и требований компания Contoso проектирует и изучает решение для развертывания. Они также указывают процесс миграции, включая службы Azure, которые они будут использовать для миграции.

### <a name="current-application"></a>Текущее приложение

- Локальное приложение SmartHotel360 распределено между двумя виртуальными машинами `WEBVM` и `SQLVM` .
- Виртуальные машины расположены на VMware ESXi узле contosohost1.contoso.com версии 6,5.
- Среда VMware управляется vCenter Server 6,5 (vcenter.contoso.com), которая выполняется на виртуальной машине.
- Contoso использует локальный центр обработки данных (contoso-datacenter) с локальным контроллером домена (contosodc1).
- После завершения миграции локальные виртуальные машины в центре обработки данных Contoso будут выведены из эксплуатации.

### <a name="proposed-solution"></a>Предлагаемое решение

- Для уровня базы данных приложения Contoso сравнивает базу данных SQL Azure с SQL Server, ссылаясь на [Сравнение функций: база данных SQL Azure и управляемый экземпляр SQL Azure](/azure/sql-database/sql-database-features). Компания Contoso решила использовать базу данных SQL Azure по нескольким причинам:
  - База данных SQL Azure — это служба управляемой реляционной базы данных. Она обеспечивает прогнозируемую производительность на нескольких уровнях обслуживания с почти нулевым администрированием. Среди преимуществ: динамическая масштабируемость без простоя, встроенная интеллектуальная оптимизация, глобальная масштабируемость и доступность.
  - Компания Contoso может использовать упрощенные Помощник по миграции данных для оценки миграции локальной базы данных в Azure SQL.
  - Contoso может использовать Azure Database Migration Service для переноса локальной базы данных в SQL Azure.
  - С помощью программы Software Assurance Contoso может обмениваться существующими лицензиями для тарифных скидок на базу данных в базе данных SQL, используя Преимущество гибридного использования Azure для SQL Server. Такой подход может обеспечить экономичное хранение до 30%.
  - База данных SQL предоставляет такие функции безопасности, как Always Encrypted, динамическое Маскирование данных, безопасность на уровне строк и обнаружение угроз SQL.
- Для веб-уровня приложения компания Contoso решила использовать службу приложений Azure. Эта служба PaaS позволяет развертывать приложения с помощью всего лишь нескольких изменений конфигурации. Contoso будет использовать Visual Studio для внесения изменений и развернуть два веб-приложения: один для веб-сайта и один для службы WCF.
- Чтобы удовлетворить требования для конвейера DevOps, Contoso будет использовать Azure DevOps для управления исходным кодом с помощью git репозиториев. Они будут использовать автоматизированные сборки и выпуск для создания кода и его развертывания в службе приложений Azure.

### <a name="solution-review"></a>Проверка решения

Компания Contoso оценивает предлагаемую конструкцию, объединяя список «плюсы» и «минус», как показано в следующей таблице.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Код приложения SmartHotel360 не требует изменений для миграции в Azure. <br><br> Компания Contoso может воспользоваться преимуществами своих инвестиций в Software Assurance, используя Преимущество гибридного использования Azure как для SQL Server, так и для Windows Server. <br><br> После переноса не потребуется поддерживать Windows Server 2008 R2. Дополнительные сведения см. в статье [Политика жизненного цикла Майкрософт](https://aka.ms/lifecycle). <br><br> Компания Contoso может настроить веб-уровень приложения с несколькими экземплярами, чтобы веб-уровень больше не был единой точкой отказа. <br><br> Исчезнет зависимость базы данных от устаревающей платформы SQL Server 2008 R2. <br><br> База данных SQL поддерживает технические требования. Компания Contoso оценивает локальную базу данных с помощью Помощник по миграции данных и обнаружила, что она совместима. <br><br> База данных SQL Azure имеет встроенную отказоустойчивость, которую не нужно настраивать компании Contoso. Это гарантия того, что уровень данных больше не является единой точкой отказа. <br><br> Если компания Contoso использует Azure Database Migration Service для переноса базы данных, инфраструктура будет готова к миграции баз данных в нужном масштабе. |
| **Недостатки** | Служба приложений Azure поддерживает только одно развертывание приложений для каждого веб-приложения. Это означает, что необходимо подготовить два веб-приложения: одно для веб-сайта, а другое — для службы WCF. |

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![Схема предлагаемой архитектуры.](./media/contoso-migration-refactor-web-app-sql/architecture.png)

### <a name="migration-process"></a>Процесс миграции

1. Компания Contoso подготавливает управляемый экземпляр SQL Azure, а затем переносит на него базу данных SmartHotel360 с помощью Azure Database Migration Service.
1. Компания Contoso подготавливает и настраивает веб-приложения, а также развертывает в них приложение SmartHotel360.

    ![Схема процесса миграции.](./media/contoso-migration-refactor-web-app-sql/migration-process.png)

### <a name="azure-services"></a>Службы Azure

| Служба | Описание | Стоимость |
| --- | --- | --- |
| [Помощник по миграции данных](/sql/dma/dma-overview?view=ssdt-18vs2017) | Contoso будет использовать Помощник по миграции данных для оценки и обнаружения проблем совместимости, которые могут повлиять на функциональность базы данных в Azure. Помощник по миграции данных оценивает четность функций между источниками и целями SQL, а также рекомендует повысить производительность и надежность. | Это загружаемое средство бесплатно. |
| [Azure Database Migration Service](/azure/dms/dms-overview) | Azure Database Migration Service обеспечивает простой перенос из нескольких источников базы данных в платформы данных Azure с минимальным временем простоя. | Дополнительные сведения о [поддерживаемых регионах](/azure/dms/dms-overview#regional-availability) см. на странице [цен на Database Migration Service](https://azure.microsoft.com/pricing/details/database-migration). |
| [База данных SQL Azure](/azure/azure-sql/database/sql-database-paas-overview) | Интеллектуальная полностью управляемая реляционная служба облачной базы данных. | Стоимость зависит от функций, пропускной способности и размера. [Подробнее.](https://azure.microsoft.com/pricing/details/sql-database/managed) |
| [Служба приложений Azure](/azure/app-service/overview) | Помогает создавать мощные облачные приложения, использующие полностью управляемую платформу. | Цены основываются на размере, расположении и продолжительности использования. [Подробнее.](https://azure.microsoft.com/pricing/details/app-service/windows) |
| [Azure DevOps](/azure/azure-portal/tutorial-azureportal-devops) | Предоставляет конвейер непрерывной интеграции и непрерывного развертывания (CI/CD) для разработки приложений. Конвейер начинается с репозитория Git для управления кодом приложения, системы сборки для создания пакетов и других артефактов сборки, а также системы управления выпусками для развертывания изменений в средах разработки, тестирования и рабочей среде. |

## <a name="prerequisites"></a>Предварительные требования

Для выполнения этого сценария компания Contoso должна соответствовать следующим предварительным требованиям:

| Требования | Сведения |
| --- | --- |
| **Подписка Azure.** | Специалисты Contoso создали подписки ранее в этой серии статей. Если у вас еще нет подписки Azure, создайте [бесплатную учетную запись Azure](https://azure.microsoft.com/free). <br><br> Если вы создаете бесплатную учетную запись, вы являетесь администратором своей подписки и можете выполнять любые действия. <br><br> Если вы используете существующую подписку, в которой не являетесь администратором, администратор должен назначить вам права владельца или участника. |
| **Инфраструктура Azure** | Contoso настраивает свою инфраструктуру Azure, как описано в статье [Развертывание инфраструктуры Azure для миграции в Contoso](./contoso-migration-infrastructure.md). |

## <a name="scenario-steps"></a>Шаги выполнения сценария

Ниже рассказывается, как компания Contoso выполняет миграцию.

> [!div class="checklist"]
>
> - **Шаг 1. подготавливает базу данных в базе данных SQL Azure**. Компания Contoso подготавливает экземпляр базы данных SQL Azure. После миграции веб-сайта приложения в Azure веб-приложение службы WCF будет указывать на этот экземпляр.
> - **Шаг 2. Оценка базы данных**. Компания Contoso оценивает базу данных для миграции с помощью Помощник по миграции данных, а затем переносит ее с помощью Azure Database Migration Service.
> - **Шаг 3. предоставление веб-приложений**. Специалисты компании Contoso выполняют подготовку двух веб-приложений.
> - **Шаг 4. Настройка Azure DevOps**. Специалисты компании Contoso создают новый проект Azure DevOps и импортируют репозитории Git.
> - **Шаг 5. Настройка строк подключения**. Специалисты компании Contoso настраивают строки подключения для обеспечения взаимодействия веб-приложения веб-уровня, веб-приложения службы WCF и экземпляра SQL.
> - **Шаг 6. Настройка конвейеров сборки и выпуска в Azure DevOps**. В качестве последнего шага компания Contoso настраивает конвейеры сборки и выпуска в Azure DevOps для создания приложения, а затем развертывает их в два отдельных веб-приложения.

## <a name="step-1-provision-a-database-in-azure-sql-database"></a>Шаг 1. предоставление базы данных в базе данных SQL Azure

1. Администраторы Contoso решили создать экземпляр базы данных SQL Azure.

    ![Снимок экрана, показывающий ссылку на базу данных SQL.](./media/contoso-migration-refactor-web-app-sql/provision-sql1.png)

1. Они указывают имя базы данных в соответствии с базой данных, `SmartHotel.Registration` которая работает на локальной виртуальной машине. Они размещают базу данных в группе ресурсов ContosoRG. Это группа ресурсов, которую специалисты компании используют для рабочих ресурсов в Azure.

    ![Снимок экрана, показывающий сведения об экземпляре базы данных SQL.](./media/contoso-migration-refactor-web-app-sql/provision-sql2.png)

1. Они настроили новый экземпляр SQL Server, **SQL-смарсотел-eus2**, в основном регионе.

    ![Снимок экрана нового экземпляра SQL Server.](./media/contoso-migration-refactor-web-app-sql/provision-sql3.png)

1. Они задают ценовую категорию в соответствии с потребностями своего сервера и базы данных, а также предпочитают сэкономить с помощью предложения "Преимущество гибридного использования Azure", так как у них уже есть лицензия SQL Server.
1. Для изменения размера они используют виртуальное ядроное приобретение и устанавливают ограничения для ожидаемых требований.

    ![Снимок экрана с требованиями к размерам Виртуальное ядро.](./media/contoso-migration-refactor-web-app-sql/provision-sql4.png)

1. Они создают экземпляр базы данных.

    ![Снимок экрана создания экземпляра базы данных SQL.](./media/contoso-migration-refactor-web-app-sql/provision-sql5.png)

1. Они открывают базу данных и запомните сведения, которые понадобятся при использовании Помощник по миграции данных для миграции.

    ![Снимок экрана текстового файла экземпляра базы данных.](./media/contoso-migration-refactor-web-app-sql/provision-sql6.png)

**Требуется дополнительная помощь?**

- [Получение справки](/azure/sql-database/sql-database-get-started-portal) о подготовке Базы данных SQL.
- Дополнительные сведения об [ограничениях ресурсов Виртуальное ядро](/azure/sql-database/sql-database-vcore-resource-limits-elastic-pools).

## <a name="step-2-assess-the-database"></a>Шаг 2. Оценка базы данных

Администраторы Contoso оценивают базу данных с помощью Помощник по миграции данных, а затем переносят ее с помощью Azure Database Migration Service, ссылаясь на пошаговое [руководство по миграции](/azure/dms/tutorial-sql-server-azure-sql-online). Они могут выполнять интерактивные, автономные и гибридные (предварительные) миграции.

Вкратце, администраторы выполняют следующие действия:

- Они используют Помощник по миграции данных для обнаружения и устранения любых проблем, связанных с миграцией базы данных.
- Они создают экземпляр Azure Database Migration Service с номером SKU уровня "Премиум", подключенным к виртуальной сети.
- Они гарантируют, что экземпляр может получить доступ к удаленным SQL Server через виртуальную сеть. Это гарантирует, что все входящие порты будут разрешены в Azure для SQL Server на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается SQL Server.
- Они настраивают экземпляр:
  - Создайте проект миграции.
  - Добавьте источник (локальная база данных).
  - Выберите целевой объект.
  - Выберите базы данных для миграции.
  - Настройка дополнительных параметров.
  - Запустите репликацию.
  - Устраните возможные ошибки.
  - Выполните окончательный прямую миграцию.

## <a name="step-3-provision-web-apps"></a>Шаг 3. предоставление веб-приложений

Сейчас, когда база данных уже перенесена, администраторы Contoso могут подготовить два веб-приложения.

1. В портал Azure они выбирают **веб-приложение**.

    ![Снимок экрана: ссылка на веб-приложение в портал Azure.](./media/contoso-migration-refactor-web-app-sql/web-app1.png)

1. Они предоставляют имя для веб-приложения, **швеб-EUS2**, запускает его в Windows и размещают в группе рабочих ресурсов **ContosoRG** . Специалисты компании создают веб-приложение и план службы приложений Azure.

    ![Снимок экрана: панель "веб-приложение", показывающая расположение "Восточная США 2".](./media/contoso-migration-refactor-web-app-sql/web-app2.png)

1. После подготовки веб-приложения он повторяет процесс создания веб-приложения для службы WCF, **швкф-EUS2**.

    ![Снимок экрана: панель "веб-приложение", в которой отображается служба WCF.](./media/contoso-migration-refactor-web-app-sql/web-app3.png)

1. Они попадают в адреса приложений, чтобы убедиться, что они были успешно созданы.

## <a name="step-4-set-up-azure-devops"></a>Шаг 4. Настройка Azure DevOps

Компании Contoso необходимо создать инфраструктуру DevOps и конвейеры для приложения. Для этого администраторы Contoso создают проект DevOps, импортируют код, а затем настраивают конвейеры сборки и выпуска.

1. В учетной записи Contoso Azure DevOps создайте новый проект **контососмарсотелрефактор**, а затем выберите **Git** для управления версиями.

    ![Снимок экрана создания нового проекта в Azure DevOps.](./media/contoso-migration-refactor-web-app-sql/vsts1.png)

1. Они импортируют репозиторий Git, в настоящее время содержащий код приложения. Они загружаются из [общедоступного репозитория GitHub](https://github.com/Microsoft/SmartHotel360-Registration).

    ![Снимок экрана: панель "Импорт репозитория Git".](./media/contoso-migration-refactor-web-app-sql/vsts2.png)

1. Они подключают Visual Studio к репозиторию, а затем клонировать код на компьютер разработчика с помощью Team Explorer.

    ![Снимок экрана: панель "подключение к проекту".](./media/contoso-migration-refactor-web-app-sql/devops1.png)

1. Они открывают файл решения для приложения. Веб-приложение и служба WCF имеют отдельные проекты в файле.

    ![Снимок экрана обозреватель решений, в котором перечислены проекты веб-приложения и службы WCF.](./media/contoso-migration-refactor-web-app-sql/vsts4.png)

## <a name="step-5-configure-connection-strings"></a>Шаг 5. Настройка строк подключения

Администраторы Contoso должны убедиться, что веб-приложения и база данных могут взаимодействовать друг с другом. Чтобы сделать это, они настраивают строки подключения в коде и в веб-приложениях.

1. В веб-приложении для службы WCF в `SHWCF-EUS2` разделе **Параметры**  >  **приложения**параметры добавляются новые строки подключения с именем **DefaultConnection**.
1. Они извлекают строку подключения из базы данных Смарсотел-Registration, а затем обновляют ее с использованием правильных учетных данных.

    ![Снимок экрана: панель параметров строки подключения.](./media/contoso-migration-refactor-web-app-sql/string1.png)

1. В Visual Studio администраторы открывают `SmartHotel.Registration.wcf` проект из файла решения. В проекте они обновляют `connectionStrings` раздел `web.config` файла со строкой подключения.

     ![Снимок экрана раздела connectionString файла web.config в проекте Смарсотел. Registration. WCF.](./media/contoso-migration-refactor-web-app-sql/string2.png)

1. Они изменяют `client` раздел `web.config` файла для `SmartHotel.Registration.Web` , чтобы указать новое расположение службы WCF. Это URL веб-приложения WCF, в котором размещена конечная точка службы.

    ![Снимок экрана раздела "клиент" файла web.config в проекте Смарсотел. Registration. WCF.](./media/contoso-migration-refactor-web-app-sql/strings3.png)

1. После изменения кода администраторы зафиксируют и синхронизируют их с помощью Team Explorer в Visual Studio.

## <a name="step-6-set-up-build-and-release-pipelines-in-azure-devops"></a>Шаг 6. Настройка конвейеров сборки и выпуска в Azure DevOps

Администраторы Contoso теперь настраивают Azure DevOps для выполнения процесса сборки и выпуска.

1. В Azure DevOps выберите **Сборка и выпуск**  >  **нового конвейера**.

    ![Снимок экрана: ссылка "Новый конвейер" в Azure DevOps.](./media/contoso-migration-refactor-web-app-sql/pipeline1.png)

1. Они выбирают **Azure Repos Git** , и в раскрывающемся списке **репозиторий** они выбирают соответствующий репозиторий.

    ![Снимок экрана с кнопкой "Azure Repos Git" и выбранным репозиторием.](./media/contoso-migration-refactor-web-app-sql/pipeline2.png)

1. В разделе **Выбор шаблона**выберите шаблон **ASP.NET** для своей сборки.

     ![Снимок экрана: панель "Выбор шаблона" для выбора шаблона ASP.NET.](./media/contoso-migration-refactor-web-app-sql/pipeline3.png)

1. Для сборки используются имя **контососмарсотелрефактор-ASP.NET-CI** , а затем выберите **сохранить & очередь**, которая запускает первую сборку.

     ![Снимок экрана кнопки "сохранить и поставить в очередь" для сборки.](./media/contoso-migration-refactor-web-app-sql/pipeline4.png)

1. Они выбирают номер сборки для просмотра процесса. По завершении администраторы могут увидеть отзывы о процессе и выбрать **артефакты** для просмотра результатов сборки.

    ![Снимок экрана со страницей "сборка" и ссылкой "артефакты" для просмотра результатов сборки.](./media/contoso-migration-refactor-web-app-sql/pipeline5.png)

    Откроется панель **Обозреватель артефактов** , а в папке **сброса** отобразятся результаты сборки.

    - Два ZIP-файла — это пакеты, содержащие приложения.
    - Эти ZIP-файлы используются в конвейере выпуска для развертывания в службе приложений Azure.

     ![Снимок экрана: панель "Обозреватель артефактов".](./media/contoso-migration-refactor-web-app-sql-managed-instance/pipeline6.png)

1. Они выбирают **выпуски**  >  **+ Новый конвейер**.

    ![Новый конвейер](./media/contoso-migration-refactor-web-app-sql/pipeline7.png)

1. Они выбирают шаблон развертывания Службы приложений Azure.

    ![Снимок экрана шаблона развертывания службы приложений Azure.](./media/contoso-migration-refactor-web-app-sql/pipeline8.png)

1. Они задают имя конвейера выпуска **ContosoSmartHotel360Refactor** , а в поле **имя этапа** укажите **швкф-EUS2** в качестве имени веб-приложения WCF.

    ![Снимок экрана с именем этапа веб-приложения WCF.](./media/contoso-migration-refactor-web-app-sql/pipeline9.png)

1. В разделе этапов они выбирают **1 задание, 1 задача**, чтобы настроить развертывание службы приложения WCF.

    ![Снимок экрана с параметром "1 задание, 1 задача".](./media/contoso-migration-refactor-web-app-sql-managed-instance/pipeline10.png)

1. Они подтверждают, что подписка выбрана и авторизация, а затем выбирает **имя службы приложений**.

     ![Снимок экрана выбора имени службы приложений.](./media/contoso-migration-refactor-web-app-sql/pipeline11.png)

1. В конвейере > **артефакты**выберите **+ Добавить артефакт**, а затем выберите для сборки с помощью конвейера **ContosoSmarthotel360Refactor** .

     ![Снимок экрана: кнопка "построить" на панели "Добавление артефакта".](./media/contoso-migration-refactor-web-app-sql/pipeline12.png)

1. Чтобы включить триггер непрерывного развертывания, Администраторы выбирают значок с молнией на артефакте.

     ![Снимок экрана значка с молнией на артефакте.](./media/contoso-migration-refactor-web-app-sql/pipeline13.png)

1. Они устанавливают триггер непрерывного развертывания в значение **Enabled**.

    ![Снимок экрана, на котором показан триггер непрерывного развертывания со значением "включено".](./media/contoso-migration-refactor-web-app-sql/pipeline14.png)

1. Администраторы вернутся к **заданию этапа 1, 1 задаче,** а затем — **развернуть службу приложений Azure**.

    ![Снимок экрана с возможностью выбора параметра "развернуть службу приложений Azure".](./media/contoso-migration-refactor-web-app-sql/pipeline15.png)

1. В окне **Выбор файла или папки**они разворачивают папку **сброса** , выберите файл *SmartHotel.Registration.Wcf.zip* , созданный во время сборки, а затем нажмите кнопку **сохранить**.

    ![Снимок экрана: панель "Выбор файла или папки" для выбора файла WCF.](./media/contoso-migration-refactor-web-app-sql/pipeline16.png)

1. Выберите этапы **конвейера**  >  **Stages**, а затем щелкните **+ Добавить** , чтобы добавить среду для `SHWEB-EUS2` . Они выбирают другое развертывание Службы приложений Azure.

    ![Снимок экрана со ссылкой "1 задание, 1 задача" для добавления среды.](./media/contoso-migration-refactor-web-app-sql/pipeline17.png)

1. Они повторно публикуют файл в нужном `SmartHotel.Registration.Web.zip` веб-приложении, а затем выбирают команду **сохранить**.

    ![Снимок экрана: область "Выбор файла или папки" для выбора веб-файла.](./media/contoso-migration-refactor-web-app-sql/pipeline18.png)

    Отобразится конвейер выпуска, как показано ниже:

     ![Снимок экрана сводки по конвейеру выпуска.](./media/contoso-migration-refactor-web-app-sql/pipeline19.png)

1. Вернитесь к разделу **Сборка**, выберите **триггеры**и установите флажок **включить непрерывную интеграцию** . Это действие активирует конвейер таким образом, что при фиксации изменений в коде выполняется полная сборка и выпуск.

    ![Снимок экрана, покрывающий флажок "включить непрерывную интеграцию".](./media/contoso-migration-refactor-web-app-sql/pipeline20.png)

1. Для запуска полного конвейера выберите **сохранить & очередь** . Запускается новая сборка, которая, в свою очередь, создает первый выпуск приложения в службе приложений Azure.

    ![Снимок экрана кнопки "Сохранить очередь &".](./media/contoso-migration-refactor-web-app-sql/pipeline21.png)

1. Администраторы компании Contoso могут выполнить конвейер сборки и выпуска из Azure DevOps. После завершения сборки запускается выпуск.

    ![Снимок экрана хода выполнения сборки и выпуска приложений.](./media/contoso-migration-refactor-web-app-sql/pipeline22.png)

1. После завершения конвейера будут развернуты оба сайта, и приложение будет работать в режиме «в сети».

    ![Снимок экрана, показывающий, что приложение работает.](./media/contoso-migration-refactor-web-app-sql/pipeline23.png)

    Приложение успешно перенесено в Azure.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После миграции Contoso завершает следующие шаги очистки:

- Удаление локальных виртуальных машин из перечня в vCenter.
- Они удаляют виртуальные машины из локальных заданий резервного копирования.
- Они обновляют внутреннюю документацию для отображения новых расположений для приложения SmartHotel360. В документации показана база данных, работающая в базе данных SQL Azure, и внешний интерфейс, работающий в двух веб-приложениях.
- Они просматривают все ресурсы, которые взаимодействуют с списанными виртуальными машинами, и обновляют соответствующие параметры или документацию в соответствии с новой конфигурацией.

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда ресурсы перенесены в Azure, Contoso необходимо полностью эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

- Компания Contoso помогает обеспечить безопасность новой `SmartHotel-Registration` базы данных. [Подробнее.](/azure/sql-database/sql-database-security-overview)
- В частности, компания Contoso обновляет веб-приложения для использования SSL с сертификатами.

### <a name="backups"></a>Резервные копии

- Группа Contoso просматривает требования к резервному копированию для базы данных SQL Azure. [Подробнее.](/azure/sql-database/sql-database-automated-backups)
- Они также изучит управление резервными копиями и восстановлением базы данных SQL. См. [дополнительные сведения](/azure/sql-database/sql-database-automated-backups) об автоматическом резервном копировании.
- Они считают реализацией групп отработки отказа для предоставления региональной отработки отказа для базы данных. [Подробнее.](/azure/sql-database/sql-database-geo-replication-overview)
- Для устойчивости рассмотрите возможность развертывания веб-приложения в основном регионе ( `East US 2` ) и в дополнительном регионе ( `Central US` ). Группа может настроить диспетчер трафика, чтобы обеспечить отработку отказа во время региональных сбоев.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- После развертывания всех ресурсов компания Contoso назначает Теги Azure на основе [планирования инфраструктуры](./contoso-migration-infrastructure.md#set-up-tagging).
- Полное лицензирование входит в стоимость служб PaaS, которые использует Contoso. Эти затраты вычитаются из Соглашение Enterprise.
- Contoso будет использовать службу [управления затратами Azure и выставления счетов](/azure/cost-management-billing/cost-management-billing-overview) , чтобы гарантировать, что они останутся в пределах бюджетов, установленных ИТ.

## <a name="conclusion"></a>Заключение

В этой статье компания Contoso выполнила рефакторинг приложения SmartHotel360 в Azure путем переноса клиентской виртуальной машины приложения в два веб-приложения службы приложений Azure. База данных приложения была перенесена в базу данных SQL Azure.