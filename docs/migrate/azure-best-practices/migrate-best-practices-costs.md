---
title: Рекомендации по оценке затрат на рабочие нагрузки, перенесенные в Azure, и определению их размеров
titleSuffix: Microsoft Cloud Adoption Framework for Azure
description: Получите рекомендации по оценке затрат на рабочие нагрузки, перенесенные в Azure, и определению их размеров.
author: BrianBlanchard
ms.author: brblanch
ms.date: 12/08/2018
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.openlocfilehash: b358c4d07e4adb30c0420c9d1b3bc85c25e9ce95
ms.sourcegitcommit: 443c28f3afeedfbfe8b9980875a54afdbebd83a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "71024938"
---
# <a name="best-practices-for-costing-and-sizing-workloads-migrated-to-azure"></a>Рекомендации по оценке затрат на рабочие нагрузки, перенесенные в Azure, и определению их размеров

Для успеха переноса в Azure в долгосрочной перспективе при планировании и проектировании миграции следует сосредоточиться на оценке затрат. На протяжении проекта миграции очень важно, чтобы все команды (финансовый отдел, руководство и команды по разработке приложений) понимали связанные с ним расходы.

- Оценка ваших затрат на ее осуществление с базовыми показателями месячного, квартального и годового бюджета перед миграцией имеет решающее значение для успеха.
- После миграции необходимо оптимизировать затраты, постоянно отслеживать рабочие нагрузки и планировать будущие структуры потребления. Сначала перенесенные ресурсы могут представлять собой один тип рабочей нагрузки, но со временем (в зависимости от использования, затрат и изменения бизнес-требований) тип может меняться.

В этой статье содержатся рекомендации по оценке затрат и изменению размеров до и после миграции.

> [!IMPORTANT]
> Рекомендации и мнения, описанные в этой статье, основываются на возможностях платформы Azure и служб, доступных на момент написания этого материала. Функции и возможности со временем меняются. Для вашего сценария развертывания могут применяться не все рекомендации, поэтому выберите подходящие.

## <a name="before-migration"></a>Перед миграцией

Прежде чем перенести рабочие нагрузки в облако, оцените ежемесячную стоимость их выполнения в Azure. Оперативное управление облачными расходами поможет оставаться в рамках бюджета операционных расходов. Если бюджет ограничен, примите это во внимание перед миграцией. Чтобы сократить расходы, рассмотрите возможность преобразования рабочих нагрузок в бессерверные технологии Azure там, где это уместно.

Рекомендации в этом разделе помогут вам оценить затраты, правильно оценить размеры виртуальных машин и хранилища, воспользоваться Преимуществами гибридного использования Azure, использовать зарезервированные виртуальные машины и оценить расходы на облако по подпискам.

## <a name="best-practice-estimate-monthly-workload-costs"></a>Рекомендация. Оценка ежемесячных затрат на рабочую нагрузку

Чтобы спрогнозировать ваш ежемесячный счет за перенесенные рабочие нагрузки, можно использовать ряд инструментов.

- **Калькулятор цен Azure.** Вы выбираете продукты, которые необходимо оценить, например виртуальные машины и хранилище. Чтобы произвести оценку, введите затраты в калькулятор цен.

 ![Калькулятор цен Azure](./media/migrate-best-practices-costs/pricing.png) *Калькулятор цен Azure*

- **Миграция Azure.** Чтобы оценить затраты, необходимо проверить и учесть все ресурсы, необходимые для запуска ваших рабочих нагрузок в Azure. Чтобы получить эти данные, необходимо провести инвентаризацию ресурсов, включая серверы, виртуальные машины, базы данных и хранилище. Для сбора этой информации можно использовать службу "Миграция Azure".

- Служба "Миграция Azure" обнаруживает и оценивает вашу локальную среду для составления инвентарного перечня.
- Она может сопоставлять и отображать зависимости между виртуальными машинами, чтобы предоставить вам полную картину.
- Оценка службы "Миграция Azure" содержит предполагаемые расходы.
  - Затраты на вычислительные ресурсы. Используя размер виртуальной машины Azure, рекомендованный при создании оценки, служба "Миграция Azure" использует API выставления счетов для расчета ежемесячных расходов на виртуальную машину. При этом учитываются такие параметры, как операционная система, программа Software Assurance, зарезервированные экземпляры, время доступности виртуальных машин, расположение и валюта. Служба суммирует затраты на все виртуальные машины, которые оцениваются, чтобы рассчитать общие ежемесячные затраты на вычислительные ресурсы.
  - Затраты на хранилище. Служба "Миграция Azure" вычисляет общие ежемесячные затраты на хранилище, суммируя затраты на хранилище для всех виртуальных машин, которые оцениваются. Вы можете вычислить ежемесячные затраты на хранилище определенного компьютера путем суммирования ежемесячных затрат на все подключенные к нему диски.

    ![Миграция Azure](./media/migrate-best-practices-costs/assess.png)
    *Оценка Миграции Azure*

**Дополнительные сведения**

- Используйте [Калькулятор цен Azure](https://azure.microsoft.com/pricing/calculator).
- Просмотрите сведения о [службе "Миграция Azure"](https://docs.microsoft.com/azure/migrate/migrate-overview).
- Узнайте об [оценках службы "Миграция Azure"](https://docs.microsoft.com/azure/migrate/concepts-assessment-calculation).
- [Узнайте больше](https://docs.microsoft.com/azure/dms/dms-overview) о службе Azure Database Migration Service.

## <a name="best-practice-right-size-vms"></a>Рекомендация. Виртуальные машины нужного размера

При развертывании виртуальных машин Azure для поддержки рабочих нагрузок можно выбрать несколько вариантов. Каждый тип виртуальной машины имеет свои особые возможности и различные комбинации ЦП, памяти и дисков. Виртуальные машины сгруппированы следующим образом.

**Тип** | **Сведения** | **Использование**
--- | --- | ---
**Универсальные** | Сбалансированное соотношение ресурсов ЦП и памяти. | Хорошее решение для тестирования и разработки, небольших и средних баз данных и веб-серверов с небольшим или средним объемом трафика.
**Оптимизированные по вычислительным ресурсам** | Высокое соотношение ресурсов ЦП и памяти. | Хорошее решение для веб-сервера со средним объемом трафика, сетевых устройств, пакетных процессов и серверов приложений.
**Оптимизированные по памяти** | Высокое соотношение ресурсов памяти и ЦП. | Хорошее решение для реляционных баз данных, кэша среднего и большого объема и выполняющейся в памяти аналитики.
**Оптимизированные для хранилища** | Высокая пропускная способность дисков и количество операций ввода-вывода. | Подходит для работы с большими данными, а также с базами данных SQL и NoSQL.
**Оптимизированные для GPU** | Специализированные виртуальные машины. Один или несколько GPU. | Большие объемы графики и редактирование видео.
**Высокопроизводительные** | Самый быстрый и мощный ЦП. Виртуальные машины, для которых можно настроить сетевые интерфейсы с высокой пропускной способностью (RDMA) | Важные приложения с высокой производительностью.

- Важно понимать разницу в ценах на эти виртуальные машины, а также долгосрочные последствия для бюджета.
- Каждый тип включает в себя несколько серий виртуальных машин.
- Кроме того, когда вы выбираете в серии виртуальную машину, то можете масштабировать ее только в пределах этой серии. Например, масштаб DSv2\_2 можно увеличить до DSv2\_4, но его нельзя изменить на масштаб для другой серии, например Fsv2\_2.

**Дополнительные сведения**

- [Размеры виртуальных машин Windows в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sizes).
- [Размеры для облачных служб](https://docs.microsoft.com/azure/cloud-services/cloud-services-sizes-specs).
- [Ознакомьтесь](https://docs.microsoft.com/azure/migrate/contoso-migration-assessment) с примером оценки для вымышленной компании Contoso.

## <a name="best-practice-select-the-right-storage"></a>Рекомендация. Выбор правильного хранилища

Настройка и обслуживание локального хранилища (SAN или NAS), а также сетей для его поддержки могут быть дорогостоящими и занимать много времени. Чтобы уменьшить операционные и управленческие проблемы, файловые данные (данные хранилища) обычно переносятся в облако. Корпорация Майкрософт предоставляет несколько вариантов перемещения данных в Azure, так что вам необходимо решить, какой из них использовать. Выбор правильного типа хранилища данных может экономить вашей организации несколько тысяч долларов ежемесячно. Ниже приведены некоторые рекомендации.

- Данные, к которым редко обращаются и которые не являются критически важными для бизнеса, не нужно размещать в самом дорогом хранилище.
- И наоборот, критически важные для бизнеса данные должны располагаться в хранилищах более высокого уровня.
- Во время планирования миграции проведите инвентаризацию данных и классифицируйте их по важности, чтобы сопоставить их с наиболее подходящим хранилищем. Учитывайте бюджет и стоимость, а также производительность. Стоимость не обязательно должна быть основным фактором при принятии решений. Выбор наименее дорогого варианта может подвергнуть рабочую нагрузку риску с точки зрения производительности и доступности.

### <a name="storage-data-types"></a>Типы данных хранилища

Azure предоставляет различные типы данных хранилища.

<!--markdownlint-disable MD033 -->

**Тип данных** | **Сведения** | **Использование**
--- | --- |  ---
**BLOB-объекты** | Оптимизировано для хранения больших объемы неструктурированных объектов, например текстовых или двоичных данных<br/><br/> | Доступ к данным отовсюду через HTTP/HTTPS. | Используется для сценариев потоковой передачи и произвольного доступа. Например, для передачи изображений и документов непосредственно в браузер, потокового видео и аудио, а также для хранения данных резервного копирования и аварийного восстановления.
**Файлы** | Используется для доступа к управляемым файловым ресурсам через SMB 3.0 | Используется при миграции локальных общих файловых ресурсов и для обеспечения множественного доступа или подключений к данным файла.
**диски;** | На основе страничных BLOB-объектах.<br/><br/> Тип диска (скорость): ценовая категория "Стандартный" (HDD или SSD) или "Премиум" (SSD).<br/><br/>Управление дисками: неуправляемый (вы управляете настройками диска и хранилищем) или управляемый (вы выбираете тип диска, а Azure управляет диском вместо вас). | Для виртуальных машин используются диски ценовой категории "Премиум". Для простого управления и масштабирования используются управляемые диски.
**Очереди** | Хранение и извлечение большого количества сообщений, к которым обращаются через аутентифицированные вызовы (HTTP или HTTPS) | Подключение компонентов приложения к очереди асинхронных сообщений.
**Таблицы** | Хранение таблиц. | Теперь входит в состав API таблиц Azure Cosmos DB.

<!--markdownlint-enable MD033 -->

### <a name="access-tiers"></a>Уровни доступа

Служба хранилища Azure предоставляет различные возможности доступа к данным блочных BLOB-объектов. Выбор правильного уровня доступа позволит хранить данные блочных BLOB-объектов наиболее экономичным способом.

<!--markdownlint-disable MD033 -->

**Тип** | **Сведения** | **Использование**
--- | --- | ---
**Горячий уровень хранилища** | Более высокая стоимость хранения, чем для холодного уровня хранилища. Более низкая плата за доступ, чем для холодного уровня хранилища.<br/><br/>Это уровень по умолчанию. | Используйте для активно используемых данных, к которым часто обращаются.
**Холодный уровень хранилища** | Более низкая стоимость хранения, чем для горячего уровня хранилища. Более высокая плата за доступ, чем для горячего уровня хранилища.<br/><br/> Хранение не менее чем 30 дней. | Краткосрочное хранение, данные доступны, но к ним редко обращаются.
**Архив** | Используется для отдельных блочных BLOB-объектов.<br/><br/> Наиболее экономный способ хранения. Доступ к данным дороже, чем для горячего и холодного уровней хранилищ. | Используется для данных, для которых допустима задержка извлечения в несколько часов и которые будут храниться не менее 180 дней.

<!--markdownlint-enable MD033 -->

### <a name="storage-account-types"></a>Типы учетных записей хранения

Azure предоставляет различные типы учетных записей хранения и уровней производительности.

<!--markdownlint-disable MD033 -->

**Тип учетной записи** | **Сведения** | **Использование**
--- | --- | ---
**Общего назначения версии 2 (ценовая категория "Стандартный")** | Поддерживает BLOB-объекты (блок, страница, добавление), файлы, диски, очереди и таблицы.<br/><br/> Поддерживает горячий, холодный и архивный уровни доступа. Поддерживается ZRS. | Используется для большинства сценариев и типов данных. Учетные записи хранения ценовой категории "Стандартный" могут быть основаны на HDD- или SSD-дисках.
**Общего назначения версии 2 (ценовая категория "Премиум")** | Поддерживает данные хранилища BLOB-объектов (страничные BLOB-объекты). Поддерживает горячий, холодный и архивный уровни доступа. Поддерживается ZRS.<br/><br/> Хранение на SSD. | Майкрософт рекомендует использовать для всех виртуальных машин.
**Общего назначения версии 1** | Распределение по уровням доступа не поддерживается. Не поддерживает ZRS. | Используется, если приложениям необходима классическая модель развертывания Azure.
**Большой двоичный объект** | Специализированная учетная запись хранения для хранения неструктурированных объектов. Предоставляет только блочные и добавочные BLOB-объекты (служб хранилища "Файл", "Очередь", "Таблица" или "Диск"). Обеспечивает такие же устойчивость, доступность, масштабируемость и производительность, как и учетная запись общего назначения версии 2. | В этих учетных записях нельзя хранить страничные BLOB-объекты, поэтому там нельзя хранить и файлы VHD. Можно задать горячий или холодный уровень доступа.

<!--markdownlint-enable MD033 -->

### <a name="storage-redundancy-options"></a>Параметры избыточности хранилища

Учетные записи хранения могут использовать различные виды избыточности для обеспечения устойчивости и высокого уровня доступности.

**Тип** | **Сведения** | **Использование**
--- | --- | ---
**Локально избыточное хранилище (LRS)** | Защищает от локальных сбоев, реплицируя одну единицу хранения в отдельный домен сбоя и домен обновления. Сохраняет несколько копий данных в одном центре обработки данных. Обеспечивает устойчивость объектов на уровне не менее 99,999999999 % (11 девяток\') в течение года. | Рекомендуется, если приложение хранит данные, которые можно легко воссоздать.
**Хранилище, избыточное между зонами (ZRS)** | Предоставляет защиту от сбоя центр обработки данных, реплицируя все три кластера хранилища в одном регионе. Каждый кластер хранилища физически отделен и размещен в собственной зоне доступности. Обеспечивает устойчивость объектов по крайней мере на 99,9999999999 % (12 девяток) на протяжении года благодаря хранению нескольких копий данных в нескольких центрах обработки данных или регионах. | Рекомендуется, если требуется согласованность, устойчивость и высокий уровень доступности. Не может защитить данные от региональной аварии, при которой полностью выходят из строя несколько зон.
**Геоизбыточное хранилище (GRS)** | Обеспечивает защиту от сбоя всего региона, реплицируя данные в дополнительный регион, который удален от основного. Обеспечивает устойчивость объектов на уровне не менее 99,99999999999999 % (16 девяток\') в течение года. | Данные реплики будут недоступны, пока корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. При отработке отказа чтение и запись доступны.
**Геоизбыточное хранилище с доступом на чтение (RA-GRS)** | Как и GRS. Обеспечивает устойчивость объектов на уровне не менее 99,99999999999999 % (16 девяток\') в течение года. | Обеспечивает доступность чтения 99,99 %, разрешая доступ на чтение из второго региона, используемого для GRS.

**Дополнительные сведения**

- [Обзор цен на хранилище Azure](https://azure.microsoft.com/pricing/details/storage)
- [Что такое служба "Импорт и экспорт Azure"?](https://docs.microsoft.com/azure/storage/common/storage-import-export-service)
- [Выбор между большими двоичными объектами Azure, службой файлов Azure и дисками Azure](https://docs.microsoft.com/azure/storage/common/storage-decide-blobs-files-disks?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).
- [Хранилище BLOB-объектов Azure: горячий, холодный, архивный уровни хранилища и уровень "Премиум" (предварительная версия)](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers).
- [Общие сведения об учетной записи хранения](https://docs.microsoft.com/azure/storage/common/storage-account-overview?toc=%2fazure%2fstorage%2fblobs%2ftoc.json).
- [Репликация службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy), [Локально избыточное хранилище (LRS). Недорогая избыточность данных для службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy-lrs?toc=%2fazure%2fstorage%2fqueues%2ftoc.json), [хранилище, избыточное в пределах зоны (ZRS). Высокодоступные приложения для службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy-zrs?toc=%2fazure%2fstorage%2fqueues%2ftoc.json), [Геоизбыточное хранилище (GRS). Межрегиональная репликация для службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy-grs?toc=%2fazure%2fstorage%2fqueues%2ftoc.json) и раздел [Геоизбыточное хранилище с доступом для чтения](https://docs.microsoft.com/azure/storage/common/storage-redundancy-grs?toc=%2fazure%2fstorage%2fqueues%2ftoc.json#read-access-geo-redundant-storage).
- [Общие сведения о службе файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-files-introduction).

## <a name="best-practice-take-advantage-of-azure-hybrid-benefits"></a>Рекомендация. Воспользуйтесь возможностями Преимущества гибридного использования Azure

Благодаря годам инвестиций в разработку программного обеспечение для таких систем, как Windows Server и SQL Server, корпорация Майкрософт обладает уникальной возможностью предложить клиентам ценные возможности в облаке со значительными скидками, которые далеко не всегда могут предоставить другие поставщики облачных служб.

Интегрированный портфель локальных продуктов корпорации Майкрософт и продуктов Azure создает конкурентные и ценовые преимущества. Используя операционную систему или другие способы лицензирования программного обеспечения с помощью Software Assurance (SA), можете поместить эти лицензии в облако благодаря Преимуществу гибридного использования Azure.

**Дополнительные сведения**

- [Калькулятор сбережений на основе преимуществ гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit).
- [Преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit) для Windows Server.
- [Руководство по выбору ценовой категории для виртуальных машин SQL Server в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-pricing-guidance).

## <a name="best-practice-use-reserved-vm-instances"></a>Рекомендация. Использование зарезервированных экземпляров виртуальной машины

Большинство облачных платформ настраиваются с оплатой по мере использования. У данной модели есть недостатки, поскольку вам не всегда известно, какими будут динамические рабочие нагрузки. Выражая четкие намерения в отношении рабочей нагрузки, вы принимаете участие в планировании инфраструктуры.

Используя зарезервированные экземпляры виртуальных машин Azure, вы предварительно оплачиваете экземпляр виртуальной машины сроком на один или три года.

- Предварительная оплата обеспечивает скидку на используемые ресурсы.
- При оплате по мере использования вы можете значительно сократить свои расходы на виртуальную машину, вычислительные ресурсы базы данных SQL, Azure Cosmos DB или другие ресурсы на 72 %.
- Резервирования обеспечивают скидку при выставлении счетов и не влияют на состояние среды выполнения ваших ресурсов.
- Зарезервированные экземпляры можно отменить.

![Зарезервированные экземпляры](./media/migrate-best-practices-costs/reserve.png)
*Зарезервированные виртуальные машины Azure*

**Дополнительные сведения**

- [Общие сведения об Azure Reserved VM Instances](https://docs.microsoft.com/azure/billing/billing-save-compute-costs-reservations).
- [Часто задаваемые вопросы по зарезервированным экземплярам](https://azure.microsoft.com/pricing/reserved-vm-instances/#faq).
- [Руководство по выбору ценовой категории для виртуальных машин SQL Server в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-pricing-guidance).

## <a name="best-practice-aggregate-cloud-spend-across-subscriptions"></a>Рекомендация. Выполнение статистического вычисления расходов на облако для нескольких подписок

Со временем у вас неизбежно будет несколько подписок Azure. Например, возможно, вам понадобится дополнительная подписка для разделения границ среды разработки и рабочей среды, или у вас появится платформа, которая потребует отдельную подписку для каждого клиента. Ценной функцией является возможность выполнять статистические вычисления для отчетов данных по всем подпискам в одной платформе.

Для этого можно использовать API службы "Управления затратами Azure". Затем после агрегирования данных в единый источник, например Azure SQL, для получения статистических данных можно использовать такие инструменты, как Power BI. Вы можете создавать статистические отчеты по подписке, а также детализированные отчеты. Например, для пользователей, которым необходимы упреждающие аналитические сведения об управлении затратами, можно создать отдельные представления затрат для отделов, групп ресурсов и т. д. При этом нет необходимости предоставлять полный доступ к данным по выставлению счетов в Azure.

**Дополнительные сведения**

- [Общие сведения об API потребления ресурсов Azure](https://docs.microsoft.com/azure/billing/billing-consumption-api-overview).
- [Подключение к Azure Consumption Insights в Power BI Desktop (бета-версия)](https://docs.microsoft.com/power-bi/desktop-connect-azure-consumption-insights).
- [Управление доступом к данным для выставления счетов в Azure](https://docs.microsoft.com/azure/billing/billing-manage-access).

## <a name="after-migration"></a>После переноса

После успешной миграции рабочих нагрузок и несколько недель сбора данных о потреблении вы получите четкое представление о затратах на ресурсы.

- При анализе данных можно приступить к созданию базового плана бюджета для ресурсов и групп ресурсов Azure.
- Затем, понимая структуру затрат в бюджете облака, можно проанализировать возможности для дополнительного сокращения затрат.

Рекомендации в этом разделе включают использование службы "Управление затратами Azure" для анализа затрат и планирования бюджета, наблюдение за ресурсами и реализацию бюджетов групп ресурсов, а также оптимизацию мониторинга, хранилища и виртуальных машин.

## <a name="best-practice-use-azure-cost-management"></a>Рекомендация. Использование службы "Управление затратами Azure"

Корпорация Майкрософт предоставляет службу "Управление затратами Azure", которая помогает отслеживать расходы следующим образом.

- Помогает отслеживать и контролировать расходы в Azure и оптимизировать использование ресурсов.
- Проверяет все подписки и ресурсы и предоставляет рекомендации.
- Предоставляет полнофункциональный API для интеграции внешних инструментов и финансовых систем для создания отчетов.
- Отслеживает использование ресурсов и управление затратами на облако с помощью единого представления.
- Предоставляет подробные операционные и финансово-аналитические сведения, чтобы помочь вам принять обоснованные решения.

Служба "Управление затратами" позволяет:

- **Создание бюджета**. Создайте бюджет для финансовой отчетности.
  - Вы можете учесть службы, которые вы используете или на которые вы подписаны, за определенный период (месяц, квартал или год), а также область (подписки или группы ресурсов). Например, можно создать бюджет подписки Azure на месячный, квартальный или годовой период.
    - Анализ затрат отображается после создания бюджета. Просмотр бюджета по текущим расходам – один из первых шагов, которые необходимо выполнить при анализе затрат и расходов.
  - При достижении порога бюджета могут отправляться уведомления по электронной почте.
  - Данные об управлении затратами можно экспортировать в службу хранилища Azure для анализа.

    ![Бюджет в Управлении затратами](./media/migrate-best-practices-costs/budget.png)
    *Бюджет в Управлении затратами Azure*

- **Анализ затрат.** Получите анализ затрат, чтобы изучить и проанализировать затраты организации. Это поможет понять, как накапливаются затраты, а также определить тенденции расходов.
  - Анализ затрат доступный пользователям EA.
  - Вы можете просмотреть данные анализа затрат для нескольких областей, в том числе для отдела, учетной записи, подписки или группы ресурсов.
  - Можно получить анализ затрат, который показывает общие затраты за текущий месяц и накопленные ежедневные затраты.

    ![Анализ в Управлении затратами](./media/migrate-best-practices-costs/analysis.png)
    *Анализ в Управлении затратами Azure*
- **Получение рекомендаций.** Получите рекомендации Помощника, которые показывают, как можно оптимизировать и повысить эффективность.

**Дополнительные сведения**

- [Общие сведения о службе "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/overview).
- [Как оптимизировать инвестиции в облако с помощью службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/cost-mgt-best-practices)
- [Использование отчетов службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/use-reports).
- [Руководство. Рекомендации по оптимизации затрат](https://docs.microsoft.com/azure/cost-management/tutorial-acm-opt-recommendations?toc=/azure/billing/TOC.json).
- [Обзор API потребления ресурсов Azure](https://docs.microsoft.com/rest/api/consumption/budgets).

## <a name="best-practice-monitor-resource-utilization"></a>Рекомендация. Отслеживание использования ресурсов

В Azure вы платите по мере использования, когда потребляете ресурсы, и не платите, если ими не пользуетесь. Для виртуальных машин выставление счетов происходит, когда виртуальная машина выделена, а когда ее выделение отменяется, плата не взимается. Учитывая это, следует контролировать использование виртуальных машин и проверять изменение их размеров.

- Постоянно оценивайте рабочие нагрузки виртуальной машины, чтобы определить базовые показатели.
- Например, если рабочая нагрузка интенсивно используется с понедельника по пятницу с 8:00 до 18:00, но вне этого времени используется редко, вне этого периода можно переходить на использование менее дорогой версии виртуальной машины. Это может приводить к изменению размеров виртуальной машины или потребовать использования масштабируемого набора виртуальных машин для автоматического масштабирования виртуальных машин.
- Некоторые компании "откладывают" виртуальные машины, обозначая в календаре дату и время их доступности.
- Помимо мониторинга виртуальной машины следует отслеживать другие сетевые ресурсы, среди которых ExpressRoute и шлюзы виртуальных сетей для избыточного и недостаточного использования.
- Использование виртуальных машин можно отслеживать с помощью нескольких инструментов корпорации Майкрософт, в том числе Управления затратами Azure, Azure Monitor и Помощника по Azure. Доступны также сторонние средства.

**Дополнительные сведения**

- Общие сведения о [службе Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) и [Azure Advisor](https://docs.microsoft.com/azure/advisor/advisor-overview).
- [Рекомендации Azure Advisor по затратам](https://docs.microsoft.com/azure/advisor/advisor-cost-recommendations).
- [Руководство. Рекомендации по оптимизации затрат](https://docs.microsoft.com/azure/cost-management/tutorial-acm-opt-recommendations?toc=/azure/billing/TOC.json) и [Предотвращение непредвиденных расходов с помощью функции выставления счетов и управления затратами в Azure](https://docs.microsoft.com/azure/billing/billing-getting-started).
- Узнайте о [наборе средств оптимизации ресурсов Azure (ARO)](https://github.com/Azure/azure-quickstart-templates/tree/master/azure-resource-optimization-toolkit).

## <a name="best-practice-implement-resource-group-budgets"></a>Рекомендация. Реализация бюджетов группы ресурсов

Группы ресурсов часто используются для представления границ затрат. Вместе с шаблоном потребления команда Azure продолжает развивать новые и улучшенные способы отслеживания и анализа расходов на ресурсы на различных уровнях, включая возможность создания бюджетов для отдельных ресурсов и их групп.

- Бюджет группы ресурсов помогает отслеживать затраты, связанные с группой ресурсов.
- Как только будет исчерпан или превышен бюджет, можно активировать оповещения и запустить различные сборники схем.

**Дополнительные сведения**

- [Управление затратами с помощью API управления бюджетом Azure](https://docs.microsoft.com/azure/billing/billing-cost-management-budget-scenario).
- [Руководство. Создание и управление бюджетами Azure](https://docs.microsoft.com/azure/cost-management/tutorial-acm-create-budgets?toc=/azure/billing/TOC.json).

## <a name="best-practice-optimize-azure-monitor-retention"></a>Рекомендация. Оптимизация хранения в Azure Monitor

Перемещая ресурсы в Azure и включая журнал ведения диагностики для них, можно создавать большое число данных журнала. Обычно эти данные журнала отправляются в учетную запись хранения, сопоставленную с рабочей областью Log Analytics.

- Чем дольше период хранения данных журнала, тем больше данных вы получите.
- Не все данные журнала одинаковые, некоторые ресурсы будут создавать больше данных журнала, чем другие.
- Из-за законодательных норм и требований к соответствию для одних ресурсов журнал данных, возможно, понадобится хранить дольше, чем для других.
- Следует провести четкую грань между оптимизацией затрат на хранение журналов и сохранением необходимых данных журнала.
- Мы рекомендуем оценивать и настраивать ведения журнала сразу же после завершения миграции, чтобы не тратить деньги на хранение ненужных журналов.

**Дополнительные сведения**

- [Мониторинг использования и ожидаемых затрат](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-usage-and-estimated-costs).

## <a name="best-practice-optimize-storage"></a>Рекомендация. Оптимизация хранилища

Если вы следовали рекомендациям по выбору хранилища перед миграцией, вы, скорее всего, смогли сэкономить какие-то средства. Тем не менее еще остаются дополнительные затраты, которые также можно оптимизировать. Со временем большие двоичные объекты и файлы устаревают. Данные могут больше не использоваться, но их приходится хранить в течение определенного периода из-за нормативных требований. Тем не менее нет необходимости хранить их в высокопроизводительном хранилище, которое использовалось для начальной миграции.

Определение и перемещение устаревших данных в дешевые области хранения значительно влияет на ежемесячный бюджет для хранилища и обеспечивает экономию средств. В Azure предусмотрено множество способов для выявления и последующего хранения этих устаревших данных.

- Воспользуйтесь преимуществами уровней доступа для хранилища общего назначения версии 2, переместив менее важные данные с горячего на холодный и архивный уровни.
- С помощью StorSimple устаревшие данные можно перемещать на основе настраиваемых политик.

**Дополнительные сведения**

- [Хранилище BLOB-объектов Azure: горячий, холодный, архивный уровни хранилища и уровень "Премиум" (предварительная версия)](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers).
- Общие сведения о StorSimple см. в [этой статье](https://docs.microsoft.com/azure/azure-monitor/overview), а цены на StorSimple [здесь](https://azure.microsoft.com/pricing/details/storsimple).

## <a name="best-practice-automate-vm-optimization"></a>Рекомендация. Автоматизация оптимизации виртуальной машины

Конечной целью запуска виртуальной машины в облаке является развертывание ЦП, памяти и используемого диска. Обнаружив неоптимизированные или часто простаивающие виртуальные машины, необходимо завершить их работу или уменьшить их масштаб с помощью масштабируемых наборов виртуальных машин.

Виртуальную машину можно оптимизировать с помощью службы автоматизации Azure, масштабируемых наборов виртуальных машин, автоматического завершения работы и стороннего решения или решения на основе сценариев.

**Дополнительные сведения**

- [Вертикальное автомасштабирование масштабируемых наборов виртуальных машин](https://docs.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-vertical-scale-reprovision).
- [Расписание автозапуска виртуальных машин](https://azure.microsoft.com/updates/azure-devtest-labs-schedule-vm-auto-start).
- [Решение для запуска и остановки виртуальных машин в нерабочее время в службе автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-solution-vm-management).
- Общие сведения о [Помощнике по Azure](https://docs.microsoft.com/azure/advisor/advisor-overview) и [наборе средств оптимизации ресурсов Azure (ARO)](https://github.com/Azure/azure-quickstart-templates/tree/master/azure-resource-optimization-toolkit).

## <a name="best-practices-use-logic-apps-and-runbooks-with-budgets-api"></a>Рекомендации. Использование Logic Apps и модулей Runbook с помощью API бюджетов

Azure предоставляет REST API с доступом к данным для выставления счетов клиента.

- API бюджетов можно использовать для интеграции внешних систем и рабочих процессов, которые активируются метриками, созданными на основе данных API.
- Вы можете извлекать данные об использовании и ресурсах в предпочтительные средства анализа данных.
- API использования ресурсов и RateCard в Azure позволяют точно прогнозировать расходы и управлять ими.
- API реализованы в виде поставщика ресурсов и относятся к API, которые предоставляют Azure Resource Manager.
- API бюджетов можно интегрировать с Azure Logic Apps и модулями Runbook.

**Дополнительные сведения**

- [Дополнительные сведения об API бюджетов](https://docs.microsoft.com/rest/api/consumption/budgets).
- [Использование API выставления счетов Azure для программного получения ценных сведений об использовании Azure](https://docs.microsoft.com/azure/billing/billing-usage-rate-card-overview).

## <a name="best-practice-implement-serverless-technologies"></a>Рекомендация. Реализация бессерверных технологий

Чтобы избежать простоев, рабочие нагрузки виртуальных машин иногда переносят "как есть". Часто на виртуальных машинах могут размещаться прерывистые задачи с коротким или, напротив, многочасовым периодом запуска. Например, виртуальные машины, на которых запускаются запланированные задачи, в том числе скрипты Планировщика задач Windows или PowerShell. Не смотря на то, что эти задачи не выполняются, вы тратите средства на виртуальную машину и хранилище диска.

Возможно, после миграции и тщательной проверки этих типов задач стоит перенести их в среду бессерверных технологий, например в задания службы "Функции Azure" или пакетной службы Microsoft Azure. Благодаря этому решению вам больше не нужно будет управлять виртуальными машинами и обслуживать их, что позволит дополнительно сэкономить средства.

**Дополнительные сведения**

- Узнайте о службе [Функциях Azure](https://azure.microsoft.com/services/functions).
- Узнайте о [пакетной службе Azure](https://azure.microsoft.com/services/batch).

## <a name="next-steps"></a>Следующие шаги

Просмотрите другие рекомендации:

- [Рекомендации по обеспечению безопасности рабочих нагрузок, перенесенных в Azure, и управлению ими](./migrate-best-practices-security-management.md).
- [Рекомендации по настройке сетей для рабочих нагрузок, перенесенных в Azure](./migrate-best-practices-networking.md).
