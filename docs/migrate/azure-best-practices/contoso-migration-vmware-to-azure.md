---
title: Перемещение локальной инфраструктуры VMware в Azure
description: Узнайте, как компания Contoso перемещает локальные виртуальные машины VMware в Azure.
author: deltadan
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: 12d83670b5d2c18a14229c2b14373da70c6b84d9
ms.sourcegitcommit: bcc73d194c6d00c16ae2e3c7fb2453ac7dbf2526
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2020
ms.locfileid: "86198971"
---
<!-- docsTest:ignore "Bulk Migration" "Cold Migration" -->

# <a name="move-on-premises-vmware-infrastructure-to-azure"></a>Перемещение локальной инфраструктуры VMware в Azure

В компании Contoso есть несколько вариантов переноса виртуальных машин VMware из локального центра обработки данных в Azure.

| Варианты переноса | Результат |
| --- | --- |
| [Миграция Azure](https://azure.microsoft.com/services/azure-migrate/) | [Оценка](https://docs.microsoft.com/azure/migrate/tutorial-assess-vmware) и [Миграция](https://docs.microsoft.com/azure/migrate/tutorial-migrate-vmware) локальных виртуальных машин. <br><br> Запуск рабочих нагрузок с помощью Azure IaaS. <br><br> Управление виртуальными машинами с помощью [Azure Resource Manager](https://azure.microsoft.com/features/resource-manager/). |
| [Решение Azure VMware](https://azure.microsoft.com/overview/azure-vmware) | Используйте VMware ХККС или vMotion для перемещения локальных виртуальных машин. <br><br> Запускайте собственные рабочие нагрузки VMware на аппаратном оборудовании Azure без операционной системы. <br><br> Управление виртуальными машинами с помощью vSphere. |

Решение VMware для Azure используется для создания частного облака в Azure с собственным доступом к VMware vCenter и других средств, поддерживаемых VMware для миграции рабочих нагрузок. Компания Contoso может уверенно использовать решение VMware для Azure, зная, что они являются первыми предложениями Майкрософт, поддерживающими VMware.

> [!NOTE]
> В этой статье рассматривается использование решения VMware для Azure (AVS) для перемещения локальных виртуальных машин VMware в Azure.

## <a name="business-drivers"></a>Бизнес-факторы

В тесной работе с бизнес-партнерами группа Contoso IT определит бизнес-драйверы для миграции VMware в Azure. Эти драйверы могут включать:

- **Эвакуации или завершение работы центра обработки данных:** Легко переносите рабочие нагрузки на основе VMware при консолидации или снятии с учета существующих центров обработки данных.
- **Аварийное восстановление и непрерывность бизнес-процессов:** Используйте стек VMware, развернутый в Azure в качестве первичного или вторичного сайта аварийного восстановления по запросу для инфраструктуры локального центра обработки данных.
- **Модернизации приложения:** Прикасайтесь к экосистеме Azure для модернизировать приложений Contoso без необходимости перестроения сред на основе VMware.
- **Реализация DevOps:** Перенесите цепочки средств Azure DevOps в среды VMware и приложения модернизировать в своем собственном темпе.
- **Обеспечение непрерывности операций:** Повторно разверните приложения на основе vSphere в Azure, избегая преобразования гипервизоров и рефакторинга приложений. Расширение поддержки устаревших приложений, работающих под Windows и SQL Server.

## <a name="vmware-on-premises-to-vmware-in-the-cloud-goals"></a>Локальная репликация VMware в VMware в целях облака

С учетом бизнес-факторов компания Contoso прикрепляет цели этой миграции:

- Продолжайте управлять существующими средами с помощью средств VMware, знакомых с их командами, а также модернизации приложения с собственными службами Azure.
- Легко перенесите рабочие нагрузки Contoso на основе VMware из центра обработки данных в Azure и интегрируйте среду VMware с Azure.
- После миграции приложение в Azure должно иметь те же возможности производительности, что и сегодня в VMware. Приложение остается критически важным в облаке, как и локально.

Эти цели поддерживают решение об использовании AVS и проверяют его как лучший способ переноса для contoso.

## <a name="benefits-of-running-vmware-workloads-in-azure"></a>Преимущества выполнения рабочих нагрузок VMware в Azure

С помощью решения Azure VMware (AVS) компания Contoso теперь может без проблем выполнять, управлять и защищать приложения в средах VMware и Azure с помощью общей операционной платформы.

Компания Contoso будет использовать существующие инвестиции, навыки и средства VMware, в том числе VMware vSphere, vSAN и vCenter, используя масштабирование, производительность и инновации в Azure. К дополнительным преимуществам могут относиться:

- Подготавливайте инфраструктуру VMware в облаке за считанные минуты и модернизировать приложения в своем собственном темпе.
- Улучшите приложения VMware с помощью выделенной изолированной высокопроизводительной инфраструктуры, а также уникальных продуктов и служб Azure.
- Перенесите или расширьте локальные виртуальные машины в Azure без рефакторинга приложений.
- Получите масштабирование, автоматизацию и быструю подготовку для рабочих нагрузок VMware в глобальной инфраструктуре Azure.
- Решение VMware для Azure поставляется корпорацией Майкрософт, проверяется с помощью VMware и выполняется в инфраструктуре Azure.

## <a name="solutions-design"></a>Разработка решений

После фиксации целей и требований компания Contoso проектирует и изучает решение по развертыванию и определяет процесс миграции.

### <a name="current-architecture"></a>Текущая архитектура

- Виртуальные машины, развернутые в локальном центре обработки данных, управляемом [vSphere](https://www.vmware.com/products/vsphere.html).
- Рабочие нагрузки, развернутые в кластере VMware ESXi узлов, управляемом с помощью [vCenter](https://www.vmware.com/products/vcenter-server.html), [vSAN](https://www.vmware.com/products/vsan.html)и [НСКС](https://www.vmware.com/products/nsx.html).

### <a name="proposed-architecture"></a>Предлагаемая архитектура

- Развертывание [частного облака AVS](https://docs.microsoft.com/azure/azure-vmware/concepts-private-clouds-clusters) в `West US` регионе Azure.
- Подключите локальный центр обработки данных к AVS, работающему в `West US` виртуальной сети и [ExpressRoute](https://docs.microsoft.com/azure/azure-vmware/concepts-networking) , с включенным Global REACH.
- Перенос виртуальных машин в выделенное решение VMware для Azure с помощью [расширения гибридного облака VMware (хккс)](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-D0CD0CC6-3802-42C9-9718-6DA5FEC246C6.html).

![Предлагаемая архитектура](./media/contoso-migration-vmware-to-azure/on-premises-stretched-network-expressroute.png)

## <a name="solution-review"></a>Проверка решения

Специалисты Contoso оценивают предлагаемый дизайн, составляя список плюсов и минусов.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Инфраструктура VMware без операционной системы с высокой производительностью. Инфраструктура, полностью выделенная для Contoso и физически изолированная от инфраструктуры других клиентов. <br><br> Поскольку компания Contoso использует повторное размещение с использованием VMware, нет никакой особой настройки или сложности миграции. <br><br> Компания Contoso может воспользоваться преимуществами своих инвестиций в Software Assurance, используя [преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) и [Расширенные обновления системы безопасности](https://www.microsoft.com/cloud-platform/windows-server-2008) для устаревших платформ Windows и SQL. <br><br> Contoso будет хранить полный контроль над виртуальными машинами приложений в Azure. <br><br> |
| **Недостатки** | Contoso потребуется продолжить поддержку приложения в качестве виртуальных машин VMware, а не перемещать их в управляемую службу, например в службу приложений Azure и базу данных SQL Azure. <br><br> Решение Azure VMware подготовлено и расценено на основе как минимум трех крупных узлов, а не отдельных виртуальных машин в Azure IaaS. Им потребуется спланировать потребности в емкости, так как они в настоящее время находятся в локальной среде, а не на основе природы других служб в Azure по требованию. |

> [!NOTE]
> Узнайте больше о [ценах](https://azure.microsoft.com/pricing/details/azure-vmware/) на решение Azure VMware.

## <a name="migration-process"></a>Процесс миграции

Компания Contoso переместит виртуальные машины в AVS с помощью средства VMware ХККС Tool. Виртуальные машины будут работать в частном облаке AVS.  [Типы миграции VMware хккс](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-8A31731C-AA28-4714-9C23-D9E924DBB666.html) включают в себя массовый перенос, холодный перенос и даже при выполнении рабочей нагрузки с использованием динамической миграции с помощью VMotion или репликации с поддержкой VMOTION (рав).

- Компания Contoso планирует свои сетевые подключения в Azure и ExpressRoute.
- Contoso создает частное облако AVS с помощью портал Azure.
- Затем сеть настраивается, включая каналы ExpressRoute.
- Затем компания Contoso настраивает компоненты ХККС для подключения локальной среды vSphere к частному облаку AVS.
- Затем виртуальные машины реплицируются и перемещаются в Azure с помощью VMware ХККС.

 ![Процесс миграции](./media/contoso-migration-vmware-to-azure/on-premises-vmware-hcx-azure.png)

## <a name="scenarios-steps"></a>Шаги сценариев

1. Планирование сети
1. Создание частного облака AVS
1. Настройка сети
1. Миграция виртуальных машин с помощью ХККС

### <a name="step-1-network-planning"></a>Шаг 1. Планирование сети

Компании Contoso необходимо спланировать сетевые подключения, в том числе виртуальную сеть Azure и подключение между локальной средой и Azure. Компании Contoso необходимо обеспечить высокоскоростное подключение между локальной средой и средами на основе Azure, а также подключение к частному облаку AVS.

Это подключение предоставляется через Azure ExpressRoute. для включения служб потребуется указать некоторые определенные диапазоны адресов сети и порты брандмауэра. Это подключение с низкой задержкой позволяет пользователям Contoso получать доступ к службам, работающим в своей подписке Azure, из среды "частный облако" AVS.

Contoso потребуется спланировать схему IP-адресов, включающую в себя неперекрывающиеся адресные пространства для своих [виртуальных сетей](https://docs.microsoft.com/azure/virtual-network/virtual-network-vnet-plan-design-arm). Они должны включить подсеть шлюза для [шлюза ExpressRoute](https://docs.microsoft.com/azure/expressroute/expressroute-about-virtual-network-gateways).

Частное облако AVS подключено к виртуальной сети Contoso Azure с помощью другого подключения Azure ExpressRoute. Global Reach ExpressRoute будет разрешена для [прямого подключения](https://docs.microsoft.com/azure/azure-vmware/concepts-networking#on-premises-interconnectivity) из локальной среды к виртуальным машинам, работающим в частном облаке AVS. Для включения Global Reach требуется номер SKU "Премиум" Premium.

![Global Reach ExpressRoute с AVS](./media/contoso-migration-vmware-to-azure/adjacency-overview-drawing-double.png)

Частным облакам AVS требуется как минимум `/22` блок сетевых адресов CIDR для подсетей. Чтобы подключить ее к локальным средам и виртуальным сетям, их блоки сетевых адресов не должны перекрываться.

>[!NOTE]
> Дополнительные сведения о планировании сети для AVS с помощью [учебника](https://docs.microsoft.com/azure/azure-vmware/tutorial-network-checklist/).

### <a name="step-2-create-an-avs-private-cloud"></a>Шаг 2. Создание частного облака "AVS"

После завершения планирования сети и IP-адресов компания Contoso будет сосредоточиться на подготовке службы AVS в регионе Azure "Западная часть США". AVS предоставляет Contoso возможность развернуть кластер vSphere в Azure.

Частное облако AVS — это изолированный программный центр данных VMware, который поддерживает узлы ESXi, vCenter, vSAN и НСКС. Стек работает на выделенных и изолированных узлах оборудования без операционной системы в регионе Azure. Минимальное первоначальное развертывание для частного облака AVS — три узла. Далее можно по одному добавлять дополнительные узлы, но не более 16 узлов на кластер.

>[!NOTE]
> Узнайте больше о [концепциях частного облака](https://docs.microsoft.com/azure/azure-vmware/concepts-private-clouds-clusters)AVS.

Частные облака AVS управляются с помощью портала AVS. Они имеют собственные vCenter Server в своем собственном домене управления.

>[!NOTE]
> Узнайте, как создавать частные облака AVS с помощью [учебника](https://docs.microsoft.com/azure/azure-vmware/tutorial-create-private-cloud).

- Contoso сначала регистрирует поставщик AVS в Azure с помощью следующей команды.

```bash
az provider register -n Microsoft.AVS --subscription <your subscription ID>
```

- С помощью портал Azure Contoso создает частное облако AVS, предоставляющее сведения о сети из плана.

![Создание частного облака AVS](./media/contoso-migration-vmware-to-azure/create-private-cloud.png)

> [!NOTE]
> Это действие занимает примерно два часа.

- Contoso проверяет развертывание частного облака AVS, перейдя в группу ресурсов и выбрав ресурс частного облака. После завершения развертывания состояние отображается как **успешно**.

![Проверка развертывания частного облака](./media/contoso-migration-vmware-to-azure/validate-deployment.png)

### <a name="step-3-configure-networking"></a>Шаг 3. Настройка сети

Для частного облака решения Azure VMware (AVS) требуется наличие виртуальной сети. Так как AVS в предварительной версии не поддерживает локальный экземпляр vCenter, вам придется выполнить дополнительные шаги по интеграции с локальной средой. Настройка канала ExpressRoute и шлюза виртуальной сети приведет к подключению их виртуальных сетей к частному облаку AVS.

>[!NOTE]
> Сведения о настройке сети для AVS с помощью [учебника](https://docs.microsoft.com/azure/azure-vmware/tutorial-configure-networking).

- Компания Contoso сначала создает виртуальную сеть с подсетью шлюза.

> [!IMPORTANT]
> Компания Contoso должна использовать адресное пространство, которое **не** пересекается с адресным пространством, используемым при создании частного облака.

- Затем они создают VPN-шлюз ExpressRoute, что позволяет выбрать правильный номер SKU.

![VPN-шлюз ExpressRoute](./media/contoso-migration-vmware-to-azure/create-virtual-network-gateway.png)

- Им требуется ключ авторизации для подключения ExpressRoute к виртуальной сети. Он находится на экране подключения ресурса частного облака AVS в портал Azure.

![Ключ проверки подлинности ER](./media/contoso-migration-vmware-to-azure/request-auth-key.png)

- Наконец, они подключают ExpressRoute к VPN-шлюзу, который подключает частное облако AVS к своей виртуальной сети. Это достигается путем создания подключения в Azure.

![Подключение ER к виртуальной сети](./media/contoso-migration-vmware-to-azure/add-connection.png)

>[!NOTE]
> Узнайте, как получить доступ к частному облаку и подключиться к vSphere с помощью этого [руководства](https://docs.microsoft.com/azure/azure-vmware/tutorial-access-private-cloud).

### <a name="step-4-migrate-using-vmware-hcx"></a>Шаг 4. Миграция с помощью VMware ХККС

Чтобы переместить виртуальные машины VMware в Azure с помощью ХККС, Contoso необходимо выполнить следующие общие действия:

- Установите и настройте VMware ХККС.
- Выполните миграцию в Azure с помощью ХККС.

>[!NOTE]
> Узнайте, как установить ХККС для AVS с помощью этого [руководства](https://docs.microsoft.com/azure/azure-vmware/hybrid-cloud-extension-installation).

<!-- docsTest:ignore L2 -->

#### <a name="install-and-configure-vmware-hcx-for-public-cloud"></a>Установка и настройка VMware ХККС для общедоступного облака

[VMware хккс](https://cloud.vmware.com/vmware-hcx) — это продукт VMware, который входит в состав установки решения Azure VMware по умолчанию. По умолчанию ХККС Advanced установлен, но может быть обновлен до ХККС Enterprise для получения дополнительных возможностей в качестве дополнительного компонента. AVS автоматизирует компонент Cloud Manager ХККС в AVS и предоставляет ключи активации клиента и ссылку для скачивания на устройство соединителя ХККС, необходимое для настройки на локальной стороне и в домене vCenter клиента. Затем они будут связываться с облачным устройством AVS, и клиенты могут начать пользоваться такими службами, как миграция и увеличение L2, если это необходимо.

- Компания Contoso развертывает ХККС с помощью OVA, предоставляемого VMware.

![ХККС OVA](./media/contoso-migration-vmware-to-azure/configure-template.png)

Сведения о настройке ХККС для частного облака AVS см. в этом руководстве.

>[!NOTE]
> Узнайте, как установить ХККС для AVS с помощью этого [руководства](https://docs.microsoft.com/azure/azure-vmware/hybrid-cloud-extension-installation).

- Во время настройки ХККС компания Contoso выбрала возможность перехода между другими параметрами, включая аварийное восстановление.

![Настройка ХККС](./media/contoso-migration-vmware-to-azure/hcx-manager.png)

> Примечание. Дополнительные сведения о [рабочем процессе установки хккс для общедоступных облаков хккс](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-FDE5473E-6B71-4A71-85B6-8C9BA2B73686.html).

#### <a name="perform-migrations-to-azure-using-hcx"></a>Выполнение миграции в Azure с помощью ХККС

Если для локального центра обработки данных (источника) и частного облака AVS (назначение) настроено с помощью VMware Cloud и ХККС, Contoso может начать миграцию виртуальных машин. Виртуальные машины можно перемещать в центры обработки данных с поддержкой VMware ХККС и из них с помощью нескольких технологий миграции.

- Приложение Contoso ХККС находится в сети, а его состояние — зеленый. Теперь они готовы к переносу и защите виртуальных машин AVS с помощью ХККС

![Состояние ХККС](./media/contoso-migration-vmware-to-azure/appliance-status.png)

#### <a name="vmware-hcx-bulk-migration"></a>ХККСная миграция VMware

Этот метод миграции использует VMware vSphere протоколы репликации для перемещения виртуальных машин на конечный сайт.

- Параметр "Групповая миграция" предназначен для параллельного перемещения виртуальных машин.
- Этот тип миграции может быть задан для завершения по заранее заданному расписанию.
- Виртуальная машина выполняется на исходном сайте до начала отработки отказа. Прерывание работы службы с массовым миграцией эквивалентно перезагрузке.

#### <a name="vmware-hcx-vmotion-live-migration"></a>Динамическая миграция VMware ХККС vMotion

Этот метод использует протокол VMware vMotion для перемещения виртуальной машины на удаленный сайт.

- Параметр vMotion предназначен для перемещения одной виртуальной машины за раз.
- Состояние виртуальной машины перемещается. В процессе VMware ХККС vMotion не происходит перерыва в работе службы.

#### <a name="vmware-hcx-cold-migration"></a>Холодный перенос VMware ХККС

Этот метод миграции использует протокол VMware NFC. Он автоматически выбирается, когда исходная виртуальная машина выключена.

#### <a name="vmware-hcx-replication-assisted-vmotion"></a>Репликация VMware ХККС с поддержкой vMotion

Репликация VMware ХККС с помощью vMotion (рав) сочетает в себе преимущества групповой миграции VMware ХККС (параллельные операции, устойчивость и планирование) с VMware ХККС vMotion (миграция состояния виртуальной машины с нулевым временем простоя).

> [!IMPORTANT]
> См. [документацию по VMware хккс](https://docs.vmware.com/en/VMware-HCX/index.html) и [Перенос виртуальных машин с помощью VMware хккс](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-D0CD0CC6-3802-42C9-9718-6DA5FEC246C6.html?hWord=N4IghgNiBcIBIGEAaACAtgSwOYCcwBcMB7AOxAF8g) в технической документации по VMware.
