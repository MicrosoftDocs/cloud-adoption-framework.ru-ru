---
title: Перемещение локальной инфраструктуры VMware в Azure
description: Узнайте, как вымышленная компания Contoso перемещает локальные виртуальные машины VMware в Azure.
author: deltadan
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.openlocfilehash: 4c2e35b3401d4a4eaeb534befee9e33c4b1a83df
ms.sourcegitcommit: 57b757759b676a22f13311640b8856557df36581
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/20/2020
ms.locfileid: "94996424"
---
<!-- docutune:casing "HCX Bulk Migration" "HCX Cold Migration" -->

# <a name="move-on-premises-vmware-infrastructure-to-azure"></a>Перемещение локальной инфраструктуры VMware в Azure

Когда вымышленная компания Contoso переносит свои виртуальные машины VMware из локального центра обработки данных в Azure, для группы доступны два варианта. В этой статье основное внимание уделяется решению Azure VMware, которое компания Contoso определила как лучшую миграцию.

| Варианты переноса | Результат |
| --- | --- |
| [Миграция Azure](https://azure.microsoft.com/services/azure-migrate/) | <li>[Оценка](/azure/migrate/tutorial-assess-vmware) и [Миграция](/azure/migrate/tutorial-migrate-vmware) локальных виртуальных машин. <li>Запуск рабочих нагрузок с помощью инфраструктуры Azure как услуги (IaaS). <li>Управление виртуальными машинами с помощью [Azure Resource Manager](https://azure.microsoft.com/features/resource-manager/). |
| [Решение Azure VMware](https://azure.microsoft.com/overview/azure-vmware) | <li>Используйте расширение гибридного облака VMware (ХККС) или vMotion для перемещения локальных виртуальных машин. <li>Запускайте собственные рабочие нагрузки VMware на оборудовании Azure без операционной системы. <li>Управление виртуальными машинами с помощью vSphere. |

В этой статье компания Contoso использует решение Azure VMware для создания частного облака в Azure с собственным доступом к VMware vCenter и другим средствам, которые поддерживаются VMware для миграции рабочих нагрузок. Компания Contoso может уверенно использовать решение VMware для Azure, зная, что это первое предложение корпорации Майкрософт, основанное на технологии VMware.

## <a name="business-drivers"></a>Бизнес-факторы

В тесной работе с деловыми партнерами ИТ-группа Contoso определяет бизнес-драйверы для миграции VMware в Azure. Эти драйверы могут включать:

- **Эвакуации или завершение работы центра обработки данных:** Легко переносите рабочие нагрузки на основе VMware при консолидации или снятии с учета существующих центров обработки данных.
- **Аварийное восстановление и непрерывность бизнес-процессов:** Используйте стек VMware, развернутый в Azure в качестве первичного или вторичного сайта аварийного восстановления по запросу для инфраструктуры локального центра обработки данных.
- **Модернизации приложения:** Прикасайтесь к экосистеме Azure для модернизировать приложений Contoso без необходимости перестроения сред на основе VMware.
- **Реализация DevOps:** Перенесите цепочки средств Azure DevOps в среды VMware и приложения модернизировать в своем собственном темпе.
- **Обеспечение непрерывности операций:** Повторно разверните приложения на основе vSphere в Azure, избегая преобразования гипервизоров и рефакторинга приложений. Расширение поддержки устаревших приложений, работающих под управлением Windows и SQL Server.

## <a name="goals-for-migrating-vmware-on-premises-to-vmware-in-the-cloud"></a>Цели переноса локальной среды VMware в VMware в облаке

С учетом его бизнес-факторов компания Contoso заблокировала несколько целей для этой миграции:

- Продолжайте управлять существующими средами с помощью средств VMware, знакомых с его командами, а также модернизации приложения с собственными службами Azure.
- Легко перенесите рабочие нагрузки Contoso на основе VMware из центра обработки данных в Azure и интегрируйте среду VMware с Azure.
- После миграции приложение в Azure должно иметь те же возможности производительности, что и сегодня в VMware. Приложение остается критически важным в облаке, как и локально.

Эти цели поддерживают решение Contoso для использования решения VMware Azure и проверки его в качестве лучшего метода переноса.

## <a name="benefits-of-running-vmware-workloads-in-azure"></a>Преимущества выполнения рабочих нагрузок VMware в Azure

Используя решение VMware для Azure, компания Contoso теперь может без проблем выполнять, управлять и защищать приложения в средах VMware и Azure с помощью общей операционной платформы.

Компания Contoso будет заменять собственные инвестиции, навыки и средства VMware, в том числе VMware vSphere, vSAN и vCenter. В то же время компания Contoso получает масштабирование, производительность и инновации в Azure. Кроме того, он может:

- Настройте инфраструктуру VMware в облаке за несколько минут.
- Модернизировать приложения в собственном темпе.
- Улучшите приложения VMware с помощью выделенной изолированной высокопроизводительной инфраструктуры, а также уникальных продуктов и служб Azure.
- Переместите или расширьте локальные виртуальные машины в Azure без необходимости рефакторинга приложений.
- Получите масштабирование, автоматизацию и быструю подготовку для рабочих нагрузок VMware в глобальной инфраструктуре Azure.
- Воспользуйтесь преимуществами решения, поставляемого корпорацией Майкрософт, проверенного с помощью VMware, и запустите в инфраструктуре Azure.

## <a name="the-solutions-design"></a>Разработка решений

После того как Contoso закрепляет свои цели и требования, компания разрабатывает и изучает решение для развертывания и определяет процесс миграции.

### <a name="current-architecture"></a>Текущая архитектура

Текущие возможности архитектуры компании Contoso:

- Виртуальные машины, развернутые в локальном центре обработки данных, управляемом [vSphere](https://www.vmware.com/products/vsphere.html).
- Рабочие нагрузки, развернутые в кластере VMware ESXi узлов, который управляется с помощью [vCenter](https://www.vmware.com/products/vcenter-server.html), [vSAN](https://www.vmware.com/products/vsan.html)и [НСКС](https://www.vmware.com/products/nsx.html).

### <a name="proposed-architecture"></a>Предлагаемая архитектура

В предлагаемой архитектуре компания Contoso будет:

- Разверните [Частное облако решения Azure VMware](/azure/azure-vmware/concepts-private-clouds-clusters) в регионе Azure "Западная часть США".
- Подключите локальный центр обработки данных к решению Azure VMware, работающему в западной части США, используя виртуальные сети и [ExpressRoute](/azure/azure-vmware/concepts-networking) с включенным Global REACH.
- Перенесите виртуальные машины в выделенное решение VMware для Azure с помощью [гибридного облачного расширения VMware (хккс)](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-D0CD0CC6-3802-42C9-9718-6DA5FEC246C6.html).

![Схема предлагаемой архитектуры.](./media/contoso-migration-vmware-to-azure/on-premises-stretched-network-expressroute.png)

## <a name="solution-review"></a>Проверка решения

Компания Contoso оценивает предлагаемую конструкцию, объединяя список «плюсы» и «минус», как показано в следующей таблице.

| Оценка | Сведения |
| --- | --- |
| **Преимущества** | <li>Инфраструктура VMware без операционной системы с высокой производительностью. <li>Инфраструктура, полностью выделенная для Contoso и физически изолированная от инфраструктуры других клиентов. <li>Поскольку компания Contoso использует повторное размещение, использующее VMware, нет особой сложной настройки или миграции. <li>Компания Contoso может воспользоваться преимуществами инвестиций в Software Assurance, используя [преимущество гибридного использования Azure](https://azure.microsoft.com/pricing/hybrid-benefit/) и [Расширенные обновления безопасности](https://www.microsoft.com/cloud-platform/windows-server-2008) для устаревших платформ Windows и SQL. <li>Contoso будет хранить полный контроль над виртуальными машинами приложений в Azure. <br><br> |
| **Недостатки** | <li>Contoso потребуется продолжить поддержку приложения в качестве виртуальных машин VMware, а не переместить их в управляемую службу, например в службу приложений Azure и базу данных SQL Azure. <li>Решение Azure VMware настраивается и оценивается на основе как минимум трех крупных узлов, а не отдельных виртуальных машин в Azure IaaS. Компании Contoso потребуется спланировать потребности в ресурсах, так как компания в настоящее время использует локальную среду, которая будет ограничивать ее от природы других служб в Azure по требованию. |

> [!NOTE]
> Сведения о ценах см. на странице [цен на решения VMware для Azure](https://azure.microsoft.com/pricing/details/azure-vmware/).

## <a name="migration-process"></a>Процесс миграции

Компания Contoso переместит свои виртуальные машины в решение VMware для Azure с помощью средства VMware ХККС. Виртуальные машины будут работать в частном облаке решения Azure VMware. [Методы миграции VMware хккс](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-8A31731C-AA28-4714-9C23-D9E924DBB666.html) включают выполнение неполного или холодного переноса. VMware vMotion или служба с поддержкой репликации vMotion (рав) — это метод, зарезервированный для рабочих нагрузок, которые выполняются с помощью динамической миграции.

Для завершения процесса группа Contoso:

- Планирование сетей в Azure и ExpressRoute.
- Создает частное облако решения Azure VMware с помощью портал Azure.
- Настраивает сеть для включения каналов ExpressRoute.
- Настраивает компоненты ХККС для подключения локальной среды vSphere к частному облаку решения Azure VMware.
- Реплицирует виртуальные машины, а затем перемещает их в Azure с помощью VMware ХККС.

 ![Схема процесса миграции.](./media/contoso-migration-vmware-to-azure/on-premises-vmware-hcx-azure.png)

## <a name="scenarios-steps"></a>Шаги сценариев

> [!div class="checklist"]
>
> - **Шаг 1. Планирование сети**
> - **Шаг 2. Создание частного облака решения Azure VMware**
> - **Шаг 3. Настройка сети**
> - **Шаг 4. Миграция виртуальных машин с помощью ХККС**

### <a name="step-1-network-planning"></a>Шаг 1. Планирование сети

Contoso необходимо спланировать сетевые подключения, чтобы включить виртуальную сеть Azure и подключение между локальной средой и Azure. Компании необходимо обеспечить высокоскоростное подключение между локальными средами и средой на основе Azure, а также подключение к частному облаку решения Azure VMware.

Это подключение предоставляется через Azure ExpressRoute. для включения служб потребуется указать некоторые определенные диапазоны адресов сети и порты брандмауэра. Это подключение с высокой пропускной способностью и с низкой задержкой позволяет компании Contoso получать доступ к службам, которые работают в своей подписке Azure, из среды частного облака решения Azure VMware.

Contoso потребуется спланировать схему IP-адресов, включающую в себя неперекрывающиеся адресные пространства для своих [виртуальных сетей](/azure/virtual-network/virtual-network-vnet-plan-design-arm). Компания должна включить подсеть шлюза для [шлюза ExpressRoute](/azure/expressroute/expressroute-about-virtual-network-gateways).

Частное облако решения Azure VMware подключено к виртуальной сети Contoso Azure с помощью другого подключения Azure ExpressRoute. Global Reach ExpressRoute будет разрешена для [прямого подключения](/azure/azure-vmware/concepts-networking#on-premises-interconnectivity) локальных виртуальных машин к виртуальным машинам, работающим в частном облаке решения VMware Azure. Для включения Global Reach требуется номер SKU "Премиум" Premium.

![Схема Global Reach ExpressRoute с помощью решения VMware для Azure.](./media/contoso-migration-vmware-to-azure/adjacency-overview-drawing-double.png)

Для частных облаков решений VMware Azure требуется, как минимум, `/22` блок сетевых адресов CIDR для подсетей. Для подключения к локальным средам и виртуальным сетям это должен быть неперекрывающийся блок сетевых адресов.

>[!NOTE]
> Дополнительные сведения о планировании сети для решения Azure VMware см. в статье [Контрольный список сетей для решения VMware для Azure](/azure/azure-vmware/tutorial-network-checklist/).

### <a name="step-2-create-an-azure-vmware-solution-private-cloud"></a>Шаг 2. Создание частного облака решения Azure VMware

После завершения планирования сети и IP-адресов компания Contoso будет сосредоточиться на настройке службы решения Azure VMware в регионе Azure "Западная часть США". С помощью решения VMware для Azure компания Contoso может развернуть кластер vSphere в Azure.

Частное облако решения Azure VMware — это изолированный программный центр VMware, который поддерживает узлы ESXi, vCenter, vSAN и НСКС. Стек работает на выделенных и изолированных узлах оборудования без операционной системы в регионе Azure. Минимальное первоначальное развертывание для частного облака решения Azure VMware — три узла. Далее можно по одному добавлять дополнительные узлы, но не более 16 узлов на кластер.

Дополнительные сведения см. в разделе [Основные понятия частного облака и кластера решения Azure VMware Preview](/azure/azure-vmware/concepts-private-clouds-clusters).

Для управления частными облаками решения Azure VMware используется портал решения Azure VMware. Contoso имеет собственный сервер vCenter в собственном домене управления.

Сведения о создании частных облаков решений VMware для Azure см. в статье [развертывание частного облака решения Azure VMware в Azure](/azure/azure-vmware/tutorial-create-private-cloud).

1. Группа Contoso сначала регистрирует поставщик решений Azure VMware в Azure, выполнив следующую команду:

    ```bash
    az provider register -n Microsoft.AVS --subscription <your subscription ID>
    ```

1. В портал Azure группа создает частное облако решения Azure VMware, предоставляя сведения о сети из плана. Затем команда выбирает команду **Обзор и создание**. Этот шаг занимает около двух часов.

    ![Снимок экрана портал Azure панели для создания частного облака решения Azure VMware.](./media/contoso-migration-vmware-to-azure/create-private-cloud.png)

1. Команда проверяет, завершено ли развертывание частного облака решения VMware Azure, перейдя к группе ресурсов и выбрав ресурс частного облака. Состояние отображается как " **успех**".

    ![Снимок экрана со страницей частного облака Contoso Azure VMware, показывающая, что развертывание прошло успешно.](./media/contoso-migration-vmware-to-azure/validate-deployment.png)

### <a name="step-3-configure-networking"></a>Шаг 3. Настройка сети

Для частного облака решения Azure VMware требуется виртуальная сеть. Так как решение VMware для Azure не поддерживает локальный сервер vCenter во время действия предварительной версии, Contoso требует дополнительных действий для интеграции с локальной средой. Настроив канал ExpressRoute и шлюз виртуальной сети, Группа подключает свои виртуальные сети к частному облаку решения Azure VMware.

Дополнительные сведения см. [в статье Настройка сетей для частного облака VMware в Azure](/azure/azure-vmware/tutorial-configure-networking).

1. Группа Contoso сначала создает виртуальную сеть с подсетью шлюза.

    > [!IMPORTANT]
    > Группа должна использовать адресное пространство, которое _не_ пересекается с адресным пространством, которое использовалось при создании частного облака.

1. Группа создает VPN-шлюз ExpressRoute, выберет правильный номер SKU, а затем нажмите кнопку Обзор и **Создание**.

    ![Снимок экрана с панелью "Создание шлюза виртуальной сети".](./media/contoso-migration-vmware-to-azure/create-virtual-network-gateway.png)

1. Команда получает ключ авторизации для подключения ExpressRoute к виртуальной сети. Ключ находится на экране подключения ресурса частного облака решения Azure VMware в портал Azure.

    ![Снимок экрана с вкладкой ExpressRoute в области подключения частного облака решения VMware для Contoso Azure.](./media/contoso-migration-vmware-to-azure/request-auth-key.png)

1. Команда подключает ExpressRoute к VPN-шлюзу, который подключает частное облако решения Azure VMware к виртуальной сети Contoso. Это достигается путем создания подключения в Azure.

    ![Снимок экрана: панель "Добавление подключения" для подключения ExpressRoute к виртуальной сети.](./media/contoso-migration-vmware-to-azure/add-connection.png)

Дополнительные сведения см. [в статье как получить доступ к частному облаку решения Azure VMware](/azure/azure-vmware/tutorial-access-private-cloud).

### <a name="step-4-migrate-by-using-vmware-hcx"></a>Шаг 4. Миграция с помощью VMware ХККС

Чтобы переместить виртуальные машины VMware в Azure с помощью ХККС, группе Contoso потребуется выполнить следующие общие действия:

- Установите и настройте VMware ХККС.
- Выполните миграцию в Azure с помощью ХККС.

Дополнительные сведения см. в [статье Установка хккс для решения VMware для Azure](/azure/azure-vmware/hybrid-cloud-extension-installation).

<!-- docutune:casing L2 -->

#### <a name="install-and-configure-vmware-hcx-for-the-public-cloud"></a>Установка и настройка VMware ХККС для общедоступного облака

[VMware хккс](https://cloud.vmware.com/vmware-hcx) — это продукт VMware, который входит в состав установки решения Azure VMware по умолчанию. ХККС Advanced устанавливается по умолчанию, но его можно обновить до ХККС Enterprise, так как требуются дополнительные функции и функциональные возможности.

Решение VMware для Azure автоматизирует компонент Cloud Manager ХККС в решении VMware для Azure. Он предоставляет ключи активации клиента и ссылку для скачивания на устройство соединителя ХККС, которое должно быть настроено на локальной стороне и в домене vCenter клиента. Затем эти элементы связаны с облачным устройством решения VMware для Azure, чтобы клиенты могли воспользоваться преимуществами таких служб, как миграция и перенос L2.

- Группа Contoso развертывает ХККС с помощью пакета OVF, предоставляемого VMware.

   ![Снимок экрана окна "развертывание шаблона OVF".](./media/contoso-migration-vmware-to-azure/configure-template.png)

   Чтобы установить и настроить ХККС для частного облака решения Azure VMware, см. статью [Установка хккс для Azure VMware](/azure/azure-vmware/hybrid-cloud-extension-installation).

- По мере того, как команда настраивает ХККС, вы решили включить миграцию и другие параметры, включая аварийное восстановление.

   ![Снимок экрана окна "Создание сетки услуг" для настройки ХККС.](./media/contoso-migration-vmware-to-azure/hcx-manager.png)

   Дополнительные сведения см. в разделе [Рабочий процесс установки хккс для общедоступных облаков хккс](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-FDE5473E-6B71-4A71-85B6-8C9BA2B73686.html).

#### <a name="migrate-vms-to-azure-by-using-hcx"></a>Перенос виртуальных машин в Azure с помощью ХККС

Если для локального центра обработки данных (источника) и частного облака Azure VMware (назначение) настроено облако VMware и ХККС, Contoso может начать перенос виртуальных машин. Команда может перемещать виртуальные машины в центры обработки данных с поддержкой VMware ХККС и обратно с помощью нескольких технологий миграции.

- Приложение ХККС contoso находится в режиме «в сети», а его состояние — «зеленый». Теперь команда готова к переносу и защите виртуальных машин решения VMware Azure с помощью ХККС.

  ![Снимок экрана со страницей веб-клиента VMware vSphere.](./media/contoso-migration-vmware-to-azure/appliance-status.png)

#### <a name="vmware-hcx-bulk-migration"></a>ХККСная миграция VMware

Этот метод миграции использует VMware vSphere протоколы репликации для одновременного перемещения нескольких виртуальных машин на конечный сайт. Доступные преимущества:

- Этот метод предназначен для параллельного перемещения нескольких виртуальных машин.
- Миграцию можно настроить на завершение по заранее определенному расписанию.
- Виртуальные машины выполняются на исходном сайте до начала отработки отказа. Прерывание работы службы эквивалентно перезагрузке.

#### <a name="vmware-hcx-vmotion-live-migration"></a>Динамическая миграция VMware ХККС vMotion

Этот метод миграции использует протокол VMware vMotion для перемещения одной виртуальной машины на удаленный сайт. Доступные преимущества:

- Этот метод предназначен для перемещения одной виртуальной машины за раз.
- При миграции состояния виртуальной машины прерывание службы не происходит.

#### <a name="vmware-hcx-cold-migration"></a>Холодный перенос VMware ХККС

В этом методе миграции используется протокол связи ближнего поля VMware. Этот параметр выбирается автоматически, если исходная виртуальная машина выключена.

#### <a name="vmware-hcx-replication-assisted-vmotion"></a>Репликация VMware ХККС с поддержкой vMotion

VMware ХККС рав сочетает в себе преимущества групповой миграции VMware ХККС, включая параллельные операции, устойчивость и планирование, благодаря преимуществам миграции VMware ХККС vMotion, которые включают в себя нулевое время простоя при миграции состояния виртуальной машины.

## <a name="additional-resources"></a>Дополнительные ресурсы

Дополнительную техническую документацию по VMware см. в следующих статьях:

- [Документация по VMware ХККС](https://docs.vmware.com/en/VMware-HCX/index.html)
- [Миграция виртуальных машин с помощью VMware ХККС](https://docs.vmware.com/en/VMware-HCX/services/user-guide/GUID-D0CD0CC6-3802-42C9-9718-6DA5FEC246C6.html?hWord=N4IghgNiBcIBIGEAaACAtgSwOYCcwBcMB7AOxAF8g)
