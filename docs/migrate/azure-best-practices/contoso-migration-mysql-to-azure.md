---
title: Перенос баз данных MySQL в Azure
description: Узнайте, как компания Contoso перенеса свои локальные базы данных MySQL в Azure.
author: deltadan
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: a23b0355fab1f921935f109ce77c0fd79d49cda5
ms.sourcegitcommit: 84d7bfd11329eb4c151c4c32be5bab6c91f376ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2020
ms.locfileid: "86233619"
---
<!-- cSpell:ignore mysqldump InnoDB binlog Navicat -->

# <a name="migrate-mysql-databases-to-azure"></a>Перенос баз данных MySQL в Azure

В этой статье показано, как вымышленная компания Contoso планирует и перенеса свою локальную платформу базы данных MySQL с открытым исходным кодом в Azure.

## <a name="business-drivers"></a>Бизнес-факторы

Совместными усилиями ИТ-руководство и деловые партнеры определили указанные ниже цели этой миграции.

- **Повышение доступности.** Компания Contoso имела проблемы с доступностью к локальной среде MySQL. Для бизнеса требуются более надежные приложения, использующие это хранилище данных.
- **Повышение эффективности.** Компании Contoso необходимо удалить ненужные процедуры и упростить процессы для разработчиков и пользователей. Бизнес требует, чтобы он был быстрым и не тратит время или деньги, чтобы ускорить выполнение требований клиентов.
- **Повышение гибкости.**  ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Он должен иметь возможность реагировать быстрее, чем изменения в Marketplace, чтобы обеспечить успешную работу в глобальной экономике. ИТ-не должны стать блоком.
- **Измените.** По мере успешного роста бизнеса ИТ-отдел компании Contoso должен предоставлять системы, способные расти в том же темпе.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции. Эти цели использовались для определения оптимального метода миграции.

| Требования | Сведения |
| --- | --- |
| **Доступность** | В настоящее время внутренний персонал имеет Нежесткое время с средой размещения для экземпляра MySQL. Компания Contoso хочет получить доступ к 99,99% уровня базы данных. |
| **Масштабируемость** | На локальном узле базы данных недостаточно ресурсов, компании Contoso требуется способ масштабировать свои экземпляры за пределами их текущих ограничений или масштабировать их, если бизнес-среда изменяется для экономии затрат. |
| **Производительность** | Отдел кадров Contoso использует различные отчеты ежедневно, еженедельно и ежемесячно. При выполнении этих отчетов они испытывают серьезные проблемы с производительностью приложения, ориентированного на сотрудников. Они должны запускать отчеты, не влияя на производительность приложения. |
| **Безопасность** | Компания Contoso должна быть в курсе, что база данных будет доступна только внутренним приложениям, а не видима или недоступна через Интернет. |
| **Мониторинг** | Contoso в настоящее время использует средства для мониторинга метрик сервера базы данных MySQL и предоставления уведомлений при возникновении проблем с ЦП, памятью или хранилищем. Они бы хотели иметь такую же возможность в Azure. |
| **Непрерывность бизнес-процессов** | Хранилище данных HR является важной частью ежедневных операций Contoso, а также в том случае, если оно было повреждено или его необходимо восстановить, чтобы максимально сократить время простоя. |
| **Azure** | Компания Contoso хочет переместить приложение в Azure, не запуская его на виртуальных машинах. Contoso хочет использовать службы PaaS Azure для уровня данных. |

## <a name="solution-design"></a>Архитектура решения

После фиксации целей и требований компания Contoso проектирует и изучает решение для развертывания и определяет процесс миграции, включая средства и службы, которые будут использоваться для миграции.

### <a name="current-application"></a>Текущее приложение

В базе данных MySQL хранятся данные о сотрудниках, используемые для всех аспектов отдела кадров компании. В качестве внешнего интерфейса для обработки запросов сотрудников отдела кадров используется приложение [на основе лампы](https://wikipedia.org/wiki/LAMP_(software_bundle)) . Компания Contoso имеет 100 000 сотрудников по всему миру, поэтому время работы очень важно.

### <a name="proposed-solution"></a>Предлагаемое решение

Используйте Azure Database Migration Service, чтобы перенести базу данных в экземпляр базы данных Azure для MySQL и изменить все приложения и процессы для использования нового экземпляра базы данных Azure для MySQL.

### <a name="database-considerations"></a>Рекомендации по базе данных

<!-- TODO: Verify GraphDBMS term -->
<!-- docsTest:ignore ColumnStore GraphDBMS -->

В рамках процесса разработки решения компания Contoso проверила возможности в Azure для размещения данных MySQL. Следующие рекомендации помогли вам решить, как использовать Azure.

- Как и база данных SQL Azure, база данных Azure для MySQL позволяет применять [правила брандмауэра](https://docs.microsoft.com/azure/mysql/concepts-firewall-rules).
- Базу данных Azure для MySQL можно использовать с [виртуальной сетью Azure](https://docs.microsoft.com/azure/mysql/concepts-data-access-and-security-vnet) , чтобы запретить доступ к экземпляру.
- База данных Azure для MySQL имеет необходимые сертификаты соответствия требованиям и конфиденциальности, которые должны соответствовать компании Contoso для аудиторов.
- Производительность отчетов и обработки приложений можно улучшить с помощью считывания реплик.
- Возможность предоставлять доступ к службе только внутреннему сетевому трафику (без общего доступа) с помощью [закрытой ссылки](https://docs.microsoft.com/azure/mysql/concepts-data-access-security-private-link).
- Они решили не переходить в базу данных Azure для MySQL, так как они могут использовать модель базы данных MariaDB ColumnStore и Графдбмс в будущем.
- Помимо функций MySQL, contoso — это большая сторонником проектов с открытым кодом и отказаться от использования MySQL.
- [Пропускная способность и задержка](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) от приложения к базе данных достаточно достаточны в зависимости от выбранного шлюза (ExpressRoute или VPN-подключение типа "сеть — сеть").

### <a name="solution-review"></a>Проверка решения

Contoso оценивает предлагаемый дизайн, составляя список плюсов и минусов.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Служба "база данных Azure для MySQL" предоставляет соглашение об уровне обслуживания с финансовыми гарантиями на 99,99% для обеспечения [высокого уровня доступности](https://docs.microsoft.com/azure/mysql/concepts-high-availability). <br><br> Azure предлагает возможность увеличения или уменьшения масштаба в течение пиковых нагрузок в каждом квартале. Компания Contoso может сэкономить еще больше покупок [зарезервированной емкости](https://docs.microsoft.com/azure/mysql/concept-reserved-pricing). <br><br> Azure предоставляет возможности восстановления на момент времени и геовосстановление для базы данных Azure для MySQL. <br><br> |
| **Недостатки** | Компания Contoso будет ограничена версиями выпуска MySQL, которые поддерживаются в Azure, в настоящее время 10,2 и 10,3. <br><br> У базы данных Azure для MySQL есть некоторые [ограничения](https://docs.microsoft.com/azure/mysql/concepts-limits) , например масштабирование хранилища. |

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![Архитектура сценария ](./media/contoso-migration-mysql-to-azure/architecture.png)
 _рис. 1. Архитектура сценария._

### <a name="migration-process"></a>Процесс миграции

#### <a name="preparation"></a>Подготовка

Прежде чем можно будет выполнить миграцию баз данных MySQL, необходимо убедиться, что эти экземпляры соответствуют всем предварительным требованиям Azure для успешной миграции.

#### <a name="supported-versions"></a>Поддерживаемые версии

MySQL использует `X.Y.Z` схему управления версиями. `X`является основной версией, `Y` является дополнительной версией, а `Z` — версией исправления.

Сейчас Azure поддерживает 10.2.25 и 10.3.16.

Azure автоматически управляет обновлениями для обновлений исправлений. Например, 10.2.21 в 10.2.23. Дополнительные и основные обновления версий не поддерживаются. Например, обновление с MySQL 10,2 до MySQL 10,3 не поддерживается. Если вы хотите выполнить обновление с 10,2 до 10,3, сделайте дамп и восстановите его на сервере, который был создан с использованием новой версии модуля.

#### <a name="network"></a>Сеть

Contoso потребуется настроить подключение шлюза виртуальной сети из локальной среды к виртуальной сети, где находится база данных MySQL. Это позволит локальному приложению получить доступ к базе данных через шлюз при обновлении строк подключения.

![Процесс миграции ](./media/contoso-migration-mysql-to-azure/migration-process.png)
 _рис. 2. процесс миграции._

#### <a name="migration"></a>Миграция

Администраторы Contoso переходят базу данных с помощью Azure Database Migration Service, используя пошаговое [руководство по миграции](https://docs.microsoft.com/azure/dms/tutorial-mysql-azure-mysql-online). Они могут выполнять миграцию в интерактивном, автономном и гибридном режиме (Предварительная версия) с помощью MySQL 5,6 или 5,7.

> [!NOTE]
> MySQL 8,0 поддерживается в базе данных Azure для MySQL, но средство Database Migration Service еще не поддерживает эту версию.

В качестве сводки необходимо выполнить следующие действия.

- Убедитесь, что выполнены все необходимые условия для миграции.

  - Источник сервера базы данных MySQL должен соответствовать версии, поддерживаемой базой данных Azure для MySQL. База данных Azure для MySQL поддерживает выпуск MySQL Community, подсистему хранилища InnoDB и миграцию на исходном и целевом компьютерах с одинаковыми версиями.
  - Включение двоичного входа в систему `my.ini` (Windows) или `my.cnf` (UNIX). В противном случае в мастере миграции произойдет следующая ошибка: `Error in binary logging. Variable binlog_row_image has value 'minimal'. Please change it to 'full'. For more information, see https://go.microsoft.com/fwlink/?linkid=873009` .
  - Пользователь должен иметь `ReplicationAdmin` роль.
  - Перенесите схемы базы данных без внешних ключей и триггеров.

- Создайте виртуальную сеть, которая подключается через ExpressRoute или VPN к локальной сети.

- Создайте экземпляр Azure Database Migration Service с `Premium` номером SKU, подключенным к виртуальной сети.

- Убедитесь, что экземпляр может получить доступ к базе данных MySQL через виртуальную сеть. Это гарантирует, что все входящие порты будут разрешены из Azure в MySQL на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается MySQL.

- Создайте новый проект Database Migration Service:

  ![Создание нового Database Migration Service проекта ](./media/contoso-migration-mysql-to-azure/migration-dms-new-project.png)
   _рис. 3. проект миграции базы данных Azure._

#### <a name="migration-using-native-tools"></a>Миграция с помощью собственных средств

В качестве альтернативы использованию Azure Database Migration Service Contoso может использовать общие служебные программы и средства, такие как MySQL Workbench, mysqldump, Toad или Navicat, для подключения и переноса данных в базу данных Azure для MySQL.

- Дамп и восстановление с помощью mysqldump:
  - Используйте параметр Exclude-Triggers в mysqldump; Это предотвратит исполнение триггеров во время импорта и повышает производительность.
  - Используйте параметр с одной транзакцией, чтобы установить режим изоляции преобразования в `REPEATABLE READ` и отправить `START TRANSACTION` инструкцию SQL перед сохранением данных.
  - Используйте параметр Disable-Keys в mysqldump, чтобы отключить ограничения внешнего ключа перед нагрузкой. Удаление этого приводит к повышению производительности.
  - Используйте хранилище BLOB-объектов Azure для хранения файлов резервных копий и выполните восстановление из этого файла для ускорения восстановления.
  - Обновление строк подключения приложения.
  - После переноса базы данных Contoso необходимо обновить строки подключения, чтобы они указывали на новую базу данных Azure для MySQL.

## <a name="cleanup-after-migration"></a>Очистка после миграции

После миграции Contoso необходимо создать резервную копию локальной базы данных для хранения и снять с учета локальный сервер базы данных MySQL.

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда выполняется миграция ресурсов в Azure, компании Contoso необходимо полностью ввести его в эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

- Компания Contoso должна обеспечить безопасность новой базы данных Azure для экземпляра MySQL и баз данных. Дополнительные сведения см. [в статье безопасность в базе данных Azure для MySQL](https://docs.microsoft.com/azure/mysql/concepts-security).
- В частности, компания Contoso должна проверить конфигурацию брандмауэра и виртуальной сети.
- Настройте частную ссылку, чтобы весь трафик базы данных хранился в Azure и локальной сети.
- Включите Azure Advanced Threat protection.

### <a name="backups"></a>Резервные копии

Убедитесь, что резервное копирование экземпляров базы данных Azure для MySQL выполняется с помощью геовосстановления. Это позволяет использовать резервные копии в парном регионе в случае регионального сбоя.

> [!IMPORTANT]
> Убедитесь, что ресурс базы данных Azure для MySQL имеет блокировку ресурсов, чтобы предотвратить удаление. Удаленные серверы нельзя восстановить.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- Базу данных Azure для MySQL можно масштабировать вверх или вниз, поэтому важно следить за производительностью сервера и баз данных, чтобы обеспечить соблюдение требований и свести к минимуму затраты.
- Ресурсы ЦП и хранилища связаны с затратами. Доступно несколько ценовых категорий. Убедитесь, что для каждой рабочей нагрузки выбран соответствующий ценовой план.
- Счета за каждую реплику чтения выставляются на основе выбранных вычислений и хранилища.
- Используйте зарезервированную емкость, чтобы сэкономить на затратах.

## <a name="conclusion"></a>Заключение

В этой статье компания Contoso перенеса свои базы данных MySQL в экземпляр базы данных Azure для MySQL.
