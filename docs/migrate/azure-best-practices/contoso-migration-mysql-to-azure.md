---
title: Перенос баз данных MySQL в Azure
description: Узнайте, как компания Contoso перенеса свои локальные базы данных MySQL в Azure.
author: deltadan
ms.author: abuck
ms.date: 07/01/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
services: azure-migrate
ms.openlocfilehash: 12468e19ef8e4ae226134117ed98e096b313dae2
ms.sourcegitcommit: 917188fa930cadddb03f9e9bbcdd7b630e4ee33e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/17/2020
ms.locfileid: "88282911"
---
<!-- cSpell:ignore mysqldump InnoDB binlog Navicat -->

# <a name="migrate-mysql-databases-to-azure"></a>Перенос баз данных MySQL в Azure

В этой статье показано, как вымышленная компания Contoso планирует и перенеса свою локальную платформу базы данных MySQL с открытым кодом в Azure.

## <a name="business-drivers"></a>Бизнес-факторы

Группа специалистов по ИТ тесно работала с бизнес-партнерами, чтобы понять, что они хотят достичь при миграции. Они хотят:

- **Повышение доступности.** Компания Contoso имела проблемы с доступностью к локальной среде MySQL. Для бизнеса требуются более надежные приложения, использующие это хранилище данных.
- **Повышение эффективности.** Компании Contoso необходимо удалить ненужные процедуры и упростить процессы для разработчиков и пользователей. Бизнес требует, чтобы он был быстрым и не тратит время или деньги, чтобы ускорить выполнение требований клиентов.
- **Повышение гибкости.** ИТ-отдел компании Contoso должен проявлять большую гибкость в отношении потребностей бизнеса. Он должен реагировать быстрее, чем изменения в Marketplace, чтобы обеспечить успешную работу в глобальной экономике. ИТ-не должны стать блоком.
- **Измените.** По мере успешного развития бизнеса компания Contoso должна предоставлять системы, которые увеличиваются в том же темпе.

## <a name="migration-goals"></a>Цели миграции

Группа, работающая над облачной инфраструктурой компании Contoso, определила цели этой миграции. Эти цели использовались для определения оптимального метода миграции.

| Требования | Сведения |
| --- | --- |
| **Доступность** | В настоящее время внутренний персонал имеет Нежесткое время с средой размещения для экземпляра MySQL. Компания Contoso хочет получить доступ к 99,99% уровня базы данных. |
| **Масштабируемость** | Недостаточная емкость локального узла базы данных. Компании Contoso требуется способ масштабировать свои экземпляры за последние ограничения или уменьшать масштаб, если бизнес-среда изменяется для экономии затрат. |
| **Производительность** | Отдел кадров Contoso использует различные отчеты ежедневно, еженедельно и ежемесячно. При выполнении этих отчетов возникают значительные проблемы с производительностью приложения, доступного для сотрудников. Он должен запускать отчеты, не влияя на производительность приложения. |
| **Безопасность** | Contoso должен быть уверен, что база данных доступна только для внутренних приложений и недоступна или не доступна через Интернет. |
| **Мониторинг** | В настоящее время компания Contoso использует средства для мониторинга метрик сервера базы данных MySQL и предоставления уведомлений при возникновении проблем с ЦП, памятью или хранилищем. Компания должна иметь такую же возможность в Azure. |
| **Непрерывность бизнес-процессов** | Хранилище данных HR является важной частью ежедневных операций contoso. Если оно повреждено или необходимо восстановить, компания хочет максимально сократить время простоя. |
| **Azure** | Компания Contoso хочет переместить приложение в Azure, не запуская его на виртуальных машинах. Contoso хочет использовать службы платформы Azure "платформа как услуга" (PaaS) для уровня данных. |

## <a name="solution-design"></a>Архитектура решения

После фиксации целей и требований компания Contoso проектирует и изучает решение для развертывания и определяет процесс миграции. Также определяются средства и службы, которые будут использоваться для миграции.

### <a name="current-application"></a>Текущее приложение

В базе данных MySQL хранятся данные о сотрудниках, используемые для всех аспектов отдела кадров компании. В качестве внешнего интерфейса для обработки запросов сотрудников отдела кадров используется приложение [на основе лампы](https://wikipedia.org/wiki/LAMP_(software_bundle)) . Компания Contoso имеет 100 000 сотрудников по всему миру, поэтому время работы очень важно.

### <a name="proposed-solution"></a>Предлагаемое решение

Используйте Azure Database Migration Service для переноса базы данных в экземпляр базы данных Azure для MySQL. Измените все приложения и процессы, чтобы они использовали новый экземпляр базы данных Azure для MySQL.

### <a name="database-considerations"></a>Рекомендации по базе данных

<!-- TODO: Verify GraphDBMS term -->
<!-- docsTest:ignore ColumnStore GraphDBMS -->

В рамках процесса разработки решения компания Contoso проверила возможности в Azure для размещения данных MySQL. Следующие рекомендации помогли компании принять решение об использовании Azure.

- Как и база данных SQL Azure, база данных Azure для MySQL позволяет применять [правила брандмауэра](/azure/mysql/concepts-firewall-rules).
- Базу данных Azure для MySQL можно использовать с [виртуальной сетью Azure](/azure/mysql/concepts-data-access-and-security-vnet) , чтобы запретить доступ к экземпляру.
- Служба "база данных Azure для MySQL" имеет необходимые сертификаты соответствия требованиям и конфиденциальности, которые должны соответствовать компании Contoso для аудиторов.
- Производительность отчетов и обработки приложений будет улучшена с помощью считывания реплик.
- Возможность предоставлять доступ к службе только внутреннему сетевому трафику (без общего доступа) с помощью [частной связи Azure](/azure/mysql/concepts-data-access-security-private-link).
- Компания Contoso решила не переходить на базу данных Azure для MySQL, так как в будущем она ищет потенциально использование MariaDB ColumnStore и модели базы данных Графдбмс.
- Помимо функций MySQL компания Contoso является сторонникомом проектов с открытым исходным кодом и решили не использовать MySQL.
- [Пропускная способность и задержка](/azure/vpn-gateway/vpn-gateway-about-vpngateways) от приложения к базе данных достаточно достаточны на основе выбранного шлюза (Azure ExpressRoute или VPN типа "сеть — сеть").

### <a name="solution-review"></a>Проверка решения

Специалисты Contoso оценивают предлагаемый дизайн, составляя список плюсов и минусов.

| Рассматриваемый вопрос | Сведения |
| --- | --- |
| **Преимущества** | Служба "база данных Azure для MySQL" предоставляет соглашение об уровне обслуживания с финансовыми гарантиями на 99,99% для обеспечения [высокого уровня доступности](/azure/mysql/concepts-high-availability). <br><br> Azure предлагает возможность увеличения или уменьшения масштаба в течение пиковых нагрузок в каждом квартале. Компания Contoso может сэкономить еще больше, приобретя [зарезервированную емкость](/azure/mysql/concept-reserved-pricing). <br><br> Azure предоставляет возможности восстановления на момент времени и геовосстановление для базы данных Azure для MySQL. <br><br> |
| **Недостатки** | Компания Contoso ограничена версиями выпуска MySQL, которые поддерживаются в Azure, в настоящее время 10,2 и 10,3. <br><br> У базы данных Azure для MySQL есть некоторые [ограничения](/azure/mysql/concepts-limits), например масштабирование хранилища. |

## <a name="proposed-architecture"></a>Предлагаемая архитектура

![На схеме показана архитектура сценария. ](./media/contoso-migration-mysql-to-azure/architecture.png)
 _Рис. 1. Архитектура сценария._

### <a name="migration-process"></a>Процесс миграции

#### <a name="preparation"></a>Подготовка

Прежде чем можно будет выполнить миграцию баз данных MySQL, необходимо убедиться, что эти экземпляры соответствуют всем предварительным требованиям Azure для успешной миграции.

#### <a name="supported-versions"></a>Поддерживаемые версии

MySQL использует схему управления версиями X. Y. Z. Например, X — основная версия, Y — дополнительный номер версии, а Z — версия исправления.

Сейчас Azure поддерживает 10.2.25 и 10.3.16.

Azure автоматически управляет обновлениями для обновлений исправлений. Примеры — 10.2.21 10.2.23. Дополнительные и основные обновления версий не поддерживаются. Например, обновление с MySQL 10,2 до MySQL 10,3 не поддерживается. Если вы хотите выполнить обновление с 10,2 до 10,3, сделайте дамп и восстановите его на сервере, созданном с помощью новой версии модуля.

#### <a name="network"></a>Сеть

Contoso необходимо настроить подключение шлюза виртуальной сети из локальной среды к виртуальной сети, в которой находится база данных MySQL. Это подключение позволяет локальному приложению получать доступ к базе данных через шлюз при обновлении строк подключения.

![На схеме показан процесс миграции. ](./media/contoso-migration-mysql-to-azure/migration-process.png)
 _Рис. 2. процесс миграции._

#### <a name="migration"></a>Миграция

Администраторы Contoso переходят базу данных с помощью Azure Database Migration Service и следуя пошаговому руководству по [миграции](/azure/dms/tutorial-mysql-azure-mysql-online). Они могут выполнять миграцию через Интернет, автономный и гибридный (Предварительная версия) с помощью MySQL 5,6 или 5,7.

> [!NOTE]
> MySQL 8,0 поддерживается в базе данных Azure для MySQL. Средство Database Migration Service еще не поддерживает эту версию.

В качестве сводки они должны выполнять следующие задачи:

- Убедитесь, что выполнены все необходимые условия для миграции.
  - Источник сервера базы данных MySQL должен соответствовать версии, поддерживаемой базой данных Azure для MySQL. База данных Azure для MySQL поддерживает выпуск MySQL Community Edition, подсистему хранилища InnoDB и миграцию между исходными и целевыми версиями.
  - Включение двоичного входа в систему `my.ini` (Windows) или `my.cnf` (UNIX). Если не включить ведение журнала в двоичном коде, в мастере миграции возникает следующая ошибка: "ошибка при ведении журнала в двоичном коде. Переменная binlog_row_image имеет значение "минимальный". Измените его на "Full". Дополнительные сведения см. на [веб-сайте MySQL](https://go.microsoft.com/fwlink/?linkid=873009`).
  - Пользователь должен иметь `ReplicationAdmin` роль.
  - Перенесите схемы базы данных без внешних ключей и триггеров.
- Создайте виртуальную сеть, которая подключается через ExpressRoute или VPN-подключение к локальной сети.
- Создайте экземпляр Azure Database Migration Service с `Premium` номером SKU, подключенным к виртуальной сети.
- Убедитесь, что экземпляр может получить доступ к базе данных MySQL через виртуальную сеть. Убедитесь, что все входящие порты разрешены из Azure в MySQL на уровне виртуальной сети, в сети VPN и на компьютере, на котором размещается MySQL.
- Создайте новый проект Database Migration Service:

  ![На снимке экрана показано, как создать новый проект Database Migration Service ](./media/contoso-migration-mysql-to-azure/migration-dms-new-project.png)
   _рис. 3. Проект Azure Database Migration Service._

#### <a name="migration-by-using-native-tools"></a>Миграция с помощью собственных средств

В качестве альтернативы использованию Azure Database Migration Service Contoso может использовать общие служебные программы и средства, такие как MySQL Workbench, mysqldump, Toad или Navicat, для подключения и переноса данных в базу данных Azure для MySQL.

- Дамп и восстановление с помощью mysqldump:
  - Используйте параметр Exclude-Triggers в mysqldump, чтобы предотвратить исполнение триггеров во время импорта и повысить производительность.
  - Используйте параметр одиночной транзакции, чтобы задать режим изоляции преобразования `REPEATABLE READ` , и `START TRANSACTION` передайте инструкцию SQL перед сохранением данных.
  - Используйте параметр Disable-Keys в mysqldump, чтобы отключить ограничения внешнего ключа перед нагрузкой. Удаление ограничений приводит к повышению производительности.
  - Используйте хранилище BLOB-объектов Azure для хранения файлов резервных копий и выполните восстановление из этого файла для ускорения восстановления.
  - Обновление строк подключения приложения.
  - После переноса базы данных компания Contoso должна обновить строки подключения, чтобы они указывали на новую базу данных Azure для MySQL.

## <a name="clean-up-after-migration"></a>Очистка после миграции

После миграции Contoso необходимо создать резервную копию локальной базы данных для хранения и снять с учета локальный сервер базы данных MySQL.

## <a name="review-the-deployment"></a>Проверка развертывания

Теперь, когда выполняется миграция ресурсов в Azure, компании Contoso необходимо полностью ввести в эксплуатацию и защитить свою новую инфраструктуру.

### <a name="security"></a>Безопасность

Компания Contoso должна:

- Убедитесь, что новые базы данных Azure для экземпляра MySQL и базы данных защищены. Дополнительные сведения см. [в статье безопасность в базе данных Azure для MySQL](/azure/mysql/concepts-security).
- Проверьте конфигурацию брандмауэра и виртуальной сети.
- Настройте частную ссылку, чтобы весь трафик базы данных хранился в Azure и локальной сети.
- Включите Azure Advanced Threat protection.

### <a name="backups"></a>Резервные копии

Убедитесь, что резервное копирование баз данных Azure для экземпляров MySQL выполняется с помощью геовосстановления. Таким образом, резервные копии можно использовать в парном регионе, если происходит региональный сбой.

> [!IMPORTANT]
> Убедитесь, что ресурс базы данных Azure для MySQL имеет блокировку ресурсов, чтобы предотвратить удаление. Невозможно восстановить удаленные серверы.

### <a name="licensing-and-cost-optimization"></a>Лицензирование и оптимизация затрат

- Можно масштабировать базу данных Azure для MySQL. Наблюдение за производительностью сервера и баз данных важно для обеспечения соблюдения требований и минимизации затрат.
- Ресурсы ЦП и хранилища связаны с затратами. Доступны несколько ценовых категорий. Убедитесь, что для каждой рабочей нагрузки выбран соответствующий ценовой план.
- Счета за каждую реплику чтения выставляются на основе выбранных вычислений и хранилища.
- Используйте зарезервированную емкость, чтобы сэкономить на затратах.

## <a name="conclusion"></a>Заключение

В этой статье компания Contoso перенеса свои базы данных MySQL в экземпляр базы данных Azure для MySQL.