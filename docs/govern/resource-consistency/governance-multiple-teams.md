---
title: Несколько структур управления группой в Azure
description: Ознакомьтесь с руководством по настройке элементов управления Azure для нескольких команд, нескольких рабочих нагрузок и нескольких сред.
author: alexbuckgit
ms.author: abuck
ms.date: 09/17/2019
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: govern
ms.custom: governance
ms.openlocfilehash: db90e2ca82164d645605e49dc288c21b610e12b9
ms.sourcegitcommit: 5d6a7610e556f7b8ca69960ba76a3adfa9203ded
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/14/2020
ms.locfileid: "83399539"
---
<!-- cSpell:ignore netops -->

# <a name="governance-design-for-multiple-teams"></a>Разработка системы управления для нескольких команд

Цель этого руководства — помочь вам ознакомиться с разработкой модели системы управления ресурсами в Azure с поддержкой нескольких команд, рабочих нагрузок и сред. Сначала вы рассмотрите набор гипотетических требований к управлению, а затем рассмотрите несколько примеров реализации, которые отвечают этим требованиям.

Для этого необходимы следующие компоненты:

- Организация планирует назначить новые роли и обязанности по работе с облаком ряду пользователей, поэтому ей требуется возможность управлять удостоверениями нескольких команд с различными потребностями в доступе к ресурсам в Azure. В этой системе управления удостоверениями должны храниться удостоверения следующих пользователей:
  - Сотрудник организации, являющийся владельцем **подписок**.
  - Сотрудник вашей организации несет ответственность за **Общие ресурсы инфраструктуры** , используемые для подключения локальной сети к виртуальной сети в Azure.
  - Два сотрудника организации, отвечающих за управление **рабочей нагрузкой**.
- Поддержка нескольких **сред**. Среда — это логическое объединение ресурсов, например виртуальных машин, виртуальных сетей и служб маршрутизации сетевого трафика. К этим группам ресурсов предъявляются схожие требования к управлению и безопасности, а сами они обычно используются для определенных задач в тестовых или рабочих средах. В этом примере требование относится к четырем средам:
  - **Среда общей инфраструктуры**, которая включает общие ресурсы, разделяемые рабочими нагрузками в других средах. Например, виртуальная сеть с подсетью шлюза, обеспечивающая подключение к локальной сети.
  - **Рабочая среда** с наиболее строгими политиками безопасности. Может включать внутренние или внешние рабочие нагрузки.
  - **Непроизводственные среды** для разработки и тестирования. Эта среда имеет политики безопасности, соответствий и затрат, которые отличаются от политик производственной среды. В Azure это принимает форму подписки Enterprise — разработка и тестирование.
  - **Среда "песочницы"** для подтверждения концепции и образовательных целей. Эта среда обычно назначается для каждого сотрудника, участвующего в действиях по разработке, и имеет ограниченную процедурную и операционную безопасность, чтобы предотвратить размещение корпоративных данных здесь. В Azure они принимают форму подписок Visual Studio. Эти подписки также _не_ должны быть привязаны к корпоративным Azure Active Directory.
- **Модель разрешений с наименьшими привилегиями**, при которой пользователи не имеют разрешений по умолчанию. Модель должна поддерживать следующее.
  - Один доверенный пользователь в области действия подписки, который рассматривается как учетная запись службы и обладает разрешением на назначение прав доступа к ресурсам.
  - Каждому владельцу рабочей нагрузки по умолчанию запрещен доступ к ресурсам. Права доступа к ресурсам предоставляются явным образом одним доверенным пользователем в области группы ресурсов.
  - Доступ к управлению для ресурсов общей инфраструктуры, ограниченный общими владельцами инфраструктуры.
  - Доступ к управлению для каждой рабочей нагрузки, ограниченный владельцем рабочей нагрузки в рабочей среде, и повышение уровня управления по мере разработки осуществляется с помощью различных сред развертывания (разработки, тестирования, промежуточного хранения и рабочей среды).
  - Предприятие не хочет управлять ролями независимо в каждой из трех основных сред, и поэтому требует использования только [встроенных ролей](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles) , доступных в управлении доступом на основе ролей Azure (RBAC). Если для предприятия абсолютно требуются пользовательские роли RBAC, для синхронизации пользовательских ролей в трех средах потребуются дополнительные процессы.
- Отслеживание затрат по имени владельца рабочей среды, по среде или по обоим.

## <a name="identity-management"></a>Управление удостоверениями

Прежде чем разрабатывать систему управления удостоверениями для модели системы управления, необходимо ознакомиться с четырьмя основными областями, которые она охватывает.

- **Администрирование:** Процессы и средства для создания, изменения и удаления удостоверений пользователей.
- **Проверка подлинности:** Проверка удостоверения пользователя путем проверки учетных данных, например имени пользователя и пароля.
- **Авторизация:** Определение ресурсов, к которым разрешен доступ пользователям, прошедшим проверку подлинности, или к каким операциям имеет разрешение на выполнение.
- **Аудит:** Периодически изучайте журналы и другие сведения для обнаружения проблем безопасности, связанных с удостоверением пользователя. Он включает проверку подозрительных шаблонов использования, периодический просмотр разрешений пользователей для проверки их точности и другие функции.

Существует только одна служба управления удостоверениями, являющаяся доверенной в Azure, — Azure Active Directory (Azure AD). Вы будете добавлять пользователей в Azure AD и использовать их для всех перечисленных выше функций. Но прежде чем посмотреть, как настроить Azure AD, важно понять суть привилегированных учетных записей, которые используются для управления доступом к этим службам.

При регистрации учетной записи организации в Azure назначается по крайней мере один **владелец учетной записи** Azure. При этом также создается **клиент** Azure AD. Исключением является ситуация, когда уже существует клиент, с помощью которого организация использует другие службы Майкрософт, например Office 365. Microsoft Azure Active Directory**Глобальный администратор** с полными правами при создании был связан с клиентом Microsoft Azure Active Directory.

Удостоверения пользователя как для владельца учетной записи Azure, так и для глобального администратора Azure AD хранятся в системе идентификации с высоким уровнем безопасности, управляемой корпорацией Майкрософт. Владелец учетной записи Azure имеет право создавать, обновлять и удалять подписки. Глобальный администратор Azure AD уполномочен выполнять множество действий в Azure AD, но в этом руководстве по проектированию рассматривается только создание и удаление удостоверения пользователя.

> [!NOTE]
> Возможно, у вашей организации уже есть клиент Azure AD, имеющий лицензию Office 365, Intune или Dynamics 365, связанную с вашей учетной записью.

Владелец учетной записи Azure имеет разрешение на создание, обновление и удаление подписок:

![Учетная запись Azure с владельцем учетной записи Azure и глобальным администратором Azure AD ](../../_images/govern/design/governance-3-0.png)
 _рис. 1. учетная запись Azure с владельцем учетной записи Azure и глобальным администратором Azure AD._

**Глобальный администратор** Microsoft Azure Active Directory имеет разрешение на создание учетных записей пользователей.

![Учетная запись Azure с владельцем учетной записи Azure и глобальным администратором Azure AD ](../../_images/govern/design/governance-3-0a.png)
 _рис. 2. Глобальный администратор Azure AD создает необходимые учетные записи пользователей в клиенте._

Первые две учетные записи, владелец **рабочей нагрузки APP1** и пользователь с **рабочими нагрузками**в г., связаны с индивидуальными сотрудниками вашей организации, ответственными за управление рабочей нагрузкой. Учетная запись **пользователя сетевых операций** принадлежит лицу, ответственному за ресурсы общей инфраструктуры. Наконец, учетная запись **владельца подписок** связана с лицом, ответственным за право собственности на подписки.

## <a name="resource-access-permissions-model-of-least-privilege"></a>Модель разрешений доступа с наименьшими привилегиями

Теперь, когда создана система управления удостоверениями и учетные записи пользователей, вам необходимо решить, как применять управление доступом на основе ролей (RBAC) к каждой учетной записи для поддержки модели разрешений с наименьшими привилегиями.

Другое требование состоит в том, чтобы ресурсы, связанные с каждой рабочей нагрузкой, были изолированы друг от друга, так чтобы ни один владелец рабочей нагрузки не мог управлять доступом к любой другой рабочей нагрузке, которой он не владеет. Также необходимо реализовать эту модель, используя только встроенные роли для управления доступом на основе ролей в Azure.

Каждая роль RBAC применяется в одной из трех областей в Azure: **подписка**, **группа ресурсов** и отдельный **ресурс**. Роли наследуются в более низких областях. Например, если пользователю назначена [роль "владелец](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#owner) " на уровне подписки, эта роль также назначается этому пользователю в группе ресурсов и на уровне отдельных ресурсов, если не переопределен.

Таким образом, чтобы создать модель доступа с минимальными полномочиями, необходимо решить, какие действия разрешено выполнять определенному типу пользователя в каждой из этих трех областей. Например, существует требование, чтобы владелец рабочей нагрузки имел разрешение управлять доступом только к ресурсам, связанным с его рабочей нагрузкой, и никаким другим. Если назначить встроенную роль владельца в области подписки, то каждый владелец рабочей нагрузки будет иметь доступ к управлению всеми рабочими нагрузками.

Давайте рассмотрим два примера моделей разрешений, чтобы лучше понять эту концепцию. В первом примере модель позволяет создавать группы ресурсов только администратору служб. Во втором примере модель назначает встроенную роль владельца каждому владельцу рабочей нагрузки в области подписки.

В обоих примерах имеется администратор служб подписки, которому назначена встроенная роль владельца в области подписки. Напомним, что встроенная роль владельца предоставляет все разрешения, включая управление доступом к ресурсам.

![Администратор службы подписки с ролью владельца ](../../_images/govern/design/governance-2-1.png)
 _рис. 3. Подписка с правами администратора службы назначила встроенную роль владельца._

<!-- docsTest:ignore "resource group A" "resource groups A and B" "workload owner A" -->

1. В первом примере есть **Владелец рабочей нагрузки A** без разрешений в области подписки, у которой нет &mdash; прав доступа к ресурсам по умолчанию. Этот пользователь хочет развернуть ресурсы для своей рабочей нагрузки и управлять ими. Ему необходимо обратиться к **администратору служб** с запросом о создании группы ресурсов.
    ![Владелец рабочей нагрузки запрашивает создание группы ресурсов A](../../_images/govern/design/governance-2-2.png)
2. **Администратор службы** просматривает свой запрос и создает **группу ресурсов A**. На этом этапе **Владелец рабочей нагрузки,** по-прежнему, не имеет разрешения на все действия.
    ![Администратор службы создает группу ресурсов A](../../_images/govern/design/governance-2-3.png)
3. **Администратор служб** добавляет **владельца рабочей нагрузки A** к **группе ресурсов A** и назначает [встроенную роль участника](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor). Роль участника предоставляет все разрешения в **группе ресурсов A**, за исключением разрешения на доступ к управлению.
    ![Администратор службы добавляет владельца рабочей нагрузки A в группу ресурсов A](../../_images/govern/design/governance-2-4.png)
4. Предположим, что **Владелец рабочей нагрузки A** имеет требование для пары участников команды, чтобы просмотреть данные мониторинга ресурсов ЦП и сетевого трафика в рамках планирования ресурсов для рабочей нагрузки. Так как **владельцу рабочей нагрузки** назначена роль участника, у них нет разрешения на добавление пользователя в **группу ресурсов A**. Они должны отправить этот запрос **администратору службы**.
    ![Владелец рабочей нагрузки запрашивает добавление участников рабочей нагрузки в группу ресурсов](../../_images/govern/design/governance-2-5.png)
5. **Администратор службы** просматривает запрос и добавляет двух пользователей **участника рабочей нагрузки** в **группу ресурсов A**. Ни один из этих двух пользователей не требует разрешения на управление ресурсами, поэтому им назначается [Встроенная роль читателя](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor).
    ![Администратор службы добавляет участников рабочей нагрузки в группу ресурсов A](../../_images/govern/design/governance-2-6.png)
6. Далее, **владелец рабочей нагрузки Б** также требует группу ресурсов для ресурсов своей рабочей нагрузки. Как и в случае с **владельцем рабочей нагрузки A**, **владелец рабочей нагрузки Б** изначально не имеет разрешения принимать какие-либо действия в области подписки, поэтому ему необходимо отправить запрос **администратору служб**
    ![Владелец рабочей нагрузки B запрашивает создание группы ресурсов B](../../_images/govern/design/governance-2-7.png)
7. **Администратор службы** просматривает запрос и создает **группу ресурсов B**.  ![Администратор службы создает группу ресурсов B](../../_images/govern/design/governance-2-8.png)
8. Затем **администратор службы** добавляет **владельца рабочей нагрузки b** в **группу ресурсов b** и назначает встроенную роль участника.
    ![Администратор службы добавляет владельца рабочей нагрузки B в группу ресурсов B](../../_images/govern/design/governance-2-9.png)

На этом этапе каждый владелец рабочей нагрузки изолирован в своей собственной группе ресурсов. Ни один из владельцев рабочей нагрузки или члены их команд не имеют доступа к управлению ресурсами в любой другой группе ресурсов.

![Подписка с группами ресурсов A и B ](../../_images/govern/design/governance-2-10.png)
 _рис. 4. Подписка с двумя владельцами рабочей нагрузки, изолированными от их собственной группы ресурсов._

Эта модель является моделью с минимальными правами доступа &mdash; . каждому пользователю назначается правильное разрешение на правильную область управления ресурсами.

Однако учтите, что каждая задача в этом примере выполнялась **администратором служб**. Это простой пример, и здесь не возникают проблемы, возможно потому, что есть только два владельца рабочей нагрузки. Но легко представить себе типы проблем, которые могут возникнуть в большой организации. Например, **администратор служб** может стать узким местом с большим количеством невыполненных запросов, которые приводят к задержкам.

Давайте рассмотрим второй пример, который уменьшает количество задач, выполняемых **администратором служб**.

1. В этой модели **владельцу рабочей нагрузки A** назначается встроенная роль владельца в области действия подписки, что позволяет им создавать собственные группы ресурсов: **Группа ресурсов а**.  ![Администратор службы добавляет владельца рабочей нагрузки A в подписку](../../_images/govern/design/governance-2-11.png)
2. Когда создается **группа ресурсов A**, по умолчанию добавляется **владелец рабочей нагрузки A** и наследует встроенную роль владельца из области подписки.
    ![Владелец рабочей нагрузки A создает группу ресурсов A](../../_images/govern/design/governance-2-12.png)
3. Роль встроенного владельца предоставляет **владельцу рабочей нагрузки A** разрешение на управление доступом к группе ресурсов. **Владелец рабочей нагрузки A** добавляет двух **участников рабочей нагрузки** и назначает каждому из них встроенную роль читателя.
    ![Владелец рабочей нагрузки A добавляет участников рабочей нагрузки](../../_images/govern/design/governance-2-13.png)
4. **Администратор служб** теперь добавляет **владельца рабочей нагрузки Б** к подписке с встроенной ролью владельца.
    ![Администратор службы добавляет владельца рабочей нагрузки B в подписку](../../_images/govern/design/governance-2-14.png)
5. **Владелец рабочей нагрузки Б** создает **группы ресурсов Б** и добавляется по умолчанию. Опять же, **владелец рабочей нагрузки Б** наследует встроенную роль владельца из области подписки.
    ![Владелец рабочей нагрузки B создает группу ресурсов B](../../_images/govern/design/governance-2-15.png)

Обратите внимание, что в этой модели **администратор служб** выполнял меньше действий, чем в первом примере, путем делегирования управления доступом каждому из отдельных владельцев рабочей нагрузки.

![Подписка с группами ресурсов A и B ](../../_images/govern/design/governance-2-16.png)
 _рис. 5. Подписка с администратором службы и двумя владельцами рабочей нагрузки, которым назначена роль «владелец»._

Тем не менее, поскольку **владельцу рабочей нагрузки A** и **владельцу рабочей нагрузки Б** присваивается встроенная роль владельца в области подписки, каждая из них унаследовала роль встроенного владельца групп ресурсов друг друга. Это означает, что они не только имеют полный доступ к ресурсам друг друга, но и могут делегировать управление доступом к группам ресурсов друг друга. Например, владелец **рабочей нагрузки Б** имеет разрешение добавлять любого другого пользователя в **группу ресурсов A** и может назначать ему какую-либо роль, включая встроенную роль владельца.

Если сравнивать примеры с требованиями, вы увидите, что в обоих примерах фигурирует один доверенный пользователь в области подписки с разрешением на предоставление прав доступа к ресурсам двум владельцам рабочей нагрузки. Каждый из двух владельцев рабочей нагрузки не имел доступа к управлению ресурсами по умолчанию и требовал, чтобы **администратор служб** явно назначил ему права. Однако только первый пример поддерживает требование, чтобы ресурсы, связанные с отдельной рабочей нагрузкой, были изолированы друг от друга таким образом, что владелец рабочей нагрузки не имеет доступа к ресурсам любой другой рабочей нагрузки.

## <a name="resource-management-model"></a>Модель управления ресурсами

Теперь, когда модель разрешений с наименьшими привилегиями разработана, давайте перейдем к рассмотрению некоторых практических приложений для этих моделей системы управления. Напомним, что требования предусматривают поддержку трех сред.

1. **Среда общей инфраструктуры:** Группа ресурсов, совместно используемых всеми рабочими нагрузками. Это такие ресурсы, как сетевые шлюзы, брандмауэры и службы безопасности.
2. **Рабочая среда:** Несколько групп ресурсов, представляющих несколько рабочих нагрузок. Эти ресурсы используются для размещения закрытых и общедоступных артефактов приложения. Эти ресурсы обычно имеют самые жесткие модели системы управления и безопасности для защиты ресурсов, кода приложений и данных от несанкционированного доступа.
3. Предварительная **Среда:** Несколько групп ресурсов, представляющих несколько рабочих нагрузок, не готовых к рабочей среде. Эти ресурсы используются для разработки и тестирования и могут иметь более ослабленную модель управления для повышения гибкости разработчиков. Безопасность в этих группах должна увеличиваться по мере того, как процесс разработки приложения перемещается ближе к рабочей среде.

Для каждой из этих трех сред есть требования по отслеживанию данных о расходах **владельца рабочей нагрузки**, **среды** или обоих. То есть вам нужно будет оценить текущие затраты на **общую инфраструктуру**, затраты **, которые являются** отдельными лицами как в **непроизводственном** , так **и в** рабочей средах, и, наконец, Общая стоимость непроизводственных и **рабочих** сред.

Вы уже знаете, что ресурсы ограничиваются только двумя уровнями: **подпиской** и **группой ресурсов**. Поэтому первое решение — организовать среду с использованием **подписки**. Существует только два варианта: одна подписка или несколько подписок.

Прежде чем перейти к примерам каждой из этих моделей, давайте рассмотрим структуру управления подписками в Azure.

Следует напомнить, что в организации есть сотрудник, отвечающий за подписки, и он распоряжается учетной записью **владельца подписок** в клиенте Azure AD. Однако эта учетная запись не имеет разрешения на создание подписок. Только **владелец учетной записи Azure** имеет на это право:

![Владелец учетной записи Azure создает подписку ](../../_images/govern/design/governance-3-0b.png)
 _рис. 6. Владелец учетной записи Azure создает подписку._

После создания подписки **владелец учетной записи Azure** может добавить учетную запись **владельца подписки** к подписке с ролью **владельца**.

![Владелец учетной записи Azure добавляет учетную запись владельца подписки в подписку с ролью владельца. ](../../_images/govern/design/governance-3-0c.png)
 _Рис. 7. Владелец учетной записи Azure добавляет учетную запись **владельца подписки** в подписку с ролью **владельца** ._

Теперь учетная запись **владельца подписки** может создавать **группы ресурсов** и делегировать управление доступом к ресурсам.

Сначала давайте рассмотрим пример модели управления ресурсами, используя единую подписку. Первое решение касается выравнивания групп ресурсов в трех средах. У вас есть два варианта:

1. Совместите каждую среду с одной группой ресурсов. Все ресурсы общей инфраструктуры развертываются в единую группу ресурсов **общей инфраструктуры**. Все ресурсы, связанные с рабочими нагрузками разработки, развертываются в единую группу ресурсов **разработки**. Все ресурсы, связанные с производственными рабочими нагрузками, развертываются в единую **производственную** группу ресурсов для **рабочей** среды.
2. Создайте отдельные группы ресурсов для каждой рабочей нагрузки, используя соглашение об именовании и теги для выравнивания групп ресурсов в каждой из трех сред.

Начнем с оценки первого способа. Воспользуйтесь моделью разрешений, о которой шла речь в предыдущем разделе, когда администратор служб одной подписки создает группы ресурсов и добавляет к ним пользователей со встроенной ролью **участника** или **читателя**.

<!-- docsTest:ignore managedBy -->
<!-- hub-vnet prod-vnet app1-dev-vnet app2-dev-vnet app1-prod-vnet app2-prod-vnet -->

1. Первая развернутая группа ресурсов представляет собой среду **общей инфраструктуры**. Учетная запись **владельца подписки** создает группу ресурсов для ресурсов общей инфраструктуры с именем `netops-shared-rg` .
    ![Создание группы ресурсов](../../_images/govern/design/governance-3-0d.png)
2. Учетная запись **владельца подписки** добавляет учетную запись **пользователя "сетевые операции** " в группу ресурсов и назначает роль **участника** .
    ![Добавление пользователя сетевых операций](../../_images/govern/design/governance-3-0e.png)
3. **Пользователь сетевых операций** создает [VPN-шлюз](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways) и настраивает его для подключения к VPN-устройству в локальной среде. **Пользователь сетевых операций** также применяет пару [тегов](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources) к каждому из ресурсов: `environment:shared` и `managedBy:netOps` . Когда **администратор служб подписки** экспортирует отчет о затратах, затраты будут выровнены по каждому из этих тегов. Это позволяет **администратору службы подписки** выполнить сведение затрат с помощью `environment` тега и `managedBy` тега. Обратите внимание на счетчик **границ ресурсов** в верхней правой части рисунка. Каждая подписка Azure имеет [границы обслуживания](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits), и чтобы понять эффект этих ограничений, придерживайтесь границ виртуальной сети для каждой подписки. Ограничение составляет 1000 виртуальных сетей на подписку, а после развертывания первой виртуальной сети остаются доступными 999 виртуальных сетей.
    ![Создание VPN-шлюза](../../_images/govern/design/governance-3-1.png)
4. Были развернуты еще две группы ресурсов. Первая называется `prod-rg`. Эта группа ресурсов сопоставлена с рабочей средой. Вторая называется `dev-rg` и сопоставлена со средой разработки. Все ресурсы, связанные с производственными рабочими нагрузками, развертываются в рабочей среде, а все ресурсы, связанные с рабочими нагрузками разработки, развертываются в среде разработки. В этом примере вы развернете только две рабочие нагрузки для каждой из этих двух сред, чтобы не превысить пределы абонентской подписки Azure. Однако учтите, что каждая группа ресурсов имеет ограничение в 800 ресурсов. Если добавлять рабочие нагрузки для каждой группы ресурсов, в конечном итоге этот предел будет достигнут.
    ![Создание группы ресурсов.](../../_images/govern/design/governance-3-2.png)
5. Первый **владелец рабочей нагрузки** отправляет запрос **администратору служб подписки** и добавляется к каждой из сред групп ресурсов (к среде разработки и к рабочей среде) с ролью **участника**. Как упоминалось ранее, роль **участника** позволяет пользователю выполнять любую операцию, отличную от назначения роли другому пользователю. Первый **владелец рабочей нагрузки** теперь может создавать ресурсы, связанные со своей рабочей нагрузкой.
    ![Добавление участников](../../_images/govern/design/governance-3-3.png)
6. Первый **владелец рабочей нагрузки** создает виртуальную сеть в каждой из двух групп ресурсов с парой виртуальных машин в каждой. Первый **Владелец рабочей нагрузки** применяет `environment` `managedBy` теги и ко всем ресурсам. Обратите внимание, что счетчик границ обслуживания Azure теперь показывает оставшиеся 997 виртуальных сетей.
    ![Создание виртуальных сетей](../../_images/govern/design/governance-3-4.png)
7. Ни одна из виртуальных сетей не подключена к локальной среде при создании. В этом типе архитектуры каждая виртуальная сеть должна быть привязана к **hub-vnet** в среде **общей инфраструктуры**. Пиринг виртуальной сети создает соединение между двумя отдельными виртуальными сетями и позволяет сетевому трафику перемещаться между ними. Обратите внимание, что пиринг виртуальной сети не является по своей сути транзитивным. Пиринг должен быть указан в каждой из двух подключенных виртуальных сетей, и если только одна из виртуальных сетей указывает пиринг, то соединение будет неполным. Чтобы проиллюстрировать этот эффект, пусть первый **владелец рабочей нагрузки** укажет пиринг между **prod-vnet** и **hub-vnet**. Создается первый пиринг, но нет потоков трафика, потому что еще не был указан взаимодополняющий пиринг из **hub-vnet** к **prod-vnet**. Первый **владелец рабочей нагрузки** связывается с пользователем **сетевых операций** и запрашивает это взаимодополняющее пиринговое подключение.
    ![Создание соединения пиринга](../../_images/govern/design/governance-3-5.png)
8. Пользователь **сетевых операций** просматривает запрос, утверждает его, а затем указывает пиринг в параметрах **hub-vnet**. Теперь подключение пиринга завершено, и сетевой трафик проходит между двумя виртуальными сетями.
    ![Создание соединения пиринга](../../_images/govern/design/governance-3-6.png)
9. Теперь второй **владелец рабочей нагрузки** отправляет запрос **администратору служб подписки** и добавляется к каждой из существующих сред групп ресурсов (к среде **разработки** и к **рабочей** среде) с ролью **участника**. Второй **владелец рабочей нагрузки** имеет те же разрешения, что и первый **владелец рабочей нагрузки**, для всех ресурсов в каждой группе ресурсов.
    ![Добавление участников](../../_images/govern/design/governance-3-7.png)
10. Второй **владелец рабочей нагрузки** создает подсеть в виртуальной сети **prod-vnet**, а затем добавляет две виртуальные машины. Второй **Владелец рабочей нагрузки** применяет `environment` `managedBy` теги и к каждому ресурсу.
    ![Создание подсетей](../../_images/govern/design/governance-3-8.png)

Этот пример модели управления ресурсами позволяет управлять ресурсами в трех требуемых средах. Общие ресурсы инфраструктуры защищены, так как только один пользователь в подписке имеет разрешение на доступ к этим ресурсам. Каждый владелец рабочей нагрузки может использовать общие ресурсы инфраструктуры без каких бы то ни было разрешений на сами общие ресурсы. Однако эта модель управления не требует изоляции рабочей нагрузки, так как оба **владельца рабочей нагрузки** имеют доступ к ресурсам рабочей нагрузки друг друга.

Есть еще одно важное замечание к этой модели, которое может быть не сразу очевидно. В этом примере он был **владельцем рабочей нагрузки APP1** , который запросил подключение к одноранговому подключению к сети с помощью **концентратора** , чтобы обеспечить подключение к локальной сети. Пользователь **сетевых операций** оценил этот запрос на основании ресурсов, развертываемых с этой рабочей нагрузкой. Когда учетная запись **владельца подписки** добавила **владельца рабочей нагрузки** «опыт» с ролью « **участник** », этот пользователь имел права доступа для управления ко всем ресурсам в группе ресурсов « **RG** ».

![Схема, демонстрирующая права на доступ к управлению](../../_images/govern/design/governance-3-10.png)

Это значит, что **владелец рабочей нагрузки app2** имел разрешение на развертывание своей собственной подсети с виртуальными машинами в виртуальной сети **prod-vnet**. По умолчанию эти виртуальные машины имеют доступ к локальной сети. Пользователь **сетевых операций** не имеет сведений о компьютерах и не утвердил их подключение к локальной сети.

Затем давайте рассмотрим единую подписку с несколькими группами ресурсов для разных сред и рабочих нагрузок. Обратите внимание, что в предыдущем примере ресурсы для каждой среды были легко идентифицируемы, поскольку они находились в одной группе ресурсов. Теперь, когда вы больше не имеете этого группирования, для обеспечения этой функциональности придется полагаться на соглашение об именовании группы ресурсов.

1. Ресурсы **общей инфраструктуры** в этой модели все еще имеют отдельную группу ресурсов, поэтому она останется прежней. Для каждой рабочей нагрузки требуются две группы ресурсов — по одной для среды **разработки** и для **рабочей** среды. Для первой рабочей нагрузки учетная запись **владельца подписки** создает две группы ресурсов. Первый элемент называется **APP1-RG** , а второй — **APP1-dev-RG**. Как обсуждалось ранее, это соглашение об именовании идентифицирует ресурсы как связанные с первой рабочей нагрузкой **app1** и либо со средой **dev**, либо со средой **prod**. Опять же, учетная запись **владельца подписки** добавляет **владельца рабочей нагрузки APP1** в группу ресурсов с ролью **участника** .
    ![Добавление участников](../../_images/govern/design/governance-3-12.png)
2. Как и в первом примере **владелец рабочей нагрузки аpp1** развертывает виртуальную сеть с именем **app1-prod-vnet** в **рабочей** среде, а другой — виртуальную сеть **app1- dev-vnet** в среде **разработки**. Опять же, **владелец рабочей нагрузки аpp1** отправляет запрос пользователю **сетевых операций** для создания пирингового соединения. Обратите внимание, что **владелец рабочей нагрузки аpp1** добавляет те же теги, что и в первом примере, а счетчик границ был уменьшен до 997 виртуальных сетей, оставшихся в подписке.
    ![Создание соединения пиринга](../../_images/govern/design/governance-3-13.png)
3. Учетная запись **владельца подписки** теперь создает две группы ресурсов для **владельца рабочей нагрузки**в. Следуя тем же соглашениям, что и для **владельца рабочей нагрузки app1**, группы ресурсов называются **app2-prod-rg** и **app2-dev-rg**. Учетная запись **владельца подписки** добавляет **владельца рабочей нагрузки** в каждую группу ресурсов с ролью **участника** .
    ![Добавление участников](../../_images/govern/design/governance-3-14.png)
4. Учетная запись **владельца рабочей нагрузки** от а затем развертывает виртуальные сети и виртуальные машины в группах ресурсов с одинаковыми соглашениями об именовании. Добавляются теги, а счетчик границ уменьшается до 995 виртуальных сетей, оставшихся в подписке.
    ![Развертывание виртуальных сетей и виртуальных машин](../../_images/govern/design/governance-3-15.png)
5. Учетная запись **владельца рабочей нагрузки** от сервера вещей отправляет запрос **пользователю сетевых операций** на одноранговое подключение **к узлу с помощью** **виртуальной сети**. Пользователь **сетевых операций** создает пиринговое соединение.
    ![Создание соединения пиринга](../../_images/govern/design/governance-3-16.png)

Полученная модель управления похожа на первый пример с несколькими ключевыми отличиями.

- Каждая из двух рабочих нагрузок является изолированной рабочей нагрузкой и средой.
- Этой модели требуются две дополнительные виртуальные сети, по сравнению с первым примером модели. Теоретический предел числа рабочих нагрузок для этой модели равен 24, хотя это не является важным отличием для модели только с двумя рабочими нагрузками.
- Ресурсы больше не группируются в одну группу ресурсов для каждой среды. Для группирования ресурсов требуется понимание соглашений об именовании, используемых для каждой среды.
- Каждое одноранговое подключение к виртуальной сети было проверено и утверждено **пользователем сетевых операций**.

Теперь давайте рассмотрим модель управления ресурсами, использующую несколько подписок. В этой модели вы сопоставляете каждую из трех сред с отдельной подпиской: подписка **общих служб**, **рабочая** подписка и, наконец, подписка **разработки**. Соображения для этой модели аналогичны модели, использующей единую подписку, в которой вам необходимо решить, как сопоставить группы ресурсов с рабочими нагрузками. Как выяснилось, создание группы ресурсов для каждой рабочей нагрузки отвечает требованию к изоляции рабочей нагрузки, поэтому в примере будем придерживаться этой модели.

1. В этой модели есть три подписки: **Общая инфраструктура**, **Рабочая среда**и **Разработка**. Для каждой из этих трех подписок требуется владелец подписки. В простейшем случае будем использовать одну учетную запись для всех трех подписок. **Общие ресурсы инфраструктуры** управляются аналогично первым двум приведенным выше примерам, а первая рабочая нагрузка связана с группой ресурсов **APP1-RG** в **рабочей** среде и группой ресурсов с тем же именем в среде **разработки** . Учетная запись **владельца рабочей нагрузки APP1** добавляется в каждую группу ресурсов с ролью *участника**.

    ![Добавление участников](../../_images/govern/design/governance-3-17.png)

2. Как и в предыдущих примерах, **владелец рабочей нагрузки аpp1** создает ресурсы и запрашивает пиринговое подключение с виртуальной сетью **общей инфраструктуры**. Учетная запись **владельца рабочей нагрузки APP1** добавляет только `managedBy` тег, так как он больше не нужен для `environment` тега. Это значит, что ресурсы для каждой среды теперь сгруппированы в одной **подписке** , а `environment` тег является избыточным. Счетчик ограничений уменьшается до 999 виртуальных сетей.

    ![Создание соединения пиринга](../../_images/govern/design/governance-3-18.png)

3. Наконец, учетная запись **владельца подписки** повторяет процесс для второй рабочей нагрузки, добавляя группы ресурсов с **владельцем рабочей нагрузки** в роли **участника** . Счетчик ограничений для каждой подписки на среду уменьшается до 998 виртуальных сетей.

Эта модель управления имеет преимущества по сравнению со вторым примером. Однако ключевое различие заключается в том, что границы являются менее значимыми так как они распределены по двум подпискам. Недостатком является то, что данные по затратам, отслеживаемые с помощью тегов, должны быть агрегированы по всем трем подпискам.

Таким образом можно выбрать любой из этих двух примеров моделей управления ресурсами в зависимости от приоритета требований. Если предполагается, что ваша организация не достигнет ограничения для служб для одной подписки, можно использовать одну подписку с несколькими группами ресурсов. И наоборот — если ваша организация планирует использовать много рабочих нагрузок, несколько подписок для каждой среды будет лучшим решением.

## <a name="implement-the-resource-management-model"></a>Реализация модели управления ресурсами

Вы изучили несколько моделей управления доступом к ресурсам Azure. Давайте рассмотрим шаги, необходимые для реализации модели управления ресурсами с одной подпиской для каждой **общей инфраструктуры**, **рабочей среды** и среды **разработки**, описанных в руководстве по проектированию. У вас будет одна учетная запись **владельца подписки** для всех трех сред. Каждая рабочая нагрузка будет изолирована в **группе ресурсов** с помощью **владельца рабочей нагрузки**, которому при добавлении назначается роль **участника**.

> [!NOTE]
> Дополнительные сведения о связи между учетными записями Azure и подписками см. в статье Общие сведения о [доступе к ресурсам в Azure](https://docs.microsoft.com/azure/role-based-access-control/rbac-and-directory-admin-roles) .

Выполните следующие действия.

1. Если у вашей организации нет учетной записи Azure, создайте [ее](https://docs.microsoft.com/azure/active-directory/sign-up-organization). Пользователь, зарегистрировавший учетную запись Azure, становится ее администратором, поэтому руководство организации должно выбрать человека, который возьмет на себя эту роль. Он будет отвечать за:
    - Создание подписок.
    - Создание и администрирование клиентов [Azure Active Directory (Azure AD)](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-whatis) , в которых хранятся удостоверения пользователей для этих подписок.
2. Группа лидерства в Организации решает, кто отвечает за:
    - Управление удостоверениями пользователей; [клиент Azure AD](https://docs.microsoft.com/azure/active-directory/develop/active-directory-howto-tenant) создается по умолчанию при создании учетной записи Azure Организации, и Администратор учетной записи добавляется как [глобальный администратор Azure AD](https://docs.microsoft.com/azure/active-directory/users-groups-roles/directory-assign-admin-roles) по умолчанию. Ваша организация может выбрать другого пользователя для управления удостоверением пользователя, [назначив ему роль глобального администратора Microsoft Azure Active Directory](https://docs.microsoft.com/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal).
    - Подписки. Благодаря этому такие пользователи могут:
        - Управление затратами, связанными с использованием ресурсов в этой подписке.
        - Реализуйте и обслуживайте модель минимальных разрешений для доступа к ресурсам.
        - отслеживать ограничения служб.
    - Общие службы инфраструктуры (при использовании вашей организацией этой модели). Вследствие этого такие пользователи несут ответственность за:
        - Подключение из локальной среды к сети Azure.
        - владение сетевым подключением в Azure через пиринг виртуальной сети.
    - Владельцы рабочих нагрузок.
3. Глобальный администратор Microsoft Azure Active Directory [создает учетные записи пользователей](https://docs.microsoft.com/azure/active-directory/add-users-azure-active-directory) для:
    - Пользователь, который будет владельцем подписки для каждой подписки, связанной с каждой средой. (обратите внимание, что это необходимо, только если на **администратора служб** подписки не будут возложены функции по управлению доступом к ресурсам для каждой подписки или среды);
    - Пользователь, который будет **пользователем сетевых операций**.
    - Пользователи, являющиеся **владельцами рабочей нагрузки**.
4. Администратор учетной записи Azure с помощью [портала управления учетными записями Azure](https://account.azure.com/subscriptions) создает следующие три подписки:
    - Подписка для среды **общей инфраструктуры** .
    - Подписка для **рабочей** среды.
    - подписку для среды **разработки**.
5. Администратор учетных записей Azure [добавляет к каждой подписке ее владельца](https://docs.microsoft.com/azure/billing/billing-add-change-azure-subscription-administrator#to-assign-a-user-as-an-administrator).
6. Чтобы запросить создание групп ресурсов, создайте процесс утверждения для **владельцев рабочей нагрузки**. Процесс утверждения может быть реализован различными способами, например по электронной почте, или же можно использовать средство управления процессами, например [рабочие процессы SharePoint](https://support.office.com/article/introduction-to-sharepoint-workflow-07982276-54e8-4e17-8699-5056eff4d9e3). Процесс утверждения может состоять из следующих шагов:
    - **Владелец рабочей нагрузки** готовит спецификацию необходимых ресурсов Azure для среды **разработки** или **рабочей** среды (или из обеих) и отправляет ее **владельцу подписки**.
    - **Владелец подписки** проверяет спецификацию и запрашиваемые ресурсы, чтобы убедиться в их применимости для запланированного использования. Например, он проверяет, верны ли запрошенные [размеры виртуальных машин](https://docs.microsoft.com/azure/virtual-machines/windows/sizes).
    - Если запрос не будет подтвержден, **владелец рабочей нагрузки** получит уведомление. Если запрос подтвержден, **владелец подписки** [создает запрашиваемую группу ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/manage-resource-groups-portal#create-resource-groups), следуя [соглашению об именовании](../../ready/azure-best-practices/naming-and-tagging.md) в организации, [добавляет **владельца рабочей нагрузки**](https://docs.microsoft.com/azure/role-based-access-control/role-assignments-portal#add-a-role-assignment) с [ролью **участник**](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles#contributor) и отправляет уведомление **владельцу рабочей нагрузки** о том, что группа ресурсов создана.
7. Чтобы запросить пиринговое соединение с виртуальной сетью у владельца общей инфраструктуры, для владельцев рабочей нагрузки создается процесс утверждения. Как и на предыдущем этапе, этот процесс утверждения может быть реализован с использованием электронной почты или инструмента управления процессами.

После внедрения своей модели управления можно развернуть службы общей инфраструктуры.

## <a name="related-resources"></a>Связанные ресурсы

[Встроенные роли управления доступом на основе ролей в Azure](https://docs.microsoft.com/azure/role-based-access-control/built-in-roles)

## <a name="next-steps"></a>Дальнейшие действия

> [!div class="nextstepaction"]
> [Сведения о развертывании базовой инфраструктуры](../../infrastructure/virtual-machines/basic-workload.md)
