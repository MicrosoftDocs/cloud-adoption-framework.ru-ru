---
title: Издержки и определение размера ресурсов Azure
description: Используйте платформу внедрения облаков для Azure, чтобы получить рекомендации по изучению затрат и изменению размера ресурсов в Azure.
author: BrianBlanchard
ms.author: brblanch
ms.date: 05/15/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: migrate
ms.openlocfilehash: ad35877a912fd9d52a74c7f44c91bd9fedb559a5
ms.sourcegitcommit: 9a84c2dfa4c3859fd7d5b1e06bbb8549ff6967fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83755127"
---
<!-- docsTest:ignore ARO -->

# <a name="best-practices-for-costing-and-sizing-resources-hosted-in-azure"></a>Рекомендации по издержки и изменению размера ресурсов, размещенных в Azure

При предоставлении дисциплин управления затратами на уровне предприятия это повторяющаяся тема. Оптимизируя и управляя затратами, вы сможете обеспечить долгосрочное успешное завершение работы среды Azure. Очень важно, чтобы все команды (например, группы "Финансы", "Управление" и "Разработка приложений") понимали связанные затраты и просматривают их на регулярной основе.

> [!IMPORTANT]
> Рекомендации и мнения, описанные в этой статье, основаны на функциях платформы и служб в Azure, которые были доступны во время написания статьи. Функции и возможности со временем меняются. Не все рекомендации будут применены к развертыванию, поэтому выберите, что лучше всего подходит для вашей ситуации.

## <a name="best-practices-by-team-and-accountability"></a>Рекомендации по группам и отчетности

Управление затратами на предприятии — это функция управления облаком и облачной операцией. Все решения по управлению затратами приводят к изменению ресурсов, поддерживающих рабочую нагрузку. Когда эти изменения влияют на архитектуру рабочей нагрузки, необходимо учитывать дополнительные моменты, чтобы снизить влияние на конечных пользователей и на бизнес-функции. Специалисты по внедрению в облако, которые настроили или разработали рабочую нагрузку, скорее всего, должны удерживать ответственность за выполнение этих типов изменений.

- **Добавление тегов является критически важным для всех систем управления.** Убедитесь, что все рабочие нагрузки и ресурсы соответствуют [соглашениям об именовании и маркировке](../../ready/azure-best-practices/naming-and-tagging.md) , и [Примените соглашения об отметке с помощью политики Azure](https://docs.microsoft.com/azure/governance/policy/tutorials/govern-tags).
- **Выявление возможностей для правильного размера.** Проверьте текущие требования к использованию ресурсов и производительности в среде.
- **Изменить размер:** Измените каждый ресурс, чтобы использовать минимальный экземпляр или номер SKU, который может поддерживать требования к производительности каждого ресурса.
- **Горизонтальное масштабирование по вертикали.** Использование нескольких небольших экземпляров может обеспечить более простой путь масштабирования в одном крупном экземпляре. Это позволяет автоматизировать масштабирование, которое создает оптимизацию затрат.

## <a name="operational-cost-management-best-practices"></a>Рекомендации по управлению операционными издержками

Следующие рекомендации обычно выполняются членами группы управления облаком или облачными операциями в соответствии с исправлениями и другими процессами запланированного обслуживания. Каждый из этих рекомендаций сопоставляется с практическими руководствами далее в этой статье.

- **Теги очень важны для всех** систем управления: Убедитесь, что все рабочие нагрузки и ресурсы соответствуют [соглашениям об именовании и маркировке](../../ready/azure-best-practices/naming-and-tagging.md) , и [Примените соглашения об отметке с помощью политики Azure](https://docs.microsoft.com/azure/governance/policy/tutorials/govern-tags).
- **Выявление возможностей для правильного размера:** Ознакомьтесь с текущими требованиями к использованию ресурсов и производительности в среде, чтобы найти ресурсы, которые оставались недостаточными в течение определенного периода времени (обычно более 90 дней).
- **Размер SKU, подготовленных по правому размеру:** Измените недостаточно загруженный ресурс, чтобы использовать минимальный экземпляр или номер SKU, который может поддерживать требования к производительности каждого ресурса.
- **Автозавершение работы виртуальных машин:** Если виртуальная машина не используется постоянно, рассмотрите возможность автоматического завершения работы. Виртуальная машина не будет удалена или списана, но она перестанет потреблять затраты на ресурсы вычислений и памяти, пока она не будет снова включена.
- **Автозавершение работы всех непроизводственных активов:** Если виртуальная машина является частью непроизводственных сред, в частности сред разработки, установите политику автоматического завершения, чтобы снизить неиспользуемые затраты. По возможности используйте Azure DevTest Labs в качестве самообслуживания, чтобы помочь разработчикам обеспечить самостоятельную учетную стоимость.
- **Завершение работы и списание неиспользуемых ресурсов:** Да, мы говорили о нем дважды. Если ресурс не использовался более 90 дней и не требует четкого требования к времени работы, отключите его. Что более важно, если машина была остановлена или завершена более 90 дней, отмените ее и удалите этот ресурс. Проверьте, выполнены ли политики хранения данных с помощью резервного копирования или других механизмов.
- **Очистка потерянных дисков:** Удалите неиспользуемое хранилище, особенно хранилище виртуальных машин, которое больше не подключено ни к одной виртуальной машине.
- **Избыточность по правому размеру:** Если ресурс не требует высокой степени избыточности, удалите геоизбыточное хранилище.
- **Настройка параметров автомасштабирования:** Рабочий мониторинг, скорее всего, не охватывает закономерности использования для различных ресурсов. Если эти шаблоны использования соответствуют параметрам, используемым для управления поведением автомасштабирования, то Группа операций может настроить параметры автомасштабирования, чтобы удовлетворить сезонные потребности или изменения в выделении бюджета. Ознакомьтесь с рекомендациями по управлению затратами на рабочую нагрузку для получения важных мер предосторожности.

## <a name="workload-cost-management-best-practices"></a>Рекомендации по управлению затратами рабочей нагрузки

Прежде чем вносить изменения в архитектуру, ознакомьтесь с техническим руководителем рабочей нагрузки. Упрощение проверки рабочей нагрузки с помощью [Microsoft Azure хорошо спроектированной](https://docs.microsoft.com/assessments/?id=azure-architecture-review) и Microsoft Azure архитектурной [инфраструктуры](https://docs.microsoft.com/azure/architecture/framework) для принятия решений относительно следующих типов архитектурных изменений.

- **Служба приложений Azure.** Проверьте требования к рабочей среде для всех планов службы приложений уровня "Премиум". Не зная бизнес-требований для рабочей нагрузки и базовой конфигурации активов, трудно определить, требуется ли план уровня "Премиум".
- **Горизонтальное масштабирование по вертикали.** Использование нескольких небольших экземпляров может обеспечить более простой путь масштабирования в одном крупном экземпляре. Это позволяет автоматизировать масштабирование, которое создает оптимизацию затрат. Прежде чем можно будет масштабировать рабочую нагрузку по горизонтали, техническая группа должна проверить, является ли приложение идемпотентными. Достижение горизонтального масштабирования может сначала потребовать внесения изменений в код и настройку различных уровней приложения.
- **Автомасштабирования.** Включите Автомасштабирование во всех службах приложений, чтобы обеспечить возможность ускоренного выполнения нескольких небольших виртуальных машин. Включение автомасштабирования имеет те же требования идемпотентными, что требует понимания архитектуры рабочей нагрузки. Рабочие нагрузки и вспомогательные ресурсы должны быть утверждены для горизонтального масштабирования и автоматического масштабирования группой внедрения до внесения любых изменений.
- **Реализуйте бессерверные технологии:** Рабочие нагрузки виртуальных машин часто переносятся "как есть", чтобы избежать простоев. Часто на виртуальных машинах могут размещаться прерывистые задачи с коротким или, напротив, многочасовым периодом запуска. Например, виртуальные машины, на которых запускаются запланированные задачи, в том числе скрипты Планировщика задач Windows или PowerShell. Не смотря на то, что эти задачи не выполняются, вы тратите средства на виртуальную машину и хранилище диска. После миграции рассмотрите возможность перепроектирования слоев рабочей нагрузки на бессерверные технологии, такие как функции Azure или пакетные задания Azure.

## <a name="actionable-best-practices"></a>Практические методики

Оставшаяся часть этой статьи содержит тактических примеры рекомендаций по эксплуатации, которые могут выполнять специалисты по управлению облаком или облачным операциям для оптимизации затрат на предприятие.

## <a name="before-adoption"></a>Перед внедрением

Прежде чем перенести рабочие нагрузки в облако, оцените ежемесячную стоимость их выполнения в Azure. Оперативное управление облачными расходами поможет оставаться в рамках бюджета операционных расходов. Рекомендации в этом разделе помогут вам оценить затраты и выполнить требуемый размер для виртуальных машин и хранилища перед развертыванием рабочей нагрузки в облаке.

## <a name="best-practice-estimate-monthly-workload-costs"></a>Рекомендации: Оценка месячных затрат на рабочую нагрузку

Чтобы прогнозировать ежемесячный счет за ресурсы Azure, можно использовать несколько средств.

<!-- TODO: Change "input costs" -->
- **Калькулятор цен Azure:** Выберите продукты, которые требуется оценить, например виртуальные машины и хранилище, а затем введите затраты в калькулятор для создания оценки.

    ![Калькулятор цен Azure](../../migrate/azure-best-practices/media/migrate-best-practices-costs/pricing.png) _Калькулятор цен Azure_

- Служба **"миграция Azure":** Чтобы оценить затраты, необходимо проверить и учитывать все ресурсы, необходимые для выполнения рабочих нагрузок в Azure. Чтобы получить эти данные, необходимо провести инвентаризацию ресурсов, включая серверы, виртуальные машины, базы данных и хранилище. Для сбора этой информации можно использовать службу "Миграция Azure".
  - Служба "Миграция Azure" обнаруживает и оценивает вашу локальную среду для составления инвентарного перечня.
  - Она может сопоставлять и отображать зависимости между виртуальными машинами, чтобы предоставить вам полную картину.
  - Оценка службы "Миграция Azure" содержит предполагаемые расходы.
    - **Затраты на вычисление:** При создании оценки рекомендуется использовать размер виртуальной машины Azure. Служба "миграция Azure" использует API-интерфейсы выставления счетов Azure для вычисления оценочных ежемесячных затрат на виртуальные машины. В ходе оценки учитывается операционная система, Software Assurance, зарезервированные экземпляры, время работы виртуальной машины, расположение и параметры валюты. Служба суммирует затраты на все виртуальные машины, которые оцениваются, чтобы рассчитать общие ежемесячные затраты на вычислительные ресурсы.
    - **Стоимость хранилища:** Служба "миграция Azure" вычисляет общие ежемесячные затраты на хранение, суммируя затраты на хранение всех виртуальных машин в ходе оценки. Вы можете вычислить ежемесячные затраты на хранилище определенного компьютера путем суммирования ежемесячных затрат на все подключенные к нему диски.

    ![Миграция Azure](../../migrate/azure-best-practices/media/migrate-best-practices-costs/assess.png)
    _Оценка Миграции Azure_

**Подробнее:**

- Используйте [Калькулятор цен Azure](https://azure.microsoft.com/pricing/calculator).
- Ознакомьтесь с [обзором службы "миграция Azure](https://docs.microsoft.com/azure/migrate/migrate-services-overview)".
- Ознакомьтесь с [оценками службы "миграция Azure](https://docs.microsoft.com/azure/migrate/concepts-assessment-calculation)".
- Дополнительные сведения о [Azure Database Migration Service](https://docs.microsoft.com/azure/dms/dms-overview).

## <a name="best-practice-right-size-vms"></a>Рекомендации: подходящие размеры виртуальных машин

При развертывании виртуальных машин Azure для поддержки рабочих нагрузок можно выбрать несколько вариантов. Каждый тип виртуальной машины имеет свои особые возможности и различные комбинации ЦП, памяти и дисков. Виртуальные машины сгруппированы следующим образом.

| **Type** | **Сведения** | **Использование** |
|---|---|---|
| **Общего назначения** | Сбалансированное соотношение ресурсов ЦП и памяти. | Подходит для тестирования и разработки, небольших и средних баз данных, с низким и средним объемами. | Веб-серверы трафика. |
| **Оптимизированные по вычислительным ресурсам** | Высокое соотношение ресурсов ЦП и памяти. | Хорошее решение для веб-сервера со средним объемом трафика, сетевых устройств, пакетных процессов и серверов приложений. |
| **Оптимизированные для памяти** | Высокое соотношение ресурсов памяти и ЦП. | Хорошее решение для реляционных баз данных, кэша среднего и большого объема и выполняющейся в памяти аналитики. |
| **Оптимизированные для хранилища** | Высокая пропускная способность диска и операции ввода-вывода. | Подходит для больших данных, баз данных SQL и NoSQL. |
| **Оптимизированные для GPU** | Специализированные виртуальные машины. Один или несколько GPU. | Большие объемы графики и редактирование видео. |
| **Высокопроизводительные** | Самый быстрый и мощный ЦП. Виртуальные машины с необязательными сетевыми интерфейсами с высокой пропускной способностью (RDMA). | Важные приложения с высокой производительностью. |

- Важно понимать разницу в ценах на эти виртуальные машины, а также долгосрочные последствия для бюджета.
- Каждый тип включает в себя несколько серий виртуальных машин.
- Кроме того, при выборе виртуальной машины в ряде можно масштабировать виртуальную машину только в пределах этого ряда. Например, dsv2 \_ 2 может масштабироваться до dsv2 \_ 4, но нельзя изменить на другой ряд, например серия fsv2 \_ 2.

**Подробнее:**

- Узнайте больше о [типах виртуальных машин и их размерах](https://docs.microsoft.com/azure/virtual-machines/windows/sizes), а затем сопоставьте размеры с типами.
- Планируйте [Размер виртуальной машины](https://docs.microsoft.com/azure/cloud-services/cloud-services-sizes-specs).
- Ознакомьтесь с [примерной оценкой для вымышленной компании Contoso](../../plan/contoso-migration-assessment.md).

## <a name="best-practice-select-the-right-storage"></a>Рекомендации. Выберите нужное хранилище.

Настройка и обслуживание локального хранилища (SAN или NAS), а также сетей для его поддержки могут быть дорогостоящими и занимать много времени. Чтобы уменьшить операционные и управленческие проблемы, файловые данные (данные хранилища) обычно переносятся в облако. Корпорация Майкрософт предоставляет несколько вариантов перемещения данных в Azure, так что вам необходимо решить, какой из них использовать. Выбор правильного типа хранилища данных может экономить вашей организации несколько тысяч долларов ежемесячно. Ниже приведены некоторые рекомендации.

- Данные, к которым не обращаются много ресурсов и которые не являются критически важными для бизнеса, не должны размещаться в наиболее дорогостоящем хранилище.
- И наоборот, критически важные для бизнеса данные должны располагаться в хранилищах более высокого уровня.
- Во время планирования перехода следует взять на себя инвентаризацию данных и классифицировать их по важности, чтобы связать их с наиболее подходящим хранилищем. Учитывайте бюджет и стоимость, а также производительность. Стоимость не обязательно должна быть основным фактором при принятии решений. Выбор наименее дорогого варианта может подвергнуть рабочую нагрузку риску с точки зрения производительности и доступности.

### <a name="storage-data-types"></a>Типы данных хранилища

Azure предоставляет различные типы данных хранилища.

<!-- markdownlint-disable MD033 -->

| **Тип данных** | **Сведения** | **Использование** |
| ---|---|---|
| **BLOB-объекты** | Оптимизировано для хранения больших объемов неструктурированных объектов, таких как текстовые или двоичные данные. | Доступ к данным отовсюду через HTTP/HTTPS. | Используется для сценариев потоковой передачи и произвольного доступа. Например, для передачи изображений и документов непосредственно в браузер, потокового видео и аудио, а также для хранения данных резервного копирования и аварийного восстановления. |
| **Файлы** | Управляемые общие файловые ресурсы, доступ к которым осуществляется через SMB 3,0. | Используется при переносе локальных файловых ресурсов и для предоставления нескольких прав доступа и подключений к данным файлов. |
| **Диски** | На основе страничных BLOB-объектах. <br><br> Тип диска (скорость): Стандартный HDD, Стандартный SSD, SSD класса Premium или Ultra Disks. <br><br> Управление дисками. неуправляемый (Управление параметрами дисков и хранением) или управление ими (выберите тип диска, и Azure управляет диском). | Используйте диски уровня "Премиум" для виртуальных машин. Для простого управления и масштабирования используются управляемые диски. |
| **Очереди** | Хранение и получение большого количества сообщений, доступ к которым осуществлялся через вызовы с проверкой подлинности (HTTP или HTTPS). | Подключение компонентов приложения к очереди асинхронных сообщений. |
| **Таблицы** | Хранение таблиц. | Теперь входит в состав API таблиц Azure Cosmos DB. |

<!--markdownlint-enable MD033 -->

### <a name="access-tiers"></a>Уровни доступа

Служба хранилища Azure предоставляет различные возможности для доступа к данным блочного BLOB-объекта. Выбор правильного уровня доступа позволит хранить данные блочных BLOB-объектов наиболее экономичным способом.

<!-- markdownlint-disable MD033 -->

| **Уровень доступа** | **Сведения** | **Использование** |
| --- | --- | --- |
| **Горячий** | Выше стоимость хранения, ниже расходы на доступ и транзакции <br><br> Это уровень доступа по умолчанию. | Используйте для активно используемых данных, к которым часто обращаются. |
| **Здорово** | Снижение затрат на хранение, повышение стоимости доступа и транзакций. <br><br> Хранение не менее чем 30 дней. | Краткосрочное хранение, данные доступны, но к ним редко обращаются. |
| **Архив** | Используется для отдельных блочных BLOB-объектов. <br><br> Наиболее экономный способ хранения. Наименьшая стоимость хранения, высокая стоимость доступа и транзакций. | Используйте для данных, которые могут допускать несколько часов задержки при получении, и будут находиться на уровне архива в течение не менее 180 дней. |

<!--markdownlint-enable MD033 -->

### <a name="storage-account-types"></a>Типы учетных записей хранения

Azure предоставляет различные типы учетных записей хранения и уровней производительности.

<!-- markdownlint-disable MD033 -->

| **Тип учетной записи** | **Сведения** | **Использование** |
| --- | --- | --- |
| **Универсальный уровень общего назначения версии 2** | Поддерживает BLOB-объекты (блок, страница, добавление), файлы, диски, очереди и таблицы. <br><br> Поддерживает горячий, стильный и архивный уровни доступа. Поддерживается хранилище, избыточное в виде зоны (ZRS). | Используется для большинства сценариев и типов данных. Учетные записи хранения уровня "Стандартный" могут быть основаны на жестких дисках или SSD. |
| **Уровень Premium общего назначения версии 2** | Поддерживает данные хранилища BLOB-объектов (страничные BLOB-объекты). Поддерживает горячий, стильный и архивный уровни доступа. Поддерживается ZRS. <br><br> Хранение на SSD. | Майкрософт рекомендует использовать для всех виртуальных машин. |
| **Общий назначение v1** | Распределение по уровням доступа не поддерживается. Не поддерживает ZRS. | Используется, если приложениям необходима классическая модель развертывания Azure. |
| **Объекте** | Специализированная учетная запись хранения для хранения неструктурированных объектов. Предоставляет блочные и добавочные BLOB-объекты (без служб файлов, очередей, таблиц или дисковых хранилищ). Обеспечивает ту же устойчивость, доступность, масштабируемость и производительность, что и общая цель версии 2. | Вы не можете хранить страничные BLOB-объекты в этих учетных записях, поэтому они не могут хранить файлы VHD. Можно установить уровень доступа "горячий" или "холодное". |

<!--markdownlint-enable MD033 -->

### <a name="storage-redundancy-options"></a>Параметры избыточности хранилища

Учетные записи хранения могут использовать различные виды избыточности для обеспечения устойчивости и высокого уровня доступности.

| **Type** | **Сведения** | **Использование** |
| --- | --- | --- |
| **Локально избыточное хранилище (LRS)** | Защищает от локальных сбоев, реплицируя одну единицу хранения в отдельный домен сбоя и домен обновления. Сохраняет несколько копий данных в одном центре обработки данных. Предоставляет по крайней мере 99,999999999% (одиннадцать 9) устойчивости объектов в течение заданного года. | Рекомендуется, если приложение хранит данные, которые можно легко воссоздать. |
| **Хранилище, избыточное в виде зоны (ZRS)** | Предоставляет защиту от сбоя центр обработки данных, реплицируя все три кластера хранилища в одном регионе. Каждый кластер хранилища физически отделен и размещен в собственной зоне доступности. Предоставляет по крайней мере уровне 99,9999999999% (двенадцать 9) устойчивость объектов в течение определенного года, сохраняя несколько копий данных в нескольких центрах обработки или регионах. | Рекомендуется, если требуется согласованность, устойчивость и высокий уровень доступности. Не может защитить данные от региональной аварии, при которой полностью выходят из строя несколько зон. |
| **Геоизбыточное хранилище (GRS)** | Обеспечивает защиту от сбоя всего региона путем репликации данных в дополнительный регион, который находится в сотнях километров от основного. Предоставляет минимум 99,99999999999999 процента (16) устойчивость объектов в течение заданного года. | Данные реплики будут недоступны, пока корпорация Майкрософт не инициирует отработку отказа в дополнительном регионе. При отработке отказа чтение и запись доступны. |
| **Геоизбыточное хранилище с доступом для чтения (RA-GRS)** | Как и GRS. Предоставляет минимум 99,99999999999999 процента (16) устойчивость объектов в течение заданного года. | Обеспечивает доступность и 99,99 процентов доступной для чтения из второго региона, используемого для GRS. |

**Подробнее:**

- [Обзор цен на хранилище Azure](https://azure.microsoft.com/pricing/details/storage)
- [Дополнительные сведения](https://docs.microsoft.com/azure/storage/common/storage-import-export-service) Импорт и экспорт Azure для внедрения больших объемов данных в большие двоичные объекты и файлы Azure.
- [Выбор между большими двоичными объектами Azure, службой файлов Azure и дисками Azure](https://docs.microsoft.com/azure/storage/common/storage-introduction).
- Дополнительные сведения о [уровнях доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers).
- [Общие сведения об учетной записи хранения](https://docs.microsoft.com/azure/storage/common/storage-account-overview).
- Сведения о [избыточности службы хранилища Azure](https://docs.microsoft.com/azure/storage/common/storage-redundancy), включая LRS, ZRS, GRS и GRS доступа для чтения.
- Дополнительные сведения о [службе файлов Azure](https://docs.microsoft.com/azure/storage/files/storage-files-introduction).

## <a name="after-adoption"></a>После внедрения

До внедрения прогнозы затрат зависят от решений, принятых владельцами рабочей нагрузки и группой внедрения в облако. Хотя Группа управления может помочь в принятии этих решений, скорее всего, у группы управления будет немало действий.

После выпуска ресурсов в рабочей среде данные могут быть агрегированы и тенденции анализируются на уровне среды. Эти данные помогут группе управления принимать решения об изменении размеров и использовании независимо друг от друга, основываясь на реальных шаблонах использования и архитектуре текущего состояния.

- Анализ данных для создания базового бюджета для групп ресурсов и ресурсов Azure.
- Выявление шаблонов использования, которые позволяют сократить размер и остановить или приостановить ресурсы для дальнейшего снижения затрат.

В этом разделе приводятся рекомендации по использованию Преимущество гибридного использования Azure и зарезервированных виртуальных машин, снижению затрат на облачные ресурсы в рамках подписок, использованию Azure Cost Management для бюджетирования и анализа затрат, мониторинга ресурсов и реализации бюджетов групп ресурсов и оптимизации мониторинга, хранения и виртуальных машин.

## <a name="best-practice-take-advantage-of-azure-hybrid-benefit"></a>Рекомендации. Воспользуйтесь преимуществами Преимущество гибридного использования Azure

Благодаря годам инвестиций в разработку программного обеспечение для таких систем, как Windows Server и SQL Server, корпорация Майкрософт обладает уникальной возможностью предложить клиентам ценные возможности в облаке со значительными скидками, которые далеко не всегда могут предоставить другие поставщики облачных служб.

Интегрированный портфель локальных продуктов корпорации Майкрософт и продуктов Azure создает конкурентные и ценовые преимущества. Если у вас есть операционная система или другое лицензирование программного обеспечения в рамках программы Software Assurance (SA), вы можете использовать эти лицензии в облаке с Преимущество гибридного использования Azure.

**Подробнее:**

- [Взгляните](https://azure.microsoft.com/pricing/hybrid-benefit) на калькулятор преимущество гибридного использования Azure экономии.
- Дополнительные сведения о [преимущество гибридного использования Azure для Windows Server](https://azure.microsoft.com/pricing/hybrid-benefit).
- [Руководство по выбору ценовой категории для виртуальных машин SQL Server в Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-pricing-guidance).

## <a name="best-practice-use-reserved-vm-instances"></a>Рекомендации. использование зарезервированных экземпляров виртуальных машин

Большинство облачных платформ настраиваются с оплатой по мере использования. У данной модели есть недостатки, поскольку вам не всегда известно, какими будут динамические рабочие нагрузки. Выражая четкие намерения в отношении рабочей нагрузки, вы принимаете участие в планировании инфраструктуры.

Используя Azure Reserved VM Instances, вы представите предоплату за один или три года для экземпляров виртуальных машин.

- Предварительная оплата обеспечивает скидку на используемые ресурсы.
- Вы можете значительно сократить затраты на виртуальные машины, вычисление базы данных SQL, Azure Cosmos DB или другие ресурсы до 72% по ценам оплаты по мере использования.
- Резервирования обеспечивают скидку при выставлении счетов и не влияют на состояние среды выполнения ваших ресурсов.
- Зарезервированные экземпляры можно отменить.

![Зарезервированные экземпляры ](../../migrate/azure-best-practices/media/migrate-best-practices-costs/reserve.png)
 _рис. 1. зарезервированные виртуальные машины Azure._

**Подробнее:**

- Дополнительные сведения о [резервировании Azure](https://docs.microsoft.com/azure/cost-management-billing/reservations/save-compute-costs-reservations).
- Считать [зарезервированные экземпляры часто задаваемые вопросы](https://azure.microsoft.com/pricing/reserved-vm-instances/#faq).
- Ознакомьтесь с [руководством по ценам для SQL Server виртуальных машин Azure](https://docs.microsoft.com/azure/virtual-machines/windows/sql/virtual-machines-windows-sql-server-pricing-guidance).

## <a name="best-practice-aggregate-cloud-spend-across-subscriptions"></a>Рекомендация: агрегирование облачных затрат по подпискам

Со временем у вас неизбежно будет несколько подписок Azure. Например, возможно, вам понадобится дополнительная подписка для разделения границ среды разработки и рабочей среды, или у вас появится платформа, которая потребует отдельную подписку для каждого клиента. Ценной функцией является возможность выполнять статистические вычисления для отчетов данных по всем подпискам в одной платформе.

Для этого можно использовать API службы "Управления затратами Azure". Затем после агрегирования данных в единый источник, например Azure SQL, для получения статистических данных можно использовать такие инструменты, как Power BI. Вы можете создавать статистические отчеты по подписке, а также детализированные отчеты. Например, для пользователей, которым требуется упреждающее представление об управлении затратами, можно создать конкретные представления затрат на основе отдела, группы ресурсов или другой информации. При этом нет необходимости предоставлять полный доступ к данным по выставлению счетов в Azure.

**Подробнее:**

- [Ознакомьтесь с обзором](https://docs.microsoft.com/azure/billing/billing-consumption-api-overview) API-интерфейсов использования Azure.
- [Подключение к Azure Consumption Insights в Power BI Desktop (бета-версия)](https://docs.microsoft.com/power-bi/desktop-connect-azure-consumption-insights).
- [Управление доступом к данным для выставления счетов в Azure](https://docs.microsoft.com/azure/billing/billing-manage-access).

## <a name="best-practice-monitor-resource-utilization"></a>Рекомендации: мониторинг использования ресурсов

В Azure вы платите по мере использования, когда потребляете ресурсы, и не платите, если ими не пользуетесь. Для виртуальных машин выставление счетов происходит, когда виртуальная машина выделена, а когда ее выделение отменяется, плата не взимается. Учитывая это, следует контролировать использование виртуальных машин и проверять изменение их размеров.

- Постоянно оценивайте рабочие нагрузки виртуальной машины, чтобы определить базовые показатели.
- Например, если рабочая нагрузка интенсивно используется с понедельника по пятницу с 8:00 до 18:00, но вне этого времени используется редко, вне этого периода можно переходить на использование менее дорогой версии виртуальной машины. Это может приводить к изменению размеров виртуальной машины или потребовать использования масштабируемого набора виртуальных машин для автоматического масштабирования виртуальных машин.
- Некоторые компании "откладывают" виртуальные машины, обозначая в календаре дату и время их доступности.
- Помимо мониторинга виртуальной машины следует отслеживать другие сетевые ресурсы, среди которых ExpressRoute и шлюзы виртуальных сетей для избыточного и недостаточного использования.
- Использование виртуальных машин можно отслеживать с помощью нескольких инструментов корпорации Майкрософт, в том числе Управления затратами Azure, Azure Monitor и Помощника по Azure. Доступны также сторонние средства.

**Подробнее:**

- Общие сведения о [службе Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/overview) и [Azure Advisor](https://docs.microsoft.com/azure/advisor/advisor-overview).
- [Рекомендации Azure Advisor по затратам](https://docs.microsoft.com/azure/advisor/advisor-cost-recommendations).
- Узнайте, как [оптимизировать расходы от рекомендаций](https://docs.microsoft.com/azure/cost-management-billing/costs/tutorial-acm-opt-recommendations)и [предотвратить непредвиденные расходы](https://docs.microsoft.com/azure/billing/billing-getting-started).
- Узнайте о [наборе средств оптимизации ресурсов Azure (АТО)](https://github.com/azure/azure-quickstart-templates/tree/master/azure-resource-optimization-toolkit).

## <a name="best-practice-reduce-nonproduction-costs"></a>Рекомендации: уменьшение непроизводственных затрат

Среды разработки, тестирования и контроля качества (QA) необходимы во время циклов разработки. К сожалению, такие среды часто остаются в процессе подготовки, когда они перестают быть полезными. Регулярная проверка неиспользуемых непроизводственных сред может оказать немедленное влияние на затраты.

Кроме того, учитывайте общее снижение затрат для любых непроизводственных сред:

- Сократите количество непроизводительных ресурсов, чтобы использовать виртуальные машины серии B и хранилище уровня "Стандартный" более низкой стоимости.
- Применяйте политики Azure, чтобы требовать снижения затрат на уровне ресурсов для любых непроизводственных ресурсов.

**Подробнее:**

- [Используйте теги](https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources) для определения целей разработки, тестирования или контроля качества для изменения размера или завершения.
- [Виртуальные машины с автозавершением](https://docs.microsoft.com/azure/cost-management-billing/manage/getting-started#consider-cost-cutting-features-like-auto-shutdown-for-vms) задают время ночных прерываний для виртуальных машин. Использование этой функции приведет к тому, что виртуальные машины, не являющиеся продукцией, будут прекращаться каждую ночь, поэтому разработчикам придется перезапускать эти виртуальные машины, когда они готовы возобновить
- Рекомендуйте группам разработки использовать [Azure DevTest Labs](https://docs.microsoft.com/azure/lab-services/devtest-lab-overview) для создания собственных подходов к контролю затрат и избежать влияния стандартного времени автоматического завершения работы на предыдущем шаге.

## <a name="best-practice-use-azure-cost-management"></a>Рекомендации. Использование службы "Управление затратами Azure"

Корпорация Майкрософт предоставляет службу "Управление затратами Azure", которая помогает отслеживать расходы следующим образом.

- Помогает отслеживать и контролировать расходы в Azure и оптимизировать использование ресурсов.
- Проверяет все подписки и ресурсы и предоставляет рекомендации.
- Предоставляет полный API для интеграции внешних средств и финансовых систем для создания отчетов.
- Отслеживает использование ресурсов и управление затратами на облако с помощью единого представления.
- Предоставляет подробные операционные и финансово-аналитические сведения, чтобы помочь вам принять обоснованные решения.

В службе "Управление затратами Azure" можно:

- **Создайте бюджет:** Создайте бюджет для финансовой отчетности.
  - Вы можете учесть службы, которые вы используете или на которые вы подписаны, за определенный период (месяц, квартал или год), а также область (подписки или группы ресурсов). Например, можно создать бюджет подписки Azure на месячный, квартальный или годовой период.
    - Анализ затрат отображается после создания бюджета. Просмотр бюджета по текущим расходам – один из первых шагов, которые необходимо выполнить при анализе затрат и расходов.
  - При достижении порога бюджета могут отправляться уведомления по электронной почте.
  - Вы можете экспортировать данные управления затратами в службу хранилища Azure для анализа.

    ![Просмотр бюджетов в службе "Управление затратами Azure" ](../../migrate/azure-best-practices/media/migrate-best-practices-costs/budget.png)
     _бюджет управления затратами_

- **Анализ затрат:** Получите анализ затрат для изучения и анализа затрат на организацию, чтобы понять, как начисляются затраты, и выявление тенденций расходов.
  - Анализ затрат доступный пользователям EA.
  - Вы можете просматривать данные анализа затрат для различных областей, включая отдел, учетную запись, подписку или группу ресурсов.
  - Можно получить анализ затрат, который показывает общие затраты за текущий месяц и накопленные ежедневные затраты.

    ![Анализ управления затратами Azure ](../../migrate/azure-best-practices/media/migrate-best-practices-costs/analysis.png)
     _: анализ управления затратами Azure._

- **Получить рекомендации:** Получите рекомендации помощника, которые покажут, как можно оптимизировать и повысить эффективность.

**Подробнее:**

- [Общие сведения о службе "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/overview).
- [Как оптимизировать инвестиции в облако с помощью службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management-billing/costs/cost-mgt-best-practices)
- [Использование отчетов службы "Управление затратами Azure"](https://docs.microsoft.com/azure/cost-management/use-reports).
- [Руководство. Рекомендации по оптимизации затрат](https://docs.microsoft.com/azure/cost-management-billing/costs/tutorial-acm-opt-recommendations).
- [Ознакомьтесь](https://docs.microsoft.com/rest/api/consumption/budgets) с API-интерфейсами использования Azure.

## <a name="best-practice-implement-resource-group-budgets"></a>Рекомендации. Реализация бюджетов групп ресурсов

Группы ресурсов часто используются для представления границ затрат. Вместе с шаблоном потребления команда Azure продолжает развивать новые и улучшенные способы отслеживания и анализа расходов на ресурсы на различных уровнях, включая возможность создания бюджетов для отдельных ресурсов и их групп.

- Бюджет группы ресурсов помогает отслеживать затраты, связанные с группой ресурсов.
- Как только будет исчерпан или превышен бюджет, можно активировать оповещения и запустить различные сборники схем.

**Подробнее:**

- [Узнайте, как](https://docs.microsoft.com/azure/billing/billing-cost-management-budget-scenario) управлять затратами с помощью бюджетов Azure.
- [Руководство. Создание и управление бюджетами Azure](https://docs.microsoft.com/azure/cost-management-billing/costs/tutorial-acm-create-budgets).

## <a name="best-practice-review-azure-advisor-recommendations"></a>Рекомендация. Ознакомьтесь с рекомендациями помощника по Azure

Рекомендации по стоимости Azure Advisor позволяют выявление возможных сделок для сокращения затрат. При низком или нехватке бюджета используйте этот отчет, чтобы найти непосредственные возможности для быстрого согласования затрат.

**Подробнее:**

- [Ознакомьтесь с рекомендациями по стоимости Azure Advisor](https://docs.microsoft.com/azure/advisor/advisor-cost-recommendations) , чтобы выполнить немедленные действия.

## <a name="best-practice-optimize-azure-monitor-retention"></a>Рекомендации: Оптимизация хранения Azure Monitor

Перемещая ресурсы в Azure и включая журнал ведения диагностики для них, можно создавать большое число данных журнала. Обычно эти данные журнала отправляются в учетную запись хранения, сопоставленную с рабочей областью Log Analytics.

- Чем дольше период хранения данных журнала, тем больше данных вы получите.
- Не все данные журнала одинаковые, некоторые ресурсы будут создавать больше данных журнала, чем другие.
- Из-за законодательных норм и требований к соответствию для одних ресурсов журнал данных, возможно, понадобится хранить дольше, чем для других.
- Распределите баланс между оптимизацией затрат на хранение журналов и хранением необходимых данных журнала.
- Мы рекомендуем оценивать и настраивать ведения журнала сразу же после завершения миграции, чтобы не тратить деньги на хранение ненужных журналов.

**Подробнее:**

- [Мониторинг использования и ожидаемых затрат](https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-usage-and-estimated-costs).

## <a name="best-practice-optimize-storage"></a>Рекомендации. Оптимизация хранилища

Если вы привыкли перед принятием решений по выбору хранилища, вы, скорее всего, сможете воспользоваться некоторыми преимуществами. Вероятно, вы можете оптимизировать некоторые дополнительные затраты на хранение. Со временем большие двоичные объекты и файлы устаревают. Данные могут больше не использоваться, но их приходится хранить в течение определенного периода из-за нормативных требований. Таким образом, вам может не понадобиться хранить его в высокопроизводительном хранилище, которое использовалось для первоначального внедрения.

Определение и перемещение устаревших данных в дешевые области хранения значительно влияет на ежемесячный бюджет для хранилища и обеспечивает экономию средств. В Azure предусмотрено множество способов для выявления и последующего хранения этих устаревших данных.

- Воспользуйтесь преимуществами уровней доступа для хранилища общего назначения версии 2, перемещая менее важные данные с горячий на холодное и архивированные уровни.
- С помощью StorSimple устаревшие данные можно перемещать на основе настраиваемых политик.

**Подробнее:**

- Дополнительные сведения о [уровнях доступа](https://docs.microsoft.com/azure/storage/blobs/storage-blob-storage-tiers).
- Общие сведения о StorSimple см. в [этой статье](https://docs.microsoft.com/azure/azure-monitor/overview), а цены на StorSimple [здесь](https://azure.microsoft.com/pricing/details/storsimple).

## <a name="best-practice-automate-vm-optimization"></a>Рекомендации: Автоматизация оптимизации виртуальной машины

Конечной целью запуска виртуальной машины в облаке является развертывание ЦП, памяти и используемого диска. Обнаружив неоптимизированные или часто простаивающие виртуальные машины, необходимо завершить их работу или уменьшить их масштаб с помощью масштабируемых наборов виртуальных машин.

Вы можете оптимизировать виртуальную машину с помощью службы автоматизации Azure, масштабируемых наборов виртуальных машин, автоматического завершения работы, сценариев или решений сторонних разработчиков.

**Подробнее:**

- [Вертикальное автомасштабирование масштабируемых наборов виртуальных машин](https://docs.microsoft.com/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-vertical-scale-reprovision).
- [Расписание автозапуска виртуальных машин](https://azure.microsoft.com/updates/azure-devtest-labs-schedule-vm-auto-start).
- [Решение для запуска и остановки виртуальных машин в нерабочее время в службе автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-solution-vm-management).
- Получите дополнительные сведения о [помощнике по Azure](https://docs.microsoft.com/azure/advisor/advisor-overview)и [средстве оптимизации ресурсов Azure (АТО)](https://github.com/azure/azure-quickstart-templates/tree/master/azure-resource-optimization-toolkit).

## <a name="best-practice-use-logic-apps-and-runbooks-with-budgets-api"></a>Рекомендации. Использование Logic Apps и модулей Runbook с API бюджетов

Azure предоставляет REST API, который может получить доступ к сведениям о выставлении счетов клиента.

- API бюджетов можно использовать для интеграции внешних систем и рабочих процессов, которые активируются метриками, созданными на основе данных API.
- Вы можете извлекать данные об использовании и ресурсах в предпочтительные средства анализа данных.
- API использования ресурсов Azure и API Azure Resource RateCard позволяют точно прогнозировать затраты и управлять ими.
- API-интерфейсы реализуются как поставщик ресурсов и включены в интерфейсы API, предоставляемые Azure Resource Manager.
- API бюджетов можно интегрировать с Azure Logic Apps и модулями Runbook службы автоматизации Azure.

**Подробнее:**

- Дополнительные сведения об [API бюджетов](https://docs.microsoft.com/rest/api/consumption/budgets).
- [Получите ценные](https://docs.microsoft.com/azure/billing/billing-usage-rate-card-overview) сведения об использовании Azure с API-интерфейсы выставления счетов Azure.

## <a name="next-steps"></a>Дальнейшие действия

Изучив рекомендации, изучите службу [управления затратами цепочки инструментов](./toolchain.md) , чтобы определить средства и функции Azure, которые помогут вам выполнить эти рекомендации.

> [!div class="nextstepaction"]
> [Цепочка инструментов управления затратами для Azure](./toolchain.md)
