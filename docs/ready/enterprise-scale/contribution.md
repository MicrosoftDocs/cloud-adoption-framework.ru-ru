---
title: Рекомендации по публикации
description: Рекомендации по публикации.
author: alexbuckgit
ms.author: abuck
ms.date: 06/15/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: cc9676ec0e35cbb75b1884524d8c23b87c174460
ms.sourcegitcommit: 84d7bfd11329eb4c151c4c32be5bab6c91f376ed
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/10/2020
ms.locfileid: "86235115"
---
# <a name="contribution-guide"></a>Рекомендации по публикации

## <a name="enterprise-scale-committee"></a>Комитет корпоративного уровня

Корпоративный Комитет и его члены являются основным каретакерсом репозитория корпоративного уровня, а также его языком, конструкцией и реализацией contoso.

Текущие участники комитетов:

<!-- docsTest:disable -->
<!-- cSpell:disable -->

- Удай Пандья
- Каллум гроб
- Kristian NESE
- Виктор Арзате
- Йохан Дахлбом
- Лйон до
- Нильс buit

<!-- docsTest:enable --->
<!-- cSpell:enable -->

## <a name="committee-member-responsibilities"></a>Обязанности членов комитетов

Сотрудники по Комитету несут ответственность за проверку и утверждение запросов RFC, предменяя новые функции или изменения структуры.

Первоначальный Комитет корпоративного уровня состоит из сотрудников корпорации Майкрософт. Предполагается, что сообщество будет расти, а новые участники сообщества будут соединяться с сотрудниками по времени. Членство зависит от уровня вклада и опыта. Пользователи, участвующие в осмысленных способах проекта, будут распознаны соответствующим образом.

Участник комитетов может в любое время присвоить сообществам надежный член сообщества. Заявку следует отправлять в виде документов RFC с подробными сведениями о том, почему это лицо квалифицировано и как они будут участвовать. После того как документ RFC обсуждается, для подтверждения нового члена Комитета потребуется единодушное голосование.

## <a name="contribution-scope-for-enterprise-scale-architecture-guidelines"></a>Область вклада для рекомендаций по архитектуре корпоративного масштаба

Область вкладов в этот репозиторий заключается в том, что по мере развития платформы и проверки новых служб и функций в рабочей среде с клиентами руководства по проектированию подчиняются обновлениям в общем контексте архитектуры. Используйте шаблон заполнителя для отправки запросов на вытягивание (вытягивание) для обновлений документации.

## <a name="contribution-scope-for-contoso-reference-implementation"></a>Область вклада для реализации ссылки contoso

Руководство по реализации и эталонная реализация должны обновляться соответствующим образом по мере появлении новых служб, ресурсов, свойств ресурсов и версий API. Вклады в код в первую очередь касаются Microsoft Azure определений политик и назначений для реализации contoso.

<!-- cSpell:ignore azops apiversion northeurope -->

## <a name="how-to-submit-a-pr-to-the-upstream-repo"></a>Отправка запроса на вытягивание в вышестоящем репозитории

1. Создайте новую ветвь на основе вышестоящего или главного сервера, выполнив следующую команду:

    ```shell
    git checkout -b feature upstream/master
    ```

2. Извлеките файлы из рабочей ветви, которую нужно включить в запрос на вытягивание:

    ```shell
    #substitute file name as appropriate. below example
    git checkout feature: .\.github\workflows\azops-push.yml
    ```

3. Отправьте ветвь Git в ваш источник:

    ```shell
    git push origin -u
    ```

4. Создание запроса на вытягивание из вышестоящего в удаленную `master` ветвь.

## <a name="writing-azure-resource-manager-templates-for-contoso-implementation"></a>Написание шаблонов Azure Resource Manager для реализации contoso

Нет правильного или неправильного способа написания диспетчер ресурсов шаблонов и файлов параметров. Диспетчер ресурсов является языком, а все имеет свой стиль записи. Несколько файлов шаблонов и параметров записываются подобным образом между группой разработчиков. Нет четких определений стилей для контроля и разделения кода в конфигурациях, что позволяет интерпретировать шаблоны и файлы параметров для интерпретации. Рекомендации по использованию параметров и объектов в качестве параметров (без какой-либо схемы) также подвергаются интерпретации и не имеют ни одного созданного стиля, удовлетворяющего всем.

Чтобы упростить разработку и модульное тестирование в масштабе с помощью нескольких разработчиков, мы предоставили специальный стиль написания шаблонов, полностью разделив шаблон на основе его файла параметров. Это минимальный набор из одного шаблона к правилу — все они sanctioned все свойства ресурсов как сложный объект в файле параметров, и мы можем обеспечить строгую проверку схемы в файле на основе схемы ресурса, которая уже опубликована платформой. Этот подход четко отделяет шаблон и параметры. Файл параметров по сути является представлением ресурсов RESTFUL при вызове `Get-AzResource` или `az resource show` .

- Template.jsна

```json
"resources": [{
        "condition": "[bool(equals(variables('resourceType'),'Microsoft.Authorization/policyDefinitions'))]",
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "[variables('policyDefinitions').name]",
        "apiVersion": "[variables('apiversion')[variables('resourceType')]]",
        "location": "northeurope",
        "properties": "[variables('policyDefinitions').Properties]"
    }],
```

Доступен [универсальный шаблон с многоресурсной](https://github.com/uday31in/AzOps/blob/main/template/template.json) версией, который позволяет гарантировать, что исправления ошибок включены в последнюю версию API.

- Template.parameters.jsна

```json
{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "input": {
            "value": {
                <copy-paste-value-of-powershell/cli-output-here>
            }
        }
    }
}
```

Извлеките определения ресурсов, вызвав `Get-AzResource` функцию и предоставив ему `resourceId` существующий ресурс.

```powershell
# Replace the resourceId in the command below before executing it

Get-AzResource -ResourceId '/providers/Microsoft.Management/managementGroups/contoso/providers/Microsoft.Authorization/policyDefinitions/DINE-Diagnostics-ActivityLog' | ConvertTo-Json -depth 100
```

<!-- docsTest:ignore "Policy definition" -->

При принятии решений по проектированию следует учитывать следующие преимущества и недостатки.

- Преимущества.

  - Больше не писать шаблоны диспетчер ресурсов. Последний шаблон диспетчер ресурсов был записан.
  - Ресурсы экспортируются единообразно на протяжении всего жизненного цикла независимо от того, как они создаются и обновляются с помощью портал Azure, Azure CLI, PowerShell или сторонних средств.
  - Проще обнаружить смещение между конфигурацией, хранящейся в Git, и текущей конфигурацией; Мы по сути сравниваем два документа JSON.
  - Можно управлять неявными зависимостями между простыми ресурсами на стороне клиента и на стороне сервера. В Azure не предусмотрено много циклических зависимостей между ресурсами, и можно работать с неявными зависимостями на основе уже опубликованных схем ресурсов. Например, виртуальная машина может зависеть от виртуальных коммутаторов уровня ядра, но не наоборот (например, определение политики — > назначение политики > назначение ролей — > исправление или виртуальная сеть — > ExpressRoute или Key Vault — > SQL Azure).

- Недостатки.

  При создании сложного объекта файла параметров можно потерять аналитику. Это одноразовое действие можно уменьшить, извлекая базовое определение текущего ресурса или сначала создав ресурс на портале. Вы не можете отслеживаниь развертываний шаблонов с помощью атрибутов Azure-Partner-site-Usage. Это не относится к масштабу предприятия.

Нет ничего плохого с текущими шаблонами диспетчер ресурсов, используемыми для развертывания ресурсов, и не требуется переписывать их. Конвейер продолжит разворачивать их и обнаружит отклонение конфигурации. Мы не сможем согласовать их, так как платформа не позволяет экспортировать шаблоны развертывания для выполнения этого действия. Из-за этих параметров все шаблоны, отправленные в вытягивание, должны соответствовать принципу, который экспортируется.

Прочитайте следующий раздел перед отправкой запроса на вытягивание, но не отправляйте запрос на вытягивание с помощью шаблонов и файлов параметров, чтобы развернуть ресурсы, такие как Azure Key Vault или Azure Monitor журналы, не заключив их в политику.

## <a name="contributing-to-policy-definitions-policy-assignments-and-role-definitions-and-assignments-for-contoso-implementation"></a>Вклад в определения политик, назначения политик, определения ролей и назначения для реализации contoso

Когда параметр соответствует стандартам, упомянутым в разделе выше и готов к Вашему ресурсу, определите, следует ли развертывать ресурс в области группы управления или в области действия подписки (подключение или подписка на управление). Хотя конвейер может развертывать шаблоны в любой из четырех областей, он не будет развернут на уровне группы ресурсов как часть шаблона целевой зоны. Нижний отрезок — это шаблон развертывания уровня подписки, заключенный в определение политики.

- Рекомендуется
  - Если у вас есть ресурсы для развертывания внутри целевой зоны, заключите их в `DeployIfNotExists` политики. назначение для этого параметра должно находиться в области группы управления.
  - В идеале политика должна иметь область существования, ориентированную на область действия подписки, если число развертываний ресурсов в основной зоне равно одному (например, виртуальной сети в целевой зоне или виртуальном концентраторе для нового региона Azure).
  - В идеале все определения политик должны создаваться в корне, определенном в шаблоне сквозного шаблона.

- Не отправляйте запрос на включение внесенных изменений с шаблоном и файлом параметров для развертывания ресурсов (например, хранилища ключей) или создания собственной иерархии групп управления за пределами описанных в сквозной зоне.

Пример:

```json
{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "input": {
      "value": {
        "Name": "Tailspin",
        "DisplayName": "Tailspin",
        "ParentId": "/providers/Microsoft.Management/managementGroups/3fc1081d-6105-4e19-b60c-1ec1252cf560",
        "Children": [
          {
            "Id": "/providers/Microsoft.Management/managementGroups/Tailspin-bu1",
            "Name": "Tailspin-bu1",
            "DisplayName": "Tailspin-bu1",
            "properties": {
              "policyAssignments" :[
              ],
              "roleAssignments": [
              ]
            }
          }
        ],
        "properties": {
          "policyDefinitions": [
                <copy-paste of Json representation of the resource>
          ],
          "policyAssignments" :[
          ],
          "roleDefinitions": [
          ],
          "roleAssignments": [
          ]
        }
      }
    }
  }
}
```

## <a name="contributing-new-azure-policy-definitions-for-contoso-implementation"></a>Добавление новых определений политик Azure для реализации contoso

Чтобы внести изменения в определения политик, которые соответствуют архитектуре корпоративного масштаба, используйте следующие средства и рекомендации.

[Расширение политики Azure для Visual Studio](https://docs.microsoft.com/azure/governance/policy/how-to/extension-for-vscode)

Используйте это расширение для поиска псевдонимов политик и просмотра ресурсов и политик.

## <a name="explore-available-resource-properties-with-corresponding-policy-aliases"></a>Просмотр доступных свойств ресурсов с соответствующими псевдонимами политик

Для Azure PowerShell:

```powershell
# List all available providers
Get-AzPolicyAlias -ListAvailable

# Get aliases for a specific resource provider
(Get-AzPolicyAlias -NamespaceMatch 'Microsoft.Network').Aliases.Name
```

При использовании Azure CLI выполните следующее:

```bash
# List all available providers

az provider list --query [*].namespace

# Get aliases for a specific resource provider

az provider show --namespace Microsoft.Network --expand "resourceTypes/aliases" --query "resourceTypes[].aliases[].name"
```

## <a name="contributing-new-azure-policy-assignments"></a>Добавление новых назначений политик Azure

При назначении всех политик необходимо учитывать следующее.

- Конкретные сведения о намерении назначения. Принадлежит ли она к двум подпискам (подключение и управление) или к группам управления?
- Что такое распределение ресурсов в подписках?
- Какие регионы используются, а также несколько регионов, разрешенных и используемых для каждой подписки?
- Какие типы ресурсов разрешены и могут не влиять на назначение политики?
- Для нескольких политик, обслуживающих одну или ту же цель, можно объединить их в инициативу политики?
- Какова обоснование действующей политики? Следует ли вместо этого преобразовывать политику аудита в принудительную?
- Для `DeployIfNotExists` политик вы должны использовать принцип наименьших привилегий для определения управления доступом на основе ролей?

<!-- cSpell:ignore don'ts -->

## <a name="code-of-conduct"></a>Правила поведения

Мы работаем над созданием надежной и продуктивной совместной работы с нашим сообществом. Мы слышали вслух и ясно. Мы работаем над набором принципов и руководств с помощью DOS и запретов.
