---
title: Управление и мониторинг
description: Узнайте, как с помощью централизованного управления и мониторинга на уровне платформы обслуживать Microsoft Azureную корпоративную организацию.
author: BrianBlanchard
ms.author: brblanch
ms.date: 06/15/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: 98f0cfccdaec32d00f3097f2f6b79f124c913aa6
ms.sourcegitcommit: 4bbd5f6444d033ef1f38dc6f3bad7b914a82f68f
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/08/2020
ms.locfileid: "86128231"
---
# <a name="management-and-monitoring"></a>Управление и мониторинг

## <a name="planning-platform-management-and-monitoring"></a>Планирование управления платформой и мониторинга

В этом разделе рассматривается работа с Microsoft Azure корпоративной организацией с централизованным управлением и мониторингом на уровне платформы. В частности, он будет представлять ключевые рекомендации для центральных рабочих групп, чтобы поддерживать операционную видимость в масштабной платформе Azure.

![Управление и мониторинг](./media/management-and-monitoring.png)

_Рис. 1. Управление платформой и мониторинг._

<!-- cSpell:ignore syslogs SIEM -->

**Рекомендации по проектированию:**

- Используйте рабочую область Azure Monitor Log Analytics в качестве административной границы.

- Мониторинг платформы на основе приложений, охватывающий как активные, так и холодные пути телеметрии для метрик и журналов соответственно:

  - Метрики операционной системы (счетчики производительности и пользовательские метрики)

  - Журналы операционной системы (службы IIS (IIS), трассировка событий для Windows и syslogs)

  - События работоспособности ресурсов

- Ведение журнала аудита безопасности и достижение горизонтальной линзы по безопасности во всей Организации Azure.

  - Потенциальная интеграция с локальными системами управления сведениями о безопасности и событиями (SIEM), такими как ServiceNow или ArcSight

  - Журналы действий Azure

  - Отчеты аудита Azure AD

  - Службы диагностики Azure, журналы и метрики; Azure Key Vault события аудита; журналы потоков группы безопасности сети (NSG); и журналы событий

  - Azure Monitor, наблюдатель за сетями, центр безопасности и Sentinel Azure

- Пороговые значения для хранения данных Azure и требования к архивированию:

  - Срок хранения по умолчанию для журналов Azure Monitor составляет 30 дней и не более двух лет.

  - Срок хранения по умолчанию для отчетов Azure Active Directory (Premium) составляет 30 дней.

  - Срок хранения по умолчанию для службы диагностики Azure составляет 90 дней.

- Эксплуатационные требования:

  - Рабочие панели с собственными средствами, такими как журналы Azure Monitor или сторонние средства

  - Управление привилегированными действиями с помощью централизованных ролей

  - [Управляемые удостоверения для ресурсов Azure](https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview) для доступа к службам Azure

  - Блокировки ресурсов для защиты редактирования и удаления ресурсов

**Рекомендации по проектированию:**

- Используйте одну [рабочую область журналов мониторинга](https://docs.microsoft.com/azure/azure-monitor/platform/design-logs-deployment) для централизованного управления платформами, за исключением случаев, когда управление доступом на основе РОЛЕЙ (RBAC) и требования к независимости данных требуют наличия отдельных рабочих областей. Централизованное ведение журнала имеет важное значение для обеспечения видимости, необходимой командам Operations Management. Централизованное ведение журнала содержит отчеты об управлении изменениями, работоспособности служб, конфигурации и других аспектах работы ИТ. Конвергенция централизованной модели рабочей области сокращает усилия администратора и возможность пропуска наблюдаемых областей.

В контексте архитектуры корпоративного уровня централизованное ведение журнала в основном связано с операциями платформы. Это не исключает использования той же рабочей области для ведения журнала приложений на основе виртуальной машины. Если Рабочая область настроена в режиме управления доступом на основе ресурсов, детализированный RBAC применяется, чтобы группы приложений имели доступ к журналам только из своих ресурсов. В этой модели группы приложений получают преимущества от использования существующей инфраструктуры платформы, уменьшая издержки на управление. Для любых нерасчетных ресурсов (например, веб-приложений или баз данных Azure Cosmos DB) группы приложений могут использовать собственные рабочие области Log Analytics и настраивать диагностику и метрики, которые будут маршрутизироваться здесь.

<!-- docsTest:ignore WORM -->

- Экспорт журналов в службу хранилища Azure, если требования к хранению журнала превышают два года. Используйте неизменяемое хранилище с ЧЕРВем WORM (однократная запись, считывание из множества), чтобы сделать данные неизменными и неизменяемыми в течение заданного пользователем интервала.

- Используйте политику Azure для отчетов об управлении доступом и соответствии требованиям. Это дает возможность применять параметры всей Организации для обеспечения согласованности политик и быстрого обнаружения нарушений. Дополнительные сведения см. в статье об [эффектах политики Azure](https://docs.microsoft.com/azure/governance/policy/concepts/effects).

- Отслеживание смещения конфигурации в гостевой виртуальной машине (ВМ) с помощью политики Azure. Включение функций аудита [настройки гостя](https://docs.microsoft.com/azure/governance/policy/concepts/guest-configuration) с помощью политики помогает рабочим нагрузкам группы приложений немедленно использовать возможности функций с минимальными усилиями.

- Используйте [Управление обновлениями в службе автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-update-management) в качестве долгосрочного механизма исправления для виртуальных машин Windows и Linux. Применение конфигураций управления обновлениями с помощью политики гарантирует, что все виртуальные машины включены в регимен управления исправлениями, предоставляют группам приложений возможность управлять развертыванием исправлений для своих виртуальных машин и предоставляет возможности по управлению и обеспечению централизованной ИТ-группы на всех виртуальных машинах.

- Используйте наблюдатель за сетями Azure для упреждающего мониторинга потоков трафика с помощью [наблюдателя за сетями, NSG журналы потоков версии 2](https://docs.microsoft.com/azure/network-watcher/network-watcher-nsg-flow-logging-overview). [Аналитика трафика](https://docs.microsoft.com/azure/network-watcher/traffic-analytics) анализирует журналы потоков NSG для сбора подробных сведений о IP-трафике в виртуальной сети и предоставляет важную информацию для эффективного управления и мониторинга. Аналитика трафика предоставить такие сведения, как большинство взаимодействующих узлов и протоколов приложений, большинство пар узлов, разрешенных или заблокированных трафика, входящего и исходящего трафика, открытые порты Интернета, большинство правил блокировки, распределение трафика в центре обработки данных Azure, виртуальная сеть, подсети или фальшивые сети.

- Используйте блокировки ресурсов, чтобы предотвратить случайное удаление критических общих служб.

- Используйте [политику Deny](https://docs.microsoft.com/azure/governance/policy/concepts/effects#deny) , чтобы дополнять назначения RBAC в Azure AD. Политики запрета используются для предотвращения развертывания и настройки ресурсов, которые не соответствуют определенным стандартам, предотвращая отправку запроса поставщику ресурсов. Сочетание политик запретов и назначений RBAC обеспечивает соблюдение соответствующих защитных шин для обеспечения возможности развертывания и **настройки ресурсов и ресурсов** **, которые они** могут развертывать и настраивать.

- Включите события работоспособности [службы](https://docs.microsoft.com/azure/service-health/service-health-overview) и [ресурса](https://docs.microsoft.com/azure/service-health/resource-health-overview) в рамках общего решения для мониторинга платформы. Отслеживание работоспособности службы и ресурсов с точки зрения платформы является важным компонентом управления ресурсами в Azure.

- Не отправляйте необработанные записи журнала обратно в локальные системы мониторинга. Вместо этого применяйте принцип, в котором *данные в Azure остаются в Azure*. Если требуется локальная интеграция SIEM, [отправьте критические оповещения](https://docs.microsoft.com/azure/security-center/continuous-export) вместо журналов.

## <a name="planning-for-app-management-and-monitoring"></a>Планирование управления приложениями и мониторинга

Чтобы расширить предыдущий раздел, в этом разделе будет рассмотрено Федеративное управление и мониторинг рабочих нагрузок приложений, а также объясняется, как группы приложений могут поддерживать эти рабочие нагрузки.

**Рекомендации по проектированию:**

- Мониторинг приложений может использовать выделенные рабочие области Log Analytics.

- Для приложений, развернутых на виртуальных машинах, журналы должны храниться централизованно в выделенной рабочей области Log Analytics с точки зрения платформы, а группы приложений могут получить доступ к журналам, находящихся на RBAC, на их приложениях или виртуальных машинах.

- Производительность приложений и наблюдение за работоспособностью для ресурсов "инфраструктура как услуга" (IaaS) и "платформа как услуга" (PaaS)

- Агрегирование данных для всех компонентов приложения

- [Моделирование работоспособности и эксплуатация](https://docs.microsoft.com/azure/cloud-adoption-framework/manage/monitor/cloud-models-monitor-overview):

  - Измерение работоспособности рабочей нагрузки и ее подсистем
  - Модель светофора для представления работоспособности
  - Реагирование на сбои в компонентах приложений

**Рекомендации по проектированию:**

- Используйте централизованную рабочую область Log Analytics Azure Monitor для сбора журналов и метрик из ресурсов приложений IaaS и PaaS и [управления доступом к журналам с помощью RBAC](https://docs.microsoft.com/azure/azure-monitor/platform/design-logs-deployment#access-control-overview).

- Используйте [метрики Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-metrics) для анализа с учетом времени. Метрики в Azure Monitor хранятся в базе данных временных рядов, оптимизированной для анализа данных с отметкой времени. Это делает метрики более подходящими для оповещений и быстро выявлять проблемы. Они могут сообщить вам, как работает система, но обычно их необходимо объединить с журналами, чтобы определить основную причину проблем.

- Используйте [журналы Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/data-platform-logs) для получения ценных сведений и отчетов. Журналы содержат различные типы данных, организованные в записи с разными наборами свойств, и они полезны для анализа сложных данных из различных источников, таких как данные о производительности, события и трассировки.

- При необходимости используйте общие учетные записи хранения в целевой зоне для хранилища журналов расширения диагностики Azure.

- Используйте [оповещения Azure Monitor](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-overview) для создания операционных оповещений. Azure Monitor оповещения объединяют оповещения для метрик и журналов и используют такие функции, как действие и интеллектуальные группы, для расширенного управления и исправления.
