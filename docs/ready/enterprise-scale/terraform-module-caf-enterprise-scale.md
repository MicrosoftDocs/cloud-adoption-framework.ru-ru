---
title: Модуль terraform для инфраструктуры внедрения в облаке корпоративный масштаб
description: Узнайте, как использовать модуль terraform для инфраструктуры внедрения облаков в масштабах предприятия.
author: krowlandson
ms.author: brblanch
ms.date: 02/03/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.custom: think-tank
ms.openlocfilehash: 6d75a3d3c0750300bf365df9447f17ee6238c3ae
ms.sourcegitcommit: 36e85ac734b184de3f29884b744ea74c81ccc72b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2021
ms.locfileid: "103443023"
---
# <a name="terraform-module-for-cloud-adoption-framework-enterprise-scale"></a>Модуль terraform для инфраструктуры внедрения в облаке корпоративный масштаб

Azure предоставляет собственные службы для развертывания целевых зон. Другие сторонние средства также могут помочь в этом. Одним из таких средств, которые клиенты и партнеры часто используют для развертывания terraform зон, является HashiCorp.

В этом разделе показано, как использовать официальный [модуль terraform для инфраструктуры облачного внедрения](https://registry.terraform.io/modules/Azure/caf-enterprise-scale/azurerm/latest) , чтобы ускорить процесс управления целевыми зонами Azure с помощью terraform.

## <a name="purpose-of-enterprise-scale-landing-zones"></a>Назначение корпоративных зон корпоративного уровня

[Модуль terraform для инфраструктуры внедрения облачных решений корпоративного уровня](https://registry.terraform.io/modules/Azure/caf-enterprise-scale/azurerm/latest) предоставляет упрощенный подход к развертыванию иерархии [группы управления и организации подписки](./management-group-and-subscription-organization.md) из [эталонной архитектуры](./architecture.md#high-level-architecture) корпоративного масштаба с помощью terraform, что позволяет:

1. Иерархия управляемых ресурсов для организации *подписки* с помощью *групп управления*.
1. Масштабируемая модель безопасности и управления, использующая *политику Azure* и *Управление доступом (IAM)*, с обширной библиотекой пользовательских определений, готовых к назначению.
1. Применение параметров безопасности и управления для *подписок* через наследование *группы управления* .

Упаковывая эти возможности в один модуль terraform, стало проще создавать и обеспечивать согласованность на платформе Azure при масштабе работы.

## <a name="use-standard-modules"></a>Использовать стандартные модули

Повторное использование компонентов является фундаментальным принципом инфраструктуры как кода. Модули Instrumental в определении стандартов и согласованности между развертыванием ресурсов в средах и между ними. Этот модуль опубликован в официальном [реестре terraform](https://registry.terraform.io/modules/Azure) и проверяется с помощью HashiCorp.

## <a name="architecture-diagram"></a>Диаграмма архитектуры

[Модуль terraform для инфраструктуры внедрения в облаке корпоративный масштаб](https://registry.terraform.io/modules/Azure/caf-enterprise-scale/azurerm/latest) развертывает следующие компоненты из [эталонной архитектуры](./architecture.md#high-level-architecture)корпоративного масштаба:

![Общие сведения о ресурсах, развернутых модулем terraform для инфраструктуры внедрения в облаке корпоративный масштаб ( ](media/terraform-caf-enterprise-scale-overview.png)
 *рис. 1). Обзор ресурсов, развернутых модулем terraform для корпоративного масштабирования инфраструктуры внедрения в облаке.*

## <a name="capabilities"></a>Характеристики

Развернутые компоненты и их назначение включают следующее.

| Компонент | Обязательство |
|---|---|
| Группы управления | Основные группы управления предоставляют иерархию ресурсов для эталонной архитектуры корпоративного масштаба: <li> Необязательные группы управления для демонстрационных целевых зон (SAP, Corp и Online) <li> Необязательные группы управления для пользовательских целевых зон (определение собственных) |
| Политика Azure | Политика Azure для обеспечения безопасности и управления на платформе: <li> Определения настраиваемых политик и определения наборов политик, охватывающие общие шаблоны управления, не охваченные встроенными политиками. <li> Создание и назначение политик в любой области иерархии групп управления для обеспечения соответствия требованиям посредством наследования <li> Расширение с помощью собственных пользовательских определений в соответствии с требованиями к безопасности и управлению </li> |
| Параметры управления доступом (IAM) | Создание и назначение ролей в иерархии ресурсов для обеспечения соответствия политикам RBAC: <li> Создание пользовательских определений ролей для обеспечения принципа минимальных привилегий <li> Создайте назначения ролей в правой области, чтобы обеспечить наличие нужных разрешений для групп платформы и приложений. |
| Подписки | Подписки назначаются группам управления: <li> Включает наследование политик и RBAC <li> Обеспечивает соответствие требованиям к безопасности и управлению платформой |

## <a name="customize-and-deploy"></a>Настройка и развертывание

Чтобы упростить начало работы с этим модулем, он был опубликован в [реестре terraform](https://registry.terraform.io/modules/Azure). Это позволяет использовать его непосредственно из реестра в качестве повторно используемого модуля и может получить преимущества от обновлений по мере их выпуска.

Для этого модуля доступны следующие зависимости:

- Terraform (*рекомендуемая версия 0.13.2 и более поздние версии*)
- Поставщик AzureRM (*рекомендуемая версия 2.34.0 и более поздние версии*)

> [!IMPORTANT]
> Существуют известные проблемы с некоторыми сочетаниями версий поставщика terraform и AzureRM. Некоторые из них возникают из-за новых ошибок, которые были устранены с момента исправления, а другие — временные ошибки, которые обычно могут быть решены путем повторного выполнения развертывания. Обычно рекомендуется закреплять определенные версии и тщательно проверять их перед обновлением. По мере выпуска каждой новой версии модуля проект группы проекта должен переосновывать модуль, чтобы обеспечить совместимость с последними версиями поставщика terraform и AzureRM.

### <a name="simple-example"></a>Простой пример

Ниже приведена простая начальная конфигурация для `main.tf` корневого модуля.

> [!TIP]
> Хотя у модуля есть только одна обязательная переменная `root_parent_id` , мы рекомендуем также настроить `root_id` . При изменении `root_id` значения будет инициировано полное повторное развертывание всех ресурсов, управляемых модулем, включая подчиненные зависимости.

```hcl

# We strongly recommend using the required_providers block to set the
# Azure Provider source and version being used.

terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = ">= 2.46.1"
    }
  }
}

provider "azurerm" {
  features {}
}

# You can use the azurerm_client_config data resource to dynamically
# extract the current Tenant ID from your connection settings.

data "azurerm_client_config" "current" {
}

# Call the caf-enterprise-scale module directly from the Terraform Registry
# pinning to the latest version

module "enterprise_scale" {
  source  = "Azure/caf-enterprise-scale/azurerm"
  version = "0.0.8"

  root_parent_id = data.azurerm_client_config.current.tenant_id
  root_id        = "demo"

}
```

<!-- docutune:enable -->

В этом примере кода будет выполнено развертывание минимальной рекомендованной [группы управления и организации подписки](./management-group-and-subscription-organization.md) из эталонной архитектуры корпоративного масштаба. После этого можно начать настройку развертывания, когда вы настроите и заработаете.

> [!TIP]
> Если вы не знакомы с terraform, ознакомьтесь с этим [руководством по HashiCorp](https://learn.hashicorp.com/tutorials/terraform/install-cli?in=terraform/azure-get-started), посвященному установке и использованию terraform, а также [руководствам для поставщиков AzureRM](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs#authenticating-to-azure) , чтобы получить сведения о настройке поставщика и проверке подлинности в Azure.

## <a name="next-steps"></a>Дальнейшие действия

Модуль terraform для инфраструктуры внедрения в облаке корпоративный масштаб обеспечивает ускоренный путь для создания корпоративных зон корпоративного уровня. Он также предоставляет большую гибкость в развертывании и настройке развертывания, в то же самое упрощенный подход к управлению конфигурацией каждой целевой зоны.

Чтобы узнать больше, ознакомьтесь с модулем в реестре terraform и изучите [вики-сайт GitHub](https://github.com/Azure/terraform-azurerm-caf-enterprise-scale/wiki) , где мы будем публиковать дополнительные примеры и учебники, в которых описано, как настроить развертывание.

> [!div class="nextstepaction"]
> [Проверка модуля в реестре terraform](https://registry.terraform.io/modules/Azure/caf-enterprise-scale/azurerm/latest)
