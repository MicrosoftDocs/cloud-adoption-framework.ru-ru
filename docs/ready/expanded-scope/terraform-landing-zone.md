---
title: Использование terraform для создания целевых зон
titleSuffix: Microsoft Cloud Adoption Framework for Azure
description: Узнайте, как использовать terraform для создания целевых зон.
author: arnaudlh
ms.author: arnaul
ms.date: 10/16/2019
ms.topic: guide
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: 51751ab0033505e34c02c17db363bc985b83e44d
ms.sourcegitcommit: e0a783dac15bc4c41a2f4ae48e1e89bc2dc272b0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/30/2019
ms.locfileid: "73058159"
---
# <a name="use-terraform-to-build-your-landing-zones"></a>Использование terraform для создания целевых зон

Azure предоставляет собственные службы для развертывания целевых зон. Другие сторонние средства также могут помочь в этом. Одним из таких средств, которые клиенты и партнеры часто используют для развертывания начальных зон, является Hashicorp terraform. В этом разделе показано, как использовать целевую зону прототипа для развертывания основных возможностей ведения журнала, учета и безопасности для подписки Azure.

## <a name="purpose-of-the-landing-zone"></a>Назначение целевой зоны

Базовая Целевая зона инфраструктуры внедрения в облаке для terraform имеет ограниченный набор обязанностей и функций для обеспечения ведения журналов, учета и безопасности. Мы разработали эту целевую зону. Используйте стандартные компоненты, известные как terraform Modules, чтобы обеспечить согласованность между ресурсами, развернутыми в среде.

## <a name="using-standard-modules"></a>Использование стандартных модулей

Повторное использование компонентов является фундаментальным принципом инфраструктуры как кода. Модули Instrumental в определении стандартов и согласованности между развертыванием ресурсов в средах и между ними. Набор модулей, используемых для развертывания этой первой целевой зоны, доступен в официальном [реестре terraform](https://registry.terraform.io/search?q=aztfmod).

## <a name="architecture-diagram"></a>Схема архитектуры

Первая целевая зона развертывает следующие компоненты в вашей подписке:

![Базовая Главная зона с использованием terraform](../../_images/ready/foundations-terraform-landingzone.png)

## <a name="capabilities"></a>Возможности

Развернутые компоненты и их назначение включают следующее.

| Компонент | Несет |
|---------|---------|
| Группы ресурсов | Основные группы ресурсов, необходимые для фундамента |
| Ведение журнала действий | Аудит всех действий и архивации подписок: </br> — Учетная запись хранения </br> — Концентраторы событий |  
| Ведение журнала диагностики | Все журналы операций хранятся в течение указанного числа дней: </br> — Учетная запись хранения </br> — Концентраторы событий |
| Анализ журналов | Хранит все журналы операций </br> Развертывание общих решений для глубокой проверки приложений: </br> -Нетворкмониторинг </br> -Адассессмент </br> -Адрепликатион </br> -Аженсеалсассессмент </br> -Днсаналитикс </br> -Кэйваултаналитикс
| Центр безопасности | Метрики санации безопасности и оповещения, отправленные по электронной почте и номеру телефона |

## <a name="use-this-blueprint"></a>Использование этой схемы

Перед использованием целевой зоны Cloud TAP Framework Foundation ознакомьтесь со следующими положениями, решениями и рекомендациями по реализации.

## <a name="assumptions"></a>Предположения

При определении первоначальной целевой зоны были учтены следующие предположения или ограничения. Если эти предположения совпадают с вашими ограничениями, вы можете использовать схему для создания первой зоны размещения. Схему также можно расширить, чтобы создать схему зоны размещения, которая соответствует вашим уникальным ограничениям.

- **Ограничения подписки:** Эта деятельность по внедрению вряд ли будет превышать [лимиты подписки](https://docs.microsoft.com/azure/azure-subscription-service-limits). Два общих индикатора — это превышение 25 000 виртуальных машин или 10 000 виртуальных ЦП.
- **Соответствие требованиям:** Для этой целевой зоны требования к соответствию сторонних производителей не требуются.
- **Сложность архитектуры:** Сложность архитектуры не требует дополнительных производственных подписок.
- **Общие службы:** В Azure нет существующих общих служб, которые нуждаются в том, что эта подписка должна рассматриваться как периферийная в архитектуре "звезда".

Если эти предположения соответствуют текущему окружению, то этот проект может быть хорошим способом начать создание целевой зоны.

## <a name="design-decisions"></a>Решения по проектированию

Следующие решения представлены в целевой зоне terraform:

| Компонент | Решения | Альтернативные подходы |
| --- | --- | --- |
|Ведение журналов и мониторинг | Будет использоваться Рабочая область Log Analytics Azure Monitor. Будет подготовлена учетная запись хранения диагностики, а также концентратор событий. |         |
|Network | Н/д — сеть будет реализована в другой целевой зоне. |[Решения по выбору сетей](../considerations/network-decisions.md) |
|Удостоверение | Предполагается, что подписка уже связана с экземпляром Azure Active Directory. | [Рекомендации по управлению идентификаторами](https://docs.microsoft.com/azure/security/azure-security-identity-management-best-practices) |
| Политика | В настоящее время эта Целевая зона предполагает, что политики Azure не применяются. | |
|Разработка подписки | Недоступно — предназначено для одной производственной подписки. | [Масштабирование с помощью подписок](../considerations/scaling-subscriptions.md) |
| Группы управления | Недоступно — предназначено для одной производственной подписки. |[Масштабирование с помощью подписок](../considerations/scaling-subscriptions.md) |
| Группы ресурсов | Недоступно — предназначено для одной производственной подписки. | [Масштабирование с помощью подписок](../considerations/scaling-subscriptions.md) |
| Данные | Н/Д | [Выберите правильный вариант SQL Server в Azure](https://docs.microsoft.com/azure/sql-database/sql-database-paas-vs-sql-server-iaas) и [руководстве по хранилищу данных Azure](https://docs.microsoft.com/azure/architecture/guide/technology-choices/data-store-overview) |
|Storage|Н/Д|[Рекомендации по выбору службы хранилища Azure](../considerations/storage-guidance.md) |
| Стандарты именования | При создании среды будет также создан уникальный префикс. Для ресурсов, которым требуется глобально уникальное имя (например, учетные записи хранения), используйте этот префикс. Пользовательское имя будет добавлено с помощью случайного суффикса. Использование тегов обязательно, как описано в таблице ниже. | [Рекомендации Azure по добавлению тегов и стандартам именования](../considerations/naming-and-tagging.md) |
| Управление затратами | Н/Д | [Отслеживание затрат](../azure-best-practices/track-costs.md) |
| Compute | Н/Д | [Варианты вычислений](../considerations/compute-decisions.md) |

### <a name="tagging-standards"></a>Стандарты тегов

Следующий набор минимальных тегов должен присутствовать во всех ресурсах и группах ресурсов:

| Имя тега | Описание | Ключ | Пример значения |
|--|--|--|--|
| Подразделение | Подразделение высшего уровня компании, которому принадлежит подписка или рабочая нагрузка, к которой принадлежит ресурс. | BusinessUnit | Финансы, маркетинг, {Product Name}, CORP, SHARed |
| Центр затрат | Центр затрат на учет, связанный с этим ресурсом.| CostCenter | NUMBER |
| Аварийное восстановление | Критически важное для бизнеса приложение, рабочая нагрузка или служба. | ПРОГРАММОЙ | С ПОДДЕРЖКОЙ АВАРИЙНОГО ВОССТАНОВЛЕНИЯ, БЕЗ АВАРИЙНОГО ВОССТАНОВЛЕНИЯ |
| Среда | Среда развертывания приложения, рабочей нагрузки или службы. |  Переменной | Произв., dev, QA, этап, тестирование, обучение |
| Имя владельца | Владелец приложения, рабочей нагрузки или службы.| Владелец. | email |
| DeploymentType | Определяет, как обслуживаются ресурсы. | deploymentType | Вручную, terraform |
| Версия | Версия развернутой схемы | версия | Версия 0,1 |
| Имя приложения | Имя связанного приложения, службы или рабочей нагрузки, связанной с ресурсом. | ApplicationName | "имя приложения" |

## <a name="customize-and-deploy-your-first-landing-zone"></a>Настройка и развертывание первой целевой зоны

Вы можете [клонировать целевую зону terraform Foundation](https://github.com/microsoft/CloudAdoptionFramework/tree/master/ready). Начать работу с целевой зоной легко, изменив переменные terraform. В нашем примере мы используем **blueprint_foundations. песочницу. Auto. тфварс**, поэтому terraform автоматически установит значения в этом файле.

Рассмотрим различные разделы переменных.

В этом первом объекте мы создаем две группы ресурсов в `southeastasia` регионе с именами "-Hub-Core-SEC" и "-Hub-Core-SEC" вместе с префиксом, добавленным во время выполнения.

```hcl
resource_groups_hub = {
    HUB-CORE-SEC    = {
        name = "-hub-core-sec"
        location = "southeastasia"
    }
    HUB-OPERATIONS  = {
        name = "-hub-operations"
        location = "southeastasia"
    }
}
```

Далее мы указываем регионы, в которых можно задать основы. Здесь `southeastasia` будет использоваться для развертывания всех ресурсов.

```hcl
location_map = {
    region1   = "southeastasia"
    region2   = "eastasia"
}
```

Затем мы указываем срок хранения журналов операций и журналов подписок Azure. Эти данные будут храниться в отдельных учетных записях хранения и концентраторе событий, имена которых создаются случайным образом, так как они должны быть уникальными.

```hcl
azure_activity_logs_retention = 365
azure_diagnostics_logs_retention = 60
```

В tags_hub мы указываем минимальный набор тегов, которые будут применяться ко всем создаваемым ресурсам.

```hcl
tags_hub = {
    environment     = "DEV"
    owner           = "Arnaud"
    deploymentType  = "Terraform"
    costCenter      = "65182"
    BusinessUnit    = "SHARED"
    DR              = "NON-DR-ENABLED"
}
```

Затем мы указываем имя log Analytics и набор решений, которые будут анализировать развертывание. Здесь мы сохранили мониторинг сети, Оценка AD и репликацию, Аналитика DNS и Аналитика Key Vault.

```hcl

analytics_workspace_name = "lalogs"

solution_plan_map = {
    NetworkMonitoring = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/NetworkMonitoring"
    },
    ADAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADAssessment"
    },
    ADReplication = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADReplication"
    },
    AgentHealthAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/AgentHealthAssessment"
    },
    DnsAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/DnsAnalytics"
    },
    KeyVaultAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/KeyVaultAnalytics"
    }
}

```

Далее мы настроили параметры оповещений для центра безопасности Azure.

```hcl
# Azure Security Center Configuration
security_center = {
    contact_email   = "joe@contoso.com"
    contact_phone   = "+6500000000"
}
```

## <a name="getting-started"></a>Начало работы

После просмотра конфигурации можно развернуть конфигурацию, как при развертывании среды terraform. Однако рекомендуется использовать Rover, который представляет собой контейнер DOCKER, позволяющий развертывать Windows, Linux или MacOS. Вы можете приступить к работе с [репозиторием Rover GitHub](https://github.com/aztfmod/rover).

## <a name="next-steps"></a>Дальнейшие действия

Базовая зона базовой зоны размещает фундамент для сложной среды в составной манере. Этот выпуск предоставляет набор очень простых возможностей, которые можно расширить с помощью:

- Добавление в проект других модулей.
- Размещение дополнительных основных зон поверх нее.

Зоны размещения по слоям — это рекомендуемая методика для разделения систем, управления версиями каждого используемого компонента и быстрого внедрения инноваций и стабильности для развертывания инфраструктуры как кода.

В будущих эталонных архитектурах эта концепция будет продемонстрирована для топологии "звезда".

> [!div class="nextstepaction"]
> [Ознакомьтесь с примером целевой зоны Foundation с помощью terraform](https://github.com/microsoft/CloudAdoptionFramework/tree/master/ready)
