---
title: Использование terraform для создания целевых зон
description: Узнайте, как использовать terraform для создания целевых зон.
author: arnaudlh
ms.author: arnaul
ms.date: 02/25/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: 8eee7eeaf2406a94ee703054ed5f1b9e369bf5a2
ms.sourcegitcommit: 9a84c2dfa4c3859fd7d5b1e06bbb8549ff6967fa
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/21/2020
ms.locfileid: "83755646"
---
<!-- cSpell:ignore arnaudlh arnaul Arnaud vCPUs eastasia southeastasia lalogs tfvars -->

# <a name="use-terraform-to-build-your-landing-zones"></a>Использование terraform для создания целевых зон

Azure предоставляет собственные службы для развертывания целевых зон. Другие сторонние средства также могут помочь в этом. Одним из таких средств, которые клиенты и партнеры часто используют для развертывания узловых зон, является HashiCorp terraform. В этом разделе показано, как использовать пример целевой зоны для развертывания базовых функций управления, учета и обеспечения безопасности для подписки Azure.

## <a name="purpose-of-the-landing-zone"></a>Назначение целевой зоны

Главная зона инфраструктуры внедрения в облаке для terraform предоставляет функции для обеспечения ведения журнала, учета и безопасности. Эта Целевая зона использует стандартные компоненты, известные как terraform Modules, для обеспечения согласованности между ресурсами, развернутыми в среде.

## <a name="use-standard-modules"></a>Использовать стандартные модули

Повторное использование компонентов является фундаментальным принципом инфраструктуры как кода. Модули Instrumental в определении стандартов и согласованности между развертыванием ресурсов в средах и между ними. Модули, используемые для развертывания этой первой целевой зоны, доступны в официальном [реестре terraform](https://registry.terraform.io/modules/aztfmod).

## <a name="architecture-diagram"></a>Диаграмма архитектуры

Первая целевая зона развертывает следующие компоненты в вашей подписке:

![Базовая Целевая зона с использованием terraform](../../_images/ready/foundations-terraform-landing-zone.png)

## <a name="capabilities"></a>Характеристики

Развернутые компоненты и их назначение включают следующее.

<!-- markdownlint-disable MD033 -->

| Компонент | Несет |
|---|---|
| Группы ресурсов | Основные группы ресурсов, необходимые для фундамента |
| Ведение журнала действий | Аудит всех действий и архивации подписок: <li> Учетная запись хранения <li> Центры событий Azure |
| ведет журнал диагностики. | Все журналы операций хранятся в течение определенного числа дней: <li> Учетная запись хранения <li> Центры событий |
| Log Analytics | Хранит все журналы операций. Развертывание общих решений для глубокой проверки приложений: <li> нетворкмониторинг <li> адассессмент <li> адрепликатион <li> аженсеалсассессмент <li> днсаналитикс <li> кэйваултаналитикс |
| Центр безопасности Azure | Метрики санации безопасности и оповещения, отправленные по электронной почте и номеру телефона |

<!-- markdownlint-enable MD033 -->

## <a name="use-this-blueprint"></a>Использование этой схемы

Перед использованием целевой зоны Cloud TAP Framework Foundation ознакомьтесь со следующими положениями, решениями и рекомендациями по реализации.

## <a name="assumptions"></a>Допущения

При определении первоначальной целевой зоны были учтены следующие предположения или ограничения. Если эти предположения совпадают с вашими ограничениями, вы можете использовать схему для создания первой зоны размещения. Схему также можно расширить, чтобы создать схему зоны размещения, которая соответствует вашим уникальным ограничениям.

- **Ограничения подписки:** Эта деятельность по внедрению вряд ли будет превышать [лимиты подписки](https://docs.microsoft.com/azure/azure-resource-manager/management/azure-subscription-service-limits). Два общих индикатора — это превышение 25 000 виртуальных машин или 10 000 виртуальных ЦП.
- **Соответствие требованиям:** Для этой целевой зоны требования к соответствию сторонних производителей не требуются.
- **Сложность архитектуры:** Сложность архитектуры не требует дополнительных производственных подписок.
- **Общие службы:** В Azure нет существующих общих служб, для которых требуется, чтобы эта подписка рассматривалась как периферийная в основной и периферийной архитектурах.

Если эти предположения соответствуют текущей среде, этот проект может быть хорошим способом начать создание целевой зоны.

## <a name="design-decisions"></a>Решения по проектированию

Следующие решения представлены в целевой зоне terraform:

| Компонент              | Решения                                                                                                                                                                                                                                                                | Альтернативные подходы                                                                                                                                                                                                                                          |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ведение журналов и мониторинг | Используется рабочая область Log Analytics Azure Monitor. Учетная запись хранения диагностики и концентратор событий подготовлены.                                                                                                                                                        |                                                                                                                                                                                                                                                                 |
| Сеть                | Н/д — сеть реализована в другой целевой зоне.                                                                                                                                                                                                                    | [Сетевые решения](../considerations/networking-options.md)                                                                                                                                                                                                 |
| Идентификация               | Предполагается, что подписка уже связана с экземпляром Azure Active Directory.                                                                                                                                                                        | [Рекомендации по управлению идентификаторами](https://docs.microsoft.com/azure/security/fundamentals/identity-management-best-practices)                                                                                                                               |
| Политика                 | В настоящее время эта Целевая зона предполагает, что политики Azure не применяются.                                                                                                                                                                                            |                                                                                                                                                                                                                                                                 |
| Разработка подписки    | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Создание первоначальных подписок](../azure-best-practices/initial-subscriptions.md)                                                                                                                                                                                  |
| Группы ресурсов        | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Масштабирование подписок](../azure-best-practices/scale-subscriptions.md)                                                                                                                                                                                           |
| Группы управления      | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Организация подписок](../azure-best-practices/organize-subscriptions.md)                                                                                                                                                                                     |
| Данные                   | Недоступно                                                                                                                                                                                                                                                                      | [Выберите правильный вариант SQL Server в Azure](https://docs.microsoft.com/azure/sql-database/sql-database-paas-vs-sql-server-iaas) и [руководстве по хранилищу данных Azure](https://docs.microsoft.com/azure/architecture/guide/technology-choices/data-store-overview) |
| Память                | Недоступно                                                                                                                                                                                                                                                                      | [Руководство по службе хранилища Azure](../considerations/storage-options.md)                                                                                                                                                                                                  |
| Стандарты именования       | При создании среды также создается уникальный префикс. Для ресурсов, которым требуется глобально уникальное имя (например, учетные записи хранения), используйте этот префикс. Пользовательское имя добавляется с помощью случайного суффикса. Использование тегов обязательно, как описано в следующей таблице. | [Рекомендации Azure по добавлению тегов и стандартам именования](../azure-best-practices/naming-and-tagging.md)                                                                                                                                                                              |
| управления затратами;        | Недоступно                                                                                                                                                                                                                                                                      | [Отслеживание затрат](../azure-best-practices/track-costs.md)                                                                                                                                                                                                        |
| Службы вычислений                | Недоступно                                                                                                                                                                                                                                                                      | [Параметры вычислений](../considerations/compute-options.md)                                                                                                                                                                                                         |

### <a name="tagging-standards"></a>Стандарты тегов

Минимальный набор тегов, приведенных ниже, должен присутствовать во всех ресурсах и группах ресурсов:

| Имя тега          | Описание                                                                                        | Ключ             | Пример значения                                    |
|-------------------|----------------------------------------------------------------------------------------------------|-----------------|--------------------------------------------------|
| Бизнес-единица     | Подразделение высшего уровня компании, которому принадлежит подписка или рабочая нагрузка, к которой принадлежит ресурс. | Businessunit    | Финансы, маркетинг, {Product Name}, Corp, Shared |
| место возникновения затрат;       | Центр затрат на учет, связанный с этим ресурсом.                                              | CostCenter      | Число                                           |
| Аварийное восстановление | Критически важное для бизнеса приложение, рабочая нагрузка или служба.                                     | Программой              | С поддержкой аварийного восстановления, без аварийного восстановления                       |
| Среда       | Среда развертывания приложения, рабочей нагрузки или службы.                                   | Переменной             | Произв., dev, QA, этап, тестирование, обучение             |
| Имя владельца        | Владелец приложения, рабочей нагрузки или службы.                                                    | Владелец           | Адрес электронной почты                                            |
| Тип развертывания   | Определяет, как обслуживаются ресурсы.                                                    | DeploymentType  | Вручную, terraform                                |
| Версия           | Версия развернутой схемы.                                                                 | Версия         | Версия 0,1                                             |
| имя приложения;  | Имя связанного приложения, службы или рабочей нагрузки, связанной с ресурсом.             | ApplicationName | "Имя приложения"                                       |

<!-- cSpell:ignore caf -->

## <a name="customize-and-deploy-your-first-landing-zone"></a>Настройка и развертывание первой целевой зоны

Вы можете [клонировать целевую зону terraform Foundation](https://github.com/azure/caf-terraform-landingzones). Чтобы легко приступить к работе с целевой зоной, измените переменные terraform. В нашем примере мы используем **blueprint_foundations. песочницы. Auto. тфварс**, поэтому terraform автоматически устанавливает значения в этом файле.

Рассмотрим различные разделы переменных.

В этом первом объекте мы создадим две группы ресурсов в регионе с `southeastasia` именем `-hub-core-sec` и `-hub-operations` префикс, добавленный во время выполнения.

```hcl
resource_groups_hub = {
    HUB-CORE-SEC    = {
        name = "-hub-core-sec"
        location = "southeastasia"
    }
    HUB-OPERATIONS  = {
        name = "-hub-operations"
        location = "southeastasia"
    }
}
```

Далее мы указываем регионы, в которых можно задать основы. Здесь `southeastasia` используется для развертывания всех ресурсов.

```hcl
location_map = {
    region1   = "southeastasia"
    region2   = "eastasia"
}
```

Затем мы указываем срок хранения журналов операций и журналов подписок Azure. Эти данные хранятся в отдельных учетных записях хранения и концентраторе событий, имена которых создаются случайным образом, так как они должны быть уникальными.

```hcl
azure_activity_logs_retention = 365
azure_diagnostics_logs_retention = 60
```

В tags_hub мы указываем минимальный набор тегов, применяемых ко всем создаваемым ресурсам.

```hcl
tags_hub = {
    environment     = "DEV"
    owner           = "Arnaud"
    deploymentType  = "Terraform"
    costCenter      = "65182"
    BusinessUnit    = "SHARED"
    DR              = "NON-DR-ENABLED"
}
```

Затем мы указываем имя Log Analytics и набор решений для анализа развертывания. Здесь мы сохранили мониторинг сети, Active Directory оценку и репликацию, аналитику DNS и аналитику Key Vault.

```hcl

analytics_workspace_name = "lalogs"

solution_plan_map = {
    NetworkMonitoring = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/NetworkMonitoring"
    },
    ADAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADAssessment"
    },
    ADReplication = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADReplication"
    },
    AgentHealthAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/AgentHealthAssessment"
    },
    DnsAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/DnsAnalytics"
    },
    KeyVaultAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/KeyVaultAnalytics"
    }
}

```

Далее мы настроили параметры оповещений для центра безопасности Azure.

```hcl
# Azure Security Center Configuration
security_center = {
    contact_email   = "joe@contoso.com"
    contact_phone   = "+6500000000"
}
```

## <a name="get-started"></a>Начало работы

После проверки конфигурации можно развернуть конфигурацию, как при развертывании среды terraform. Рекомендуется использовать Rover, который представляет собой контейнер DOCKER, позволяющий развертывать Windows, Linux или macOS. Вы можете приступить к работе с [зонами](https://github.com/azure/caf-terraform-landingzones).

## <a name="next-steps"></a>Дальнейшие действия

Базовая зона базовой зоны размещает фундамент для сложной среды в составной манере. Этот выпуск предоставляет набор простых возможностей, которые можно расширить с помощью:

- Добавление в проект других модулей.
- Размещение дополнительных основных зон поверх нее.

Зоны размещения по слоям — это рекомендуемая практика для разделения систем, управления версиями каждого используемого компонента и быстрого внедрения инноваций и стабильности инфраструктуры в качестве развертывания кода.

В будущих эталонных архитектурах эта концепция будет продемонстрирована для топологии "звезда".

> [!div class="nextstepaction"]
> [Ознакомьтесь с примером учебной зоны Foundation terraform](https://github.com/azure/caf-terraform-landingzones)
