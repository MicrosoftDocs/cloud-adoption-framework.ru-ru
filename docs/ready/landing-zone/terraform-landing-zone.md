---
title: Использование terraform для создания целевых зон
description: Узнайте, как использовать terraform by HashiCorp для создания целевых зон.
author: arnaudlh
ms.author: arnaul
ms.date: 02/25/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: 25bb59e5f79609536a7a1a6711c94c5ff25fdbd5
ms.sourcegitcommit: 07d56209d56ee199dd148dbac59671cbb57880c0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88884799"
---
<!-- cSpell:ignore eastasia southeastasia vCPUs lalogs tfvars NetworkMonitoring ADAssessment ADReplication AgentHealthAssessment DnsAnalytics KeyVaultAnalytics -->

# <a name="use-terraform-to-build-your-landing-zones"></a>Использование terraform для создания целевых зон

Azure предоставляет собственные службы для развертывания целевых зон. Другие сторонние средства также могут помочь в этом. Одним из таких средств, которые клиенты и партнеры часто используют для развертывания terraform зон, является HashiCorp. В этом разделе показано, как использовать пример целевой зоны для развертывания базовых функций управления, учета и обеспечения безопасности для подписки Azure.

## <a name="purpose-of-the-landing-zone"></a>Назначение целевой зоны

Главная зона инфраструктуры внедрения в облаке для terraform предоставляет функции для обеспечения ведения журнала, учета и безопасности. Эта Целевая зона использует стандартные компоненты, известные как terraform Modules, для обеспечения согласованности между ресурсами, развернутыми в среде.

## <a name="use-standard-modules"></a>Использовать стандартные модули

Повторное использование компонентов является фундаментальным принципом инфраструктуры как кода. Модули Instrumental в определении стандартов и согласованности между развертыванием ресурсов в средах и между ними. Модули, используемые для развертывания этой первой целевой зоны, доступны в официальном [реестре terraform](https://registry.terraform.io/modules/aztfmod).

## <a name="architecture-diagram"></a>Диаграмма архитектуры

Первая целевая зона развертывает следующие компоненты в вашей подписке:

![Базовая Целевая зона с использованием terraform ](../../_images/ready/foundations-terraform-landing-zone.png)
 _рис. 1. Базовая зона с использованием terraform._

## <a name="capabilities"></a>Возможности

Развернутые компоненты и их назначение включают следующее.

| Компонент | Несет |
|---|---|
| Группы ресурсов | Основные группы ресурсов, необходимые для фундамента |
| Журнал активности | Аудит всех действий и архивации подписок: <li> Учетная запись хранения <li> Центры событий Azure |
| ведет журнал диагностики. | Все журналы операций хранятся в течение определенного числа дней: <li> Учетная запись хранения <li> Центры событий |
| Анализ журналов | Хранит журналы операций. Развертывание общих решений для глубокой проверки приложений: <li> нетворкмониторинг <li> адассессмент <li> адрепликатион <li> аженсеалсассессмент <li> днсаналитикс <li> кэйваултаналитикс |
| Центр безопасности Azure | Метрики санации безопасности и оповещения, отправленные по электронной почте и номеру телефона |

## <a name="use-this-blueprint"></a>Использование этой схемы

Перед использованием целевой зоны Cloud TAP Framework Foundation ознакомьтесь со следующими положениями, решениями и рекомендациями по реализации.

## <a name="assumptions"></a>Предположения

При определении первоначальной целевой зоны были учтены следующие предположения или ограничения. Если эти предположения совпадают с вашими ограничениями, вы можете использовать схему для создания первой зоны размещения. Схему также можно расширить, чтобы создать схему зоны размещения, которая соответствует вашим уникальным ограничениям.

- **Ограничения подписки:** Эта деятельность по внедрению вряд ли будет превышать [лимиты подписки](/azure/azure-resource-manager/management/azure-subscription-service-limits). Два общих индикатора — это превышение 25 000 виртуальных машин или 10 000 виртуальных ЦП.
- **Соответствие требованиям:** Для этой целевой зоны требования к соответствию сторонних производителей не требуются.
- **Сложность архитектуры:** Сложность архитектуры не требует дополнительных производственных подписок.
- **Общие службы:** Ни одна из существующих общих служб в Azure не требует, чтобы эта подписка рассматривалась как периферийная в центрально-лучевой архитектуре.

Если эти предположения соответствуют текущей среде, этот проект может быть хорошим способом начать создание целевой зоны.

## <a name="design-decisions"></a>Решения по проектированию

Следующие решения представлены в модулях КАФ terraform:

| Компонент              | Решения                                                                                                                                                                                                                                                                | Альтернативные подходы                                                                                                                                                                                                                                          |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Ведение журналов и мониторинг | Используется рабочая область Log Analytics Azure Monitor. Учетная запись хранения диагностики и концентратор событий подготовлены.                                                                                                                                                        |                                                                                                                                                                                                                                                                 |
| Сеть                | Н/д — сеть реализована в другой целевой зоне.                                                                                                                                                                                                                    | [Сетевые решения](../considerations/networking-options.md)                                                                                                                                                                                                 |
| Удостоверение               | Предполагается, что подписка уже связана с экземпляром Azure Active Directory.                                                                                                                                                                        | [Рекомендации по управлению идентификаторами](/azure/security/fundamentals/identity-management-best-practices)                                                                                                                               |
| Политика                 | В настоящее время эта Целевая зона предполагает, что политики Azure не применяются.                                                                                                                                                                                            |                                                                                                                                                                                                                                                                 |
| Разработка подписки    | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Создание первоначальных подписок](../azure-best-practices/initial-subscriptions.md)                                                                                                                                                                                  |
| Группы ресурсов        | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Масштабирование подписок](../azure-best-practices/scale-subscriptions.md)                                                                                                                                                                                           |
| Группы управления      | Н/д — предназначено для одной рабочей подписки.                                                                                                                                                                                                                     | [Организация подписок](../azure-best-practices/organize-subscriptions.md)                                                                                                                                                                                     |
| Данные                   | н/д                                                                                                                                                                                                                                                                      | [Выберите правильный вариант SQL Server в Azure](/azure/sql-database/sql-database-paas-vs-sql-server-iaas) и [руководстве по хранилищу данных Azure](/azure/architecture/guide/technology-choices/data-store-overview) |
| Хранилище                | н/д                                                                                                                                                                                                                                                                      | [Руководство по службе хранилища Azure](../considerations/storage-options.md)                                                                                                                                                                                                  |
| Стандарты именования       | При создании среды также создается уникальный префикс. Для ресурсов, которым требуется глобально уникальное имя (например, учетные записи хранения), используйте этот префикс. Пользовательское имя добавляется с помощью случайного суффикса. Использование тегов обязательно, как описано в следующей таблице. | [Рекомендации Azure по добавлению тегов и стандартам именования](../azure-best-practices/naming-and-tagging.md)                                                                                                                                                                              |
| управления затратами        | н/д                                                                                                                                                                                                                                                                      | [Отслеживание затрат](../azure-best-practices/track-costs.md)                                                                                                                                                                                                        |
| Вычисления                | н/д                                                                                                                                                                                                                                                                      | [Параметры вычислений](../considerations/compute-options.md)                                                                                                                                                                                                         |

### <a name="tagging-standards"></a>Стандарты тегов

Минимальный набор тегов, приведенных ниже, должен присутствовать во всех ресурсах и группах ресурсов:

<!-- TODO: Review capitalization and hyphenation -->
<!-- TODO: Eliminate either "Tag name" or "Key" column -->

| Имя тега          | Описание                                                                                        | Клавиши             | Примеры значений                                    |
|-------------------|----------------------------------------------------------------------------------------------------|-------------------|--------------------------------------------------|
| Бизнес-единица     | Подразделение высшего уровня компании, которому принадлежит подписка или рабочая нагрузка, к которой принадлежит ресурс. | `BusinessUnit`    | `finance`, `marketing`, `<product-name>`, `corp`, `shared` |
| место возникновения затрат;       | Центр затрат на учет, связанный с этим ресурсом.                                              | `CostCenter`      | `<cost-center-number>`                                     |
| Аварийное восстановление | Критически важное для бизнеса приложение, рабочая нагрузка или служба.                                     | `DR`              | `dr-enabled`, `non-dr-enabled`                   |
| Среда       | Среда развертывания приложения, рабочей нагрузки или службы.                                   | `Env`             | `prod`, `dev`, `qa`, `staging`, `test`, `training` |
| Имя владельца        | Владелец приложения, рабочей нагрузки или службы.                                                    | `Owner`           | `email`                                            |
| Тип развертывания   | Определяет, как обслуживаются ресурсы.                                                    | `DeploymentType`  | `manual`, `terraform`                                |
| Версия           | Версия развернутой схемы.                                                                 | `Version`         | `v0.1`                                             |
| имя приложения;  | Имя связанного приложения, службы или рабочей нагрузки, связанной с ресурсом.             | `ApplicationName` | `<app-name>`                                       |

## <a name="customize-and-deploy-your-first-landing-zone"></a>Настройка и развертывание первой целевой зоны

Вы можете [клонировать целевую зону terraform Foundation](https://github.com/azure/caf-terraform-landingzones). Чтобы легко приступить к работе с целевой зоной, измените переменные terraform. В нашем примере мы используем **blueprint_foundations. песочницы. Auto. тфварс**, поэтому terraform автоматически устанавливает значения в этом файле.

Рассмотрим различные разделы переменных.

В этом первом объекте мы создадим две группы ресурсов в регионе с `southeastasia` именем `-hub-core-sec` и `-hub-operations` префикс, добавленный во время выполнения.

```hcl
resource_groups_hub = {
    HUB-CORE-SEC    = {
        name = "-hub-core-sec"
        location = "southeastasia"
    }
    HUB-OPERATIONS  = {
        name = "-hub-operations"
        location = "southeastasia"
    }
}
```

Далее мы указываем регионы, в которых можно задать основы. Здесь `southeastasia` используется для развертывания всех ресурсов.

```hcl
location_map = {
    region1   = "southeastasia"
    region2   = "eastasia"
}
```

Затем мы указываем срок хранения журналов операций и журналов подписок Azure. Эти данные хранятся в отдельных учетных записях хранения и концентраторе событий, имена которых создаются случайным образом, так как они должны быть уникальными.

```hcl
azure_activity_logs_retention = 365
azure_diagnostics_logs_retention = 60
```

В tags_hub мы указываем минимальный набор тегов, применяемых ко всем создаваемым ресурсам.

```hcl
tags_hub = {
    environment     = "DEV"
    owner           = "Arnaud"
    deploymentType  = "Terraform"
    costCenter      = "65182"
    BusinessUnit    = "SHARED"
    DR              = "NON-DR-ENABLED"
}
```

Затем мы указываем имя Log Analytics и набор решений для анализа развертывания. Здесь мы сохранили мониторинг сети, Active Directory оценку и репликацию, аналитику DNS и аналитику Key Vault.

```hcl

analytics_workspace_name = "lalogs"

solution_plan_map = {
    NetworkMonitoring = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/NetworkMonitoring"
    },
    ADAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADAssessment"
    },
    ADReplication = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/ADReplication"
    },
    AgentHealthAssessment = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/AgentHealthAssessment"
    },
    DnsAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/DnsAnalytics"
    },
    KeyVaultAnalytics = {
        "publisher" = "Microsoft"
        "product"   = "OMSGallery/KeyVaultAnalytics"
    }
}

```

Далее мы настроили параметры оповещений для центра безопасности Azure.

```hcl
# Azure Security Center Configuration
security_center = {
    contact_email   = "joe@contoso.com"
    contact_phone   = "+6500000000"
}
```

## <a name="get-started"></a>Начало работы

После проверки конфигурации можно развернуть конфигурацию, как при развертывании среды terraform. Рекомендуется использовать Rover, который представляет собой контейнер DOCKER, позволяющий развертывать Windows, Linux или macOS. Вы можете приступить к работе с [зонами](https://github.com/azure/caf-terraform-landingzones).

## <a name="next-steps"></a>Дальнейшие шаги

Базовая зона базовой зоны размещает фундамент для сложной среды в составной манере. Этот выпуск предоставляет набор простых возможностей, которые можно расширить, добавив другие модули в схему или разслойировать дополнительные основные зоны поверх нее.

Размещение размещенных зон является хорошей практикой при разделении систем, управлении версиями каждого используемого компонента и возможности быстрого внедрения и стабильности инфраструктуры в качестве развертывания кода.

В будущих эталонных архитектурах эта концепция будет продемонстрирована для топологии "звезда".

> [!div class="nextstepaction"]
> [Ознакомьтесь с примером целевой зоны terraform базовой основы.](https://github.com/azure/caf-terraform-landingzones)
