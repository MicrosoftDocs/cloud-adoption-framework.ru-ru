---
title: Проектирование и эксплуатация кластеров
description: Узнайте о Kubernetes в облачной инфраструктуре внедрения для проектирования и эксплуатации кластеров.
author: sabbour
ms.author: asabbour
ms.date: 12/16/2019
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: innovate
ms.openlocfilehash: 0c83a98928d1341a4f311d78972430277284becf
ms.sourcegitcommit: becf7868250fe159be940aa93f6f8f84bdbc27c6
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/13/2020
ms.locfileid: "92003897"
---
<!-- cSpell:ignore autoscaler PDBs -->

# <a name="cluster-design-and-operations"></a>Проектирование и эксплуатация кластеров

Выявление конфигурации кластера и структуры сети. Масштабируемость в будущем путем автоматизации подготовки инфраструктуры. Поддерживайте высокий уровень доступности, планируя непрерывность бизнес-процессов и аварийное восстановление.

## <a name="plan-train-and-proof"></a>Планирование, обучение и подтверждение

По мере того как вы приступите к работе, контрольный список и приведенные ниже ресурсы помогут вам спланировать структуру кластера. Вы можете ответить на следующие вопросы:

> [!div class="checklist"]
>
> - Определили ли вы требования к проектированию сети для кластера?
> - У вас есть рабочие нагрузки с различными требованиями? Сколько пулов узлов вы собираетесь использовать?

<!-- -->

> [!div class="tdCol2BreakAll"]
>
> | Контрольный список  | Ресурсы |
> |------------------------------------------------------------------|-----------------------------------------------------------------|
> | **Выявление рекомендаций по проектированию сети.** Ознакомьтесь с вопросами по проектированию сети кластера, Сравните сетевые модели и выберите подключаемый модуль Kubernetes Network, соответствующий вашим потребностям. Для сетевого интерфейса контейнера Azure (CNI) Рассмотрите количество IP-адресов, необходимое для нескольких модулей в одном узле (по умолчанию 30) и количества узлов. Добавьте один узел, необходимый во время обновления. При выборе служб подсистемы балансировки нагрузки рассмотрите возможность использования контроллера входящих данных, если слишком много служб для уменьшения числа видимых конечных точек. Для Azure CNI служба CIDR должна быть уникальной в пределах виртуальной сети и всех подключенных виртуальных сетей, чтобы обеспечить соответствующую маршрутизацию. | <li> [Кубенет &nbsp; и &nbsp; &nbsp; &nbsp; сетевой интерфейс контейнеров &nbsp; Azure &nbsp; (CNI)](/azure/aks/concepts-network#azure-virtual-networks) <li>  [Использование сети kubenet с пользовательскими диапазонами IP-адресов в Службе Azure Kubernetes (AKS)](/azure/aks/configure-kubenet) <li> [Настройка сети Azure CNI в Службе Azure Kubernetes (AKS)](/azure/aks/configure-azure-cni) <li>  [Разработка безопасной сети для кластера AKS](https://github.com/Azure/sg-aks-workshop/blob/master/cluster-design/NetworkDesign.md)|
> | **Создайте несколько пулов узлов.** Для поддержки приложений, имеющих различные требования к вычислению или хранению, при необходимости можно настроить кластер с несколькими пулами узлов. Например, используйте дополнительные пулы узлов, чтобы предоставить графические процессоры для приложений с большим объемом вычислений или доступ к высокопроизводительному хранилищу SSD.   | <li> [Создание &nbsp; &nbsp; &nbsp; нескольких &nbsp; пулов узлов для кластера и управление им &nbsp; &nbsp; в службе Kubernetes Azure](/azure/aks/use-multiple-node-pools) |
> | **Решите требования к доступности.** Как минимум две модули, лежащие в основе службы Azure Kubernetes, обеспечивают высокую доступность приложения в случае сбоев или перезапуска Pod. Используйте три или более модулей Pod для управления нагрузкой во время сбоев и перезапуска модулей. Для конфигурации кластера требуется как минимум 2 узла в группе доступности или масштабируемом наборе виртуальных машин для удовлетворения соглашения об уровне обслуживания 99,95%. Используйте по крайней мере три модуля Pod для обеспечения планирования модулей во время сбоев узла и перезагрузки. Чтобы обеспечить более высокий уровень доступности приложений, кластеры можно распределять между зонами доступности. Эти зоны являются физически отдельными центрами обработки данных в пределах заданного региона. Когда компоненты кластера распределяются по нескольким зонам, кластер может допускать сбои в одной из этих зон. Ваши приложения и операции управления остаются доступными даже в случае сбоя всего центра обработки данных. | <li> [Создание кластера Службы Azure Kubernetes (AKS), который использует зоны доступности](/azure/aks/availability-zones) |

## <a name="go-to-production-and-apply-best-practices"></a>Перейдите в рабочую среду и примените рекомендации

При подготовке приложения для рабочей среды следует реализовать минимальный набор рекомендаций. На этом этапе используйте контрольный список. Вы должны иметь возможность ответить на следующие вопросы:

> [!div class="checklist"]
>
> - Вы можете уверенно повторно развернуть инфраструктуру кластера?
> - Были ли вы применены квоты ресурсов?

<!-- -->

> [!div class="tdCol2BreakAll"]
>
> | Контрольный список  | Ресурсы                                                                                                     |
> |------------------------------------------------------------------|-----------------------------------------------------------------|
> | **Автоматизируйте подготовку кластера.** С помощью инфраструктуры в качестве кода можно автоматизировать подготовку инфраструктуры, чтобы обеспечить повышенную устойчивость во время аварийных ситуаций и повысить гибкость при необходимости быстрого повторного развертывания инфраструктуры.  | <li> [созданию кластера Kubernetes с помощью Службы Azure Kubernetes и Terraform](/azure/terraform/terraform-create-k8s-cluster-with-tf-and-aks)|
> | **Планируйте доступность с помощью бюджетов прерываний Pod.** Чтобы обеспечить доступность приложений, определите бюджеты перерывов в устройстве (PDB), чтобы обеспечить доступность в кластере минимального числа модулей Pod при сбоях оборудования или обновлении кластера. | <li> [Планирование &nbsp; &nbsp; доступности &nbsp; с использованием &nbsp; &nbsp; &nbsp; бюджетов нарушений Pod](/azure/aks/operator-best-practices-scheduler#plan-for-availability-using-pod-disruption-budgets)  |
> | **Применение квот ресурсов для пространств имен.** Спланируйте и примените квоты ресурсов на уровне пространства имен. Квоты могут быть установлены для ресурсов вычислений, ресурсов хранилища и числа объектов.| <li> [Применение квот ресурсов](/azure/aks/operator-best-practices-scheduler#enforce-resource-quotas)  |

## <a name="optimize-and-scale"></a>Оптимизация и масштабирование

Теперь, когда приложение находится в рабочей среде, как можно оптимизировать рабочий процесс и подготовить приложение и команду к масштабированию? Для подготовки используйте контрольный список для оптимизации и масштабирования. Вы должны иметь возможность ответить на следующие вопросы:

> [!div class="checklist"]
>
> - Есть ли у вас план обеспечения непрерывности бизнес-процессов и аварийного восстановления?
> - Можно ли масштабировать кластер в соответствии с потребностями приложений?
> - Вы можете отслеживать работоспособность кластера и приложения и получать оповещения?

<!-- -->

> [!div class="tdCol2BreakAll"]
>
> | Контрольный список | Ресурсы |
> |--|--|
> | **Автоматическое масштабирование кластера в соответствии с потребностями приложений.** Чтобы справиться с потребностями приложений, может потребоваться изменить число узлов, которые запускают рабочие нагрузки, автоматически с помощью автомасштабирования кластера. | <li> [Настройка автомасштабирования кластера Kubernetes](/azure/aks/cluster-autoscaler) |
> | **Спланируйте непрерывность бизнес-процессов и аварийное восстановление.** Спланируйте развертывание в многорегионом, создайте план миграции хранилища и включите георепликацию для образов контейнеров. | <li> [Рекомендации по развертыванию регионов](/azure/aks/operator-best-practices-multi-region) <li>  [Георепликация реестра контейнеров Azure](/azure/container-registry/container-registry-geo-replication) |
> | **Настройка мониторинга и устранения неполадок в масштабе.** Настройка оповещений и мониторинга для приложений в Kubernetes. Узнайте о конфигурации по умолчанию, о том, как интегрировать более сложные метрики и как добавить собственные настраиваемые средства мониторинга и оповещения для надежной работы приложения. | <li> [Приступая к работе с мониторингом и оповещениями для Kubernetes (видео)](https://www.youtube.com/watch?v=W7aN_z-cyUw&list=PLLasX02E8BPCrIhFrc_ZiINhbRkYMKdPT&index=16) <li> [Настройка оповещений с помощью Azure Monitor для контейнеров](/azure/azure-monitor/insights/container-insights-overview) <li> [Обзор &nbsp; &nbsp; журналов диагностики &nbsp; для &nbsp; основных &nbsp; компонентов](/azure/aks/view-master-logs) <li> [Диагностика службы Azure Kubernetes Service (AKS)](/azure/aks/concepts-diagnostics) |
