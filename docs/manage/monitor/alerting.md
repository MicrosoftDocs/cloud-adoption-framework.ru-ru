---
title: Мониторинг и оповещения в облаке
description: Узнайте, как определить, когда использовать Azure Monitor или System Center Operations Manager в Microsoft Azure, можно с помощью инфраструктуры внедрения в облако для Azure.
author: MGoedtel
ms.author: magoedte
ms.date: 08/05/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: operate
services: azure-monitor
ms.openlocfilehash: 48a9d309e644f7232e014201781f52edbb359c1f
ms.sourcegitcommit: 07d56209d56ee199dd148dbac59671cbb57880c0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/26/2020
ms.locfileid: "88877693"
---
<!-- cSpell:ignore multisignal -->

# <a name="cloud-monitoring-guide-alerting"></a>Руководство по мониторингу облака: предупреждения

В течение многих лет ИТ организации сталкиваются с тем, чтобы предупредить выносливости оповещений, создаваемых средствами мониторинга, развернутыми на предприятии. Многие системы создают большое количество оповещений, которые часто считаются бессмысленными, в то время как другие предупреждения являются важными, но не проводятся или пропускаются. Как следствие, ИТ-отделы и операции разработчиков испытывают проблемы с требованиями к качеству уровня службы для внутренних или внешних клиентов. Чтобы обеспечить надежность, важно понимать состояние инфраструктуры и приложений. Чтобы свести к минимуму снижение производительности и прерывание работы службы или уменьшить число инцидентов, необходимо быстро выявлять причины.

## <a name="successful-alerting-strategy"></a>Стратегия успешного создания предупреждений

*Вы не можете исправить неизвестные сведения о нарушении.*

Предупреждение о том, что важно. Она подкрепляется путем сбора и измерения правильных метрик и журналов. Кроме того, вам потребуется средство мониторинга, которое может хранить, объединять, визуализировать, анализировать и инициировать автоматический ответ при выполнении условий. Вы можете улучшить наблюдаемость служб и приложений только в том случае, если вы полностью понимаете его композицию. Вы сопоставляете эту композицию с подробной конфигурацией мониторинга, которая будет применена платформой мониторинга. В эту конфигурацию входят предсказуемые состояния сбоя (симптомы, а не причина сбоя), которые имеют смысл оповещать.

Примите во внимание следующие принципы, чтобы определить, является ли симптом подходящим кандидатом для предупреждений:

- **Есть ли разница?** Является ли проблема признакомой реальной проблемы или проблемы, влияющей на общую работоспособность приложения? Например, вы хотите узнать, высокая ли загрузка ЦП в ресурсе? Или что определенный SQL-запрос, выполняющийся в экземпляре базы данных SQL на этом ресурсе, потребляет высокую загрузку ЦП в течение длительного периода? Поскольку условие использования ЦП является реальной проблемой, вы должны получать оповещения о ней. Но вам не нужно уведомлять команду, так как она не помогает указывать на то, что вызывает условие в первую очередь. Предупреждения и уведомления об использовании процесса SQL-запроса являются актуальными и действиями.
- **Это срочно?** Является ли эта ситуация реальной, и она требует срочного внимания? Если да, ответственная команда должна немедленно получать уведомления.
- **Затронули ли ваши клиенты?** Были ли пользователи службы или приложения, подверженные воздействию проблемы?
- **Затронуты ли другие зависимые системы?** Имеются ли предупреждения о взаимосвязанных зависимостях, которые могут быть сопоставлены, чтобы не уведомлять различных групп о том, что все работает над одной и той же проблемой?

Задавайте эти вопросы при первоначальной разработке конфигурации мониторинга. Протестируйте и проверяйте предположения в непроизводственной среде, а затем разверните их в рабочую среду. Конфигурации мониторинга являются производными от известных режимов сбоя, результатов имитации сбоев и взаимодействия разных членов группы.

После выпуска конфигурации мониторинга вы можете узнать о том, что работает, а что нет. Рассмотрите высокий объем оповещений, незамеченные проблемы, которые не были замечены конечными пользователями, а какие — лучшие действия, которые должны быть выполнены в рамках этой оценки. Выявление изменений, которые необходимо реализовать для улучшения доставки служб, в рамках непрерывного процесса улучшения мониторинга. Он не только оценивает шум оповещений или пропущенные оповещения, но и эффективность мониторинга рабочей нагрузки. Это зависит от эффективности политик оповещений, процесса и общего языка и региональных параметров, чтобы определить, что вы улучшаете.

И System Center Operations Manager, и Azure Monitor поддерживают оповещения на основе статических или даже динамических пороговых значений и действий, настраиваются поверх них. К примерам относятся оповещения для электронной почты, SMS и голосовой связи для простых уведомлений. Обе эти службы также поддерживают интеграцию управления ИТ-службами (ITSM), чтобы автоматизировать создание записей инцидентов и передать их в соответствующую группу поддержки или любую другую систему управления оповещениями, которая использует веб-перехватчик.

По возможности для автоматизации действий по восстановлению можно использовать любую из нескольких служб. К ним относятся System Center Orchestrator, служба автоматизации Azure, Azure Logic Apps или автомасштабирование в случае эластичных рабочих нагрузок. Хотя уведомление ответственных команд является наиболее распространенным действием для предупреждений, также может быть уместна Автоматизация корректирующих действий. Эта автоматизация может помочь в оптимизации всего процесса управления инцидентами. Автоматизация этих задач восстановления также может снизить риск возникновения ошибок в человеке.

## <a name="azure-monitor-alerting"></a>Azure Monitor оповещения

Если вы используете Azure Monitor исключительно, следуйте этим рекомендациям, когда вы рассмотрите скорость, стоимость и объем хранилища.

В зависимости от используемой функции и конфигурации можно хранить данные мониторинга в любом из шести репозиториев:

- **База данных метрик Azure Monitor:** База данных временных рядов используется в основном для Azure Monitor метрик платформы, но в ней также есть Application Insights данные метрик. Сведения, вводимые в эту базу данных, имеют наибольшее время оповещения.

- **Application Insights ресурс:** База данных, в которой хранятся большинство Application Insights телеметрии в форме журнала.

- **Рабочая область Log Analytics Azure Monitor:** Основное хранилище для данных журнала Azure. Другие средства могут передавать данные в него и анализировать их в журналах Azure Monitor. Из-за приема и индексирования запросы оповещений журнала имеют более высокую задержку. Эта задержка обычно составляет 5-10 минут, но при определенных обстоятельствах она может быть выше.

- **Журнал действий:** Используется для всех событий журнала действий и работоспособности службы. Возможен выделенный оповещение. Содержит события уровня подписки, происходящие с объектами в подписке, как видно за пределами этих объектов. Например, если политика задана или к ресурсу осуществляется доступ или удаление.

- Служба **хранилища Azure:** Хранилище общего назначения, поддерживаемое система диагностики Azure и другими средствами мониторинга. Это экономичный вариант долгосрочного хранения данных телеметрии мониторинга. Предупреждения не поддерживаются данными, хранящимися в этой службе.

- **Концентраторы событий:** Обычно используется для потоковой передачи данных в локальные или другие партнерские средства мониторинга или ITSM.

Azure Monitor имеет четыре типа предупреждений, которые в некоторой степени связаны с репозиторием, в котором хранятся данные:

- [Оповещение метрики](/azure/azure-monitor/platform/alerts-metric). оповещения о данных метрик в Azure Monitor. Оповещения возникают, когда наблюдаемое значение пересекается с заданным пользователем пороговым значением, а затем снова возвращается в состояние "нормальное".

- [Предупреждение о запросе журнала](/azure/azure-monitor/platform/alerts-log-query): доступно для оповещения о данных журнала из Application Insights или журналов Azure Monitor. Он также может получать оповещения на основе запросов между рабочими областями.

- [Оповещение журнала действий](/azure/azure-monitor/platform/alerts-activity-log). оповещения об элементах в журнале действий за исключением данных о работоспособности службы Azure.

- [Оповещение о работоспособности службы Azure](/azure/azure-monitor/platform/alerts-activity-log-service-notifications). Специальный тип оповещений, который используется только для проблем работоспособности служб Azure, поступающих из журнала действий, таких как сбои и запланированное обслуживание. Обратите внимание, что этот тип оповещений настраивается с помощью службы [работоспособности служб Azure](/azure/service-health/service-health-overview), вспомогательной службы для Azure Monitor.

### <a name="enable-alerting-through-partner-tools"></a>Включение оповещений с помощью средств партнеров

Если вы используете внешнее решение для оповещений, направьте его так, как это можно делать через концентраторы событий Azure. это самый быстрый путь из Azure Monitor. Вам придется платить за прием в концентратор событий. Если стоимость невысока, вы можете использовать службу хранилища Azure в качестве менее дорогостоящей альтернативы. Просто убедитесь, что средства мониторинга или ITSM могут читать хранилище Azure для извлечения данных.

Azure Monitor включает поддержку интеграции с другими платформами мониторинга и ITSM программного обеспечения, например ServiceNow. Вы можете использовать оповещения Azure и по-прежнему запускать действия вне Azure, как это необходимо для управления инцидентами или процесса DevOps. Если вы хотите создать оповещение в Azure Monitor и автоматизировать ответ, вы можете инициировать автоматические действия с помощью функций Azure, Azure Logic Apps или службы автоматизации Azure в зависимости от вашего сценария и требований.

### <a name="specialized-azure-monitoring-offerings"></a>Специализированные предложения мониторинга Azure

Обычно [решения по управлению](/azure/azure-monitor/insights/solutions-inventory) хранят свои данные Azure Monitor журналы. Для контейнеров используются два исключения: Azure Monitor для виртуальных машин и Azure Monitor. В следующей таблице описывается процесс создания предупреждений на основе конкретного типа данных и места его хранения.

| Решение | Тип данных | Поведение предупреждений |
|---| ---| --- |
| Azure Monitor для контейнеров | Вычисленные средние данные о производительности из узлов и модулей Pod записываются в базу данных метрик. | Создавайте оповещения метрик, если хотите получать оповещения на основе вариации измеряемой производительности использования, агрегированной со временем. |
| | Вычисленные данные производительности, использующие процентили из узлов, контроллеров, контейнеров и модулей Pod, записываются в рабочую область. Журналы контейнеров и сведения инвентаризации также записываются в рабочую область. | Создание оповещений о запросах журнала, если вы хотите получать оповещения на основе варианта измеряемого использования из кластеров и контейнеров. Оповещения о запросах журнала также можно настроить на основе количества фаз и количества узлов состояния. |
| Azure Monitor для виртуальных машин | Критерии работоспособности — это метрики, хранящиеся в базе данных метрик. | Оповещения создаются, когда состояние работоспособности меняется с работоспособного на неработоспособное. Это оповещение поддерживает только группы действий, настроенные для отправки SMS или уведомлений по электронной почте. |
| | Данные журнала производительности операционной системы на карте и виртуальной машине записываются в рабочую область Log Analytics. | Создание оповещений о запросах журнала. |

### <a name="fastest-speed-driven-by-cost"></a>Самая высокая скорость, управляемая затратами

Задержка является одним из наиболее важных решений, влияющих на предупреждения, и быстрым разрешением проблем, влияющих на работу службы. Если вам требуется оповещение практически в реальном времени в течение пяти минут, сначала оцените, если у вас есть оповещения о телеметрии и они хранятся по умолчанию. Как правило, эта стратегия также является самым дешевым вариантом, так как используемое средство уже отправляет свои данные в это место.

С другой стороны, в этом правиле есть несколько важных сносок.

Данные **телеметрии гостевой ОС** имеют несколько путей, чтобы приступить к системе.

- Самый быстрый способ оповещения об этих данных — импортировать их в качестве пользовательских метрик. Это можно сделать с помощью расширения система диагностики Azure, а затем с помощью оповещения метрики. Однако пользовательские метрики сейчас находятся в режиме предварительной версии и [более дороги, чем другие параметры](https://azure.microsoft.com/pricing/details/monitor).

- Самое дорогое, но с некоторой задержкой приема — отправить его в рабочую область Log Analytics. Запуск агента Log Analytics на виртуальной машине — лучший способ получить метрику операционной системы на виртуальной машине и данные журналов в рабочей области.

- Вы можете отправить его для хранилища как метрику и войти в Azure Monitor, запустив как диагностическое расширение, так и агент Log Analytics на одной виртуальной машине. Вы можете быстрее получать оповещения, но также использовать данные операционной системы на виртуальной машине в составе более сложных запросов при их объединении с другими данными телеметрии.

**Импорт данных из локальной среды:** Если вы пытаетесь выполнять запросы и отслеживать компьютеры, работающие в Azure и локально, можно использовать агент Log Analytics для сбора данных операционной системы на виртуальной машине. Затем можно использовать функцию [журналов для метрик](/azure/azure-monitor/platform/alerts-metric-logs) , которые будут собраны и храниться в качестве метрик в Azure Monitor. Этот метод обходит часть процесса приема в журналы Azure Monitor, и данные, таким способом, доступны быстрее.

### <a name="minimize-alerts"></a>Сведение предупреждений

Если вы используете такое решение, как Azure Monitor для виртуальных машин и нашли критерии работоспособности по умолчанию, которые отслеживают использование производительности приемлемым образом, не создавайте перекрывающиеся оповещения о метриках или запросах журналов на основе тех же счетчиков производительности.

Если вы не используете Azure Monitor для виртуальных машин, сделайте задание создавать оповещения и упростить управление уведомлениями, изучив следующие функции:

> [!NOTE]
> Эти функции применяются только к оповещениям метрик, оповещениям на основе данных, отправляемых в базу данных метрик Azure Monitor. Эти функции не применяются к другим типам оповещений. Как упоминалось ранее, основная цель оповещений метрик — скорость. Если получение предупреждения менее чем за пять минут не является основной проблемой, можно использовать оповещение о запросе журнала.

- [Динамические пороговые](/azure/azure-monitor/platform/alerts-dynamic-thresholds)значения: динамические пороговые значения проводят Просмотр активности ресурса за период времени и создают верхние и нижние пороговые значения нормального поведения. Если отслеживаемая метрика находится за пределами этих порогов, вы получаете предупреждение.

- [Оповещения для нескольких подписей](https://azure.microsoft.com/blog/monitor-at-scale-in-azure-monitor-with-multi-resource-metric-alerts). можно создать оповещение метрик, которое использует сочетание двух различных входных значений из двух различных типов ресурсов. Например, если вы хотите запустить оповещение, когда загрузка ЦП виртуальной машины превышает 90%, а количество сообщений в определенной очереди служебной шины Azure, которое потребует, чтобы виртуальная машина превышала определенный объем, это можно сделать без создания запроса журнала. Эта функция работает только для двух сигналов. При наличии более сложного запроса данные метрик можно передать в рабочую область Log Analytics и использовать запрос журнала.

- [Многоресурсные оповещения](https://azure.microsoft.com/blog/monitor-at-scale-in-azure-monitor-with-multi-resource-metric-alerts). Azure Monitor позволяет создавать одно правило оповещения метрики, которое применяется ко всем ресурсам виртуальной машины. Эта функция может сэкономить время, поскольку вам не нужно создавать отдельные предупреждения для каждой виртуальной машины. Цены для этого типа оповещений одинаковы. Если вы создаете оповещения 50 для мониторинга загрузки ЦП для виртуальных машин 50, или одно оповещение, которое наблюдает за использованием ЦП для всех виртуальных машин 50, затраты на него будут одинаковы. Вы также можете использовать эти типы оповещений в сочетании с динамическими пороговыми значениями.

Эти функции позволяют экономить время за счет минимизации уведомлений об оповещениях и управления основными оповещениями.

### <a name="limits-on-alerts"></a>Ограничения на предупреждения

Обязательно запишите [ограничения на количество создаваемых оповещений](/azure/azure-resource-manager/management/azure-subscription-service-limits#azure-monitor-limits). Некоторые ограничения (но не все из них) можно увеличить, вызвав поддержку.

### <a name="best-query-experience"></a>Лучшие возможности запросов

Если вы ищете тенденции во всех данных, имеет смысл импортировать все данные в журналы Azure, если они еще не находятся в Application Insights. Вы можете создавать запросы в обеих рабочих областях, поэтому нет необходимости перемещать данные между ними. Вы также можете импортировать журнал действий и данные о работоспособности службы Azure в рабочую область Log Analytics. Вы платите за это место приема и хранения, но будете получать все данные в одном месте для анализа и запросов. Этот подход также дает возможность создавать сложные условия запросов и оповещать их.
