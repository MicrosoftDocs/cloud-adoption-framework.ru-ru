---
title: Руководство по мониторингу облака — предупреждения
titleSuffix: Microsoft Cloud Adoption Framework for Azure
description: Выберите, когда следует использовать Azure Monitor или System Center Operations Manager в Microsoft Azure
author: MGoedtel
ms.author: magoedte
ms.date: 06/26/2019
ms.topic: guide
ms.service: cloud-adoption-framework
ms.subservice: operate
services: azure-monitor
ms.openlocfilehash: 76fb8084aad799d3bbfdaf3bd2ef4330fd080ac0
ms.sourcegitcommit: 443c28f3afeedfbfe8b9980875a54afdbebd83a8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/16/2019
ms.locfileid: "71030636"
---
# <a name="cloud-monitoring-guide-alerting"></a>Руководство по облачному мониторингу: Оповещение

В течение многих лет специалисты по ИТ сталкиваются с выносливостиами предупреждений, созданными средствами мониторинга, развернутыми на предприятии. Многие системы создают большое количество оповещений, которые часто считаются бессмысленными, а другие являются важными, но не проводятся или пропускаются. Как следствие, ИТ-отделы и операции разработчиков испытывают проблемы с требованиями к качеству уровня службы для внутренних или внешних клиентов. Важно понимать состояние инфраструктуры и приложений, чтобы обеспечить надежность. Необходимо быстро выявлять причины, чтобы свести к минимуму снижение производительности и прерывание работы службы или уменьшить число инцидентов.

## <a name="successful-alerting-strategy"></a>Стратегия успешного создания предупреждений

*Вы не можете исправить неизвестные сведения о нарушении.*

Предупреждение о том, что важно. Она подкрепляется путем сбора и измерения правильных метрик и журналов. Кроме того, вам потребуется средство мониторинга, которое может хранить, объединять, визуализировать, анализировать и инициировать автоматический ответ при выполнении условий. Улучшение наблюдаемых служб и приложений может быть выполнено только в том случае, если вы полностью понимаете его композицию. Вы сопоставляете эту композицию с подробной конфигурацией мониторинга, которая будет применена платформой мониторинга. Сюда входят прогнозируемые состояния сбоя (симптомы, которые не являются причиной сбоя), о которых имеет смысл создать предупреждение.

Примите во внимание следующие принципы, чтобы определить, является ли симптом подходящим кандидатом для предупреждений:

- **Имеет ли это значения?** Проблема признакома от реальной проблемы или проблемы, влияющей на общую работоспособность приложения? Например, нужно ли вам заботиться о высокой загрузке ЦП в ресурсе? Или что определенный SQL-запрос, выполняющийся в экземпляре базы данных SQL на этом ресурсе, потребляет высокую загрузку ЦП в течение длительного периода? Поскольку условие использования ЦП является реальной проблемой, вы должны получать оповещения о ней. Но вам не нужно уведомлять команду, так как она не помогает указывать на то, что вызывает условие в первую очередь. Предупреждения и уведомления об использовании процесса SQL-запроса являются актуальными и действиями.
- **Это срочно?** Является ли эта ситуация реальной, и она требует срочного внимания? Если да, то Группа, ответственная за группу, должна немедленно получать уведомления.
- **Затронули ли ваши клиенты?** Были ли пользователи службы или приложения, подверженные воздействию проблемы?
- **Затронуты ли другие зависимые системы?** Имеются ли предупреждения о взаимосвязанных зависимостях, которые могут быть сопоставлены, чтобы не уведомлять различных групп о том, что все работает над одной и той же проблемой?

Задавайте эти вопросы при первоначальной разработке конфигурации мониторинга. Протестируйте и проверяйте предположения в непроизводственной среде, а затем разверните их в рабочую среду. Конфигурации мониторинга являются производными от известных режимов сбоя, результатов имитации сбоев и взаимодействия разных членов группы.

После выпуска конфигурации мониторинга вы можете узнать о том, что работает, а что нет. Рассмотрите высокий объем оповещений, незамеченные проблемы, которые не были замечены конечными пользователями, а какие — лучшие действия, которые должны быть выполнены в рамках этой оценки. Выявление изменений, которые необходимо реализовать для улучшения доставки служб, в рамках непрерывного процесса улучшения мониторинга. Он не только оценивает шум оповещений или пропущенные оповещения, но и эффективность мониторинга рабочей нагрузки. Это зависит от эффективности политик оповещений, процесса и общего языка и региональных параметров, чтобы определить, что вы улучшаете.

И System Center Operations Manager, и Azure Monitor поддерживают оповещения на основе статических или даже динамических пороговых значений и действий, настраиваются поверх них. К примерам относятся оповещения для электронной почты, SMS и голосовой связи для простых уведомлений. Обе эти службы также поддерживают интеграцию ITSM, чтобы автоматизировать создание записей инцидентов и передать их в соответствующую группу поддержки или любую другую систему управления оповещениями с помощью веб-перехватчика.

По возможности для автоматизации действий по восстановлению можно использовать любую из нескольких служб. К ним относятся System Center Orchestrator, служба автоматизации Azure, Azure Logic Apps или автомасштабирование в случае эластичных рабочих нагрузок. Хотя уведомление о ответственных командах является наиболее распространенным действием для оповещений, также может быть уместна Автоматизация корректирующих действий. Это поможет упростить весь процесс управления инцидентами. Автоматизация этих задач восстановления также может снизить риск возникновения ошибок в человеке.

## <a name="azure-monitor-alerting"></a>Azure Monitor оповещения

Если вы используете Azure Monitor исключительно, то применимо следующее руководство. При расчете скорости, затрат и объема хранилища следует следовать этим рекомендациям в Azure Monitor.

Существует шесть репозиториев, в которых данные мониторинга хранятся в зависимости от используемой функции и конфигурации.

- **База данных метрик Azure Monitor.** База данных временных рядов используется в основном для Azure Monitor метрик платформы, но в ней также есть Application Insights данные метрик. Сведения, вводимые в эту базу данных, имеют наибольшее время оповещения.

- **Хранилище журналов Application Insights.** База данных, в которой хранятся большинство Application Insights телеметрии в форме журнала.

- **Хранилище журналов Azure Monitor.** Основное хранилище для данных журнала Azure. Другие средства могут передавать данные в него и анализировать их в журналах Azure Monitor. Запросы предупреждений журнала имеют большую задержку из-за приема и индексирования. Эта задержка обычно составляет 5-10 минут, но при определенных обстоятельствах она может быть выше.

- **Хранилище журналов действий.** Используется для всех событий журнала действий и работоспособности службы. Возможен выделенный оповещение. Содержит события уровня подписки, происходящие с объектами в подписке, как видно за пределами этих объектов. Например, если политика задана или доступ к ресурсу осуществляется или удаляется.

- **Служба хранилища Azure.** Хранилище общего назначения, поддерживаемое система диагностики Azure и другими средствами мониторинга. Это экономичный вариант долгосрочного хранения данных телеметрии мониторинга. Оповещения не поддерживаются в данных, хранящихся в этой службе.

- **Концентраторы событий.** Обычно используется для потоковой передачи данных в средства мониторинга или ITSM для локальных партнеров.

В Azure Monitor есть четыре типа оповещений, которые в некоторой степени привязаны к репозиторию, в котором хранятся данные.

- [Оповещение метрики](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-metric). Оповещения о данных в базе данных метрик Azure Monitor. Оповещения возникают, когда наблюдаемое значение пересекается с заданным пользователем пороговым значением, а затем снова возвращается в состояние "нормальное".

- [Оповещение о запросе журнала](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-log-query). Доступно для оповещений о содержимом в Application Insights или хранилищах журналов Azure. Также может оповещаться на основе запросов между рабочими областями.

- [Оповещение журнала действий](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-activity-log). Оповещения об элементах в хранилище журнала действий, за исключением данных о работоспособности службы.

- [Оповещение о работоспособности службы](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-activity-log-service-notifications?toc=%2fazure%2fservice-health%2ftoc.json). Особый тип оповещения — только для проблем работоспособности служб, поступающих из хранилища журналов действий.

### <a name="alerting-through-partner-tools"></a>Оповещение с помощью средств партнеров

Если вы используете внешнее решение для создания предупреждений, направьте его так, как это можно делать через концентраторы событий Azure, так как это самый быстрый путь из Azure Monitor. Вам придется платить за прием в концентратор событий. Если стоимость неважна, вы можете использовать службу хранилища Azure в качестве более дешевой альтернативы. Просто убедитесь, что средства мониторинга или ITSM могут читать хранилище Azure для извлечения данных.

Azure Monitor включает поддержку интеграции с другими платформами мониторинга и ITSM программного обеспечения, например ServiceNow. Вы можете использовать оповещения Azure и по-прежнему запускать действия вне Azure, как это необходимо для управления инцидентами или процесса DevOps. Если вы хотите создать оповещение в Azure Monitor и автоматизировать ответ, вы можете инициировать автоматические действия с помощью функций Azure, Azure Logic Apps или службы автоматизации Azure в зависимости от вашего сценария и требований.

### <a name="specialized-azure-monitoring-offerings"></a>Специализированные предложения мониторинга Azure

Обычно [решения](https://docs.microsoft.com/azure/azure-monitor/insights/solutions-inventory) по управлению хранят свои данные в хранилище журналов Azure. Эти два исключения Azure Monitor для виртуальных машин и Azure Monitor для контейнеров. В следующей таблице описывается процесс создания предупреждений на основе конкретного типа данных и места его хранения.

Решение| Тип данных | Поведение предупреждений
:---|:---|:---
Azure Monitor для контейнеров | Вычисленные средние данные о производительности из узлов и модулей Pod записываются в хранилище метрик. | Создавайте оповещения метрик, если вы хотите получать оповещения на основе вариации измеряемой производительности использования, агрегированной за определенный период времени.
|| Вычисленные данные производительности, использующие процентили из узлов, контроллеров, контейнеров и модулей Pod, записываются в хранилище журналов. Журналы контейнеров и сведения инвентаризации также записываются в хранилище журналов. | Создание оповещений о запросах журнала, если вы хотите получать оповещения на основе варианта измеряемого использования из кластеров и контейнеров. Оповещения о запросах журнала также можно настроить на основе количества фаз и количества узлов состояния.
Azure Monitor для виртуальных машин | Критерии работоспособности — это метрики, записываемые в хранилище метрик. | Оповещения создаются, когда состояние работоспособности изменяется с работоспособного на неработоспособное. Поддерживает только группы действий, настроенные для отправки уведомлений SMS или по электронной почте.
|| Данные журнала производительности операционной системы на карте и виртуальной машине записываются в хранилище журналов. | Создание оповещений о запросах журнала.

### <a name="fastest-speed-driven-by-cost"></a>Самая высокая скорость, управляемая затратами

Задержка — одно из важнейших решений, влияющих на предупреждения и быстрое разрешение проблем, влияющих на работу службы. Если вы хотите получать оповещения практически в реальном времени в течение пяти минут, сначала оцените ее, если у вас есть оповещения о телеметрии и они хранятся по умолчанию. Как правило, эта стратегия также является самым дешевым вариантом, так как используемое средство уже отправляет свои данные в это место.

С другой стороны, в этом правиле есть несколько важных сносок.

Данные **телеметрии гостевой ОС** имеют ряд путей, которые можно приступить к системе.

- Самый быстрый способ оповещения об этих данных — импортировать их в качестве пользовательских метрик. Это можно сделать с помощью расширения система диагностики Azure, а затем с помощью оповещения метрики. Однако пользовательские метрики сейчас находятся в режиме предварительной версии и [более дороги, чем другие параметры](https://azure.microsoft.com/pricing/details/monitor/).

- Самый дешевый, но самый медленный способ — отправить его в хранилище Azure Logs Kusto Store. Запуск агента Log Analytics на виртуальной машине — лучший способ получить метрику операционной системы на виртуальной машине и данные журналов в этом хранилище.

- Вы можете отправить в оба хранилища, запустив расширение и агент на одной виртуальной машине. Затем вы можете быстро получать оповещения, но также использовать данные операционной системы на виртуальной машине в составе более сложных поисков в сочетании с другими данными телеметрии.

**Импорт данных из локальной среды.** Если вы пытаетесь выполнять запросы и отслеживать компьютеры, работающие в Azure и локально, можно использовать агент Log Analytics для сбора данных операционной системы на виртуальной машине. Затем можно использовать функцию [журналов для метрик](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-metric-logs) , чтобы оптимизировать эти метрики в хранилище метрик. Этот метод обходит часть процесса приема в хранилище журналов Azure и, таким способом, становится доступной раньше в базе данных метрик.

### <a name="minimize-alerts"></a>Сведение предупреждений

Если вы используете такое решение, как Azure Monitor для виртуальных машин и найдете критерии работоспособности по умолчанию, которые отслеживают использование производительности приемлемым образом, не создавайте перекрывающиеся оповещения о метриках или запросах журналов на основе тех же счетчиков производительности.

Если вы не используете Azure Monitor для виртуальных машин, ознакомьтесь со следующими возможностями, чтобы упростить создание оповещений и Управление уведомлениями.  

> [!NOTE]
> Эти функции применяются только к оповещениям метрик. Это значит, что оповещения основываются на данных, отправляемых в базу данных метрик Azure Monitor. Они не применяются к другим типам оповещений. Как упоминалось ранее, основная цель оповещений метрик — скорость. Если получение предупреждения менее чем за 5 минут не является основной проблемой, можно использовать оповещение о запросе журнала.

- [Динамические пороговые значения](https://docs.microsoft.com/azure/azure-monitor/platform/alerts-dynamic-thresholds). Динамические пороговые значения проводят Просмотр активности ресурса за период времени и создают верхние и нижние пороговые значения нормального поведения. Если отслеживаемая метрика находится за пределами этих порогов, вы получаете предупреждение.

- [Оповещения о многознаковой подписи](https://azure.microsoft.com/blog/monitor-at-scale-in-azure-monitor-with-multi-resource-metric-alerts/). Можно создать оповещение метрики, которое использует сочетание двух различных входных значений из двух различных типов ресурсов. Например, если вы хотите запустить оповещение, когда ЦП виртуальной машины превышает 90%, а количество сообщений в определенной очереди служебной шины Azure, подающее виртуальную машину, превысит определенный объем, это можно сделать без создания запроса к журналу. Это работает только для двух сигналов. При наличии более сложного запроса данные метрик можно передать в Azure Monitor хранилище журналов и использовать запрос журнала.

- [Многоресурсные предупреждения](https://azure.microsoft.com/blog/monitor-at-scale-in-azure-monitor-with-multi-resource-metric-alerts/). Azure Monitor позволяет одно правило оповещения метрики, которое применяется ко всем ресурсам виртуальной машины. Эта функция может сэкономить время, поскольку вам не нужно создавать отдельные предупреждения для каждой виртуальной машины. Цены для этого типа оповещений одинаковы. Если вы создали 50 оповещений для мониторинга загрузки ЦП для виртуальных машин 50, или 1 оповещение, отслеживающее использование ЦП для всех виртуальных машин 50, то затраты на него будут одинаковы. Вы также можете использовать эти типы оповещений в сочетании с динамическими пороговыми значениями.

Эти функции позволяют экономить время за счет минимизации уведомлений об оповещениях и управления основными оповещениями.

### <a name="alerts-limitations"></a>Ограничения оповещений

Обратите внимание на [ограничения](https://docs.microsoft.com/azure/azure-subscription-service-limits#azure-monitor-limits) на количество создаваемых оповещений. Некоторые ограничения (но не все из них) можно увеличить, вызвав поддержку.

### <a name="best-query-experience"></a>Лучшие возможности запросов

Если вы ищете тенденции во всех данных, имеет смысл импортировать все данные в журналы Azure, если они еще не находятся в Application Insights. Вы можете создавать запросы в обеих рабочих областях, поэтому нет необходимости перемещать данные между ними. Вы также можете импортировать данные журнала действий и службы работоспособности в рабочую область Log Analytics. Вы платите за это место приема и хранения, но будете получать все данные в одном месте для анализа и запросов. Это также дает возможность создавать сложные условия запросов и предупреждать о них.
