---
title: Топология сети корпоративного уровня и подключение для миграции SAP
description: Общие сведения о проектировании и рекомендации по работе с сетью и подключением к Microsoft Azure и развертыванию SAP.
author: JefferyMitchell
ms.author: brblanch
ms.date: 03/01/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.custom: think-tank
ms.openlocfilehash: 304d25c93beb683842126227602b374a3e82d8d8
ms.sourcegitcommit: 36e85ac734b184de3f29884b744ea74c81ccc72b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2021
ms.locfileid: "103442978"
---
# <a name="enterprise-scale-network-topology-and-connectivity-for-an-sap-migration"></a>Топология сети корпоративного уровня и подключение для миграции SAP

В этой статье рассматриваются ключевые вопросы и рекомендации по проектированию сети и подключения к Microsoft Azure и развертыванию SAP.

## <a name="plan-for-ip-addressing"></a>Планирование IP-адресации

Важно спланировать IP-адресацию в Azure, чтобы обеспечить следующее:

- Пространство IP-адресов не пересекается между локальными расположениями и регионами Azure.
- Виртуальная сеть (VNet) содержит правильное адресное пространство.
- Правильное планирование конфигурации подсети выполняется заранее.

На следующей схеме архитектуры показаны вопросы масштабирования сети корпоративного уровня в наборе конструкций SAP в Azure:

 ![Схема сетевых возможностей корпоративного масштабирования в наборе конструкций SAP в Azure.](./media/ntc-architecture.png#lightbox)

*Рис. 1. схема сетевых возможностей корпоративного масштабирования в наборе конструкций SAP в Azure.*

**Рекомендации по проектированию для реализации SAP:**

Вы можете [выделить](/azure/virtual-network/virtual-network-for-azure-services#services-that-can-be-deployed-into-a-virtual-network) подсети и делегировать их определенным службам, а затем создать экземпляры этих служб в подсетях. Хотя Azure помогает создать несколько делегированных подсетей в виртуальной сети, для Azure NetApp Files может существовать только одна Делегированная подсеть. Попытка создать новый том завершится ошибкой, если для Azure NetApp Files используется более одной делегированной подсети.

**Вариант использования:**

Делегированные подсети необходимы для реализации Azure NetApp Files, что является популярным при развертывании SAP с использованием общих файловых систем. Делегированная подсеть требуется только для шлюза приложений в случае таких сценариев SAP, как балансировка нагрузки или SAP BusinessObjects Business Intelligence, сервера веб-приложений SAP с балансировкой нагрузки.

## <a name="configure-dns-and-name-resolution-for-on-premises-and-azure-resources"></a>Настройка DNS и разрешения имен для локальных и ресурсов Azure

Служба доменных имен (DNS) является важнейшим разделом разработки в общей архитектуре корпоративного масштаба. Некоторым организациям может потребоваться использовать существующие вложения в DNS. Другие могут видеть внедрение облака как возможность модернизировать свою внутреннюю инфраструктуру DNS и использовать собственные возможности Azure.

**Рекомендации по проектированию для реализации SAP:**

Следующие рекомендации предназначены для того, когда DNS-имя или виртуальная машина виртуальной машины не изменяется во время миграции.

**Вариант использования:**

- Фоновые DNS и виртуальные имена соединяют многие системные интерфейсы в ландшафте SAP, а клиенты иногда знают о интерфейсах, определяемых разработчиками с течением времени. Проблемы подключения возникают между различными системами, когда виртуальные или DNS-имена изменяются после миграции, и рекомендуется хранить псевдонимы DNS для предотвращения подобных проблем.

- Используйте разные зоны DNS, чтобы отличать каждую среду (песочницу, разработку, предварительную продукцию и рабочую) друг от друга. Исключением являются развертывания SAP с собственной виртуальной сетью; в этом случае частные зоны DNS могут оказаться ненужными.

## <a name="define-an-azure-network-topology"></a>Определение топологии сети Azure

Центральные зоны корпоративного уровня поддерживают две сетевые топологии: одна на основе виртуальной глобальной сети Azure, а другая — традиционная топология сети на основе архитектуры "звезда". В этом разделе приводятся рекомендации по конфигурации и методикам SAP для обеих моделей развертывания.

Используйте топологию сети на основе виртуальной глобальной сети, если ваша организация планирует:

- Развертывайте ресурсы в нескольких регионах Azure и подключайте свои глобальные расположения как к Azure, так и к локальной среде.
- Полная интеграция программно-определяемых развертываний глобальной сети с помощью Azure.
- Развертывание до 2 000 рабочих нагрузок виртуальных машин во всех виртуальных сетей, подключенных к одному виртуальному концентратору глобальной сети.

Организации используют виртуальную глобальную сеть для удовлетворения потребностей крупномасштабного взаимодействия. Корпорация Майкрософт управляет этой службой, что помогает сократить общую сложность сети и модернизировать сеть Организации.

Используйте традиционную топологию сети Azure на основе архитектуры "звезда", если ваша организация:

- Планирование развертывания ресурсов только в выбранных регионах Azure
- Не требуется глобальная, взаимосвязь сети
- Имеет несколько удалений или расположений ветвей в одном регионе и требует менее 30 туннелей IP-безопасности (IPsec).
- Требует полного контроля и детализации для ручной настройки сети Azure

**Рекомендации по проектированию для реализации SAP:**

- Используйте виртуальную сеть WAN для развертываний Azure в новых, крупных или глобальных сетях, где требуется глобальное транзитное подключение между регионами Azure и локальными расположениями. При таком подходе вам не придется вручную настраивать транзитную маршрутизацию для сетей Azure, и вы можете следовать стандарту для развертываний SAP в Azure.

- Рассмотрите возможность развертывания виртуальных сетевых модулей (NVA) между регионами, только если используется Партнерская NVA. NVA между регионами или виртуальных сетей не требуются, если имеются собственные NVA. При развертывании технологий сетевых сетей и NVA используйте рекомендации поставщика по проверке конфликтующих конфигураций с помощью сети Azure.

- Виртуальная глобальная сеть управляет подключением между периферийными виртуальных сетей для топологий на основе виртуальной глобальной сети (не нужно настраивать определяемую пользователем маршрутизацию [UDR] или NVA), а максимальная пропускная способность сети для трафика между виртуальными сетями в одном виртуальном концентраторе составляет 50 гигабит в секунду. При необходимости в зонах размещения SAP можно использовать пиринг виртуальных сетей для подключения к другим зонам размещения и преодоления этого ограничения пропускной способности.

- Развертывание NVA на сервере базы данных приложения SAP не поддерживается.

- Локальный и глобальный пиринг виртуальных сетей обеспечивают подключение и являются предпочтительными подходами для обеспечения подключения между зонами размещения для развертываний SAP в нескольких регионах Azure.

## <a name="plan-for-in--and-outbound-internet-connectivity"></a>Планирование встроенного и исходящего подключения к Интернету

В этом разделе приводятся рекомендации по моделям подключения для установления и исходящего подключения к общедоступному Интернету. Так как Azure — собственные службы безопасности сети, такие как брандмауэр Azure, брандмауэр веб-приложения Azure на шлюзе приложений и передняя дверца Azure, являются полностью управляемыми службами, вы не несете расходов на эксплуатацию и управление, связанные с развертываниями инфраструктуры, которые могут стать сложными в масштабе.

**Рекомендации по проектированию для реализации SAP:**

- Для клиентов с глобальной областью использования [, она](/azure/frontdoor/front-door-overview) позволяет развертывать приложения SAP с помощью политик брандмауэра веб-приложения Azure для предоставления и защиты глобальных приложений HTTP/S в регионах Azure.

- Воспользуйтесь преимуществами политик брандмауэра веб-приложений в передней дверце Azure, если вы используете эту службу и шлюз приложений для защиты приложений HTTP/S. Блокировка шлюза приложений для получения трафика только из передней дверцы Azure.

- Шлюз приложений и брандмауэр веб-приложения имеют ограничения, когда шлюз приложений выступает в качестве обратных прокси-серверов для приложений SAP, как показано в сравнении между шлюзом приложений, веб-диспетчером SAP и сторонней службой NetScaler.

Поскольку веб-диспетчер SAP и NetScaler являются более интеллектуальными по сравнению с шлюзом приложений, для их замены с помощью этой службы требуется всестороннее тестирование. Проверьте актуальное состояние и перечислите все поддерживаемые и неподдерживаемые (или протестированные/не протестированные) сценарии, если это возможно.

- Используйте брандмауэр веб-приложения для сканирования трафика при доступе к Интернету. Другой вариант — использовать его с подсистемой балансировки нагрузки или с ресурсами, имеющими встроенные возможности брандмауэра, такими как шлюз приложений или сторонние решения.

- Чтобы предотвратить утечку данных, используйте частную связь Azure для безопасного доступа к платформе как к ресурсам службы, таким как хранилище BLOB-объектов Azure, служба файлов Azure, Azure Data Lake Storage 2-го поколения, фабрика данных Azure и многое другое. Частная конечная точка Azure также помогает защитить трафик между виртуальных сетей и службами, такими как служба хранилища Azure, Azure Backup и многое другое. Трафик между виртуальной сетью и службой с закрытой конечной точкой перемещается по глобальной сети Майкрософт, что предотвращает его раскрытие с общедоступным Интернетом.

## <a name="define-network-encryption-requirements"></a>Определение требований к шифрованию сети

В этом разделе рассматриваются основные рекомендации по шифрованию сетей между локальной средой и Azure, а в регионах Azure.

**Рекомендации по проектированию для реализаций SAP:**

- В настоящее время трафик не шифруется при использовании Azure ExpressRoute для настройки частного пиринга.

- Нет необходимости шифровать трафик по ExpressRoute для развертываний SAP. Трафик SAP обычно потребляет много пропускной способности и зависит от производительности. По умолчанию туннели IPsec шифруют трафик Интернета, а шифрование или расшифровку может негативно сказаться на производительности трафика.

- Клиент должен определить, следует ли шифровать трафик SAP. Ознакомьтесь с [топологией сети и подключением](../../ready/enterprise-scale/network-topology-and-connectivity.md#define-network-encryption-requirements) , чтобы ознакомиться с вариантами шифрования сети в целевых зонах корпоративного масштаба.

## <a name="segregate-systems"></a>Разделение систем

Так как в сценарии SAP существуют различные среды, такие как разработка, тестирование, качество, предварительная продукция, Рабочая среда и т. д., клиенты, как правило, делят эти системы на логические или физические конструкции, чтобы правилами стандарты безопасности и соответствия требованиям. Идея состоит в управлении всеми системами с одним и тем же жизненным циклом в одной общей группе ресурсов, и группирование может быть определено на различных уровнях, например на уровне подписки или группы ресурсов. Организациям также следует учитывать структуру безопасности и политики при группировании ресурсов в ландшафте SAP. Однако для транспорта SAP между разработкой, тестированием, качеством и производством может потребоваться:

- Пиринг виртуальных сетей и связанные затраты
- Порт брандмауэра, отличный от виртуальных сетей
- UDR и правила группы безопасности сети (NSG)

Не рекомендуется размещать систему управления базами данных (СУБД) и уровни приложений систем SAP в разных виртуальных сетей, а также подключать их к пирингу виртуальных сетей из-за значительных расходов на создание чрезмерного сетевого трафика между этими слоями.

**Дополнительные рекомендации по реализации SAP:**

- Размещение уровня приложений SAP и СУБД SAP в разных виртуальных сетейах Azure, не являющихся равноправными, не поддерживаются.

- Вы можете использовать правила группы безопасности приложений (ASG) и NSG для определения списков управления доступом к сети между приложением SAP и уровнями СУБД. ASG группы виртуальных машин, помогающие управлять безопасностью.

- Убедитесь, что на виртуальных машинах, используемых в приложении SAP и на уровнях СУБД, включена Ускоренная сеть Azure. Учтите, что различные уровни операционной системы поддерживают ускорение сети в Azure:

  - Windows Server 2012 R2 и более поздние версии
  - SUSE Linux 12 SP3 или более поздней версии
  - Red Hat Enterprise Linux 7,4 или более поздней версии
  - Oracle Linux 7,5: Release 3.10.0-862.13.1. el7 требуется для ядра, совместимого с Red Hat Enterprise Linux. Для неповрежденного корпоративного ядра Oracle требуется выпуск 5.

- Убедитесь, что во внутренних развертываниях для Azure Load Balancer настроено использование прямого возврата сервера (DSR). Этот параметр позволяет сократить задержку при использовании внутренних конфигураций подсистемы балансировки нагрузки для конфигураций с высоким уровнем доступности на уровне СУБД.

- При использовании Load Balancer с гостевыми операционными системами Linux убедитесь, что параметр сети Linux `net.ipv4.tcp_timestamps` имеет значение `0` .

- Чтобы обеспечить оптимальную задержку в сети с приложениями SAP, рассмотрите возможность использования [групп размещения близости к Azure](/azure/virtual-machines/workloads/sap/sap-proximity-placement-scenarios).

- Ознакомьтесь с [порталом поддержки SAP](https://support.sap.com/en/index.html) и [примечанием SAP 2391465](https://launchpad.support.sap.com/#/notes/2931465) , чтобы узнать больше о реализации SAP.
