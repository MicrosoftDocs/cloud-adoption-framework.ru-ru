---
title: Непрерывность бизнес-процессов и аварийное восстановление в масштабах предприятия для миграции SAP
description: Сведения о непрерывности бизнес-процессов и аварийном восстановлении для миграции SAP в рамках платформы внедрения Microsoft Cloud для Azure.
author: JeffreyMitchell
ms.author: brblanch
ms.date: 3/12/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.custom: think-tank
ms.openlocfilehash: c0b5c312ca35d57b3a7ea06c83c1d646c01663cf
ms.sourcegitcommit: 36e85ac734b184de3f29884b744ea74c81ccc72b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/13/2021
ms.locfileid: "103442895"
---
<!-- docutune:casing "Azure Fence Agent" -->
<!-- docutune:ignore DB -->

# <a name="enterprise-scale-business-continuity-and-disaster-recovery-for-an-sap-migration"></a>Непрерывность бизнес-процессов и аварийное восстановление в масштабах предприятия для миграции SAP

## <a name="scenario-and-scope"></a>Сценарий и область

Ваша организация или предприятие должны проектировать возможности уровня платформы, которые помогают рабочим нагрузкам приложений соответствовать определенным требованиям. Приложения SAP, работающие с важнейшими бизнес-процессами Организации, имеют следующие требования.

- Доступность службы/бизнес-процесса

- Целевые показатели времени восстановления (RTO) во время сбоев или аварийных ситуаций; Например, сценарий сбоя ограничен компонентом системы SAP или распространенным сбоем, влияющим на центр обработки данных или регион Azure.

- Цели точки восстановления (RPO) для сценария сбоя, ограниченного компонентом системы SAP или распространенным сбоем, влияющим на центр обработки данных или регион Azure.
- Для задач управления рабочими и жизненным циклом может потребоваться технология, которая заполняется для сценариев сбоя. Эти задачи управления включают исправление исправлений для гостевых операционных систем и систем управления базами данных, клонирование и обновление систем SAP.

Ваша архитектура имеет множество принципов и задач, позволяющих решать сценарии непрерывности бизнес-процессов и аварийного восстановления (BCDR) в локальной среде, а также применять их в Azure. Основное отличие состоит в том, что в Azure может быть больше аппаратных ресурсов, чем в Организации, чтобы компенсировать сбой узла. Даже самые крупные виртуальные машины Azure могут быть восстановлены с помощью перезапуска на другом сервере. Помимо этого, те же условия применяются и к локальным. Таким образом в Azure также должны быть развернуты системы, развернутые с помощью конфигураций автоматического перехода на другой ресурс в локальной среде или на оборудовании с несистемным восстановлением.

В этой статье рассматриваются следующие аспекты BCDR для сценария SAP корпоративного масштаба.

- Высокий уровень доступности (HA) в регионе Azure
- Рекомендации по резервному копированию и восстановлению
- Аварийное восстановление: критерии выбора между региональными и региональными решениями аварийного восстановления

### <a name="high-availability-ha-within-an-azure-region"></a>Высокий уровень доступности (HA) в регионе Azure

**Рекомендации по проектированию для HA:**

С высокой доступностью основное внимание уделяется обеспечению доступности для единой точки отказа программного обеспечения SAP, например:

- Системы управления базами данных
- Единые точки отказа в приложении, такие как ABAP SAP ASCS/SCS (например, архитектура SAP NetWeaver и S/4HANA).
- Другие средства, например веб-диспетчер SAP

В других случаях доступность не должна быть ограничена инфраструктурой или программным обеспечением и должна включать все необходимые задачи управления жизненным циклом, такие как исправление операционной системы на виртуальных машинах, СУБД или программном обеспечении SAP. Для минимизации простоев, которые могут возникнуть во время запланированного простоя и задач управления жизненным циклом, можно использовать общие средства, защищающие от незапланированных нарушений в работе служб.

Базы данных SAP и SAP поддерживают автоматические отказоустойчивые кластеры. Функция отказоустойчивой кластеризации Windows Server достигает этого в Windows, тогда как Linux Pacemaker или сторонние средства, такие как SIOS Protection Suite или Veritas Инфоскале, предназначены для Linux. С помощью Azure можно развернуть только подмножество конфигураций высокой доступности в собственном центре обработки данных.

Ознакомьтесь с [рабочими нагрузками SAP в сценариях, поддерживаемых виртуальной машиной Azure](/azure/virtual-machines/workloads/sap/sap-planning-supported-configurations) , и [поддерживаемыми сценариями для SAP HANA (крупные экземпляры)](/azure/virtual-machines/workloads/sap/hana-supported-scenario) , чтобы узнать о поддерживаемых Azure для SAP.

Для уровня СУБД распространенным шаблоном архитектуры является репликация баз данных в то же время и с различными стеками хранилища, используемыми первичной и вторичной машинами. Azure не поддерживает архитектуры, в которых основное и вторичное хранилище общих ресурсов виртуальной машины для данных СУБД, а также не поддерживают журналы транзакций и повторов. Принцип GUID состоит в том, что необходимо наличие двух независимых стеков хранилища, даже если они основаны на общих ресурсах NFS, и это основное ограничение по сравнению с тем, что возможно в локальной среде.

В Azure есть другие варианты, так как служба поддерживает общий доступ к блокам сообщений NFS или сервера. [Общий диск Azure](/azure/virtual-machines/disks-shared) можно использовать в Windows для компонентов ASCS/SCS и конкретных СЦЕНАРИЯХ высокой доступности. Отказоустойчивые кластеры должны быть настроены отдельно для компонентов уровня приложений SAP и уровня СУБД, так как Azure не поддерживает архитектуры с высоким уровнем доступности, сочетающие компоненты уровня приложений SAP и уровень СУБД в одном отказоустойчивом кластере.

Для большинства отказоустойчивых кластеров компонентов уровня приложений SAP и уровня СУБД требуется виртуальный IP-адрес для отказоустойчивого кластера. Одним из распространенных исключений является Oracle Data Guard, функциональность которого не требует виртуального IP-адреса. [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) должны поддерживать виртуальный IP-адрес во всех остальных случаях. В качестве принципа проектирования используйте один Load Balancer на конфигурацию кластера. рекомендуется использовать стандартную версию балансировщика нагрузки. Дополнительные сведения см. [в статье подключение к общедоступной конечной точке для виртуальных машин с помощью Load Balancer (цен. Категория "Стандартный") Azure в сценариях с высоким уровнем доступности SAP](/azure/virtual-machines/workloads/sap/high-availability-guide-standard-load-balancer-outbound-connections).

Ознакомьтесь с [архитектурой высокой доступности и сценариями для SAP NetWeaver](/azure/virtual-machines/workloads/sap/sap-high-availability-architecture-scenarios) , чтобы получить дополнительные сведения и возможности.

#### <a name="azure-availability-sets-vs-availability-zones"></a>Группы доступности Azure и Зоны доступности

Перед развертыванием инфраструктуры высокой доступности и в зависимости от выбранного региона решите, хотите ли вы выполнить развертывание с помощью [группы доступности Azure](/azure/virtual-machines/availability) или зоны доступности. Ниже приведены основные отличия виртуальных машин, развернутых с помощью группы доступности.

- Виртуальные машины не распределяются по разным Зоны доступности.

- Тип виртуальных машин, которые могут быть развернуты через одну группу доступности, ограничен, так как узел определяется первой виртуальной машиной, развернутой в наборе. Одним из примеров является то, что вы не сможете объединить виртуальные машины серии M и серии E в одну группу доступности.

Одним из преимуществ развертывания архитектуры высокой доступности в разных Зоны доступности является то, что соглашение об уровне обслуживания для виртуальных машин может быть более высоким. Дополнительные сведения см. в описании [соглашения об уровне обслуживания для виртуальной машины Azure](https://azure.microsoft.com/support/legal/sla/virtual-machines/v1_9/). В зависимости от региона Azure вы можете обнаружить различные условия задержки сети в сетевом трафике между виртуальными машинами. Дополнительные сведения о развертывании рабочих нагрузок SAP в разных Зоны доступности см. [в статье конфигурации рабочих нагрузок SAP с зоны доступности Azure](/azure/virtual-machines/workloads/sap/sap-ha-availability-zones) .

**Рекомендации по проектированию для HA:**

- Azure предлагает несколько вариантов, чтобы обеспечить соответствие приложений требованиям соглашения об уровне обслуживания. Необходимо выбрать один и тот же вариант для всех трех компонентов SAP (Центральные службы, сервер приложений и база данных).

  - Соглашение об уровне обслуживания для одной виртуальной машины предлагает 99,9%.
  - Развертывание группы доступности предлагает 99,95 процентов.
  - Зоны доступности предложение 99,99%.

- В развертывании группы доступности каждый компонент системы SAP должен находиться в собственной группе доступности. Центральные службы SAP, базы данных и виртуальные машины приложений должны быть сгруппированы в группы доступности.

- При использовании групп размещения близости к Azure в развертывании группы доступности все три компонента SAP (Центральные службы, сервер приложений и база данных) должны находиться в одной и той же группе размещения.

- Используйте одну группу размещения с учетом расположения на уровне безопасности SAP. Группы не охватываются в Зоны доступности или в регионах Azure.

- В настоящее время Azure не поддерживает объединение ASCS и базы данных HA в одном кластере Linux Pacemaker. Разделите их на отдельные кластеры. Однако можно объединить до пяти [кластеров центральных служб](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-multi-sid) в пару виртуальных машин.

- Используйте номер SKU Load Balancer (цен. категория "Стандартный") перед кластерами ASCS и DB.

- Все рабочие системы должны работать на твердотельных накопителях, управляемых с помощью Premium, и использовать Azure NetApp Files или диски Ultra. По крайней мере диск ОС должен иметь уровень "Премиум", чтобы повысить производительность и лучшее соглашение об уровне обслуживания.

- Обе виртуальные машины в паре HA должны быть развернуты в группе доступности, или Зоны доступности должны иметь одинаковый размер и иметь одинаковую конфигурацию хранилища.

- Для синхронизации базы данных в паре с высоким уровнем доступности следует использовать технологию собственной репликации базы данных.

- Для запуска кластеров централизованных служб SAP в разных операционных системах следует выбрать одну из следующих служб.

  - [Кластер SUSE Linux Enterprise Server Pacemaker](/azure/virtual-machines/workloads/sap/high-availability-guide-suse-netapp-files): поддерживает до трех блочных устройств STONITH (сбдс) или агента ограждения Azure.
  - [Кластер Red Hat Enterprise Linux Pacemaker](/azure/virtual-machines/workloads/sap/high-availability-guide-rhel-netapp-files): SBD еще не поддерживается; поддерживается только агент ограждения Azure.
  - [Кластер Windows](/azure/virtual-machines/workloads/sap/sap-ascs-ha-multi-sid-wsfc-shared-disk)
  - Программное обеспечение сторонних кластеров, сертифицированное SAP

- Необходимо настроить параметры времени ожидания кластера, Рекомендуемые в документации по Центральным службам и кластерам баз данных.

### <a name="backuprestore"></a>Резервное копирование и восстановление

**Рекомендации по проектированию для резервного копирования и восстановления:**

Хотя резервное копирование и восстановление обычно не считаются достаточной функциональностью высокой доступности для производственной рабочей нагрузки SAP, эта технология охватывает различные другие области. Большинству компаний, использующих приложения SAP, необходимо следовать нормативным требованиям, которые требуют хранения резервных копий в течение многих лет. Существуют также другие условия и сценарии, в которых резервное копирование и возможность восстановления из него являются обязательными. Предполагается, что вы уже устанавливаете и выполняете рекомендации по резервному копированию и восстановлению для развертывания приложений SAP. Это означает, что вы можете:

- Выполните восстановление на момент времени для рабочих баз данных в любой момент времени и в течение интервала, соответствующего вашему RTO; Восстановление до точки во времени обычно включает ошибки операторов, которые удаляют данные на уровне СУБД или через SAP.

- Храните магазин, где вы храните долгосрочные резервные копии для удовлетворения нормативных требований.

- Используйте резервные копии базы данных для клонирования системы SAP и их восстановления на другом сервере или виртуальной машине.

- Используйте данные рабочей базы данных из резервных копий баз данных для обновления непроизводственных систем.

- Резервное копирование серверов приложений SAP, виртуальных машин, дисков или моментальных снимков виртуальных машин.

Если это можно сделать в локальной среде, необходимо перенести эти возможности в системы SAP в Azure.

Если вы удовлетворены текущим решением, проверьте, поддерживает ли поставщик резервного копирования службы развертывания Azure или настроено ли в Azure решение SaaS (программное обеспечение как услуга).

Azure предоставляет резервную службу SaaS, [Azure Backup](/azure/backup/backup-overview), которая принимает моментальные снимки виртуальной машины и управляет потоковой [SQL Server](/azure/backup/backup-azure-sql-database) и [SAP HANA](/azure/backup/sap-hana-db-about) резервным копированием. Если вы используете [Azure NetApp Files](https://azure.microsoft.com/services/netapp/) для хранения баз данных SAP Hana, можно выполнять резервное копирование на основе моментальных снимков хранилища, поддерживающих Hana.

**Рекомендации по проектированию для резервного копирования и восстановления:**

- Для резервного копирования сервера приложений SAP и виртуальных машин Центральной службы можно использовать Azure Backup.

- Резервную копию SAP HANA можно использовать для развертываний HANA до 8 ТБ. Дополнительные сведения см. в матрице поддержки для [резервного копирования SAP HANA баз данных на виртуальных машинах Azure](/azure/backup/sap-hana-backup-support-matrix).

- Проверьте время резервного копирования и восстановления, чтобы убедиться, что они соответствуют вашему RTO.

- Не рекомендуется извлекать резервные копии из Azure в локальную инфраструктуру резервного копирования, особенно с большими базами данных. Этот параметр влияет на объем пропускной способности, потребляемой каналами ExpressRoute.

### <a name="dr"></a>ПРОГРАММОЙ

**Рекомендации по проектированию для аварийного восстановления:**

На [карте региона Azure](https://azure.microsoft.com/global-infrastructure/geographies/) отображается более 60 регионов Azure, а не все они выполняют одни и те же службы. Во время крупномасштабных развертываний программного обеспечения SAP, особенно с помощью SAP HANA, найдите регионы Azure, которые предлагают виртуальные машины Azure [серии M](/azure/virtual-machines/m-series) и (или [) Mv2](/azure/virtual-machines/mv2-series) . Служба хранилища Azure также применяет разные регионы для репликации меньшего подмножества типов хранения в другой регион. Дополнительные сведения см. в статье Общие сведения о [парных регионах Azure](/azure/best-practices-availability-paired-regions).

Ниже перечислены основные проблемы, связанные с связыванием регионов Azure для рабочих нагрузок SAP.

- Эти пары не всегда согласуются со службами виртуальных машин серии M или Mv2. Многие клиенты, развертывающие свои системы SAP, не входят в парные регионы Azure и в то же самое относятся к доступности служб требуемых семейств виртуальных машин.

- Хранилище уровня "Стандартный" может быть реплицировано между парными регионами, но не может хранить базы данных или виртуальные жесткие диски. Вы можете реплицировать только резервные копии только между парными регионами, которые вы используете. Для всех остальных данных выполните собственные репликации с собственными функциями СУБД, такими как SQL Server Always On, SAP HANA репликация системы и другие службы. Используйте сочетание Azure Site Recovery, `rsync` / `robocopy` и другого стороннего программного обеспечения для уровня приложений SAP.

После определения регионов Azure второе решение по проектированию Организации должно решить, следует ли развертывать рабочие системы в основном регионе, непроизводственных системах SAP в регионе аварийного восстановления или если вы используете архитектуру, которая группирует все системы SAP в основной регион, чтобы регион аварийного восстановления использовался только для регионов аварийного восстановления. В текущем шаблоне развертывания клиентов SAP показаны большинство клиентов, использующих оба региона для работающих систем SAP. Клиенты, которые обычно запускают полные копии своих рабочих систем в качестве системы тестовой регрессии, обычно планируют использовать систему бизнес-тестов линейной регрессии SAP в качестве цели аварийного восстановления.

Еще один важный фактор, определяющий, какой из двух регионов Azure должен быть в качестве региона аварийного восстановления, — если у вас есть несколько каналов Azure ExpressRoute, подключающихся к Azure. По крайней мере один канал ExpressRoute должен подключаться к основному региону Azure, а другие — к региону аварийного восстановления. Этот тип архитектуры должен подключаться к сети Azure в другой географической области и защищать подключение, если катастрофы влияет на другой регион Azure.

Некоторые клиенты используют сочетание архитектуры высокой доступности и аварийного восстановления, которое группирует высокий уровень доступности с аварийным восстановлением в одном регионе Azure и обычно не рекомендуется. [Зоны доступности Azure](/azure/availability-zones/az-overview) поддерживают эту архитектуру. Поскольку расстояние между Зоны доступности в пределах одного региона Azure не так велико, как расстояние между двумя разными регионами Azure, естественная авария может подвергнуть риску эту архитектуру в том регионе, где она выполняется. Клиенты выбирают эту архитектуру по следующим причинам:

- Соблюдение конфигураций, которые поддерживают меньше расстояний между рабочим развертыванием и целевым объектом аварийного восстановления;
- Аспекты независимости данных
- Неадминистративные факторы

Другой фактор, который следует учитывать при выборе региона аварийного восстановления, — это RPO и RTO для перехода на сайт аварийного восстановления. Чем выше расстояние между рабочими и АВАРИЙными регионами, тем больше задержка в сети. Несмотря на то, что репликация между различными регионами Azure выполняется в асинхронном режиме, задержка в сети может повлиять на пропускную способность, которую вы можете реплицировать, и целевой объект RPO. Часто можно сократить нагрузку, используя архитектуру высокой доступности и аварийного восстановления, но с повышенным риском на основе крупномасштабных и естественных катастроф.

**Рекомендации по проектированию для аварийного восстановления:**

- CIDR для основной виртуальной сети (VNet) не должно конфликтовать или перекрываться с CIDR виртуальной сети сайта аварийного восстановления.

- Настройте подключения ExpressRoute из локальной среды к основному и дополнительному региону Azure DR.

- Альтернативой использованию ExpressRoute является настройка VPN-подключений из локальных регионов к основному и дополнительному регионам Azure DR.

- Используйте Site Recovery для репликации сервера приложений на сайт аварийного восстановления. Site Recovery также может помочь при репликации виртуальных машин кластера Центральной службы на сайт аварийного восстановления. При запуске аварийного восстановления необходимо перенастроить кластер Linux Pacemaker на сайте аварийного восстановления (например, заменить VIP или SBD, выполнить `corosync.conf` и многое другое).

- Используйте репликацию между регионами в Azure NetApp Files для синхронизации файловых томов между основным регионом и регионами аварийного восстановления. Репликация между регионами [в настоящее время доступна в общедоступной предварительной версии](/azure/azure-netapp-files/cross-region-replication-introduction).

- Для синхронизации данных с сайтом аварийного восстановления следует использовать собственную репликацию базы данных. Site Recovery не следует использовать.

- Пиринг основного и АВАРИЙного виртуальных сетей. Например, для репликации системы HANA виртуальная сеть SAP HANA DB должна быть соединена с виртуальной сетью SAP HANA DB сайта аварийного восстановления.

- Вы должны создать две учетные записи Azure NetApp Files в двух разных регионах на уровне Premium, по крайней мере, если для развертываний SAP используется хранилище Azure NetApp Files.
