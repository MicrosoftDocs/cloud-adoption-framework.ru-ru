---
title: Непрерывность бизнес-процессов и аварийное восстановление для службы Kubernetes Azure в масштабах предприятия
description: Опишите, как этот сценарий корпоративного уровня может улучшить непрерывность бизнес-процессов и аварийное восстановление службы Azure Kubernetes.
author: JeffMitchell
ms.author: jemitche
ms.date: 02/18/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: fa72f05e479ff56a7163a747ea5cca49c08e7199
ms.sourcegitcommit: b8f8b7631aabaab28e9705934bf67dad15e3a179
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101797547"
---
# <a name="enterprise-scale-business-continuity-and-disaster-recovery-for-azure-kubernetes-service"></a>Непрерывность бизнес-процессов и аварийное восстановление для службы Kubernetes Azure в масштабах предприятия

Организация должна разрабатывать подходящие возможности уровня платформы Azure Kubernetes Service (AKS) для удовлетворения своих конкретных требований. Эти службы приложений имеют требования, связанные с целевым временем восстановления (RTO) и целевой точкой восстановления (RPO). Существует несколько рекомендаций по устранению аварийного восстановления AKS. Первым шагом является определение соглашения об уровне обслуживания (SLA) для инфраструктуры и приложения. Узнайте о [соглашении об уровне обслуживания для службы Azure Kubernetes (AKS)](https://azure.microsoft.com/support/legal/sla/kubernetes-service/v1_1/). Сведения о вычислении месячного времени работы см. в разделе **сведения об уровне обслуживания** .

## <a name="design-considerations"></a>Рекомендации по проектированию

Примите во внимание следующие факторы.

- Кластер AKS должен использовать несколько узлов в пуле узлов, чтобы обеспечить минимальный уровень доступности приложения.

- Установка [запросов и ограничений Pod](/azure/aks/developer-best-practices-resource-management#define-pod-resource-requests-and-limits). Установка этих ограничений позволяет Kubernetes:

  - Эффективное предоставление ресурсов ЦП и памяти для модулей Pod.

  - Более высокая плотность контейнеров на узле.

  Ограничения также могут повысить надежность благодаря снижению затрат из-за более эффективного использования оборудования.

- Пригодность AKS для [зоны доступности](/azure/aks/availability-zones) или групп доступности.

  - Выберите регион с поддержкой зон доступности.

  - Зоны доступности можно задать только при создании пула узлов и последующего изменения. Поддержка многозоны применяется только к пулам узлов.

  - Для полного преимущества зональные все зависимости службы также должны поддерживать зоны. Если зависимая служба не поддерживает зоны, возможно, сбой зоны приведет к сбою этой службы.

  - Чтобы получить более высокий уровень доступности, чем Зоны доступности может достичь, запустите несколько кластеров AKS в разных парных регионах. Если ресурс Azure поддерживает геоизбыточность, укажите расположение, в котором у избыточной службы будет свой дополнительный регион.

- Следует иметь в виду [рекомендации по аварийному восстановлению](/azure/aks/operator-best-practices-multi-region) в AKS. Затем определите, применяются ли они к кластерам AKS, которые используются для Azure Dev Spaces.

- Согласованно создавайте резервные копии приложений и данных.

  - Службу без отслеживания состояния можно эффективно реплицировать.

  - Если необходимо сохранить состояние в кластере (не рекомендуется), убедитесь, что вы регулярно создаете резервные копии данных в парном регионе.

- Обновление и обслуживание кластера.

  - Всегда обновляйте кластер.

  - Помните о процессе выпуска и устаревания.

  - Планируйте обновления и обслуживание заранее.

- Сетевое подключение, если происходит отработка отказа.

  - Выберите маршрутизатор трафика, который может распределять трафик между зонами или регионами в зависимости от требований. Эта архитектура развертывает [Azure Load Balancer](/azure/load-balancer/load-balancer-overview) , так как она может распределять трафик между зонами без веб-сайта.

  - Если вам нужно распределить трафик между регионами, попробуйте использовать [переднюю дверцу Azure](/azure/frontdoor/front-door-overview).

- Запланированные и незапланированные отработки отказа.

  - При настройке каждой службы Azure выберите компоненты, поддерживающие аварийное восстановление. Например, в этой архитектуре включите [Реестр контейнеров Azure](/azure/container-registry/container-registry-intro) для георепликации. Если регион выходит из строя, вы по-прежнему можете получать изображения из реплицированной области.

- Настройте возможности инженерного DevOpsа для достижения целей уровня обслуживания.

- Определите, требуется ли [соглашение об уровне обслуживания с финансовыми](/azure/aks/uptime-sla) обязательствами для конечной точки сервера API Kubernetes.

## <a name="design-recommendations"></a>Рекомендации по проектированию

Ниже приведены рекомендации по проектированию.

- Используйте три узла для пула системных узлов. Для пула узлов пользователей Начните с не менее двух узлов. Если требуется более высокая доступность, настройте дополнительные узлы.

- Изолируйте приложение от системных служб, поместив его в отдельный пул узлов. Таким образом, службы Kubernetes работают на выделенных узлах и не конкурируют с другими службами. Используйте [теги, метки и таинтс](/azure/aks/use-multiple-node-pools#specify-a-taint-label-or-tag-for-a-node-pool) для обозначения пула узлов, чтобы запланировать рабочую нагрузку.

- Регулярное отслеживание кластера, например обеспечение своевременных обновлений, является критически важным для надежности. Учитывать [поддерживаемое окно Kubernetes версий на AKS](/azure/aks/supported-kubernetes-versions) и планируйте обновления заранее. Кроме того, рекомендуется отслеживать работоспособность модулей Pod с помощью проб.

- По возможности [удаляйте состояние службы из контейнеров внутри](/azure/aks/operator-best-practices-multi-region#remove-service-state-from-inside-containers). Вместо этого используйте платформу Azure как службу (PaaS), которая поддерживает репликацию по регионам.

- Обеспечьте доступность ресурсов Pod. Настоятельно рекомендуется, чтобы в развертываниях были указаны требования к ресурсам Pod. Затем планировщик может соответствующим образом спланировать модуль. Надежность значительно снижается, если не планируется выполнение модулей Pod.

- Настройте несколько реплик в развертывании, чтобы обрабатывались нарушения, такие как сбои оборудования. Для запланированных событий, таких как обновления и обновления, бюджет на прерывание может обеспечить наличие необходимого количества реплик Pod для выполнения ожидаемой загрузки приложения.

- Приложения могут использовать службу [хранилища Azure](/azure/aks/operator-best-practices-multi-region#create-a-storage-migration-plan) для своих данных. Так как приложения распределены между несколькими кластерами AKS в разных регионах, необходимо синхронизировать хранилище. Ниже приведены два распространенных способа репликации хранилища.

  - Асинхронная репликация на основе инфраструктуры

  - асинхронная репликация на основе приложений;

- Оценка [ограничений Pod](/azure/aks/quotas-skus-regions#service-quotas-and-limits). Тестирование и создание базовых показателей. Начните с одинаковых значений для запросов и ограничений. Затем постепенно Настраивайте эти значения до тех пор, пока не будет установлен порог, который может привести к нестабильной работе кластера. Ограничения Pod можно указать в манифестах развертывания.

  Встроенные функции предоставляют решение сложной задачи по обработке сбоев и нарушений в архитектуре службы. Эти конфигурации помогают упростить разработку и автоматизацию развертывания. Если в организации определен стандарт для соглашений об уровне обслуживания, RTO и RPO, он может использовать встроенные службы для Kubernetes и Azure, чтобы достичь своих бизнес-целей.

- Установка [бюджетов прерываний Pod](/azure/aks/operator-best-practices-scheduler#plan-for-availability-using-pod-disruption-budgets). Этот параметр проверяет количество реплик в развертывании, которые можно выполнить во время обновления или обновления.

- [Принудительное использование квот ресурсов](/azure/aks/operator-best-practices-scheduler#enforce-resource-quotas) для пространств имен службы. Квота ресурсов в пространстве имен обеспечит правильную установку запросов и ограничений на ресурсы Pod в развертывании.

  - Установка квот ресурсов на уровне кластера может вызвать проблемы при развертывании партнерских служб, у которых нет соответствующих запросов и ограничений.

- Регулярно запускайте последнюю версию средства с [ `kube-advisor` открытым исходным кодом](/azure/aks/operator-best-practices-scheduler#regularly-check-for-cluster-issues-with-kube-advisor) для обнаружения проблем в кластере.

- Храните образы контейнеров в [реестре контейнеров Azure](/azure/aks/operator-best-practices-multi-region#enable-geo-replication-for-container-images) и Георепликация реестра в каждом регионе AKS.

- AKS можно использовать в качестве бесплатной службы, но этот уровень не предлагает соглашение об уровне обслуживания с финансовыми обязательствами. Чтобы получить это соглашение об уровне обслуживания, необходимо добавить соглашение об уровне обслуживания времени работы в то, что вы покупаете. Мы рекомендуем использовать этот параметр для всех рабочих кластеров. Резервирование кластеров без этого параметра для подготовительных кластеров. При объединении с Зоны доступности уровень соглашения об уровне обслуживания Kubernetes API увеличивается до 99,95%. Пулы узлов и другие ресурсы попадают под свои соглашения об уровне обслуживания.

- Используйте несколько регионов и расположений пиринга для подключения [ExpressRoute](/azure/expressroute/expressroute-introduction) .

  При возникновении сбоя, влияющего на расположение региона Azure или поставщика пиринга, избыточная Гибридная архитектура сети поможет обеспечить непрерывное подключение между организациями.

- Области Interconnect с [глобальным пирингом виртуальной сети](/azure/aks/operator-best-practices-multi-region#interconnect-regions-with-global-virtual-network-peering). Если кластеры должны взаимодействовать друг с другом, подключение между виртуальными сетями может осуществляться через пиринг виртуальных сетей. Эта технология соединяет виртуальные сети друг с другом, обеспечивая высокую пропускную способность в магистральной сети Майкрософт, даже в разных географических регионах.

- Использование [протокола разбиения на части по протоколу TCP](/azure/aks/operator-best-practices-multi-region#application-routing-with-azure-front-door-service), передняя дверца Azure гарантирует, что конечные пользователи сразу же подключаются к ближайшей точке присутствия в передней дверце. К другим функциям передней дверцы Azure относятся:

  - Терминирование TLS

  - Личный домен

  - Брандмауэр веб-приложения

  - Переопределение URL-адреса

  - Сходство сеансов

  Изучите потребности вашего трафика приложения, чтобы узнать, какое решение является наиболее подходящим.
