---
title: Управление безопасностью и соответствие требованиям службы Azure Kubernetes Service (AKS) в масштабах предприятия
description: Узнайте о жизненном цикле управления безопасностью в облаке, а также о том, как настроить элементы управления безопасностью AKS, политику Azure и управление затратами AKS.
author: BrianBlanchard
ms.author: brblanch
ms.date: 03/01/2021
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: ready
ms.openlocfilehash: 6f7b00443846d2219828784c077b00516211752e
ms.sourcegitcommit: b8f8b7631aabaab28e9705934bf67dad15e3a179
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/03/2021
ms.locfileid: "101798893"
---
<!-- docutune:casing "Contoso Financials" -->

# <a name="aks-enterprise-scale-platform-security-governance-and-compliance"></a>Управление безопасностью платформы корпоративного уровня AKS и соответствие требованиям

В этой статье рассматриваются аспекты управления безопасностью Azure Kubernetes Service (AKS), которые следует учесть перед реализацией любого решения.

Большая часть этого содержимого не зависит от технологии, так как реализация зависит от клиентов. В этой статье рассматривается реализация решений с помощью Azure и некоторых программ с открытым кодом (OSS).

## <a name="cloud-security-control-lifecycle"></a>Жизненный цикл управления безопасностью в облаке

В облачной системе безопасности и управлении облако может быть динамическим, в то время как большинство предприятий используют относительно стабильные среды. Традиционные среды включают элементы управления обнаружением и предотвращением в структурированной организационной модели, которая соответствует традиционным ИТ-функциям, таким как идентификация, работа в сети, управление компьютерами и виртуальными машинами (ВМ). Традиционные группы обеспечения безопасности и соответствия требованиям сталкиваются относительно редких изменений в общей структуре и инфраструктуре, а также к необходимым элементам управления и мониторингу для достижения целей обеспечения безопасности и риска.

Благодаря внедрению моделей Cloud и DevOps безопасность должна адаптироваться к изменениям, поэтому она не станет препятствием для бизнеса и хода выполнения. В процессе адаптации к системе безопасности предусмотрены такие процессы, как создание правильных ролей и обязанностей, а также автоматизация и технические инструменты, такие как сканирование, тестирование и инфраструктура в виде кода. Эти средства являются частью конвейера DevOps, который обеспечивает инновации и быструю доставку, в то же время соблюдая требования к безопасности.

Искушения — начать с того, что вы делаете сегодня, но ключ мысль заключается в том, что при попытке сделать это в облаке точно так же, как и локально, произойдет сбой. Внедрение в облако — это возможность изучать, обновлять навыки и повышать уровень безопасности Организации. Вы можете установить защиту в качестве активации, а не блокирования, оптимизируя безопасность как часть процесса разработки в рабочем процессе. Если вы используете 10-20 лет и более старых средств и процессов, вы наследуете или представите 10-20 лет старые проблемы безопасности, проблемы и разочарования. Внедрение облачных технологий — ваш шанс начать новую работу.

Начало нового начинается с понимания облака.

- Какие доступны облачные службы, элементы управления и видимость?
- Как работают облачные службы и элементы управления?
- Что такое доступные средства обеспечения безопасности и средства управления?
- Как можно использовать средства безопасности и управления в процессах и системах, благодаря чему бизнес-процессы могут быть более гибкими с помощью современной модели DevOps?
- Как можно обеспечить соблюдение требований к безопасности и соответствию требованиям?

Зачастую проще начать инфраструктуру жизненного цикла с точки зрения процесса, как при создании элементов управления безопасностью, так и при управлении и эксплуатацию элементов управления. Для установки средств управления безопасностью многие клиенты используют общие платформы и стандарты, такие как NIST 800-53, ISO, тесты производительности и HIPAA/HITRUST. Эти стандарты помогут вам создать комплексную платформу и предоставить рекомендации по созданию, документированию и аудиту средств управления и процессов безопасности.

Для управления и эксплуатацию элементов управления безопасностью можно взглянуть на различные модели, включая процессы жизненного цикла разработки системы безопасности, включающие Cloud и DevOps. Эти подходы и модели рассматривают элементы управления безопасностью, такие как любые другие активы в Организации, и включают управление жизненным циклом. На следующей схеме показан пример управления безопасностью в Организации.

:::image type="content" source="./media/security-control-lifecycle.png" alt-text="Диаграмма, показывающая настройку управления жизненным циклом системы управления безопасностью Azure." border="false":::

### <a name="azure-security-control-architecture"></a>Архитектура управления безопасностью Azure

Все элементы управления безопасностью Azure начинаются с и поверх Azure Resource Manager API. На следующей схеме показано, как подсистема политик Azure помогает применять политики независимо от их происхождения. Эта возможность важна, так как она означает, что организациям не нужно определять политики в нескольких местах.

:::image type="content" source="./media/enterprise-control-plane-architecture.png" alt-text="Схема, показывающая архитектуру управления безопасностью Azure." border="false":::

### <a name="security-control-governance"></a>Управление безопасностью

Одним из ключевых преимуществ платформы управления безопасностью является его организация и Управление аудитом. В дополнение к политике Azure система управления безопасностью Azure включает [Центр безопасности Azure](/azure/security-center/security-center-introduction)с его функциями панели мониторинга " [Безопасность](/azure/security-center/secure-score-security-controls) и соответствие требованиям". Соответствие требованиям, в свою основу, — это все, что является наблюдаемым. На следующем рисунке показан пример панели мониторинга соответствия:

:::image type="content" source="./media/enterprise-control-plane-governance.png" alt-text="Схема управления безопасностью Azure." border="false":::

## <a name="azure-security-controls-setup"></a>Установка средств управления безопасностью Azure

В этом разделе рассматривается настройка структуры управления безопасностью, относящейся к Azure. В этом разделе предполагается, что элементы безопасности Организации уже установлены. Определение этих средств безопасности выходит за рамки этой статьи.

В следующих разделах описывается реализация следующих элементов управления в соответствии с требованиями безопасности для вымышленного сценария Contoso Financial.

- Заносить в журнал все запросы к облачным API для создания отчетов об аудите.
- Включите разрешенные диапазоны IP-адресов для безопасного доступа к серверу API.
- Используйте разрешенные расположения для создания кластеров AKS только в определенных регионах.

Эти элементы управления являются лишь подмножеством элементов управления безопасностью и политик Azure, включенных в полное развертывание Azure. Когда вы понимаете процесс, его можно повторить, чтобы реализовать любые другие средства управления безопасностью, необходимые для Организации.

### <a name="log-all-cloud-api-requests-for-audit-reporting-purposes"></a>Регистрация всех запросов облачных API для создания отчетов об аудите

[Журналы действий Azure](/azure/azure-monitor/essentials/platform-logs-overview) записывают все взаимодействия Azure Resource Manager, включая журналы аудита. Проблема в том, что журналы действий имеют только определенный жизненный цикл хранения. Чтобы хранить журналы для отчетов аудита, необходимо экспортировать данные из журналов действий в более устойчивое место хранения, например в журналы Azure Monitor.

Руководство по настройке сбора журналов действий для подписки Azure см. в статье [Отправка в log Analytics рабочую область](/azure/azure-monitor/essentials/activity-log#send-to-log-analytics-workspace).

На следующем снимке экрана показана запись журнала действий Azure в рабочей области Azure Log Analytics.

:::image type="content" source="./media/activity-log-capture.png" alt-text="Снимок экрана, показывающий запись журнала действий." border="false":::

### <a name="enable-azure-security-monitoring-to-check-for-authorized-ip-ranges"></a>Включение мониторинга безопасности Azure для проверки диапазонов разрешенных IP-адресов

Прежде чем создавать все, ознакомьтесь с вашим поставщиком облачных решений для мониторинга безопасности и рекомендациями. Поставщик облачных служб не реализует все средства управления безопасностью, необходимые Организации, но ключ заключается в использовании предоставленных элементов управления, чтобы избежать повторного создания колесика, и создавать пользовательские элементы управления только при необходимости.

В Azure можно включить центр безопасности Azure, чтобы просмотреть рекомендации по мониторингу безопасности. Вы также можете использовать центр безопасности Azure, чтобы определить, разрешены ли диапазоны разрешенных IP-адресов в кластере AKS.

Сведения о включении центра безопасности Azure уровня "Стандартный" для подписки Azure см. в разделе [Краткое руководство. Настройка центра безопасности Azure](/azure/security-center/security-center-get-started).

На следующем снимке экрана показан стандартный мониторинг центра безопасности Azure.

:::image type="content" source="./media/security-center-standard.png" alt-text="Снимок экрана со стандартным мониторингом центра безопасности Azure.":::

### <a name="enforce-an-azure-policy-to-create-aks-clusters-only-in-certain-regions"></a>Применение политики Azure для создания кластеров AKS только в определенных регионах

Также просмотрите поставщик облачных служб для применения политик. В Azure оцените политику Azure, которая является ключевой частью плоскости управления предприятием. Вы не можете выполнить все действия с политикой Azure, но в этом разделе вы сможете использовать предоставляемые ресурсы, чтобы избежать пересчета колесика и создавать пользовательские элементы управления только при необходимости.

Вы можете использовать политику Azure для реализации допустимых расположений для создания ресурсов Azure, таких как кластеры AKS. Дополнительные сведения и инструкции см. [в разделе Учебник. Создание политик и управление ими для обеспечения соответствия](/azure/governance/policy/tutorials/create-and-manage).

На следующих снимках экрана показаны шаги использования политики Azure для реализации допустимых расположений регионов.

1. Выберите встроенную политику **разрешенных расположений** в политике Azure.

   :::image type="content" source="./media/policy-definitions.png" alt-text="Снимок экрана, показывающий встроенные политики Azure.":::

1. Просмотр определения политики и назначение политики.

   :::image type="content" source="./media/assign-policy.png" alt-text="Снимок экрана, показывающий определение политики разрешенных расположений.":::

1. Настройте политику.

   :::image type="content" source="./media/configure-policy.png" alt-text="Снимок экрана, показывающий экран конфигурации разрешенных расположений.":::

1. Настройте параметры политики.

   :::image type="content" source="./media/configure-parameters.png" alt-text="Снимок экрана, показывающий экран параметров разрешенных расположений.":::

1. Просмотр назначений политик.

   :::image type="content" source="./media/policy-assignments.png" alt-text="Снимок экрана с назначениями политик Azure.":::

Возможность ограничить создание ресурсов в определенном регионе — это лишь одна из многих доступных политик Azure.

- Примеры того, что можно сделать с помощью политики Azure, см. в статье [примеры политик Azure](/azure/governance/policy/samples/).
- Дополнительные сведения о политике Azure для центра безопасности Azure см. [в статье встроенные определения политик Azure для центра безопасности Azure](/azure/security-center/policy-reference).

## <a name="cost-governance"></a>Управление затратами

Управление затратами — это непрерывный процесс реализации политик для управления затратами. В контексте Kubernetes существует несколько способов, с помощью которых организации могут управлять затратами и оптимизировать их. К ним относятся собственные средства Kubernetes для управления использованием ресурсов и их использования, а также упреждающий мониторинг и оптимизация базовой инфраструктуры.

В этом разделе показано, как с помощью [кубекост](https://kubecost.com/) управлять стоимостью кластера AKS. Вы можете ограничить распределение затрат для развертывания, службы, метки, Pod или пространства имен, что обеспечивает гибкость при отсчете или отображении пользователей кластера.

### <a name="install-kubecost"></a>Установка Кубекост

Существует несколько вариантов установки Кубекост. Дополнительные сведения см. в разделе [Installing кубекост](https://docs.kubecost.com/install).

Чтобы установить Кубекост напрямую, используйте следующие команды:

```bash

# Create the Kubecost namespace

kubectl create namespace kubecost

# Install Kubecost into the AKS cluster

kubectl apply -f https://raw.githubusercontent.com/kubecost/cost-analyzer-helm-chart/master/kubecost.yaml --namespace kubecost
```

Чтобы установить Кубекост с помощью Helm 2, выполните следующие команды:

```bash
helm repo add kubecost https://kubecost.github.io/cost-analyzer/
helm install kubecost/cost-analyzer --namespace kubecost --name kubecost --set kubecostToken="YWxnaWJib25AbWljcm9zb2Z0LmNvbQ==xm343yadf98"
```

Чтобы установить Кубекост с помощью Helm 3, выполните следующие команды:

```bash
kubectl create namespace kubecost
helm repo add kubecost https://kubecost.github.io/cost-analyzer/
helm install kubecost kubecost/cost-analyzer --namespace kubecost --set kubecostToken="YWxnaWJib25AbWljcm9zb2Z0LmNvbQ==xm343yadf98"
```

Через несколько минут убедитесь, что Кубекост работает и работает:

```bash
kubectl get pods -n kubecost

# Connect to the Kubecost dashboard UI

kubectl port-forward -n kubecost svc/kubecost-cost-analyzer 9090:9090
```

Теперь можно открыть браузер и указать, `http://127.0.0.1:9090` чтобы открыть пользовательский интерфейс кубекост. В пользовательском интерфейсе Кубекост выберите кластер, чтобы просмотреть сведения о распределении затрат.

### <a name="navigate-kubecost"></a>Навигация по Кубекост

Кубекост разделяет ресурсы на следующие категории:

- Месячная стоимость кластера
- Стоимость пространства имен
- Стоимость ресурсов развертывания
- Экономичность

Выберите кластер, чтобы просмотреть общие сведения, такие как следующая панель мониторинга:

:::image type="content" source="./media/kubecost-dashboard.png" alt-text="Снимок экрана, показывающий панель мониторинга Кубекост.":::

Выберите **выделение** в левой части, чтобы получить более подробную информацию о затратах на пространство имен ресурсов. **Выделение** показывает затраты на ЦП, память, постоянные тома и сеть. Кубекост получает данные из цен Azure, но вы также можете задать настраиваемые затраты для ресурсов.

:::image type="content" source="./media/kubecost-allocation.png" alt-text="Снимок экрана, показывающий экран выделения Кубекост.":::

Выберите **экономия** в левой части, чтобы получить сведения о снижении затрат для недостаточного использования ресурсов. **Экономия** позволяет получить сведения о недостаточно загруженных узлах и модулях Pod и отброшенных ресурсах, а также определяет запросы ресурсов, которые передаются в кластере. На следующем снимке экрана показан пример **сокращения для экономии** :

:::image type="content" source="./media/kubecost-savings.png" alt-text="Снимок экрана, показывающий экран экономии Кубекост.":::

Потратьте некоторое время на навигацию по различным представлениям и функциям, предоставляемым Кубекост.

## <a name="design-considerations"></a>Рекомендации по проектированию

AKS имеет несколько интерфейсов для других служб Azure, таких как Azure Active Directory, служба хранилища Azure и виртуальная сеть Azure, которые требуют особого внимания на этапе планирования. AKS также добавляет дополнительную сложность, которая требует применения тех же механизмов обеспечения безопасности, управления и обеспечения соответствия, что и в оставшейся инфраструктуре инфраструктуры.

Ниже приведены некоторые другие рекомендации по проектированию для управления безопасностью AKS и обеспечения соответствия требованиям.

- Решите, доступна ли доступ к плоскости управления кластера через Интернет (по умолчанию) или только в пределах определенной виртуальной сети в качестве частного кластера.

- Оцените использование встроенного модуля безопасности [AppArmor](/azure/aks/operator-best-practices-cluster-security#app-armor) Linux, чтобы ограничить действия, которые могут выполнять контейнеры, такие как чтение, запись, выполнение или системные функции, такие как монтирование файловых систем.

- Оцените использование [безопасных вычислений (секкомп)](/azure/aks/operator-best-practices-cluster-security#secure-computing) на уровне процесса, чтобы ограничить количество вызовов процессов, которые могут выполнять контейнеры.

- Рассмотрите возможность использования [защитника Azure для Kubernetes](/azure/security-center/defender-for-kubernetes-introduction) при обнаружении угроз.

## <a name="design-recommendations"></a>Рекомендации по проектированию

- Ограничьте доступ к файлу [конфигурации кластера Kubernetes](/azure/aks/control-kubeconfig-access) с помощью управления доступом на основе ролей Azure.

- [Обеспечьте безопасность доступа к ресурсам в Pod](/azure/aks/developer-best-practices-pod-security#secure-pod-access-to-resources). Укажите Минимальное число разрешений и Избегайте использования корневого или привилегированного укрупнения.

- Используйте [идентификаторы, управляемые Pod](/azure/aks/operator-best-practices-identity#use-pod-managed-identities) , и [поставщик Azure Key Vault для зашифрованных данных. драйвер хранилища CSI](https://github.com/Azure/secrets-store-csi-driver-provider-azure) для защиты секретов, сертификатов и строк подключения.

- Необходимо регулярно [переворачивать сертификаты](/azure/aks/certificate-rotation) , например каждые 90 дней.

- Используйте [Обновление образа узла AKS](/azure/aks/node-image-upgrade) для обновления образов узлов кластера AKS, если это возможно, или [куред](/azure/aks/node-updates-kured) для автоматизации перезагрузки узла после применения обновлений.

- Просмотрите рекомендации по AKS в [центре безопасности Azure](/azure/security-center/security-center-introduction).

- Мониторинг и принудительное применение конфигурации с помощью [надстройки политики Azure для Kubernetes](/azure/aks/use-pod-security-on-azure-policy).
