---
title: Как настроить экземпляр контроллера Moodle и рабочие узлы
description: Узнайте, как настроить экземпляр контроллера Moodle и рабочие узлы (конфигурация инфраструктуры Azure).
author: BrianBlanchard
ms.author: brblanch
ms.date: 11/06/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: plan
ms.openlocfilehash: 9a40bc5b34d85a94641e2381c7773621dfe09e9f
ms.sourcegitcommit: a7eb2f6c4465527cca2d479edbfc9d93d1e44bf1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/17/2020
ms.locfileid: "94714806"
---
# <a name="how-to-set-up-moodle-controller-instance-and-worker-nodes"></a>Как настроить экземпляр контроллера Moodle и рабочие узлы

## <a name="virtual-machine-scale-set-instances"></a>Экземпляры масштабируемых наборов виртуальных машин

Экземпляры масштабируемых наборов виртуальных машин назначаются частным IP-адресам, доступ к которым можно получить только с помощью виртуальной машины контроллера, которая находится в той же виртуальной сети. Включите шлюз для подключения экземпляра масштабируемого набора виртуальных машин к частному IP-адресу и [Создайте шлюз виртуальной сети и подключитесь через частный IP-адрес](./vpn-gateway.md) , чтобы получить доступ шлюза к экземпляру масштабируемого набора виртуальных машин. Перед доступом к масштабируемому набору виртуальных машин задайте для него значение с поддержкой пароля.

Чтобы создать частный IP-адрес экземпляра масштабируемого набора виртуальных машин, выполните следующие действия.

- Войдите в [портал Azure](https://ms.portal.azure.com/#home)и выберите созданную группу ресурсов.
- Найдите ресурс масштабируемого набора виртуальных машин и перейдите к нему.
- На панели слева выберите **экземпляры**.
- Перейдите к выполняющемуся экземпляру и найдите частный IP-адрес, связанный с ним, в разделе **Обзор** .

Войдите в масштабируемый набор виртуальных машин и виртуальную машину контроллера. выполните следующие команды:

```bash
 sudo -s
 sudo ssh azureadmin@172.31.X.X
```

172.31. x. X — частный IP-адрес экземпляра масштабируемого набора виртуальных машин.

Войдите в экземпляр виртуальной машины масштабируемого набора. Выполните следующие действия:

- Каталог резервного копирования извлекается как хранилище или по адресу/Хоме/азуреадмин. Этот каталог хранения содержит Moodle, мудледата и каталог конфигурации, а также файл резервной копии базы данных. Они будут скопированы в нужные расположения.

- Создайте каталог резервного копирования.

  ```bash
  cd /home/azureadmin/
  mkdir -p backup
  mkdir -p backup/moodle
  ```

- Чтобы настроить PHP и веб-сервер, создайте резервную копию конфигурации PHP и веб-сервера и задайте в качестве версии PHP переменную.

   ```bash
  _PHPVER=`/usr/bin/php -r "echo PHP_VERSION;" | /usr/bin/cut -c 1,2,3`
  echo $_PHPVER
   ```

  ```bash
  sudo mv /etc/nginx/sites-enabled/*.conf  /home/azureadmin/backup/
  sudo mv /etc/php/$_PHPVER/fpm/pool.d/www.conf /home/azureadmin/backup/www.conf  
  ```

- Скопируйте файлы конфигурации PHP и веб-сервера.

  ```bash
  sudo cp /moodle/config/nginx/*.conf  /etc/nginx/sites-enabled/
  sudo  cp /moodle/config/php/www.conf /etc/php/$_PHPVER/fpm/pool.d/
  ```

- Установите недостающие расширения PHP и используйте шаблон Azure Resource Manager, чтобы установить следующие расширения PHP: FPM, CLI, мкрипт, ZIP, груша, mbstring, dev,, SOAP, JSON, Redis, бкмас, GD, MySQL, ксмлрпк, Intl, XML и bz2.

- Чтобы получить список расширений PHP, установленных в локальной среде, выполните следующую команду на локальной виртуальной машине:

  ```bash
  php -m
  ```

- Если в локальной среде есть дополнительные расширения PHP, которые отсутствуют в виртуальной машине контроллера, их можно установить вручную.

  ```bash
  sudo apt-get install -y php-<extensionName>
  ```

## <a name="next-steps"></a>Следующие шаги

Перейдите к [дальнейшим действиям после Moodle миграции,](./migration-post.md) чтобы получить сведения о следующем шаге процесса миграции Moodle.
