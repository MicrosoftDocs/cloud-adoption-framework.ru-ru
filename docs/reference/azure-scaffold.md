---
title: Рекомендации для предприятий, переходящих на использование Azure
titleSuffix: Microsoft Cloud Adoption Framework for Azure
description: Описывается каркас, который предприятия могут использовать, чтобы обеспечить безопасную и управляемую среду.
author: rdendtler
ms.author: rodend
ms.date: 09/22/2018
ms.topic: guide
ms.service: cloud-adoption-framework
ms.subservice: reference
ms.openlocfilehash: 1cdf066617ee43de6fedfeb707311e663318f8c4
ms.sourcegitcommit: bf9be7f2fe4851d83cdf3e083c7c25bd7e144c20
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/04/2019
ms.locfileid: "73561811"
---
# <a name="azure-enterprise-scaffold-prescriptive-subscription-governance"></a>Корпоративный каркас Azure: рекомендуемая система управления подписками

> [!NOTE]
> Формирование шаблонов Azure Enterprise интегрировано в платформу внедрения Microsoft Cloud. Содержимое этой статьи теперь представлено в разделе [готовности](../ready/index.md) новой платформы. Эта статья будет признана устаревшей в начале 2020. Чтобы приступить к использованию нового процесса, ознакомьтесь с [обзором готовности](../ready/index.md), [созданием первой целевой зоны](../ready/azure-setup-guide/migration-landing-zone.md)и [сведениями о целевой зоне](../ready/considerations/index.md).

Предприятия все чаще внедряют общедоступное облако ввиду его гибкости и динамичности. Они полагаются на сильные стороны облака для создания дохода и оптимизации использования ресурсов для бизнеса. Microsoft Azure предоставляет множество служб и возможностей, из которых как из строительных блоков предприятия конструируют решения для широкого спектра рабочих нагрузок и приложений.

Принятие решения об использовании Microsoft Azure является только первым шагом к получению преимуществ облака. Второй шаг — это понимание того, как предприятие может эффективно использовать Azure и определять базовые возможности, которые должны быть созданы для решения таких вопросов, как:

- "Я обеспокоен сохранением контроля над данными; как я могу убедиться, что данные и системы соответствуют нормативным требованиям?"
- "Как узнать, что обеспечивает тот или иной ресурс, чтобы учесть его и правильно добавить в счет?"
- "Я хочу убедиться, что все развертывания или другие действия в общедоступном облаке ставят безопасность на первое место. Как я могу этому посодействовать?"

Деловое отношение пустой подписки без снятие является непростой задачей. Этот пробел может помешать перемещению в Azure.

Эта статья служит отправной точкой для технических специалистов и посвящена балансу требований управления и гибкости. В ней вводится понятие корпоративного каркаса, который помогает организациям безопасно внедрять среды Azure и управлять ими. Она предоставляет платформу для разработки эффективных и действенных элементов управления.

## <a name="need-for-governance"></a>Требования управления

При перемещении в Azure необходимо заблаговременно рассмотреть вопрос управления, чтобы обеспечить успешное использование облака на предприятии. К сожалению, нехватка времени и волокита, связанная с созданием комплексной системы управления, приводят к тому, что некоторые рабочие группы сразу идут к поставщикам, не привлекая ИТ-отдел предприятия. Такой подход может оставить предприятие уязвимым, если управление ресурсами осуществляется неправильно. Характеристики общедоступного облака &mdash;agility, гибкости и ценообразования на основе потребления &mdash;are важны для бизнес-групп, которым необходимо быстро удовлетворить требования клиентов (как внутренних, так и внешних). Но Enterprise ИТ необходимо обеспечить эффективную защиту данных и систем.

При строительстве здания, чтобы создать базовую структуру, используется каркас. Каркас обеспечивает общую структуру и предоставляет точки крепления, на которые можно устанавливать другие постоянные системы. Корпоративный каркас ничем не отличается: это набор гибких элементов управления и возможностей Azure, обеспечивающих структуру среды, и привязок для служб на основе общедоступного облака. Он предоставляет строителям (ИТ-отделам и бизнес-группам) основу для создания и присоединения новых служб, учитывающих скорость доставки.

В основе каркаса лежат рекомендации, полученные при сотрудничестве с клиентскими организациями различных размеров. Эти клиенты находятся в диапазоне от малых организаций, занимающихся разработкой решений в облаке для крупных многонациональных предприятий и независимых поставщиков программного обеспечения, которые переносят рабочие нагрузки и разрабатывают собственные облачные решения. Корпоративный шаблон — "предназначенный для использования", который должен быть гибким для поддержки традиционных рабочих нагрузок ИТ и гибких рабочих нагрузок, таких как разработчики, создающие приложения SaaS (программное обеспечение как услуга) на основе возможностей платформы Azure.

Корпоративный каркас предназначен стать основой каждой новой подписки в Azure. Он позволяет администраторам гарантировать, что рабочие нагрузки соответствуют минимальным требованиям управления организации, не мешая бизнес-группам и разработчикам быстро достигать собственных целей. Наш опыт показывает, что это значительно ускоряет, а не препятствует расширению общедоступного облака.

> [!NOTE]
> Корпорация Microsoft выпустила предварительную версию новой функции под названием [Azure Blueprints](https://docs.microsoft.com/azure/governance/blueprints/overview), которая позволит вам упаковывать и развертывать стандартные образы, шаблоны, политики и сценарии в подписках и группах управления, а также управлять ими. Эта возможность является мостом между назначением каркаса как эталонной модели и развертыванием этой модели для вашей организации.
>
На рисунке ниже приведены компоненты каркаса. В основе лежит надежный план для иерархии управления и подписок. Опорами служат политики Resource Manager и строгие стандарты именования. Остальная часть каркаса состоит из основных возможностей и функций Azure, обеспечивающих подключение безопасной и управляемой среды.

![каркас предприятия](../_images/reference/scaffoldv2.png)

## <a name="define-your-hierarchy"></a>Определение иерархии

Основой каркаса является иерархия и взаимосвязь соглашения о регистрации в Azure Enterprise для подписок и групп ресурсов. Соглашение о регистрации Enterprise определяет форму и использование служб Azure в вашей компании с точки зрения контракта. В Соглашение Enterprise можно дополнительно разделить среду на подразделения, учетные записи, подписки и группы ресурсов в соответствии со структурой Организации.

![Иерархия](../_images/reference/agreement.png)

Подписка Azure представляет собой базовую единицу, в которой содержатся все ресурсы. Она также определяет несколько ограничений в Azure, в том числе количество ядер, виртуальных сетей и других ресурсов. Группы ресурсов используются для дальнейшего уточнения модели подписки и обеспечения более естественного группирования ресурсов.

Все предприятия разные, и иерархия на предыдущем рисунке допускает значительную гибкость в организации ресурсов Azure в рамках компании. Моделирование иерархии для отражения потребностей компании, управления ресурсами и доступа к ресурсам — это первое и наиболее важное решение, которое вы принимаете при запуске в общедоступном облаке.

### <a name="departments-and-accounts"></a>Подразделения и учетные записи

Ниже представлены три распространенных шаблона для Соглашений о регистрации Azure Enterprise.

- **Функциональный** шаблон:

  ![Функциональный шаблон](../_images/reference/functional.png)

- Шаблон **бизнес-единицы** :

  ![Шаблон бизнес-единицы](../_images/reference/business.png)

- **Географический** шаблон:

  ![Географический шаблон](../_images/reference/geographic.png)

Несмотря на то что каждый из этих шаблонов имеет свое место, шаблон **бизнес-единицы** все чаще используется благодаря гибкости при создании модели затрат организации, а также отражению диапазона контроля. Группа разработки и эксплуатации Microsoft Core создала эффективное подмножество шаблона **бизнес-подразделения** , смоделированное на **основе федерального**, **штатного**и **местного**. Дополнительные сведения см. [в статье Организация подписок и групп ресурсов в рамках предприятия](https://azure.microsoft.com/blog/organizing-subscriptions-and-resource-groups-within-the-enterprise).

### <a name="azure-management-groups"></a>Группы управления Azure

Теперь корпорация Майкрософт предоставляет еще один способ моделирования иерархии: [группы управления Azure](https://docs.microsoft.com/azure/azure-resource-manager/management-groups-overview). Группы управления являются гораздо более гибкими, чем отделы и учетные записи, и их можно вкладывать до шести уровней. Группы управления позволяют создать иерархию, отдельную от иерархии выставления счетов, исключительно для эффективного управления ресурсами. Группы управления могут отражать иерархию выставления счетов и зачастую предприятия начинают именно с этого. Однако возможности групп управления используются для моделирования Организации, объединения связанных подписок (независимо от их расположения в иерархии выставления счетов) и назначения общих ролей, политик и инициатив. Некоторые примеры:

- **Рабочие и непроизводственные.** Некоторые компании создают группы управления для обнаружения своих производственных и непроизводственных подписок. Такие группы управления позволяют упростить управление ролями и политиками. Например, непроизводственная подписка может предоставить разработчикам доступ к участнику, но в рабочей среде они имеют только доступ читателя.
- **Сравнение внутренних служб и внешних служб.** Предприятиям часто предъявляются различные требования, политики и роли для внутренних служб и служб, ориентированных на клиентов.

Хорошо спроектированные группы управления — вместе с политикой и инициативами Azure — это основа эффективного управления Azure.

### <a name="subscriptions"></a>Подписки

При выборе подразделений и учетных записей (или групп управления) вы ориентированы, в первую очередь, на разделение среды Azure в соответствии с требованиями вашей организации. Однако подписки — это то, где происходит реальная работа, и ваши решения влияют на безопасность, масштабируемость и выставление счетов. Многие организации рассматривают следующие шаблоны в качестве руководств.

- **Приложение или служба:** Подписки представляют собой приложение или службу (портфель приложений)
- **Жизненный цикл:** Подписки представляют жизненный цикл службы, например рабочую среду или разработку.
- **Отдел:** Подписки представляют отделы в Организации.

Первые два шаблона являются наиболее часто используемыми, и мы настоятельно рекомендуем их использовать. Подход "Жизненный цикл" подходит для большинства организаций. В этом случае общая рекомендация заключается в использовании двух базовых подписок: `Production` и `Nonproduction`, а затем используйте группы ресурсов для дальнейшей разделения сред.

### <a name="resource-groups"></a>Группы ресурсов

Azure Resource Manager позволяет помещать ресурсы в предметные группы для управления, выставления счетов или обеспечения естественного сходства. Группы ресурсов — это контейнеры ресурсов, которые имеют общий жизненный цикл или какой-либо атрибут, например "все серверы SQL Server" или "Приложение A".

Группы ресурсов не могут быть вложенными, и ресурсы могут принадлежать только одной группе ресурсов. Определенные действия могут применяться для всех ресурсов в группе ресурсов. Например, при удалении группы ресурсов можно удалять все ее ресурсы. Как и в случае с подписками, при создании групп ресурсов существуют распространенные шаблоны, и для "Традиционных ИТ" и "Гибких ИТ" рабочих нагрузок они различаются.

- В первом случае рабочие нагрузки чаще всего группируются по элементам в рамках одного жизненного цикла, например приложения. Группирование по приложениям позволяет управлять отдельными приложениями.
- Во втором случае рабочие нагрузки, как правило, сосредотачиваются на облачных приложениях для внешних клиентов. Группы ресурсов часто отражают уровни развертывания (например, уровень Интернета или уровень приложений) и управления.

> [!NOTE]
> Понимание рабочей нагрузки помогает разработать стратегию групп ресурсов. Эти шаблоны можно комбинировать и сопоставлять. Например, группа ресурсов общих служб в той же подписке, что и "Гибкие" группы ресурсов.

## <a name="naming-standards"></a>Стандарты именования

Первая опора каркаса — это согласованный стандарт именования. Хорошо спроектированные стандарты именования позволяют определять ресурсы на портале, в счете и в сценариях. Скорее всего, у вас уже есть существующие стандарты именования для локальной инфраструктуры. При добавлении Azure в свою среду следует распространить эти стандарты именования на ресурсы Azure.

> [!TIP]
> Для соглашений об именовании:
>
> - Ознакомьтесь с [руководством по шаблонам и рекомендациями](https://docs.microsoft.com/azure/architecture/best-practices/naming-conventions) и применяйте полученные знания, где это уместно. Это руководство поможет выбрать информативный стандарт именования, также в нем приведено множество примеров.
> - Использование политик диспетчер ресурсов для обеспечения соблюдения стандартов именования.
>
> Помните, что впоследствии изменить имена будет сложно, поэтому уделите несколько минут сейчас, чтобы избежать трудностей в будущем.

Сосредоточьте свои стандарты именования на тех ресурсах, которые чаще всего ищут и используют. Например, для ясности все группы ресурсов должны следовать четкому стандарту.

### <a name="resource-tags"></a>Теги ресурсов

Теги ресурсов тесно связаны со стандартами именования. Поскольку ресурсы добавляются к подпискам, чрезвычайно важно логически классифицировать их для таких целей, как выставление счетов, управление и эксплуатация. Дополнительные сведения см. в статье [Использование тегов для организации ресурсов в Azure](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-using-tags).

> [!IMPORTANT]
> Теги могут содержать личную информацию и могут подпадать под действие положений GDPR. Тщательно планируйте управление тегами. Если вы ищете общие сведения о GDPR, см. раздел GDPR на [портале доверия службы](https://servicetrust.microsoft.com/ViewPage/GDPRGetStarted).

Существует много вариантов использования тегов, помимо выставления счетов и управления. Они часто используются как часть службы автоматизации (см. раздел ниже). Если не предусмотреть заранее, это может привести к конфликтам. Рекомендуется указывать все общие теги на уровне предприятия (например, Аппликатионовнер и CostCenter) и применять их единообразно при развертывании ресурсов с помощью автоматизации.

## <a name="azure-policy-and-initiatives"></a>Политика и инициативы Azure

Вторая основа шаблона включает использование [политики и инициатив Azure](https://docs.microsoft.com/azure/azure-policy/azure-policy-introduction) для управления рисками путем применения правил (с эффектами) к ресурсам и службам в подписках. Инициативы Azure — это коллекции политик, предназначенных для достижения единой цели. Затем политики и инициативы назначаются области действия ресурса, чтобы приступить к принудительному применению этих политик.

Политики и инициативы еще более эффективны при использовании с группами управления, упомянутыми выше. Группы управления позволяют назначать инициативу или политику для всего набора подписок.

### <a name="common-uses-of-resource-manager-policies"></a>Распространенные примеры использования политик Resource Manager

Политики и инициативы — это мощный инструмент в наборе средств Azure. Политики позволяют компаниям предоставлять элементы управления для "традиционных" ИТ-рабочих нагрузок, которые обеспечивают стабильность, необходимую для бизнес-приложений, а также позволяют выполнять "гибкие" рабочие нагрузки, &mdash;for пример, разработку клиентских приложений без предоставление корпоративного уровня для дополнительного риска. Ниже приведены наиболее распространенные шаблоны для политик.

- **Географическое соответствие и независимости данных.** Azure постоянно расширяет список регионов по всему миру. Предприятиям часто требуется обеспечить, чтобы ресурсы в определенной области оставались в географическом регионе для устранения нормативных требований.
- **Избегайте публичного предоставления серверов.** Политика Azure может запрещать развертывание определенных типов ресурсов. Обычно создается политика, запрещающая создание общедоступного IP-адреса в определенной области, что позволяет избежать непредвиденного воздействия сервера на Интернет.
- **Управление затратами и метаданные.** Теги ресурсов часто используются для добавления важных данных о выставлении счетов в ресурсы и группы ресурсов, такие как CostCenter, owner и т. д. Эти теги являются очень полезными для точного выставления счетов и управления ресурсами. Политики могут применять приложение тегов ресурсов для всех развернутых ресурсов, что упрощает управление ими.

### <a name="common-uses-of-initiatives"></a>Распространенные варианты использования инициатив

Инициативы предоставляют предприятиям возможность группировать логические политики и контролировать их как единую сущность. Инициативы помогают корпоративному адресу удовлетворить потребности гибкой и традиционной рабочей нагрузки. К распространенным применениям инициатив относятся:

- **Включите наблюдение в центре безопасности Azure.** Это инициатива по умолчанию в политике Azure, а также отличный пример инициатив. Он включает политики, которые позволяют обнаруживать незашифрованные базы данных SQL, уязвимости виртуальной машины и более распространенные потребности в безопасности.
- **Инициатива по соответствию нормативным требованиям.** Предприятия часто группируют политики, общепринятые для нормативных требований (например, HIPAA), что позволяет эффективно отслеживать управление и соответствие этим элементам контроля.
- **Типы ресурсов и номера SKU.** Создание инициативы, которая будет ограничивать типы ресурсов, которые могут быть развернуты, а также номера SKU, которые могут быть развернуты, помогает контролировать затраты и обеспечивать развертывание только тех ресурсов, которые имеют набор навыков и поддерживаемые им процедуры.

> [!TIP]
> Мы рекомендуем всегда использовать определения инициатив вместо определений политик. После назначения инициативы для области, такой как подписка или группа управления, вы можете легко добавить другую политику к инициативе, без изменения назначений. Это значительно облегчает распознавание применения и отслеживания соответствий.

### <a name="policy-and-initiative-assignments"></a>Назначение политик и инициатив

После создания политик и их группирования в логические инициативы необходимо назначить политику для области, будь то группа управления, подписка или даже группа ресурсов. Назначения позволяют также исключить подобласть из назначения политики. Например, если отказаться от создания публичных IP-адресов в рамках подписки, можно создать назначение с исключением для группы ресурсов, подключенной к защищенной DMZ.

Вы найдете несколько примеров политики, которые показывают, как политики и инициативы могут применяться к различным ресурсам в Azure в этом репозитории [GitHub](https://github.com/Azure/azure-policy).

## <a name="identity-and-access-management"></a>Управление идентификационной информацией и доступом

Один из первых и наиболее важных вопросов, которые вы задаете себе, начиная работу с публичным облаком, — "кто будет иметь доступ к ресурсам?" "Как контролировать этот доступ?" Управление доступом к портал Azure и ресурсам на портале крайне важно для долгосрочной безопасности ресурсов в облаке.

Чтобы защитить доступ к ресурсам, сначала нужно настроить поставщик удостоверений, а затем настроить роли и доступ. Служба Azure Active Directory (Azure AD), подключенная к вашей локальной Active Directory, лежит в основе идентификации Azure. С другой стороны, Azure AD *отличается от* локального Active Directory, и важно понимать, что такое клиент Azure AD и как он связан с регистрацией Azure. Ознакомьтесь с доступными [сведениями](../govern/resource-consistency/resource-access-management.md) для получения надежной основы в Azure AD и локальной Active Directory. Чтобы подключиться к Azure AD и синхронизировать Active Directory, установите и настройте [средство Azure AD Connect](https://docs.microsoft.com/azure/active-directory/connect/active-directory-aadconnect) локально.

![Схема архитектуры AD](../_images/reference/ad-architecture.png)

При первоначальном выпуске Azure элементы управления доступом к подписке были простыми: администратор или соадминистратор. В классической модели доступ к подписке подразумевал доступ ко всем ресурсам на портале. Отсутствие детализированного контроля приводило к созданию избыточного количества подписок, необходимых, чтобы обеспечить адекватный контроль доступа для Соглашения о регистрации Azure. Больше такое увеличение числа подписок не требуется. С помощью управления доступом на основе ролей (RBAC) можно назначать пользователей стандартным ролям, которые предоставляют общий доступ, например "владелец", "участник" или "читатель", или даже создавать собственные роли.

При внедрении доступа на основе ролей настоятельно рекомендуются следующие действия:

- Управляйте администратором и соадминистратором подписки, поскольку эти роли имеют многочисленные привилегии. Если пользователю нужно управлять классическими развертываниями Azure, просто добавьте учетную запись владельца подписки в качестве соадминистратора.
- Используйте группы управления для назначения [ролей](https://docs.microsoft.com/azure/azure-resource-manager/management-groups-overview#management-group-access) в нескольких подписках и уменьшайте время управления ими на уровне подписки.
- Добавьте пользователей Azure в группу (например, в группу "Владельцы приложения А") в Active Directory. Используйте синхронизированную группу, чтобы предоставить необходимые права для управления группой ресурсов, содержащей это приложение.
- Придерживайтесь принципа предоставления **минимальных привилегий**, необходимых для выполнения предстоящей работы.

> [!IMPORTANT]
>Рассмотрите возможность использования [Azure Active Directory Privileged Identity Management](https://docs.microsoft.com/azure/active-directory/privileged-identity-management/pim-configure), [Многофакторной идентификации](https://docs.microsoft.com/azure/active-directory/authentication/howto-mfa-getstarted) Azure и возможностей [условного доступа](https://docs.microsoft.com/azure/active-directory/active-directory-conditional-access-azure-portal) для обеспечения лучшего уровня безопасности и видимости административных действий в подписках Azure. Эти возможности исходят от действительной лицензии Azure AD Premium (в зависимости от функции) для дальнейшей защиты и управления идентификатором. Azure AD PIM включает административный JIT-доступ с рабочим процессом утверждения, а также полным аудитом активаций и действий администратора. Многофакторная идентификация Azure является еще одной критической возможностью и включает двухфакторную проверку подлинности для входа в портал Azure. В сочетании с условным управлением доступом можно эффективно управлять риском взлома.

Планирование и подготовка к управлению удостоверением личности и доступом, а также рекомендации Azure Identity Management ([ссылка](https://docs.microsoft.com/azure/security/azure-security-identity-management-best-practices)) — одна из лучших стратегий снижения риска для использования и должна быть обязательной для каждого развертывания.

## <a name="security"></a>Безопасность

Традиционно одним из самых серьезных препятствий для внедрения облака были вопросы безопасности. Подразделениям безопасности и управления рисками в сфере ИТ необходимо обеспечить защиту и безопасность ресурсов в Azure по умолчанию. Azure предоставляет возможности, которые можно использовать для защиты ресурсов при обнаружении и устранении угроз для этих ресурсов.

### <a name="azure-security-center"></a>Центр безопасности Azure

[Центр безопасности Azure](https://docs.microsoft.com/azure/security-center/security-center-intro) обеспечивает единое представление о состоянии безопасности ресурсов в среде в дополнение к расширенной защите от угроз. Центр безопасности Azure — это открытая платформа, позволяющая партнерам корпорации Майкрософт создавать программное обеспечение, которое встраивается в центр безопасности Azure, расширяя его возможности. Базовые возможности центра безопасности Azure (уровень Free) обеспечивают оценку и рекомендации, повышающие уровень безопасности. Его платные уровни включают дополнительные и ценные возможности, такие как JIT-доступ и адаптивное управление приложениями (список разрешений).

> [!TIP]
>Центр безопасности Azure — это мощное средство, которое регулярно повышается благодаря новым возможностям, которые можно использовать для обнаружения угроз и защиты предприятия. Настоятельно рекомендуется всегда включать центр безопасности Azure.

### <a name="azure-resource-locks"></a>Блокировки ресурсов Azure

По мере того как ваша организация добавляет основные службы к подпискам, она становится все более важной, чтобы избежать нарушения бизнеса. Одним из часто встречаемых видов сбоев являются непреднамеренные последствия работы сценариев и средств против подписки Azure, с ошибочным удалением ресурсов. [Блокировки ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-lock-resources) позволяют ограничить операции с ценными ресурсами, изменение или удаление которых оказало бы значительное влияние. Блокировки применяются к подписке, группе ресурсов или даже к отдельным ресурсам. Распространенным вариантом использования является применение блокировок к базовым ресурсам, таким как виртуальные сети, шлюзы, группы безопасности сети и учетные записи хранения ключей.

### <a name="secure-devops-toolkit"></a>Безопасный набор средств DevOps

Пакет Secure DevOps Kit для Azure (Азск) — это набор сценариев, инструментов, расширений и возможностей автоматизации, изначально созданный собственной ИТ-группой Майкрософт и [выпущенных в виде открытого кода с помощью GitHub](https://github.com/azsk/DevOpsKit-docs). Азск подразделяется на требования к подписке Azure и безопасности ресурсов для групп, использующих обширную автоматизацию, и плавное внедрение безопасности в собственные рабочие процессы DevOps, которые помогают обеспечить безопасность DevOps с помощью этих шести областей.

- защита подписки;
- включение безопасной разработки;
- Интеграция безопасности в CI/CD
- Постоянная гарантия
- Оповещения и мониторинг
- Управление облачными рисками

![Набор средств Azure DevOps](../_images/reference/secure-devops-kit.png)

Азск — это обширный набор средств, сценариев и информации, которые являются важной частью полного плана управления Azure, и их внедрение в шаблон крайне важно для поддержки целей Организации по управлению рисками.

### <a name="azure-update-management"></a>Управление обновлениями Azure

Одной из ключевых задач для поддержки безопасности среды является обеспечение исправления серверов с помощью последних обновлений. Хотя существует множество средств для выполнения этой задачи, Azure предоставляет решение по [управлению обновлениями Azure](https://docs.microsoft.com/azure/automation/automation-update-management) для идентификации и развертывания критически важных исправлений операционной системы. Оно использует службу автоматизации Azure, которая рассматривается в разделе [Автоматизация](#automate) данного руководства.

## <a name="monitor-and-alerts"></a>Мониторинг и оповещения

Сбор и анализ данных телеметрии, обеспечивающих понимание действий, метрик производительности, работоспособность и доступность служб, которые используются в подписках Azure, крайне важны для упреждающего управления приложениями и инфраструктура и является базовой потребностью в каждой подписке Azure. Каждая служба Azure создает данные телеметрии в виде журналов действий, метрик и журналов диагностики.

- В **журналах действий** описаны все операции, выполняемые с ресурсами в ваших подписках.
- **Метрики** — это числовые данные, создаваемые ресурсом, который описывает производительность и работоспособность ресурса.
- **Журналы диагностики** выпускаются службой Azure и предоставляют обширные, часто используемые данные о работе этой службы.

Эти сведения можно просматривать и обрабатывать на нескольких уровнях и постоянно улучшать. Azure предоставляет **Общие**, **основные**и **детальные** возможности мониторинга ресурсов Azure с помощью служб, описанных на приведенной ниже схеме.

![monitoring](../_images/reference/monitoring.png)

### <a name="shared-capabilities"></a>Возможности общего доступа

- **Оповещения:** Вы можете составлять все журналы, события и метрики из ресурсов Azure, но без возможности получать уведомления о критических условиях и действовать эти данные полезны только для исторических целей и судебных расследований. Оповещения Azure активно уведомляют об условиях, которые вы определяете во всех приложениях и инфраструктуре. Правила генерации оповещений создаются для журналов, событий и метрик, которые используют группы действий для уведомления наборов получателей. Группы действий также предоставляют возможность автоматизировать восстановление с помощью внешних действий, например веб-перехватчики для запуска runbooks службы автоматизации и функций Azure.

- **Панели мониторинга:** Панели мониторинга позволяют объединять представления мониторинга и объединять данные между ресурсами и подписками, чтобы предоставить представление телеметрии ресурсов Azure для всего предприятия. Вы можете создавать и настраивать свои собственные представления и делиться ими с другими. Например, можно создать панель мониторинга, состоящую из различных плиток для администраторов баз данных, чтобы предоставить сведения всем службам Azure Database Services, включая базу данных SQL Azure, Azure DB для PostgreSQL и Azure DB для MySQL.

- **Обозреватель метрик:** Метрики — это числовые значения, создаваемые ресурсами Azure (например,% CPU или дискового ввода-вывода), которые позволяют получить представление о работе и производительности ресурсов. С помощью обозреватель метрик можно определить и отправить метрики, которые интересуют Log Analytics для агрегирования и анализа.

### <a name="core-monitoring"></a>Базовый мониторинг

- **Azure Monitor:** Azure Monitor — это основная служба платформы, которая предоставляет единый источник для мониторинга ресурсов Azure. Портал Azure интерфейс Azure Monitor предоставляет централизованный переход на все функции мониторинга в Azure, включая возможности глубокого мониторинга Application Insights, Log Analytics, мониторинг сети, решения для управления и Схемы услуги. С помощью Azure Monitor Вы можете визуализировать, запрашивать, маршрутизировать, архивировать и выполнять действия с метриками и журналами, поступающими из ресурсов Azure во всей облачной организации. Помимо портала вы можете получать данные с помощью командлетов Monitor PowerShell, кросс-платформенного интерфейса командной строки или интерфейсов API Azure Monitor.

- **Помощник по Azure:** Помощник Azure постоянно отслеживает данные телеметрии в ваших подписках и средах и предоставляет рекомендации по оптимизации ресурсов Azure для экономии денег и повышения производительности, безопасности и доступности ресурсов. , которые составляют приложения.

- **Работоспособность службы:** Служба работоспособности служб Azure определяет все проблемы со службами Azure, которые могут повлиять на ваши приложения, а также помогают в планировании запланированных периодов обслуживания.

- **Журнал действий:** В журнале действий описываются все операции с ресурсами в ваших подписках. Он предоставляет журнал аудита для определения "что", "кому" и "когда" для всех операций создания, обновления и удаления ресурсов. События журнала действий хранятся на платформе и доступны для запроса в течение 90 дней. Журналы действий можно получать в Log Analytics для более длительных периодов хранения и более глубокого запроса и анализа по нескольким ресурсам.

### <a name="deep-application-monitoring"></a>Сложный мониторинг приложений

- **Application Insights:** Application Insights позволяет выполнять сбор данных телеметрии для конкретного приложения и отслеживать производительность, доступность и использование приложений в облаке или локальной среде. С помощью инструментирования приложения с поддерживаемыми пакетами SDK для нескольких языков, включая .NET, JavaScript, JAVA, Node. js, Ruby и Python. События Application Insights попадают в одно хранилище данных Log Analytics, которое поддерживает мониторинг инфраструктуры и безопасности, чтобы вы могли коррелировать и агрегировать события во времени с помощью богатого языка запросов.

### <a name="deep-infrastructure-monitoring"></a>Инфраструктура сложного мониторинга

- **Log Analytics:** Log Analytics играет центральную роль в мониторинге Azure, собирая телеметрию и другие данные из различных источников и предоставляя язык запросов и модуль аналитики, который позволяет получить представление о работе приложений и ресурсов. Вы можете напрямую взаимодействовать с Log Analytics данными с помощью быстрого поиска по журналам и представлений. также можно использовать средства анализа в других службах Azure, которые хранят свои данные в Log Analytics таких как Application Insights или центр безопасности Azure.

- **Мониторинг сети:** Службы мониторинга сети Azure позволяют получить представление о потоке сетевого трафика, производительности, безопасности, подключении и узких местах. Тщательно спланированный проект сети должен включать настройку служб мониторинга сети Azure, такую как Наблюдатель за сетями и ExpressRoute Monitor.

- **Решения по управлению:** Решения по управлению — это Упакованные наборы логики, аналитических сведений и предопределенных Log Analytics запросов для приложения или службы. Они полагаются на Log Analytics как основу для хранения и анализа данных событий. Пример решений по управлению содержат контрольные контейнеры и аналитику Базы данных Azure SQL.

- **Сопоставление служб:** Сопоставление служб предоставляет графическое представление компонентов инфраструктуры, их процессов и взаимозависимостей на других компьютерах и внешних процессах. Оно объединяет события, данные о производительности и решения по управлению в Log Analytics.

> [!TIP]
> Перед созданием отдельных предупреждений создайте и поддерживайте набор общих групп действий, которые можно использовать во всех оповещениях Azure. Это позволит вам централизованно поддерживать жизненный цикл списков получателей, методы доставки уведомлений (электронная почта, Номера телефонов SMS) и веб-перехватчики внешним действиям (Runbook службы автоматизации Azure, функции Azure и Logic Apps, ITSM).

## <a name="cost-management"></a>Управление затратами

Одним из основных изменений, с которым вам придется столкнуться при переходе от локального облака к общедоступному, является переход от капитальных затрат (покупка оборудования) к операционным расходам (плата за обслуживание по мере его использования). Этот параметр также требует более тщательного управления затратами. Преимуществом облака является то, что вы можете эффективно и эффективно влиять на стоимость службы, которую вы используете, просто отключая или изменяя ее размер, если она не нужна. Рекомендуется поочередно управлять затратами в облаке, а также на одном из клиентов, которые выполняют повседневную работу.

Корпорация Майкрософт предоставляет несколько средств для визуализации и мониторинга затрат, а также управления ими. Мы также предоставляем полный набор интерфейсов API, которые позволяют настраивать и интегрировать управление затратами в свои собственные инструменты и панели мониторинга. Эти средства слабо сгруппированы в портал Azure возможности и внешние возможности.

### <a name="azure-portal-capabilities"></a>портал Azure возможности

Это инструменты для предоставления вам мгновенных сведений о затратах, а также возможность выполнения действий.

- **Стоимость ресурса подписки:** В представлении " [анализ затрат Azure](https://docs.microsoft.com/azure/cost-management/overview) " на портале представлен краткий обзор затрат и сведений о ежедневных расходах ресурсов или групп ресурсов.
- **Управление затратами Azure:** Этот продукт является результатом покупки Cloudyn корпорацией Майкрософт и позволяет управлять и анализировать расходы на Azure, а также то, что вы тратите на других общедоступных облачных поставщиках. Есть как бесплатные, так и платные уровни, с большим количеством возможностей, как показано в [Обзоре](https://docs.microsoft.com/azure/cost-management/overview).
- **Бюджеты и группы действий Azure:** Знание каких-либо затрат и действий с ней в течение последнего времени не было внесено в действие вручную. С появлением бюджетов Azure и своих API-интерфейсов теперь можно создавать действия (как показано в [этом примере](https://channel9.msdn.com/Shows/Azure-Friday/Managing-costs-with-the-Azure-Budgets-API-and-Action-Groups)), когда стоимость достигает порогового значения. Например, выключение группы ресурсов "тест", когда она достигает 100% своего бюджета, или [другой пример].
- **Помощник по Azure**. Иметь представление о затратах — это только половина дела; что делать с этой информацией — совершенно другое. [Помощник по Azure](https://docs.microsoft.com/azure/advisor/advisor-overview) предоставляет рекомендации по действиям, которые необходимо предпринять для экономии средств, повышения надежности или даже повышения безопасности.

### <a name="external-cost-management-tools"></a>Внешние средства управления затратами

- **Azure Consumption Insights Power BI:** Вы хотите создать собственные визуализации для вашей организации? В этом случае Azure Consumption Insights пакет содержимого для Power BI — это ваше средство выбора. С помощью этого пакета содержимого и Power BI вы можете создавать пользовательские визуализации для представления Организации, выполнять углубленный анализ затрат и добавлять другие источники данных для дальнейшей обогащенности.

- **API потребления:** [Интерфейсы API потребления](https://docs.microsoft.com/rest/api/consumption) предоставляют программный доступ к данным о затратах и использовании, а также сведения о бюджетах, зарезервированных экземплярах и платах Marketplace. Эти API-интерфейсы доступны только для регистрации Enterprise и некоторых подписок Web Direct, кроме того они дают возможность интегрировать ваши данные о расходах в свои собственные средства и хранилища данных. Вы также можете [получить доступ к этим API через Azure CLI](https://docs.microsoft.com/cli/azure/consumption?view=azure-cli-latest).

Клиенты, которые являются долгосрочными и зрелыми пользователями облака, следуют определенным рекомендациям:

- **Активно отслеживать затраты.** Организации, которые являются опытными пользователями Azure, постоянно отслеживают затраты и при необходимости предпринимают действия. Некоторые организации даже назначают людей, в чьи обязанности входит выполнять анализ и предлагать изменения в использовании, и эти люди более чем окупаются при первом же найденном неиспользуемом кластере HDInsight, который был запущен вот уже несколько месяцев.
- **Используйте зарезервированные экземпляры виртуальных машин.** Еще одним ключевым принципом клиента для управления расходами в облаке является использование правильного средства для работы. Если у вас есть виртуальная машина IaaS, которая должна оставаться постоянной, использование зарезервированного экземпляра виртуальной машины позволит сэкономить значительные деньги. Поиск правильного баланса между автоматизацией завершения работы виртуальных машин и использованием зарезервированных экземпляров виртуальных машин требует выполнения и анализа.
- **Эффективно используйте автоматизацию.** Многие рабочие нагрузки не должны выполняться каждый день. При отключении виртуальной машины в течение 4-часового периода каждый день может сэкономить 15% затрат. Служба автоматизации быстро окупит себя.
- **Используйте теги ресурсов для видимости.** Как упоминалось в другой части этого документа, использование тегов ресурсов позволит лучше анализировать затраты.

Управление затратами — это дисциплина, которая является основой эффективного и действенного управления общедоступным облаком. Предприятия, которые достигают успеха, могут управлять своими затратами и сопоставлять их с фактическим спросом, а не переобретать и покупая спрос.

## <a name="automate"></a>Автоматизация

Одна из многих возможностей, которая отличает опытность организаций, использующих поставщики облака, — это уровень автоматизации, который они включили. Автоматизация — это бесконечный процесс, и поскольку ваша организация перемещается в облако, как и любая другая часть требует вложений ресурсов и времени для создания. Автоматизация служит многими целями, включая единообразное развертывание ресурсов (где они напрямую привязывается к другой концепции базового шаблона, шаблоны и DevOps) для устранения проблем. Служба автоматизации — это "соединительная ткань" каркаса Azure, которая связывает все области между собой.

Некоторые средства могут помочь вам создать эту возможность, от сторонних средств, таких как служба автоматизации Azure, служба "Сетка событий" и Azure CLI, к широкому числу сторонних средств, таких как terraform, Jenkins, Chef и Puppet. Основные средства автоматизации включают службу автоматизации Azure, службу "Сетка событий" и Azure Cloud Shell.

- Служба **автоматизации Azure** — Это облачная возможность, которая позволяет создавать модули Runbook (в PowerShell или Python) и позволяет автоматизировать процессы, настраивать ресурсы и даже применять исправления. [Служба автоматизации Azure](https://docs.microsoft.com/azure/automation/automation-intro) имеет расширенный набор кроссплатформенных возможностей, которые являются неотъемлемой частью развертывания, но слишком обширны, чтобы можно было здесь подробно их перечислить и описать.
- **Сетка событий** — это полностью управляемая система маршрутизации событий, позволяющая реагировать на события в среде Azure. Так же, как служба автоматизации Azure — это ткани в зрелых облачных организациях, служба " [Сетка событий](https://docs.microsoft.com/azure/event-grid) " — это подсоединенная ткани хорошей автоматизации. С помощью таблицы событий можно создать простое бессерверное действие для отправки сообщения администратору при создании нового ресурса и записи этого ресурса в базу данных. Эта же Сетка событий может уведомлять, когда ресурс удаляется, и удалять элемент из базы данных.
- **Azure Cloud Shell** — это интерактивная [оболочка](https://docs.microsoft.com/azure/cloud-shell/overview) на основе браузера для управления ресурсами в Azure. Она обеспечивает полную среду для PowerShell или Bash, которая запускается по мере необходимости (и поддерживается для вас), чтобы получить согласованную среду для запуска сценариев. Azure Cloud Shell предоставляет доступ к дополнительным инструментам, уже установленным — для автоматизации среды, в том числе [Azure CLI](https://docs.microsoft.com/cli/azure/get-started-with-azure-cli?view=azure-cli-latest), [terraform](https://docs.microsoft.com/azure/virtual-machines/linux/terraform-install-configure) и растущего списка дополнительных [средств](https://azure.microsoft.com/updates/cloud-shell-new-cli-tools-and-font-size-selection) для управления контейнерами, базами данных (sqlcmd) и удобн.

Автоматизация — это полноценное задание, которое быстро становится одной из самых важных рабочих задач в облачной группе. Организации, которые используют подход "Автоматизация на первом месте" имеют больший успех в использовании Azure.

- **Управление затратами:** Активное Поиск возможных сделок и создание автоматизации для изменения размера ресурсов, увеличения или уменьшения масштаба и отключение неиспользуемых ресурсов.
- **Гибкость в работе:** С помощью службы автоматизации (вместе с шаблонами и DevOps) вы получаете уровень повторяемости, который повышает доступность, повышает безопасность и позволяет команде сосредоточиться на решении бизнес-задач.

## <a name="templates-and-devops"></a>Шаблоны и инструменты DevOps

Как указано в разделе "Автоматизация", ваша цель как организации должна заключаться в предоставлении ресурсов с помощью шаблонов и сценариев, контролируемых источником для минимизации интерактивной конфигурации среды. Такой подход "инфраструктуры как кода" наряду с дисциплинированным процессом DevOps для непрерывного развертывания может обеспечить согласованность и уменьшить смещение в среде. Почти каждый ресурс Azure можно развернуть с помощью [шаблонов JSON Azure Resource Manager](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-template-deploy) в сочетании с PowerShell или кроссплатформенными CLI и средствами Azure, например Terraform от Hashicorp (который имеет поддержку первого класса и интегрирован в Azure Cloud Shell).

В статье, например рекомендации [по использованию шаблонов Azure Resource Manager](https://blogs.msdn.microsoft.com/mvpawardprogram/2018/05/01/azure-resource-manager) , представлено отличное обсуждение рекомендаций и уроков по применению подхода DevOps к Azure Resource Manager шаблонам с помощью [Azure DevOps](https://docs.microsoft.com/azure/devops/user-guide/?view=vsts) цепочки инструментов . Уделите время и усилия по разработке базового набора шаблонов, характерных для требований вашей организации, а также для разработки конвейеров непрерывной доставки с помощью DevOps цепочек инструментов (например, Azure DevOps, Jenkins, bamboo, TeamCity и т. д.), особенно для среды производства и контроля качества. В GitHub имеется большая библиотека шаблонов быстрого запуска [Azure](https://github.com/Azure/azure-quickstart-templates) , которые можно использовать в качестве отправной точки для шаблонов, а также быстро создавать конвейеры облачной доставки с помощью Azure DevOps.

Для рабочих подписок или групп ресурсов рекомендуется использовать безопасность RBAC, чтобы запретить интерактивных пользователей по умолчанию и использовать конвейеры непрерывной доставки на основе субъектов-служб для подготовки всех ресурсов и Доставьте весь код приложения. Ни администратор, ни разработчик не должны касаться портал Azure для интерактивной настройки ресурсов. Этот уровень DevOps берет на себя концертные усилия и использует все концепции формирования шаблонов Azure, обеспечивая единообразную и безопасную среду, которая будет соответствовать потребностям вашей организации по масштабированию.

> [!TIP]
> При разработке и подготовке сложных шаблонов Azure Resource Manager используйте [связанные шаблоны](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-linked-templates) для организации и реорганизации сложных отношений ресурсов из монолитных файлов JSON. Это позволит вам управлять ресурсами по отдельности и сделать шаблоны более удобочитаемыми, тестируемыми и пригодными для повторного использования.

Azure — это высокомасштабируемый поставщик облачных служб. При перемещении Организации с локальных серверов в облако полагаться на те же концепции, которые поставщики облачных приложений и приложения SaaS помогут вашей организации в значительной степени эффективно реагировать на потребности бизнеса.

## <a name="core-network"></a>Основная сеть

Заключительным компонентом эталонной модели каркаса Azure является основная возможность получения организацией доступа к Azure, в безопасном режиме. Доступ к ресурсам может быть внутренним (внутри корпоративной сети) или внешним (через Интернет). Пользователи в вашей организации могут случайно помещать ресурсы в расположения, не предназначенные для них, тем самым потенциально открывая их для вредоносного доступа. Как и в случае локальных устройств, предприятия должны добавить соответствующие элементы управления, чтобы гарантировать, что пользователи Azure принимают правильные решения. Для управления подписками мы определяем основные ресурсы, обеспечивающие базовые элементы управления доступом. К основным ресурсам относятся следующие.

- **Виртуальные сети** представляют собой объекты контейнеров для подсетей. Хотя это не является обязательным, их часто используют при подключении приложений к внутренним корпоративным ресурсам.
- **Определяемые пользователем маршруты** позволяют управлять таблицей маршрутов в подсети, что позволяет передавать трафик через виртуальный сетевой модуль или удаленный шлюз в одноранговой виртуальной сети.
- **Пиринг виртуальных сетей** позволяет легко подключать две или больше виртуальных сетей Azure, создавая более сложные модели концентраторов и периферийных серверов или сети общих служб.
- **Конечные точки службы.** Раньше службы PaaS использовали разные методы для обеспечения доступа к этим ресурсам из виртуальных сетей. Конечные точки службы позволяют защитить доступ к включенным службам PaaS **только** с подключенных конечных точек, повышая общую безопасность.
- **Группы безопасности** — это обширный набор правил, которые предоставляют возможность разрешать или запрещать входящий и исходящий трафик между ресурсами Azure. [Группы безопасности](https://docs.microsoft.com/azure/virtual-network/security-overview) состоят из правил безопасности, которые можно дополнить **тегами службы** (которые определяют общие службы Azure, такие как Azure Key Vault или база данных SQL Azure) и **группы безопасности приложений** (определяющие и приложения). структура, например веб-серверы или серверы приложений.

> [!TIP]
> Используйте теги службы и группы безопасности приложений в группах безопасности сети, не только повышая удобочитаемость правил, &mdash;which важно понимать влияние &mdash;but также обеспечить эффективное микросегментацию в более крупной подсети. уменьшение числа и повышение гибкости.

### <a name="azure-virtual-datacenter"></a>Виртуальный центр обработки данных Azure

Azure предоставляет как внутренние возможности, так и возможности от сторонних производителей из нашей расширенной партнерской сети, которые позволяют иметь эффективную стратегию обеспечения безопасности. Что более важно, корпорация Майкрософт предоставляет рекомендации и руководства в виде [виртуального центра обработки данных Azure (в постоянного тока)](./networking-vdc.md). При переходе с одной рабочей нагрузки на несколько рабочих нагрузок, использующих гибридные возможности, руководство по работе с подсистемой включает в себя "рецепты" для обеспечения гибкой сети, которая будет расти по мере роста рабочих нагрузок в Azure.

## <a name="next-steps"></a>Дальнейшие действия

Управление крайне важно для успешной работы Azure. В этой статье рассматривается техническая реализация корпоративного каркаса, но только затрагивается более широкий процесс и связи между компонентами. Политики управления действуют сверху вниз и определяются целями бизнеса. Естественно, в создании модели управления для Azure участвуют представители ИТ-отдела, но, что более важно, в нем должны активно участвовать представители руководителей бизнес-групп, а также специалисты по безопасности и управлению рисками. В конечном счете задача корпоративного каркаса — уменьшить бизнес-риски и помочь в выполнении миссии и достижении целей организации.

Теперь, когда вы узнали об управлении подписками, пришло время ознакомиться с этими рекомендациями на практике. Ознакомьтесь с разделом [Примеры реализации корпоративного каркаса Azure](./azure-scaffold-examples.md).
