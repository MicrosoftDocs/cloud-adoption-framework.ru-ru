---
title: 'Виртуальные центры обработки данных: перспективы сети'
description: Узнайте, как создать виртуальный центр обработки данных в Azure.
author: tracsman
ms.author: jonor
ms.date: 06/12/2019
ms.topic: guide
ms.service: cloud-adoption-framework
ms.subservice: reference
manager: rossort
tags: azure-resource-manager
ms.custom: virtual-network
ms.openlocfilehash: 718c93b560b38eaae6556e549a0c6f6bb97b807b
ms.sourcegitcommit: 7ffb0427bba71177f92618b2f980e864b72742f4
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/29/2019
ms.locfileid: "73048246"
---
# <a name="virtual-datacenters-a-network-perspective"></a>Виртуальные центры обработки данных: перспективы сети

## <a name="overview"></a>Краткое описание

Переместив локальные приложения в Azure, организации могут пользоваться преимуществами безопасной и экономичной инфраструктуры, даже если приложения переносятся с минимальными изменениями. Тем не менее для получения максимальной гибкости облачных вычислений организациям необходимо модернизировать свою архитектуру, чтобы использовать возможности Azure в полном объеме.

Microsoft Azure предоставляет службы и инфраструктуру масштабирования с возможностями и надежностью корпоративного класса. Эти службы и инфраструктура предлагают множество вариантов гибридного подключения, поэтому клиенты могут выбрать доступ к ним через общедоступный Интернет или через частное подключение Azure ExpressRoute. Кроме того, партнеры Майкрософт предоставляют расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

Клиенты могут обращаться к этим облачным службам через Интернет или с помощью службы Azure ExpressRoute, которая позволяет создавать подключения к частной сети. Благодаря Microsoft Azureной платформе клиенты могут легко расширить свою инфраструктуру в облаке и создать многоуровневые архитектуры. Кроме того, партнеры Майкрософт предоставляют расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

<!-- markdownlint-disable MD026 -->

## <a name="what-is-the-virtual-datacenter"></a>Что такое виртуальный центр обработки данных?

С самого начала облако являлось платформой для размещения общедоступных приложений. Предприятия начали понимать ценность облака и начали перемещать в него внутренние бизнес-приложения. Эти типы приложений обеспечили дополнительные параметры безопасности, надежности, производительности и стоимости, которым требовалась дополнительная гибкость способа предоставления облачных услуг. Именно поэтому были созданы новая инфраструктура и сетевые службы, разработанные для обеспечения этой гибкости, а также новые функции масштабирования, аварийного восстановления и другие возможности.

Изначально облачные решения разрабатывались для размещения относительно изолированных отдельных приложений для общедоступного использования. Этот подход был оптимальным несколько лет. Затем преимущества облачных решений стали очевидными, и облака стали использоваться для размещения нескольких крупномасштабных рабочих нагрузок. Решение проблем безопасности, надежности, производительности и затрат на развертывание в одном или нескольких регионах стало жизненно важным в течение жизненного цикла облачной службы.

На следующей схеме облачного развертывания **красным прямоугольником** обозначена область с недостаточным уровнем защиты. В **желтом поле** отображается место для оптимизации сетевых виртуальных модулей между рабочими нагрузками.

![0][0]

Виртуальный центр обработки данных — это концепция, которая порождена по мере необходимости масштабирования для поддержки корпоративных рабочих нагрузок и балансировки проблем, возникающих при поддержке крупномасштабных приложений в общедоступном облаке.

Реализация виртуального центра обработки данных не только представляет рабочие нагрузки приложений в облаке, а также сеть, безопасность, управление и инфраструктуру (например, службы DNS и каталогов). По мере того как рабочие нагрузки предприятия переходят в Azure, важно подумать о поддержке инфраструктуры и объектах, в которых размещены эти рабочие нагрузки. Верное понимание того, как структурированы ресурсы, может помочь избежать распространения сотен "островов рабочих нагрузок", которым требуется отдельное управление с независимым потоком данных, моделями безопасности и подходом к решению проблем соответствия требованиям.

Концепция виртуального центра обработки данных — это набор рекомендаций и рекомендаций по реализации коллекции отдельных, но связанных сущностей с общими вспомогательными функциями, функциями и инфраструктурой. Просматривая рабочие нагрузки с помощью линзы виртуального центра обработки данных, вы можете снизить затраты благодаря экономии, оптимизированной безопасности через компонент и централизованную работу с потоком данных, а также упростить операции, управление и аудит соответствия требованиям.

> [!NOTE]
> Важно понимать, что виртуальный центр обработки данных **не является** дискретным продуктом Azure, но сочетание различных функций и возможностей в соответствии с вашими требованиями. Виртуальный центр обработки данных — это способ подумать о рабочих нагрузках и использовании Azure для максимального увеличения ресурсов и возможностей в облаке. Это модульный подход к созданию ИТ-служб в Azure при соблюдении организационных ролей и обязанностей предприятия.

Реализация виртуальных центров обработки данных помогает предприятиям получать рабочие нагрузки и приложения в Azure в следующих сценариях:

- размещение нескольких связанных рабочих нагрузок;
- перенос рабочих нагрузок из локальной среды в Azure;
- обеспечение общей или централизованной защиты и доступности рабочих нагрузок;
- сбалансированное применение ролей централизованной ИТ-команды и команды Azure DevOps в рамках крупного предприятия.

Ключом к разблокированию преимуществ виртуального центра обработки данных является централизованная топология концентратора и периферийная сеть с сочетанием служб и функций Azure:

- [Виртуальная сеть Azure][VNet],
- [Группы безопасности сети][network-security-groups],
- [Пиринг виртуальных сетей][VNetPeering],
- [Определяемые пользователем маршруты][user-defined-routes]и
- Удостоверение Azure с [контролем доступа на основе ролей (RBAC)][RBAC] и необязательный [брандмауэр Azure][AzFW], [Azure DNS][DNS], [Передняя дверца Azure][AFD]и [Виртуальная глобальная сеть Azure][vWAN].

## <a name="who-should-implement-a-virtual-datacenter"></a>Кто отвечает за реализацию ВЦОД?

Любой клиент Azure, принявший решение использовать облако, может выиграть за счет эффективной настройки набора ресурсов для общего использования всеми приложениями. В зависимости от величины, даже отдельные приложения могут воспользоваться преимуществами шаблонов и компонентов, используемых для создания реализации виртуального центра обработки данных.

Если ваша организация имеет централизованные группы или отделы для ИТ, сети, обеспечения безопасности или соответствия требованиям, реализация виртуального центра обработки данных может помочь в обеспечении политик, разделениях обязанностей и обеспечении единообразия базовых общих компонентов при предоставлении Группа разработчиков приложений обладает большой свободу и контроля, что подходит для ваших требований.

Организации, которые ищут DevOps, могут также использовать основные понятия центра обработки данных для предоставления полномочных карманных устройств ресурсов Azure и обеспечения общего контроля в группе (подписка или группа ресурсов в общей подписке), но границы сети и безопасности остаются соответствующими требованиям, определенным централизованной политикой в виртуальной сети концентратора и группе ресурсов.

<!-- markdownlint-enable MD026 -->

## <a name="considerations-for-implementing-a-virtual-datacenter"></a>Рекомендации по реализации виртуального центра обработки данных

При проектировании реализации виртуального центра обработки данных необходимо учитывать несколько проблем:

### <a name="identity-and-directory-service"></a>Служба удостоверений и каталогов

Службы идентификации и каталогов — главный компонент всех ВЦОД, как в локальной, так и в облачной средах. Удостоверение связано со всеми аспектами доступа и авторизации к службам в реализации виртуального центра обработки данных. Чтобы обеспечить доступ к учетной записи и ресурсам Azure только авторизованным пользователям и процессам, Azure использует несколько типов учетных данных для аутентификации. К ним относятся пароли (для доступа к учетной записи Azure), криптографические ключи, цифровые подписи и сертификаты. [Многофакторная идентификация Azure][multi-factor-authentication] — это дополнительный уровень безопасности для доступа к службам Azure. Многофакторная идентификация обеспечивает надежную проверку подлинности с помощью ряда простых вариантов проверки (телефонный звонок, текстовое сообщение или уведомление мобильного приложения) и позволяет клиентам выбрать предпочтительный метод.

Любой крупной организации необходимо определить процесс управления удостоверениями, который описывает управление индивидуальными удостоверениями, их проверку подлинности, авторизацию, роли и привилегии в пределах или в рамках реализации виртуальных центров обработки данных. Цели такого процесса — повышение безопасности и производительности при одновременном снижении затрат, времени простоя, а также повторяющихся и выполняемых вручную задач.

Корпоративные организации могут потребовать использования ресурсоемких служб для различных отраслей, а сотрудники часто имеют различные роли при работе с различными проектами. Виртуальный центр обработки данных требует хорошего взаимодействия между различными группами, каждый из которых имеет определенные определения ролей, чтобы получать системы, работающие с хорошим управление. Процесс назначения обязанностей, разрешений и прав может быть очень непростым. Управление удостоверениями в виртуальном центре обработки данных реализуется с помощью [Azure Active Directory (Azure AD)][azure-ad] и управления доступом на основе РОЛЕЙ (RBAC).

Служба каталогов — это общая информационная инфраструктура для поиска, администрирования и организации ежедневно используемых элементов и сетевых ресурсов. Эти ресурсы могут включать тома, папки, файлы, принтеры, пользователей, группы, устройства и другие объекты. Каждый ресурс в сети считается объектом сервера каталогов. Сведения о ресурсе хранятся в виде коллекции атрибутов, связанных с этим ресурсом или объектом.

Все бизнес-службы Microsoft Online используют Azure Active Directory (Azure AD) для входа и других задач, связанных с идентификацией. Azure Active Directory (Azure AD) — это комплексное высокодоступное облачное решение для управления удостоверениями и доступом, предоставляющее базовые службы каталогов, расширенные функции управления удостоверениями и функции управления доступом к приложениям. Azure AD можно интегрировать с локальным экземпляром Active Directory для включения единого входа для всех облачных и локальных приложений. Атрибуты пользователя локальной службы Active Directory могут автоматически синхронизироваться с Azure AD.

Одному глобальному администратору не требуется назначать все разрешения в реализации виртуального центра обработки данных. Вместо этого у каждого конкретного отдела, группы пользователей или служб в службе каталогов могут быть разрешения, необходимые для управления собственными ресурсами в реализации виртуального центра обработки данных. Структурирование разрешений требует балансировки. Большое количество разрешений может препятствовать оптимальной производительности, а недостаточное или отсутствие некоторых — может повысить риски для системы безопасности. Управление доступом на основе ролей (RBAC) в Azure помогает решить эту проблему, предлагая детальное управление доступом для ресурсов в реализации виртуального центра обработки данных.

#### <a name="security-infrastructure"></a>инфраструктуру безопасности;

Инфраструктура безопасности — это разделение трафика в сегменте виртуальной сети, относящейся к реализации виртуального центра обработки данных. Эта инфраструктура определяет, как входящий и исходящий трафик контролируется в реализации виртуального центра обработки данных. Azure основана на архитектуре с несколькими клиентами, которая предотвращает несанкционированный и непреднамеренной трафик между развертываниями с помощью изоляции виртуальной сети, списков управления доступом (ACL), подсистем балансировки нагрузки, IP-фильтров и политик потоков трафика. Преобразование сетевых адресов (NAT) отделяет внутренний и внешний сетевой трафик.

Структура Azure выделяет ресурсы инфраструктуры для рабочих нагрузок клиента и управляет исходящим и входящим обменом данными виртуальных машин. Низкоуровневая оболочка Azure принудительно разделяет память и процессы между виртуальными машинами и обеспечивает безопасную передачу сетевого трафика клиентам гостевой ОС.

#### <a name="connectivity-to-the-cloud"></a>подключения к облаку;

Реализация виртуального центра обработки данных требует подключения к внешним сетям для предоставления служб клиентам, партнерам и внутренним пользователям. Эта потребность в возможности подключения касается не только Интернета, но также локальных сетей и центров обработки данных.

Клиенты контролируют, какие службы имеют доступ и доступны из общедоступного Интернета с помощью [брандмауэра Azure][AzFW] или других типов устройств виртуальной сети (NVA), пользовательских политик маршрутизации с помощью [определяемых пользователем маршрутов][user-defined-routes]и сети. Фильтрация с помощью [групп безопасности сети][network-security-groups]. Рекомендуется, чтобы все ресурсы с выходом в Интернет также были защищены [стандартом Azure от атак DDoS Protection][DDoS].

Предприятиям может потребоваться подключить свою реализацию виртуального центра обработки данных к локальным центрам обработки данных или другим ресурсам. Эта возможность подключения между Azure и локальными сетями – важный аспект при проектировании эффективной архитектуры. У предприятий есть два разных способа создать это подключение: транзит через Интернет или через частные прямые подключения.

VPN-подключение [**типа "сеть — сеть" Azure**][VPN] — это служба взаимодействия через Интернет между локальными сетями и реализацией виртуального центра обработки данных, установленная с помощью защищенных зашифрованных соединений (туннели IPSec/IKE). Подключение типа "сеть — сеть" Azure — это гибкое подключение, которое можно быстро создать. Оно не требует последующего снабжения, так как все подключения выполняются через Интернет.

Для большого числа VPN-подключений [**Виртуальная глобальная сеть Azure**][vWAN] — это сетевая служба, которая обеспечивает оптимизированное и автоматизированное подключение ветвей между ветвями через Azure. Виртуальная глобальная сеть позволяет подключаться к настройкам устройств филиалов для взаимодействия с Azure. Подключение и настройку можно выполнить вручную или с помощью устройств провайдеров через партнера виртуальной глобальной сети. Использование нужных устройств провайдеров позволяет облегчить использование, подключение и управление конфигурацией. Встроенная панель управления глобальной виртуальной сетью Azure обеспечивает мгновенное устранение неполадок, что экономит время и предоставляет простой способ просмотра широкомасштабных подключений типа "сайт — сайт".

[**ExpressRoute**][ExR] — это служба подключения Azure, которая обеспечивает частные подключения между реализацией виртуального центра обработки данных и любыми локальными сетями. Подключения ExpressRoute не осуществляются через общедоступный Интернет и обеспечивают повышенный уровень безопасности, надежности и быстродействия (до 10 Гбит/с) с низкими и последовательными задержками. ExpressRoute полезен для реализации виртуальных центров обработки данных, так как клиенты ExpressRoute могут получить преимущества правил соответствия, связанных с частными подключениями. С помощью [ExpressRoute Direct][ExRD]можно подключаться непосредственно к маршрутизаторам майкрософт через 100 Гбит/с для клиентов с большим объемом пропускной способности.

Развертывание подключений ExpressRoute обычно требует участия поставщика услуг ExpressRoute. Для клиентов, которым необходимо быстро начать работу, обычно используется VPN-подключение типа "сеть — сеть" для установления подключения между реализацией виртуального центра обработки данных и локальными ресурсами, а затем выполняется переход на подключение ExpressRoute, когда физически подключение к поставщику услуг завершено.

#### <a name="connectivity-within-the-cloud"></a>*Подключения в облаке*

[Виртуальных сетей][VNet] и [пиринг][VNetPeering] виртуальных сетей — это основные службы сетевого подключения внутри реализации виртуального центра обработки данных. Виртуальная сеть гарантирует естественную границу изоляции ресурсов виртуального центра обработки данных, а пиринг виртуальных сетей обеспечивает взаимодействие между разными виртуальных сетей в одном регионе Azure или даже в разных регионах. Управление трафиком в виртуальной сети и между виртуальных сетей должно соответствовать набору правил безопасности, указанных в списках управления доступом ([группы безопасности сети][network-security-groups]), [виртуальных сетевых устройствах][NVA]и пользовательских таблицах маршрутизации ([определяемых пользователем маршрутов][user-defined-routes]).

## <a name="virtual-datacenter-overview"></a>Общие сведения о ВЦОД

### <a name="topology"></a>Топология

*Звезда* – это модель проектирования топологии сети для реализации виртуального центра обработки данных.

![1][1]

Как показано ниже, в Azure можно использовать два типа проектирования ступицы и звезды. Для обмена данными, общими ресурсами и централизованной политикой безопасности (концентратором виртуальной сети на схеме) или виртуальным глобальным кластером (виртуальная сеть WAN на схеме) для крупномасштабного обмена данными между ветвями и ветвями и Azure.

Центральная зона (концентратор) контролирует и проверяет входящий и исходящий трафик между разными зонами, включая Интернет, а также локальные периферийные зоны. Топология типа "звезда" позволяет ИТ-отделу применять политики безопасности в центральном расположении, одновременно минимизируя уязвимости и ошибки в конфигурации.

Концентратор часто содержит общие компоненты службы, используемые периферийными серверами. Их примеры представлены ниже.

- Инфраструктура Windows Active Directory для проверки подлинности внешних пользователей, которые пытаются получить доступ из ненадежных сетей, до предоставления таким пользователям доступа к рабочим нагрузкам в периферийных зонах. Сюда входят связанные службы федерации Active Directory (AD FS).
- Служба DNS для разрешения имен рабочих нагрузок в периферийных зонах и получения доступа к ресурсам локально и в Интернете, если [Azure DNS][DNS] не используется.
- Инфраструктура открытых ключей (PKI) для реализации единого входа в рабочие нагрузки.
- Управление TCP- и UDP-трафиком между зонами периферийными зонами и Интернетом.
- Управление потоком между периферийными зонами и локальными ресурсами.
- Управление потоком между несколькими периферийными зонами (при необходимости).

Виртуальный центр обработки данных сокращает общую стоимость, используя общую инфраструктуру концентратора между несколькими периферийными серверами.

Роль каждой периферийной зоны может заключаться в размещении различных типов рабочих нагрузок. Использование периферийных зон также позволяют реализовать модульный подход для повторяемых развертываний одних и тех же рабочих нагрузок в среде разработки и тестирования, пользовательского приемочного тестирования, а также подготовительной и рабочей среде. Также эти зоны можно использовать для разделения и включения различных групп в пределах организации, например, групп DevOps в Azure. В пределах периферийной зоны можно развернуть базовую рабочую нагрузку или сложные многоуровневые рабочие нагрузки с управлением трафиком между уровнями.

#### <a name="subscription-limits-and-multiple-hubs"></a>Ограничения подписки и несколько центральных зон

В Azure каждый компонент (независимо от типа) развертывается в подписке Azure. Изоляция компонентов Azure в разных подписках Azure может удовлетворять требования различных бизнес-приложений, например настройку дифференцированных уровней доступа и авторизации.

Реализация одной виртуальной системы обработки данных может масштабироваться до большого количества периферийных серверов, хотя, как и в случае с каждой ИТ-системой, существуют ограничения платформы. Развертывание концентратора привязано к определенной подписке Azure с ограничениями и ограничениями (например, с максимальным числом пиринга виртуальных сетей; дополнительные сведения см. в разделе [Подписка Azure, ограничения службы, квоты и ограничения][limits] ). В случаях, когда ограничения становятся проблемой, архитектуру можно далее масштабировать, расширяя отдельную звездообразную модель до кластера. Несколько концентраторов в одном или нескольких регионах Azure могут быть взаимосвязаны с помощью пиринга виртуальных сетей, подключения ExpressRoute, Виртуальной глобальной сети или VPN типа "сеть — сеть".

![2][2]

Включение нескольких концентраторов приводит к увеличению затрат и действий по управлению системой. Это будет оправдано только путем масштабирования, системных ограничений, избыточности и региональной репликации для производительности конечных пользователей или аварийного восстановления. В сценариях, требующих несколько концентраторов, все концентраторы должны обеспечивать один набор служб для упрощения выполнения операций.

#### <a name="interconnection-between-spokes"></a>Взаимодействие между периферийными зонами

Внутри одной звезды можно реализовать сложные многоуровневые рабочие нагрузки. Многоуровневые конфигурации можно реализовать с помощью подсетей (по одному для каждого уровня) в одной виртуальной сети и фильтрации потоков с помощью групп безопасности сети.

Архитектор может развернуть многоуровневую рабочую нагрузку в пределах нескольких виртуальных сетей. Используя пиринг между виртуальными сетями, периферийные зоны могут подключаться к другим периферийным зонам в пределах одного или нескольких концентраторов. Типичным примером такого сценария является случай, когда серверы обработки приложения располагаются в одной периферийной зоне или виртуальной сети, а база данных развернута в другой периферийной зоне или виртуальной сети. В этом случае периферийные зоны могут легко обмениваться данными через пиринговые виртуальные сети, не используя при этом концентратор. Необходимо соблюдать тщательную архитектуру и проверку безопасности, чтобы не обходить концентратор без использования важных точек безопасности или аудита, которые могут существовать только в концентраторе.

![3][3]

Периферийные зоны могут также взаимодействовать с периферийной зоной, выполняющей функции концентратора. Такой подход создает двухуровневую иерархию: периферийная зона высокого уровня (уровень 0) становится концентратором подчиненных периферийных зон (уровень 1) иерархии. Для реализации виртуального центра обработки данных требуется перенаправить трафик в Центральный концентратор, чтобы трафик мог быть передан в его место назначения в локальной сети или в общедоступном Интернете. Архитектура с двумя уровнями концентраторов представляет сложную маршрутизацию, которая устраняет преимущества простой связи Hub-лучевой.

Хотя Azure допускает сложные топологии, одним из основных принципов концепции виртуального центра обработки данных является повторяемость и простота. Чтобы упростить управление, простейший проект в виде звезды является эталонной архитектурой виртуального центра обработки данных, которую мы рекомендуем использовать.

### <a name="components"></a>Компоненты

Виртуальный центр обработки данных состоит из четырех основных типов компонентов: **инфраструктуры**, **сетей периметра**, **рабочих нагрузок**и **мониторинга**.

Каждый тип компонента состоит из различных функций и ресурсов Azure. Реализация виртуального центра обработки данных состоит из экземпляров нескольких типов компонентов и нескольких разновидностей одного и того же типа компонента. Например, у вас может быть много разных, логически разделенных экземпляров рабочей нагрузки, представляющих разные приложения. Для создания виртуального центра обработки данных используются различные типы компонентов и экземпляры.

![4..][4]

В предыдущей концептуальной архитектуре виртуального центра обработки данных показаны различные типы компонентов, используемые в разных зонах топологии Hub-периферийных серверов. На схеме показаны компоненты инфраструктуры в различных частях архитектуры.

В общем рекомендуется, чтобы права доступа и привилегии предоставлялись на основе группы. Работа с группами, а не отдельными пользователями, упрощает обслуживание политик доступа, предоставляя единообразный способ управления ИТ в группах и помогает свести к минимуму ошибки конфигурации. Назначение и удаление пользователей в соответствующих группах позволит обеспечить актуальность привилегий определенного пользователя.

Каждая группа роли должна содержать уникальный префикс в своем имени, позволяя легко определять связь между определенной группой и определенной рабочей нагрузкой. Например, рабочая нагрузка, размещающая службы проверки подлинности, должна содержать группы с именами **AuthServiceNetOps**, **AuthServiceSecOps**, **AuthServiceDevOps** и **AuthServiceInfraOps**. Для централизованных ролей или ролей, не связанных с определенной службой, может быть предваряется **Corp**. Например, **корпнетопс**.

Многие организации используют разновидность следующих групп для предоставления основной декомпозиции ролей:

- Центральная ИТ-группа **Corp**, имеет права владения для управления компонентами инфраструктуры. Примерами являются сетевые компоненты и система безопасности. Группе должна быть назначена роль участника в подписке, а также предоставлены права управления концентратором и права участника сети в периферийных зонах. Крупные организации часто разделяют эти функции между несколькими командами. Примеры — команда, отвечающая за сетевые операции (**CorpNetOps**), которая фокусируется на сетевых компонентах, а также команда, отвечающая за операции системы безопасности (**CorpSecOps**), которая фокусируется на политиках безопасности и брандмауэра. В этом конкретном случае требуется создание двух разных групп для назначения этих пользовательских ролей.
- Группа разработки и тестирования **AppDevOps** отвечает за развертывание рабочих нагрузок (приложений или служб). Эта группа принимает роль участника виртуальной машины для развертываний IaaS или одну или несколько ролей участника PaaS. См. раздел [встроенные роли для ресурсов Azure][Roles]. Кроме того, группе разработки и тестирования может потребоваться видимость политик безопасности (групп безопасности сети) и политик маршрутизации (определяемых пользователем маршрутов) в центре или определенном периферийном сервере. Кроме ролей участника для рабочих нагрузок этой группе также потребуется роль читателя сетей.
- Группа операций и обслуживания (**CorpInfraOps** или **AppInfraOps**) отвечает за управление рабочими нагрузками в рабочей среде. Эта группа должна быть участником подписки для рабочих нагрузок в любой рабочей подписке. Некоторые организации могут также определить необходимость в дополнительной эскалации группы службы поддержки с помощью роли участника подписки в рабочей среде и подписке центрального концентратора. Это позволит им решить потенциальные проблемы с конфигурацией в рабочей среде.

Виртуальный центр обработки данных разработан таким образом, что группы, созданные для Центральной ИТ-группы, управления концентратором, имеют соответствующие группы на уровне рабочей нагрузки. Кроме управления ресурсами концентратора только центральные ИТ-группы могут управлять внешним доступом и разрешениями верхнего уровня в подписке. Группы рабочей нагрузки также могут управлять ресурсами и разрешениями своей виртуальной сети независимо от центрального ИТ.

Виртуальный центр обработки данных разбивается на разделы для безопасного размещения нескольких проектов в разных отраслях. Всем проектам необходимы разные изолированные среды (разработки, UAT, рабочая среда). Отдельные подписки Azure для каждой из этих сред обеспечивают естественную изоляцию.

![5][5]

На предыдущей схеме показана связь между проектами организации, пользователями, группами и средами, в которых развернуты компоненты Azure.

Обычно в сфере ИТ среда (или уровень) представляет систему, в которой развертываются и выполняются несколько приложений. Крупные предприятия используют среду разработки (где изменения вносятся и тестируются) и рабочую среду (используемую конечными пользователями). Эти среды отделены, часто с помощью нескольких промежуточных сред, что позволяет выполнять поэтапное развертывание, тестирование и откат в случае возникновения проблем. Архитектуры развертывания сильно различаются, но обычно соблюдается основной процесс начала развертывания (разработка) и окончания развертывания (рабочая среда).

Общая архитектура для таких типов многоуровневой среды состоит из Azure DevOps для разработки и тестирования, UAT для промежуточных и рабочих сред. Организации могут использовать один или несколько клиентов Azure AD для определения доступа к этим средам и соответствующих прав. На предыдущей схеме показана ситуация, когда используются два разных клиента Azure AD: один для DevOps и UAT, а другой — исключительно для рабочей среды.

Наличие разных клиентов Azure AD обеспечивает разделение между средами. Одна группа пользователей (например, центральная ИТ-команда) должна пройти проверку подлинности с помощью другого URI, чтобы получить доступ к другому клиенту AD и изменить роли или разрешения Azure DevOps или рабочих сред проекта. Выполнение проверки подлинности другого пользователя для доступа к другим средам минимизирует возможные простои и предотвращает появление других проблем, вызванных человеческим фактором.

#### <a name="component-type-infrastructure"></a>Тип компонента: инфраструктура

В этом типе компонента размещается большая часть вспомогательной инфраструктуры. С этим компонентом большую часть времени работает централизованная ИТ-команда и команда по обеспечению соответствия и безопасности.

![6][6]

Компоненты инфраструктуры обеспечивают связь между различными компонентами реализации виртуального центра обработки данных и находятся как в концентраторе, так и в периферийных зонах. Управлением компонентами инфраструктуры и их обслуживанием обычно занимается центральная ИТ-команда или команда обеспечения безопасности.

Одна из основных задач группы ИТ-инфраструктуры — обеспечение согласованности схем IP-адреса на предприятии. Пространство частных IP-адресов, назначенное реализации виртуального центра обработки данных, должно быть единообразным и не перекрываться с частными IP-адресами, назначенными в локальных сетях.

Хотя преобразование NAT в локальных пограничных маршрутизаторах или средах Azure может помочь избежать конфликтов IP-адресов, оно усложняет работу компонентов инфраструктуры. Простота управления — одна из основных целей виртуального центра обработки данных, поэтому использование NAT для решения проблем с IP-адресами не является рекомендуемым решением.

Инфраструктура включает следующие компоненты:

- [**Службы удостоверений и каталогов**][azure-ad]. Доступ к каждому типу ресурса в Azure регулируется удостоверением, хранящимся в службе каталогов. В службе каталогов хранится не только список пользователей, но также права доступа к ресурсам в определенной подписке Azure. Эти службы могут существовать только в облаке или их можно синхронизировать с локальным удостоверением, хранящимся в Active Directory.
- [**Виртуальная сеть**][VPN]. Виртуальные сети являются одним из основных компонентов виртуального центра обработки данных и позволяют создавать границы изоляции трафика на платформе Azure. Виртуальная сеть состоит из одного или нескольких сегментов виртуальной сети, каждый из которых содержит определенный сетевой префикс IP-адреса (подсеть). Виртуальная сеть определяет внутреннюю область периметра, где виртуальные машины IaaS и службы PaaS могут устанавливать конфиденциальный канал связи. Виртуальные машины (и службы PaaS) в одной виртуальной сети не могут напрямую обращаться к виртуальным машинам (и службам PaaS) в другой виртуальной сети, даже если обе виртуальные сети созданы одним клиентом в одной подписке. Это критически важное свойство, которое гарантирует, что виртуальные машины и все коммуникации клиента останутся закрытыми в пределах виртуальной сети.
- [**Определяемые пользователем маршруты**][user-defined-routes]. Трафик в виртуальной сети перенаправляется по умолчанию на основе системной таблицы маршрутизации. Определяемый пользователем маршрут — это пользовательская таблица маршрутизации, которую сетевые администраторы могут связать с одной или несколькими подсетями, чтобы перезаписать поведение системной таблицы маршрутизации и определить путь обмена данными в виртуальной сети. Наличие определяемых пользователем маршрутов гарантирует, что исходящий трафик из периферийного транзитного трафика будет проходить через определенные пользовательские виртуальные машины или сетевые виртуальные устройства и подсистемы балансировки нагрузки, приходящие как в концентраторе, так и на периферийных устройствах.
- [**Группы безопасности сети**][network-security-groups]. Группа безопасности сети — это список правил безопасности, которые действуют как фильтрация трафика в IP-источниках, назначения IP-адресов, протоколы, порты источника IP-адресов и порты назначения IP-адресов. Группу безопасности сети можно применить к подсети, виртуальной сетевой карте, связанной с виртуальной машиной Azure, или к обеим. Группы безопасности сети необходимы для реализации правильного управления потоком в концентраторе и в периферийных зонах. Уровень безопасности, обеспечиваемый группой безопасности сети, — это функция, с которой открываются порты, и для каких целей. Клиенты должны применить дополнительные фильтры для каждой виртуальной машины с помощью брандмауэров на основе узла, например iptables или брандмауэра Windows.
- [**DNS**][DNS]. Разрешение имен ресурсов в виртуальных сетей реализации виртуального центра обработки данных обеспечивается с помощью DNS. Azure предоставляет службы DNS как для [открытого][DNS] , так и для [закрытого][PrivateDNS] разрешения имен. Частные зоны обеспечивают разрешение имен внутри виртуальной сети и между виртуальными сетями. Частные зоны могут не только охватывать виртуальные сети в том ж регионе, но также сети в разных регионах и подписках. Для общедоступного разрешения Azure DNS предоставляет службу размещения для доменов DNS, которая в свою очередь предоставляет разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure.
- Управление [**подписками**][SubMgmt] и [**группами ресурсов**][RGMgmt]. Подписка определяет естественную границу, чтобы создать несколько групп ресурсов в Azure. Ресурсы в подписке объединяются в логические контейнеры, называемые группами ресурсов. Группа ресурсов представляет логическую группу для Организации ресурсов в реализации виртуального центра обработки данных.
- [**RBAC**][RBAC]. Через RBAC можно сопоставить роль в организации с правами доступа к определенным ресурсам Azure, позволяя предоставить пользователям разрешения только на определенный набор действий (т. е. ограничить их). С помощью RBAC доступ предоставляется путем назначения соответствующей роли пользователям, группам и приложениям в определенной области. Областью назначения роли может быть подписка Azure, группа ресурсов или отдельный ресурс. RBAC разрешает наследование разрешений. Роли, назначенной в родительской области, предоставляется доступ также к содержащимся в ней дочерним элементам. С помощью RBAC вы можете распределить обязанности и предоставить пользователям доступ на уровне, который им необходим для выполнения поставленных задач. Например, можно использовать RBAC, чтобы разрешить одному сотруднику управлять виртуальными машинами в подписке, а другому — управлять в ней базами данных SQL.
- [**Пиринг виртуальной сети**][VNetPeering]. Фундаментальным компонентом, используемым для создания инфраструктуры виртуального центра обработки данных, является пиринг виртуальных сетей, механизм, соединяющий две виртуальные сети (виртуальных сетей) в одном регионе через сеть центра обработки данных Azure или использование магистральной магистрали Azure в регионах. .

#### <a name="component-type-perimeter-networks"></a>Тип компонента: сети периметра

Компоненты [сети периметра][DMZ] обеспечивают сетевое подключение между локальными или физическими центрами обработки данных, а также подключение к Интернету и подключения к ним. Сетевые группы и группы по обеспечению безопасности также проводят здесь большую часть времени.

Прежде чем попасть на внутренние серверы в периферийных зонах, входящие пакеты должны пройти через устройства безопасности в концентраторе, такие как брандмауэры, IDS и IPS. Пакеты, направленные в Интернет рабочими нагрузками, также должны пройти через защитные устройства сети периметра перед выходом из сети. Это удобно для применения политик, выполнения проверок и аудита.

Компоненты сети периметра предоставляют следующие возможности:

- [Виртуальные сети][VNet], [определяемые пользователем маршруты][user-defined-routes] и [группы безопасности сети][network-security-groups].
- [Сетевые виртуальные устройства][NVA]
- [Подсистема балансировщика нагрузки Azure][ALB]
- [Шлюз приложений Azure][AppGW] с [брандмауэром веб-приложения (WAF)][AppGWWAF]
- [Общедоступные IP-адреса][PIP].
- [Передняя дверца Azure][AFD] с [брандмауэром веб-приложения (WAF)][AFDWAF]
- [Брандмауэр Azure][AzFW]

Как правило, центральная ИТ-команда и команда по обеспечению безопасности отвечают за определение требований и операций в сетях периметра.

![7][7]

На предыдущей схеме показано применение двух периметров с доступом к Интернету и локальной сети, которые находятся в центре DMZ. В центре ДЕМИЛИТАРИЗОВАНной зоны сеть периметра может масштабироваться для поддержки большого количества больших объемов данных, используя несколько ферм брандмауэров веб-приложений (WAF) или брандмауэров Azure. В центре также обеспечивает возможность подключения через VPN или ExpressRoute по мере необходимости.

[**Виртуальные сети**][VNet]. Обычно концентратор создается в виртуальной сети с несколькими подсетями для размещения другого типа служб, выполняющих фильтрацию и анализ трафика в Интернет и обратно через NVA, WAF и экземпляры Шлюзов приложения Azure.

[**Определяемые пользователем маршруты**][user-defined-routes] Используя определяемые пользователем маршруты, клиенты могут развертывать брандмауэры, ИДЕНТИФИКАТОРы и IP-адреса и другие виртуальные устройства, а также маршрутизировать сетевой трафик через эти устройства безопасности для принудительного применения политик границ безопасности, аудита и проверки. Определяемые пользователем маршруты можно создавать как в концентраторе, так и на периферийных устройствах, чтобы обеспечить передачу трафика через определенные пользовательские виртуальные машины, сетевые виртуальные устройства и подсистемы балансировки нагрузки, используемые реализацией виртуальных центров обработки данных. Чтобы гарантировать, что трафик, созданный на виртуальных машинах, находящихся на периферийных серверах, перемещается в правильные виртуальные устройства, необходимо задать определяемый пользователем маршрут в подсетях периферийного сервера, установив интерфейсный IP-адрес внутренней подсистемы балансировки нагрузки в качестве следующий прыжок. Внутренняя подсистема балансировки нагрузки распределяет внутренний трафик на виртуальные устройства (внутренний пул подсистемы балансировки нагрузки).

[**Брандмауэр Azure**][AzFW] — это управляемая облачная служба безопасности сети, которая защищает ресурсы виртуальной сети Azure. Это высокодоступная служба с полным отслеживанием состояния и неограниченными возможностями облачного масштабирования. Вы можете централизованно создавать, применять и регистрировать политики приложений и сетевых подключений в подписках и виртуальных сетях. Брандмауэр Azure использует статический общедоступный IP-адрес для ресурсов виртуальной сети. Он разрешает внешним брандмауэрам идентифицировать трафик, поступающий из вашей виртуальной сети. Служба полностью интегрирована с Azure Monitor для ведения журналов и аналитики.

[**Сетевые виртуальные устройства**][NVA]. В концентраторе сеть периметра с доступом в Интернет обычно управляется с помощью экземпляра Брандмауэра Azure, фермы брандмауэров или брандмауэров веб-приложений (WAF).

Разные бизнес-приложения обычно используют многие веб-приложения, которые, как правило, являются уязвимыми. Брандмауэры веб-приложений — это особый тип продукта, используемый для обнаружения атак, направленных на веб-приложения (HTTP и HTTPS). Это отличает их от обычных брандмауэров. По сравнению с традиционными брандмауэрами WAF содержит набор специальных функций для защиты внутренних веб-серверов от угроз.

Как брандмауэр Azure, так и брандмауэр NVA используют общую панель администрирования с набором правил безопасности для защиты рабочих нагрузок, размещенных в периферийных зонах, а также управления доступом к локальным сетям. Брандмауэр Azure имеет встроенную масштабируемость, тогда как брандмауэры NVA можно масштабировать вручную за подсистемой балансировки нагрузки. Как правило, программное обеспечение фермы брандмауэра менее специализированное по сравнению с ПО WAF, но включает более широкую область для фильтрации и проверки любого типа трафика (входящего и исходящего). Если используется подход NVA, их можно найти и развернуть с рынка Azure.

Используйте один набор брандмауэров Azure (или NVA) для трафика, поступающего из Интернета, и другой набор – для трафика, создаваемого локальными системами. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также позволяет понять, какие правила соответствуют определенным входящим сетевым запросам.

Рекомендуется использовать один набор экземпляров Брандмауэров Azure или брандмауэров NVA для трафика в Интернете и другой — для трафика в локальной среде. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также помогает понять, какие правила соответствуют определенным входящим сетевым запросам.

[**Azure Load Balancer**][ALB] предлагает службу высокого уровня доступности 4 (TCP, UDP), которая может распределять входящий трафик между экземплярами службы, определенными в наборе балансировки нагрузки. Трафик, отправленный в подсистему балансировки нагрузки из интерфейсных конечных точек (конечных точек общедоступного IP-адреса или частных IP-адресов), можно распространять с помощью или без преобразования адресов в набор внутренних IP-адресов (например, виртуальные сетевые устройства или виртуальные машины).

Azure Load Balancer может проверять работоспособность различных экземпляров сервера, а когда экземпляр не отвечает на проверку, балансировщик нагрузки останавливает передачу трафика в неработоспособный экземпляр. В виртуальном центре обработки данных внешняя подсистема балансировки нагрузки развертывается в центре и периферийных зонах. В концентраторе балансировщик нагрузки используется для эффективной маршрутизации трафика к службам в периферийных зонах, а в самих периферийных зонах – для управления трафиком приложений.

[**Передняя дверца Azure**][AFD] (АФД) — это высокодоступная и масштабируемая платформа ускорения веб-приложений Майкрософт, Глобальная Load Balancer HTTP, защита приложений и сеть доставки содержимого. В более 100 расположениях на границе глобальной сети корпорации Майкрософт АФД позволяет создавать, использовать и масштабировать динамическое веб-приложение и статическое содержимое. Служба AFD предоставляет вашему приложению производительность конечного пользователя мирового класса, единую автоматизацию регионального/маркированного обслуживания, автоматизацию BCDR, унифицированную клиентскую/пользовательскую информацию, кэширование и полезные сведения об услугах. Платформа обеспечивает производительность, надежность и поддержку соглашения об уровне обслуживания, сертификаты соответствия и проверенные методы безопасности, разработанные, эксплуатируемые и поддерживаемые платформой Azure.

[**Шлюз приложений**][AppGW] Шлюз приложений Microsoft Azure — это выделенный виртуальный модуль, предоставляющий контроллер доставки приложений (ADC) в качестве службы, предлагающий различные возможности балансировки нагрузки уровня 7 для вашего приложения. Таким образом, вы можете оптимизировать производительность веб-фермы за счет выполнения операции завершения SSL-запросов, требующей интенсивного использования ЦП, на шлюзе приложений. Кроме того, пользователи получают другие возможности маршрутизации уровня 7, включая распределение входящего трафика методом циклического перебора, соответствие сеансу на основе файлов cookie, маршрутизацию на основе URL-путей и возможность размещения нескольких веб-сайтов за одним шлюзом приложений. Брандмауэр веб-приложений (WAF) также предоставляется как часть SKU WAF шлюза приложений. Этот SKU обеспечивает защиту веб-приложений от распространенных веб-уязвимостей и эксплойтов. Шлюз приложений можно настроить как шлюз с выходом в Интернет, внутренний шлюз или их сочетание.

[**Общедоступные IP-адреса**][PIP]. Некоторые функции Azure позволяют связывать конечные точки службы с общедоступным IP-адресом для получения доступа к ресурсам из Интернета. Эта конечная точка использует преобразование сетевых адресов (NAT) для маршрутизации трафика на внутренний адрес и порт в виртуальной сети Azure. Это основной путь передачи внешнего трафика в виртуальную сеть. Общедоступные IP-адреса можно настроить, чтобы определить, какой трафик следует пропускать в виртуальную сеть, а также как и где его следует пропускать.

[**Azure от атак DDoS Protection Standard**][DDoS] предоставляет дополнительные возможности по устранению рисков по сравнению с уровнем [служб "базовый][DDoS] ", которые настроены специально для ресурсов виртуальной сети Azure. Службу "Защита от атак DDoS" уровня "Стандартный" легко включить, и для ее использования не нужно изменять приложение. Политики защиты корректируются на основе мониторинга выделенного трафика и алгоритмов машинного обучения. Они применяются к общедоступным IP-адресам, связанным с ресурсами, развернутыми в виртуальных сетях, такими как Azure Load Balancer, Шлюз приложений Azure и экземпляры Azure Service Fabric. Данные телеметрии доступны в представлениях Azure Monitor в режиме реального времени во время атаки и после ее окончания. Можно также включить защиту на прикладном уровне с помощью брандмауэра веб-приложения в Шлюзе приложений Azure. Защита обеспечивается для общедоступных IP-адресов Azure IPv4.

#### <a name="component-type-monitoring"></a>Тип компонента: мониторинг

Компоненты мониторинга обеспечивают видимость и оповещения, получаемые от всех других типов компонентов. У всех групп должен быть доступ к мониторингу соответствующих компонентов и служб. Если у вас есть централизованная служба поддержки или операционные группы, им необходим интегрированный доступ к данным, которые обеспечивают эти компоненты.

Azure предлагает несколько типов служб ведения журналов и мониторинга для отслеживания поведения размещенных ресурсов Azure. Регулирование рабочих нагрузок и управление ими в Azure основано не только на сборе данных журнала, но также на возможности активировать действия на основе определенных сообщаемых событий.

[**Azure Monitor**][Monitor]. Azure предлагает несколько служб, которые по отдельности выполняют определенную роль или задачу в пространстве мониторинга. Вместе эти службы предоставляют комплексное решение для сбора, анализа и использования телеметрии из вашего приложения и ресурсов Azure, которые их поддерживают. Они также могут выполнять мониторинг критически важных локальных ресурсов и предоставлять гибридную среду мониторинга. Понимание имеющихся инструментов и данных является первым шагом в разработке комплексной стратегии мониторинга для вашего приложения.

Есть два основных типа журналов в Azure:

- [Журнал действий Azure][ActLog], ранее именуемый **операционными журналами**, предоставляет сведения об операциях, выполненных с ресурсами в подписке Azure. Эти журналы предоставляют отчет о событиях уровня управления в подписках. Журналы аудита ведутся для каждого ресурса Azure.

- [Azure Monitor журналы диагностики][DiagLog] создаются ресурсом, который предоставляет широкие и часто встречающиеся данные о работе этого ресурса. Содержимое этих журналов зависит от типа ресурса.

![9][9]

Важно отвести журналы для групп безопасности сети, в частности, эту информацию:

- [Журналы событий][nsg-log] содержат сведения о том, какие правила группы безопасности сети применяются к виртуальным машинам и ролям экземпляров на основе MAC-адреса.
- В [журналах счетчиков][nsg-log] показано, сколько раз было запущено каждое правило групп безопасности сети, чтобы запретить или разрешить трафик.

Все журналы можно хранить в учетных записях хранения Azure для аудита, статического анализа или резервного копирования. Если журналы хранятся в учетной записи хранения Azure, клиенты могут использовать разные типы платформ для извлечения, подготовки, анализа и визуализации этих данных для создания отчета о состоянии и работоспособности облачных ресурсов.

У крупных предприятий должна быть стандартная платформа для мониторинга локальных систем, которую они могут расширить для интеграции журналов, созданных облачными развертываниями. С помощью [Azure Log Analytics](https://docs.microsoft.com/azure/log-analytics/log-analytics-queries) организации могут хранить все журналы в облаке. Log Analytics реализуется как облачная служба. Поэтому подготовка к работе и запуск выполняются быстро и без значительных инвестиций в службы инфраструктуры. Log Analytics также интегрируется с компонентами System Center, такими как System Center Operations Manager, для расширения существующих инвестиций в управление в облако.

Log Analytics — это служба в Azure, которая помогает выполнять сбор, сопоставление, поиск и действия в отношении данных журналов и производительности, созданных операционными системами, приложениями и облачными компонентами инфраструктуры. Он предоставляет клиентам оперативную аналитику в режиме реального времени с помощью интегрированной службы поиска и настраиваемых панелей мониторинга для анализа всех записей во всех рабочих нагрузках в реализации виртуального центра обработки данных.

[Наблюдатель за сетями Azure][NetWatch] предоставляет средства для мониторинга, диагностики и просмотра метрик, а также включения и отключения журналов для ресурсов в виртуальной сети Azure. Это многоаспектная служба, обеспечивающая следующие возможности:

- мониторинг взаимодействия между виртуальной машиной и конечной точкой;
- просмотр ресурсов и их связей в виртуальной сети;
- диагностика проблем с фильтрацией входящего или исходящего трафика виртуальной машины;
- диагностика проблем с сетевой маршрутизацией на виртуальной машине;
- диагностика исходящих подключений виртуальной машины;
- сбор пакетов, направляющихся в виртуальную машину и из нее;
- диагностика проблем со шлюзом и подключениями виртуальной сети Azure;
- определение относительных задержек между регионами Azure и поставщиками услуг Интернета;
- просмотр правил безопасности для сетевого интерфейса;
- просмотр метрик сети;
- анализ трафика, направляющегося в группу безопасности сети или из нее;
- просмотр журналов диагностики для сетевых ресурсов.

Решение [Монитор производительности сети][NPM] в Operations Management Suite может обеспечить сквозную работу с подробными сведениями о сети. включая единое представление сетей Azure и локальных сетей. Это решение имеет отдельные функции мониторинга для ExpressRoute и общедоступных служб.

#### <a name="component-type-workloads"></a>Тип компонента: рабочие нагрузки

Именно здесь находятся ваши фактические приложения и службы. Группы разработчиков приложения также проводят здесь большую часть времени.

Возможности рабочих нагрузок на самом деле безграничны. Ниже приведены всего несколько возможных типов рабочих нагрузок.

**Внутренние бизнес-приложения:** Бизнес-приложения — это компьютерные приложения, критически важные для текущей работы предприятия. У них есть некоторые общие характеристики.

- **Интерактивное по природе:** Данные будут указаны, а результаты или отчеты возвращаются.
- **Управляемые данные:** Рабочие нагрузки с интенсивным использованием данных, которые часто обращаются к базам данных или другому хранилищу.
- **Интеграция:** Рабочие нагрузки, предлагающие интеграцию с другими системами внутри организации или за ее пределами.

**Клиентские веб-сайты (Интернет или внутренние)** . Большинство приложений, взаимодействующих с Интернетом, являются веб-сайтами. Azure предлагает возможность запуска веб-сайта на виртуальной машине IaaS или на сайте [веб-приложений Azure][WebApps] (PaaS). Веб-приложения Azure поддерживают интеграцию с виртуальными сетями, что позволяет развертывать веб-приложения в периферийной зоне сети. Внутренним веб-сайтам не требуется предоставлять общедоступную конечную точку Интернета, так как доступ к ресурсам осуществляется через частные адреса, отличные от адресов в Интернете, из частной виртуальной сети.

**Большие данные и аналитика:** Если для данных требуется увеличить масштаб до большого объема, возможно, базы данных не будут правильно масштабироваться. Технология Hadoop предлагает систему для параллельного запуска распределенных запросов в большом количестве узлов. У клиентов есть возможность выполнять рабочие нагрузки данных в виртуальных машинах IaaS или PaaS ([HDInsight][HDI]). HDInsight поддерживает развертывание в виртуальной сети на основе расположения. ее можно развернуть в кластере на периферийном уровне виртуального центра обработки данных.

**События и обмен сообщениями.** [концентраторы событий Azure][EventHubs] — это служба приема данных телеметрии с помощью линейной передачи, которая собирает, преобразует и хранит миллионы событий. Эта распределенная платформа для потоковой передачи данных с низкой задержкой и настраиваемым временем хранения позволяет принимать большие объемы данных телеметрии в Azure, а также считывать эти данные из нескольких приложений. С Центрами событий отдельный поток может поддерживать обработку конвейеров в режиме реального времени и на основе пакетов.

Вы можете реализовать высоконадежную облачную службу обмена сообщениями между приложениями и службами с помощью [служебной шины Azure][ServiceBus]. Это решение обеспечивает асинхронный обмен сообщениями через брокер между клиентом и сервером, обработку сообщений в порядке поступления, а также предлагает возможность публикации и подписки.

![10][10]

### <a name="making-a-virtual-datacenter-highly-available-multiple-virtual-datacenters"></a>Обеспечение высокой доступности виртуального центра обработки данных: несколько виртуальных центров обработки данных

До сих пор эта статья посвящена проектированию одного виртуального центра обработки данных, описывающего основные компоненты и архитектуру, которые способствуют устойчивости. Такие функции Azure, как балансировщик нагрузки Azure, NVA, группы доступности, масштабируемые наборы и другие механизмы, участвуют в системе, позволяющей создавать надежные уровни соглашения об уровне обслуживания в производственных службах.

Однако, поскольку один виртуальный центр обработки данных обычно реализуется в одном регионе, он может быть уязвим для любого крупного сбоя, влияющего на весь регион. Клиенты, которым требуются высокие соглашения об уровне обслуживания, должны защищать службы с помощью развертываний одного и того же проекта в двух (или нескольких) реализациях виртуальных центров обработки данных, размещенных в разных регионах.

В дополнение к вопросам соглашения об уровне обслуживания существует несколько распространенных сценариев, в которых имеет смысл развертывание нескольких реализаций виртуальных центров обработки данных:

- региональное или глобальное присутствие;
- аварийное восстановление.
- перенаправление трафика между центрами обработки данных

#### <a name="regionalglobal-presence"></a>Региональное и глобальное присутствие

Центры обработки данных Azure присутствуют в различных регионах по всему миру. При выборе нескольких центров обработки данных Azure клиенты должны учитывать два связанных фактора: географические расстояния и задержку. Чтобы обеспечить лучшее взаимодействие с пользователем, оцените географическое расстояние между реализацией виртуальных центров обработки данных, а также расстояние между реализацией виртуальных центров обработки данных и конечными пользователями.

Регион, в котором размещены реализации виртуальных центров обработки данных, должен соответствовать нормативным требованиям, установленным в любой юридической юрисдикции, в которой работает ваша организация.

#### <a name="disaster-recovery"></a>Аварийное восстановление

Проектирование плана аварийного восстановления зависит от типов рабочих нагрузок и способности синхронизировать состояние этих рабочих нагрузок между различными реализациями виртуальных центров обработки данных. В идеале большинству клиентов требуется быстрый механизм отработки отказа, и это может потребовать синхронизации данных приложений между развертываниями, на которых выполняется несколько реализаций виртуальных центров данных. Однако при разработке планов аварийного восстановления важно учитывать, что большинство приложений чувствительны к задержке, которая может быть вызвана этой синхронизацией данных.

Для мониторинга синхронизации и пульса приложений в различных реализациях виртуальных центров обработки данных необходимо, чтобы они могли взаимодействовать по сети. Две реализации в разных регионах могут быть соединены с помощью:

- Пиринг виртуальных сетей — пиринг виртуальной сети может соединять центры между регионами.
- Частный пиринг ExpressRoute, когда концентраторы в каждой реализации виртуального центра обработки данных подключены к одному каналу ExpressRoute.
- Несколько каналов ExpressRoute, подключенных с помощью корпоративной магистрали и нескольких реализаций виртуальных центров обработки данных, подключенных к каналам ExpressRoute.
- VPN-подключения типа "сеть — сеть" между зоной основных реализаций виртуальных центров обработки данных в каждом регионе Azure.

Обычно пиринг виртуальных сетей или подключения ExpressRoute – предпочтительные типы подключений из-за более высокой пропускной способности и последовательных уровней задержки при передаче через магистраль Майкрософт.

Рекомендуется, чтобы клиенты выполнили тестовую проверку сети, чтобы проверить задержку и пропускную способность подключений и на основе полученных данных решили, какая репликация данных более подходящая. Также важно взвесить эти результаты с точки зрения оптимальной цели времени восстановления (RTO).

#### <a name="disaster-recovery-diverting-traffic-from-one-region-to-another"></a>Аварийное восстановление: перенаправление трафика из одного региона в другой

[Диспетчер трафика Azure][traffic-manager] периодически проверяет работоспособность общедоступных конечных точек в различных реализациях виртуальных центров обработки данных и, в случае сбоя этих конечных точек, автоматически направляет их во вторичный виртуальный центр обработки данных, используя систему доменных имен ( DNS).

Поскольку он использует DNS, диспетчер трафика предназначен только для использования с общедоступными конечными точками Azure. Служба обычно используется для управления трафиком к виртуальным машинам Azure и веб-приложениям в работоспособном экземпляре реализации виртуального центра обработки данных. Диспетчер трафика является устойчивым даже в случае сбоя всего региона Azure и может контролировать распределение пользовательского трафика для конечных точек служб в разных виртуальных центрах обработки данных на основе нескольких критериев. Например, сбой службы в определенной реализации виртуального центра обработки данных или выбор реализации центра обработки данных с наименьшей задержкой сети.

### <a name="summary"></a>Резюме

Виртуальный центр обработки данных — это подход к переносу центра Datacenter для создания масштабируемой архитектуры в Azure, которая позволяет максимально эффективно использовать облачные ресурсы, сокращает затраты и упрощает управление системой. Виртуальный центр обработки данных основан на топологии концентратора и периферийной сети, предоставляя общие общие службы в концентраторе и позволяя выполнять определенные приложения и рабочие нагрузки на периферийных ресурсах. Виртуальный центр обработки данных также соответствует структуре ролей компании, где различные подразделения, такие как Центральная ИТ, DevOps, а также все операции и обслуживание работают вместе при выполнении конкретных ролей. Виртуальный центр обработки данных удовлетворяет требованиям к миграции "точности и смены", но также предоставляет множество преимуществ для развертывания собственных облаков.

## <a name="references"></a>Справочники

В этом руководстве были рассмотрены приведенные ниже функции и компоненты. Дополнительные сведения см. в следующих ссылках.

<!-- markdownlint-disable MD033 -->

|Сетевые функции|Балансировка нагрузки|Подключение|
|-|-|-|
|[Виртуальные сети Azure][VNet]</br>[Группы безопасности сети][network-security-groups]</br>[Журналы группы безопасности сети][nsg-log]</br>[Определяемые пользователем маршруты][user-defined-routes]</br>[Виртуальные сетевые модули][NVA]</br>[Общедоступные IP-адреса][PIP]</br>[Azure от атак DDoS][DDoS]</br>[Брандмауэр Azure][AzFW]</br>[Azure DNS][DNS]|[Передняя дверца Azure][AFD]</br>[Azure Load Balancer (L3)][ALB]</br>[Шлюз приложений (на уровне 7)][AppGW]</br>[Брандмауэр веб-приложения] WAF</br>[Azure Traffic Manager][traffic-manager]</br></br></br></br></br> |[Пиринг между виртуальными сетями][VNetPeering]</br>[Виртуальная частная сеть][VPN]</br>[Виртуальная глобальная сеть][vWAN]</br>[ExpressRoute][ExR]</br>[ExpressRoute Direct][ExRD]</br></br></br></br></br>

|Удостоверение</br>|Мониторинг</br>|Рекомендации</br>|
|-|-|-|
|[Azure Active Directory][azure-ad]</br>[Многофакторная идентификация][multi-factor-authentication]</br>[Базовые элементы управления доступом к роли][RBAC]</br>[Роли Azure AD по умолчанию][Roles]</br></br></br> |[Наблюдатель за сетями][NetWatch]</br>[Azure Monitor][Monitor]</br>[Журналы действий][ActLog]</br>[Журналы диагностики][DiagLog]</br>[Microsoft Operations Management Suite][OMS]</br>[Монитор производительности сети][NPM]|[Рекомендации для сетей периметра][DMZ]</br>[Управление подписками][SubMgmt]</br>[Управление группой ресурсов][RGMgmt]</br>[Ограничения подписки Azure][limits] </br></br></br>|

|Прочие службы Azure|
|-|
|[Веб-приложения Azure][WebApps]</br>[HDInsight (Hadoop)][HDI]</br>[Центры событий][EventHubs]</br>[Служебная шина][ServiceBus]|

<!-- markdownlint-enable MD033 -->

## <a name="next-steps"></a>Следующие шаги

- Изучите [пиринг виртуальных сетей][VNetPeering], технологию лежащая для виртуального центра обработки данных и периферийных дизайнов.
- Реализуйте [Azure AD][azure-ad] , чтобы приступить к исследованию [RBAC][RBAC] .
- Разработайте модель управления ресурсами и подпиской, а также модель RBAC для обеспечения необходимой структуры, требований и политик организации. Планирование является самым важным действием: Запланируйте реорганизации, слияния, новые линейки продуктов и другие вопросы, насколько это целесообразно.

<!-- images -->

[0]: ../_images/vdc/networking-redundant-equipment.png "Примеры перекрытия компонента"
[1]: ../_images/vdc/networking-vdc-high-level.png "Высокоуровневый пример использования концентратора и звезды в реализации виртуального центра обработки данных"
[2]: ../_images/vdc/networking-hub-spokes-cluster.png "Кластер концентраторов и периферийных зон"
[3]: ../_images/vdc/networking-spoke-to-spoke.png "Связь между периферийными зонами"
[4]: ../_images/vdc/networking-vdc-block-level-diagram.png "Схема уровня блока для реализации виртуального центра обработки данных"
[5]: ../_images/vdc/networking-users-groups-subscriptions.png "Пользователи, группы, подписки и проекты"
[6]: ../_images/vdc/networking-infrastructure-high-level.png "Высокоуровневая схема инфраструктуры"
[7]: ../_images/vdc/networking-high-level-perimeter-networks.png "Высокоуровневая схема инфраструктуры"
[8]: ../_images/vdc/networking-vnet-peering-perimeter-networks.png "Пиринг виртуальных сетей и сети периметра"
[9]: ../_images/vdc/networking-high-level-diagram-monitoring.png "Общая схема для мониторинга"
[10]: ../_images/vdc/networking-high-level-workloads.png "Схема высокого уровня для рабочих нагрузок"

<!-- links -->

[limits]: https://docs.microsoft.com/azure/azure-subscription-service-limits
[Roles]: https://docs.microsoft.com/azure/role-based-access-control/built-in-roles
[VNet]: https://docs.microsoft.com/azure/virtual-network/virtual-networks-overview
[network-security-groups]: https://docs.microsoft.com/azure/virtual-network/virtual-networks-nsg
[DNS]: https://docs.microsoft.com/azure/dns/dns-overview
[PrivateDNS]: https://docs.microsoft.com/azure/dns/private-dns-overview
[VNetPeering]: https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview
[user-defined-routes]: https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview
[RBAC]: https://docs.microsoft.com/azure/role-based-access-control/overview
[multi-factor-authentication]: https://docs.microsoft.com/azure/multi-factor-authentication/multi-factor-authentication
[azure-ad]: https://docs.microsoft.com/azure/active-directory/active-directory-whatis
[VPN]: https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways
[ExR]: https://docs.microsoft.com/azure/expressroute/expressroute-introduction
[ExRD]: https://docs.microsoft.com/azure/expressroute/expressroute-erdirect-about
[vWAN]: https://docs.microsoft.com/azure/virtual-wan/virtual-wan-about
[NVA]: https://docs.microsoft.com/azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: https://docs.microsoft.com/azure/firewall/overview
[SubMgmt]: /azure/architecture/cloud-adoption/appendix/azure-scaffold
[RGMgmt]: https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview
[DMZ]: https://docs.microsoft.com/azure/best-practices-network-security
[ALB]: https://docs.microsoft.com/azure/load-balancer/load-balancer-overview
[DDoS]: https://docs.microsoft.com/azure/virtual-network/ddos-protection-overview
[PIP]: https://docs.microsoft.com/azure/virtual-network/virtual-network-public-ip-address
[AFD]: https://docs.microsoft.com/azure/frontdoor/front-door-overview
[AFDWAF]: https://docs.microsoft.com/azure/frontdoor/waf-overview
[AppGW]: https://docs.microsoft.com/azure/application-gateway/application-gateway-introduction
[AppGWWAF]: https://docs.microsoft.com/azure/application-gateway/application-gateway-web-application-firewall-overview
[Monitor]: https://docs.microsoft.com/azure/monitoring-and-diagnostics/
[ActLog]: https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-activity-logs
[DiagLog]: https://docs.microsoft.com/azure/monitoring-and-diagnostics/monitoring-overview-of-diagnostic-logs
[nsg-log]: https://docs.microsoft.com/azure/virtual-network/virtual-network-nsg-manage-log
[OMS]: https://docs.microsoft.com/azure/operations-management-suite/operations-management-suite-overview
[NPM]: https://docs.microsoft.com/azure/log-analytics/log-analytics-network-performance-monitor
[NetWatch]: https://docs.microsoft.com/azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: https://docs.microsoft.com/azure/app-service/
[HDI]: https://docs.microsoft.com/azure/hdinsight/hdinsight-hadoop-introduction
[EventHubs]: https://docs.microsoft.com/azure/event-hubs/event-hubs-what-is-event-hubs
[ServiceBus]: https://docs.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview
[traffic-manager]: https://docs.microsoft.com/azure/traffic-manager/traffic-manager-overview
