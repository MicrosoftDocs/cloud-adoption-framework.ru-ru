---
title: 'Виртуальный центр обработки данных: перспектива сети'
description: Используйте платформу внедрения облаков для Azure, чтобы узнать, как с помощью Azure легко расширить инфраструктуру в облаке и создать многоуровневые архитектуры.
author: tracsman
ms.author: jonor
ms.date: 02/25/2020
ms.topic: conceptual
ms.service: cloud-adoption-framework
ms.subservice: reference
manager: rossort
ms.custom: virtual-network
ms.openlocfilehash: 0a605d987715aee0b12c846472a6fddd1060087c
ms.sourcegitcommit: 12fa4597633ca8e04efbae7d0bd7526d3581618e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/20/2020
ms.locfileid: "88662478"
---
<!-- docsTest:disable TODO -->
<!-- cSpell:ignore tracsman jonor rossort NVAs iptables WAFs DDOS ITSM LLAP anycast vwan -->

# <a name="the-virtual-datacenter-a-network-perspective"></a>Виртуальный центр обработки данных: перспектива сети

Приложения, перенесенные из локальной среды, будут использовать преимущества безопасной инфраструктуры Azure, даже при минимальных изменениях приложения. Даже поэтому предприятиям следует адаптировать свои архитектуры для повышения гибкости и использования возможностей Azure.

Microsoft Azure предоставляет службы и инфраструктуру масштабирования с возможностями и надежностью корпоративного класса. Эти службы и инфраструктура предлагают множество вариантов гибридного подключения, поэтому клиенты могут получить доступ к ним через Интернет или через частную сеть. Партнеры корпорации Майкрософт также могут предоставлять расширенные возможности, предлагая службы безопасности и виртуальные устройства, оптимизированные для работы в Azure.

Клиенты могут использовать Azure, чтобы легко расширить инфраструктуру в облаке и создать многоуровневые архитектуры.

## <a name="what-is-a-virtual-datacenter"></a>Что такое виртуальный центр обработки данных?

Облако приступило как платформа для размещения общедоступных приложений. Предприятия распознают ценность облака и начали переводить внутренние бизнес-приложения. Эти приложения обеспечивали дополнительные требования к безопасности, надежности, производительности и затратам, которые требовали дополнительной гибкости при доставке облачных служб. Новая инфраструктура и сетевые службы были разработаны для обеспечения этой гибкости и новых функций, предоставляемых для эластичного масштабирования, аварийного восстановления и других соображений.

Облачные решения изначально разрабатывались для размещения отдельных, относительно изолированных приложений в общедоступном спектре. Этот подход был оптимальным несколько лет. По мере того, как облачные решения стали понятны, в облаке размещается несколько крупномасштабных рабочих нагрузок. Решение проблем с безопасностью, надежностью, производительностью и затратами на развертывание в одном или нескольких регионах стало жизненно важным в течение жизненного цикла облачной службы.

В приведенном ниже образце схемы развертывания в облаке красный прямоугольник выделяет разрыв безопасности. Желтое поле показывает возможность оптимизации сетевых виртуальных модулей между рабочими нагрузками.

![0][0]

Виртуальные центры обработки данных помогают достичь необходимого масштаба для корпоративных рабочих нагрузок. Эта шкала должна решать проблемы, появившиеся при выполнении крупномасштабных приложений в общедоступном облаке.

Реализация виртуального центра обработки данных (постоянного тока) включает больше рабочих нагрузок приложений в облаке. Она также обеспечивает сеть, безопасность, управление и другую инфраструктуру, например DNS и службы Active Directory. При переносе дополнительных рабочих нагрузок в Azure предприятия Рассмотрите инфраструктуру и объекты, поддерживающие эти рабочие нагрузки. Тщательное структурирование ресурсов помогает избежать распространения сотен отдельных несамостоятельных управляемых «островов рабочей нагрузки» с независимыми потоками данных, моделями безопасности и проблемами соответствия.

Концепция виртуального центра обработки данных предоставляет рекомендации и высокоуровневые проекты для реализации коллекции отдельных, но связанных сущностей. Эти сущности часто имеют общие вспомогательные функции, функции и инфраструктуру. Просмотр рабочих нагрузок в качестве виртуального центра обработки данных помогает снизить затраты на экономию масштабируемости, оптимизированную безопасность через компонент и централизованную работу потока данных, а также упрощает аудит операций, управления и соответствия требованиям.

> [!NOTE]
> Виртуальный центр обработки данных **не** является определенной службой Azure. Вместо этого различные функции и возможности Azure объединяются в соответствии с вашими требованиями. Виртуальный центр обработки данных — это способ подумать о рабочих нагрузках и использовании Azure для оптимизации ресурсов и возможностей в облаке. Она предоставляет модульный подход для предоставления ИТ-услуг в Azure с учетом организационных ролей и обязанностей Организации.

Виртуальный центр обработки данных помогает предприятиям развертывать рабочие нагрузки и приложения в Azure в следующих сценариях:

- размещение нескольких связанных рабочих нагрузок;
- перенос рабочих нагрузок из локальной среды в Azure;
- обеспечение общей или централизованной защиты и доступности рабочих нагрузок;
- Смешивание DevOps и централизованное ИТ-подходящее для крупных предприятий.

## <a name="who-should-implement-a-virtual-datacenter"></a>Кто отвечает за реализацию ВЦОД?

Любой клиент, который решил внедрить Azure, может воспользоваться преимуществами настройки набора ресурсов для общего использования всеми приложениями. В зависимости от размера даже отдельные приложения могут воспользоваться преимуществами шаблонов и компонентов, используемых для создания реализации в постоянного тока.

Некоторые организации имеют централизованные группы или отделы для ИТ, сети, безопасности или соответствия требованиям. Реализация постоянного тока может помочь в применении точек политики, отдельных обязанностей и обеспечении согласованности базовых общих компонентов. Группы приложений могут хранить свободу и возможности управления, которые подходят для своих требований.

Организации с DevOps подходом также могут использовать основные понятия постоянного тока для предоставления законных карманных устройств ресурсов Azure. Этот метод может гарантировать, что группы DevOps имеют полный контроль над группой, на уровне подписки или в группах ресурсов в общей подписке. В то же время границы сети и безопасности остаются соответствующими требованиям, определенным централизованной политикой в сети концентратора и централизованно управляемой группой ресурсов.

## <a name="considerations-for-implementing-a-virtual-datacenter"></a>Рекомендации по реализации виртуального центра обработки данных

При проектировании виртуального центра обработки данных учитывайте следующие сводные проблемы:

### <a name="identity-and-directory-service"></a>Служба удостоверений и каталогов

Службы удостоверений и каталогов являются ключевыми возможностями локальных и облачных центров обработки данных. Удостоверение охватывает все аспекты доступа и авторизации к службам в рамках реализации в постоянного тока. Чтобы обеспечить доступ к ресурсам Azure только полномочным пользователям и процессам, Azure использует несколько типов учетных данных для проверки подлинности, включая пароли учетных записей, криптографические ключи, цифровые подписи и сертификаты. [Многофакторная идентификация Azure][multi-factor-authentication] обеспечивает дополнительный уровень безопасности для доступа к службам Azure, используя строгую проверку подлинности с помощью ряда простых вариантов проверки (телефонный звонок, текстовое сообщение или уведомление мобильного приложения), которые позволяют пользователям выбрать предпочтительный метод.

Любой крупной организации необходимо определить процесс управления удостоверениями, который описывает управление индивидуальными удостоверениями, их проверку подлинности, авторизацию, роли и привилегии в сети или в пределах их постоянного тока. Цель этого процесса — повысить безопасность и производительность, одновременно уменьшая затраты, время простоя и повторяющиеся ручные задачи.

Корпоративные организации могут потребовать использования ресурсоемких служб для различных отраслей, а сотрудники часто имеют различные роли при работе с различными проектами. ВЦОД требует слаженного взаимодействия между разными командами, для каждой из которых предусмотрены конкретные определения ролей. Все это позволяет надлежащим образом управлять рабочими системами. Процесс назначения обязанностей, разрешений и прав может быть очень непростым. Управление удостоверениями в постоянного тока реализуется с помощью [Azure Active Directory (Azure AD)][azure-ad] и управления доступом на основе РОЛЕЙ (RBAC).

Служба каталогов — это общая информационная инфраструктура для поиска, администрирования и организации ежедневно используемых элементов и сетевых ресурсов. Эти ресурсы могут включать тома, папки, файлы, принтеры, пользователей, группы, устройства и другие объекты. Каждый ресурс в сети считается объектом сервера каталогов. Сведения о ресурсе хранятся в виде коллекции атрибутов, связанных с этим ресурсом или объектом.

Все бизнес-службы Microsoft Online используют Azure Active Directory (Azure AD) для входа и других требований к удостоверениям. Azure Active Directory (Azure AD) — это комплексное высокодоступное облачное решение для управления удостоверениями и доступом, предоставляющее базовые службы каталогов, расширенные функции управления удостоверениями и функции управления доступом к приложениям. Azure AD можно интегрировать с локальным экземпляром Active Directory для включения единого входа для всех облачных и локальных приложений. Атрибуты пользователя локальной службы Active Directory могут автоматически синхронизироваться с Azure AD.

Для назначения всех разрешений в ВЦОД не требуется отдельный глобальный администратор. Вместо этого получить разрешения, необходимые для управления собственными ресурсами в виртуальном центре обработки данных, может каждый отдел (группа пользователей или служб в службе каталогов). Структурирование разрешений требует балансировки. Большое количество разрешений может препятствовать оптимальной производительности, а недостаточное или отсутствие некоторых — может повысить риски для системы безопасности. Управление доступом на основе ролей (RBAC) в Azure помогает решить эту проблему, предлагая детальное управление доступом для ресурсов в реализации в постоянного тока.

### <a name="security-infrastructure"></a>инфраструктуру безопасности;

Инфраструктура безопасности относится к разделению трафика в конкретном сегменте виртуальной сети реализации виртуального центра обработки данных. Эта инфраструктура определяет, как входящие и исходящие данные управляются в реализации в постоянного тока. Azure основана на архитектуре с несколькими клиентами, которая предотвращает несанкционированный и непреднамеренной трафик между развертываниями с помощью изоляции виртуальной сети, списков управления доступом, подсистем балансировки нагрузки, IP-фильтров и политик потоков трафика. Преобразование сетевых адресов (NAT) отделяет внутренний и внешний сетевой трафик.

Структура Azure выделяет ресурсы инфраструктуры для рабочих нагрузок клиента и управляет исходящим и входящим обменом данными виртуальных машин. Низкоуровневая оболочка Azure принудительно разделяет память и процессы между виртуальными машинами и обеспечивает безопасную передачу сетевого трафика клиентам гостевой ОС.

### <a name="connectivity-to-the-cloud"></a>подключения к облаку;

Виртуальный центр обработки данных требует подключения к внешним сетям для предоставления служб клиентам, партнерам или внутренним пользователям. Эта потребность в возможности подключения касается не только Интернета, но также локальных сетей и центров обработки данных.

Клиенты контролируют, к каким службам разрешен доступ и к которым можно получить доступ из общедоступного Интернета. Этот доступ контролируется с помощью [брандмауэра Azure][AzFW] или других типов устройств виртуальной сети (NVA), настраиваемых политик маршрутизации с помощью [определяемых пользователем маршрутов][UDR]и фильтрации сети с помощью [групп безопасности сети][NSG]. Рекомендуется, чтобы все связанные с Интернетом ресурсы были дополнительно защищены с помощью [Защиты от атак DDoS уровня "Стандартный"][DDoS].

Предприятиям может потребоваться подключить виртуальный центр обработки данных к локальным центрам обработки данных или другим ресурсам. Эта возможность подключения между Azure и локальными сетями – важный аспект при проектировании эффективной архитектуры. У предприятий есть два разных способа создать это подключение: транзит через Интернет или через частные прямые подключения.

[VPN-подключение типа "сеть — сеть" Azure][VPN] подключает локальные сети к виртуальному центру обработки данных в Azure. Связь устанавливается через безопасные зашифрованные соединения (туннели IPsec). VPN-подключения типа "сеть — сеть" Azure являются гибкими, быстрыми в создании и обычно не нуждаются в дополнительных закупок оборудования. На основе стандартных отраслевых протоколов большинство текущих сетевых устройств могут создавать VPN-подключения к Azure через Интернет или существующие пути подключения.

[ExpressRoute][ExR] обеспечивает частные подключения между виртуальным центром обработки данных и локальными сетями. Подключения ExpressRoute не проходят через общедоступный Интернет и обеспечивают повышенную безопасность, надежность и высокую скорость (до 100 Гбит/с) и постоянную задержку. ExpressRoute предоставляет преимущества правил соответствия, связанных с частными подключениями. С помощью [ExpressRoute Direct][ExRD]можно подключаться непосредственно к маршрутизаторам Майкрософт с 10 Гбит/с или 100 Гбит/с.

Развертывание подключений ExpressRoute обычно включает в себя поставщик служб ExpressRoute (это исключение ExpressRoute). Для клиентов, которым необходимо быстро запуститься, обычно используется VPN-подключение типа "сеть — сеть" для установления подключения между виртуальным центром обработки данных и локальными ресурсами. После завершения физического подключения к поставщику услуг перенесите подключение через подключение ExpressRoute.

Для большого числа подключений VPN или ExpressRoute [Виртуальная глобальная сеть Azure][virtual-wan] — это сетевая служба, которая обеспечивает оптимизированное и автоматизированное подключение ветвей между ветвями через Azure. Виртуальная глобальная сеть позволяет подключаться и настраивать устройства филиалов для взаимодействия с Azure. Подключение и настройка можно выполнять либо вручную, либо с помощью предпочтительных устройств поставщика с помощью виртуального глобального партнера. Использование нужных устройств провайдеров позволяет облегчить использование, подключение и управление конфигурацией. Встроенная панель мониторинга Azure WAN обеспечивает мгновенную диагностику, которая помогает сэкономить время и позволяет легко просматривать крупномасштабное подключение типа "сеть — сеть". Виртуальная сеть WAN также предоставляет службы безопасности с дополнительным брандмауэром Azure и диспетчером брандмауэра в виртуальном концентраторе глобальной сети.

### <a name="connectivity-within-the-cloud"></a>подключения в облаке.

[Виртуальные сети Azure][virtual-network] и [пиринг виртуальных сетей][virtual-network-peering] — это основные сетевые компоненты в виртуальном центре обработки данных. Виртуальная сеть гарантирует изоляцию для ресурсов виртуального центра обработки данных. Пиринг обеспечивает взаимодействие между разными виртуальными сетями в одном регионе Azure, между регионами и даже между сетями в разных подписках. Как внутри, так и между виртуальными сетями потоки трафика могут управляться наборами правил безопасности, заданных для [групп безопасности сети][NSG], политик брандмауэра ([брандмауэра Azure][AzFW] или [сетевых виртуальных устройств][NVA]) и настраиваемых пользовательских [маршрутов][UDR].

Виртуальные сети также являются точками привязки для интеграции таких продуктов Azure, как служба [хранилища Azure][Storage], [SQL Azure][SQL]и других интегрированных общедоступных служб, имеющих общедоступные конечные точки. С [конечными точками службы][ServiceEndpoints] и [частной связью Azure][PrivateLink]вы можете интегрировать общедоступные службы с частной сетью. Вы даже можете использовать общедоступные службы в частном порядке, но все же сможете воспользоваться преимуществами служб PaaS, управляемых Azure.

## <a name="virtual-datacenter-overview"></a>Общие сведения о ВЦОД

### <a name="topologies"></a>Топологии

Виртуальный центр обработки данных можно создать с помощью одной из этих высокоуровневой топологии в зависимости от потребностей и требований к масштабированию.

В _плоской топологии_все ресурсы развертываются в одной виртуальной сети. Подсети допускают управление потоком и разделение.

![11][11]

В _топологии сетки_пиринг виртуальных сетей соединяет все виртуальные сети напрямую друг с другом.

![12][12]

_Топология ступицы и звезды_ хорошо подходит для распределенных приложений и команд с делегированными обязанностями.

![13][13]

_Топология виртуальной глобальной сети Azure_ может поддерживать крупномасштабные сценарии филиалов и глобальные службы WAN.

![14][14]

Топология концентратора пиринга и звезды и топология виртуальной сети Azure используют центрально-лучевой проект, оптимальный для связи, общих ресурсов и централизованной политики безопасности. Концентраторы создаются с помощью концентратора пиринга виртуальной сети (помеченного как `Hub Virtual Network` схема) или виртуального концентратора глобальной сети (помеченного как `Azure Virtual WAN` на схеме). Виртуальная глобальная сеть Azure предназначена для крупномасштабного обмена данными между ветвями и филиалами, а также для предотвращения сложностей, связанных с созданием всех компонентов по отдельности в центре пиринга виртуальной сети. В некоторых случаях ваши требования могут затребовать структуру узлов пиринга виртуальной сети, например потребность в сетевых виртуальных модулях в концентраторе.

В обеих топологиях ступицы концентратор является центральной зоной сети, которая управляет и проверяет весь трафик между разными зонами: Интернет, локальная сеть и периферийные серверы. Топология "звезда" помогает ИТ-отделу централизованно применять политики безопасности. одновременно минимизируя уязвимости и ошибки в конфигурации.

Концентратор часто содержит общие компоненты службы, используемые периферийными серверами. Их примеры представлены ниже.

- Инфраструктура Windows Active Directory для проверки подлинности внешних пользователей, которые пытаются получить доступ из ненадежных сетей, до предоставления таким пользователям доступа к рабочим нагрузкам в периферийных зонах. Сюда входят связанные службы федерации Active Directory (AD FS).
- Служба распределенных имен (DNS) для разрешения именования рабочей нагрузки на периферийных ресурсах для доступа к ресурсам в локальной среде и в Интернете, если [Azure DNS][DNS] не используется.
- Инфраструктура открытых ключей (PKI) для реализации единого входа в рабочие нагрузки.
- Управление TCP- и UDP-трафиком между зонами периферийными зонами и Интернетом.
- Управление потоком между периферийными зонами и локальными ресурсами.
- Управление потоком между несколькими периферийными зонами (при необходимости).

Виртуальный центр обработки данных сокращает общую стоимость, используя общую инфраструктуру концентратора между несколькими периферийными серверами.

Роль каждой периферийной зоны может заключаться в размещении различных типов рабочих нагрузок. Использование периферийных зон также позволяют реализовать модульный подход для повторяемых развертываний одних и тех же рабочих нагрузок Примеры: Разработка и тестирование, приемочное тестирование пользователей, предварительная Продукция и Рабочая среда. Также эти зоны можно использовать для разделения и включения различных групп в пределах организации, Например, DevOps группы. В пределах периферийной зоны можно развернуть базовую рабочую нагрузку или сложные многоуровневые рабочие нагрузки с управлением трафиком между уровнями.

### <a name="subscription-limits-and-multiple-hubs"></a>Ограничения подписки и несколько центральных зон

> [!IMPORTANT]
> В зависимости от размера ваших развертываний Azure может потребоваться стратегия с несколькими центрами. При проектировании основной и резервной стратегии спросите «может ли этот масштаб проектирования использовать другую виртуальную сеть в этом регионе?», также «может ли этот масштаб проекта поддерживать несколько регионов?». Гораздо лучше спланировать проект, который масштабируется и не нуждается в нем, а не для планирования и необходимости.
>
> При масштабировании на дополнительный (или более) центр будет зависеть от множества факторов, которые обычно основываются на встроенных ограничениях масштабирования. При проектировании для масштабирования обязательно ознакомьтесь с [ограничениями][limits] подписки, виртуальной сети и виртуальной машины.

В Azure каждый компонент (независимо от типа) развертывается в подписке Azure. Изоляция компонентов Azure в разных подписках Azure позволяет выполнять требования различных бизнес-приложений, например настройку дифференцированных уровней доступа и авторизации.

Одна реализация постоянного тока может масштабироваться до большого количества периферийных серверов, хотя, как и в случае с каждой ИТ-системой, существуют ограничения платформы. Развертывание концентратора привязано к определенной подписке Azure с ограничениями и ограничениями (например, с максимальным числом пиринга виртуальных сетей). Дополнительные сведения см. в статье [Подписка Azure, ограничения службы, квоты и ограничения][limits]. В случаях, когда ограничения становятся проблемой, архитектуру можно далее масштабировать, расширяя отдельную звездообразную модель до кластера. Несколько концентраторов в одном или нескольких регионах Azure можно подключить с помощью пиринга виртуальных сетей, ExpressRoute, виртуальной глобальной сети или VPN типа "сеть — сеть".

![2][2]

Включение нескольких концентраторов приводит к увеличению затрат и действий по управлению системой. Она выравниваются только из-за масштабируемости, системных ограничений, избыточности, региональной репликации для производительности конечных пользователей или аварийного восстановления. В сценариях, требующих несколько концентраторов, все концентраторы должны обеспечивать один набор служб для упрощения выполнения операций.

### <a name="interconnection-between-spokes"></a>Взаимодействие между периферийными зонами

Внутри одной периферийной или плоской структуры сети можно реализовать сложные многоуровневые рабочие нагрузки. Многоуровневые конфигурации можно реализовать с помощью подсетей, по одной для каждого уровня или приложения в одной виртуальной сети. Управление трафиком и фильтрация выполняется с помощью групп безопасности сети и определяемых пользователем маршрутов.

Архитектор может развернуть многоуровневую рабочую нагрузку в пределах нескольких виртуальных сетей. Используя пиринг между виртуальными сетями, периферийные зоны могут подключаться к другим периферийным зонам в пределах одного или нескольких концентраторов. Типичным примером такого сценария является случай, когда серверы обработки приложения располагаются в одной периферийной зоне или виртуальной сети, а база данных развернута в другой периферийной зоне или виртуальной сети. В этом случае можно легко соединить периферийные серверы с помощью пиринга виртуальных сетей и, сделав это, избежать пересылки через центр. Тщательное изучение архитектуры и безопасности должно быть сделано, чтобы обход концентратора не обходит важные точки безопасности или аудита, которые могут существовать только в концентраторе.

![3][3]

Периферийные зоны могут также взаимодействовать с периферийной зоной, выполняющей функции концентратора. Такой подход создает двухуровневую иерархию: периферийная зона высокого уровня (уровень 0) становится концентратором подчиненных периферийных зон (уровень 1) иерархии. Периферийные точки реализации в постоянного тока необходимы для пересылки трафика в Центральный концентратор, чтобы трафик мог пересылаться в место назначения в локальной сети или в общедоступном Интернете. Архитектура с двумя уровнями концентраторов представляет сложную маршрутизацию, которая устраняет преимущества простой связи Hub-лучевой.

Несмотря на то что Azure допускает сложные топологии, одним из основных принципов концепции VDC является повторяемость и простота. Чтобы свести к минимуму действия по управлению системой, в качестве эталонной архитектуры ВЦОД рекомендуется использовать простую топологию тира "звезда".

### <a name="components"></a>Components

Виртуальный центр обработки данных состоит из четырех основных типов компонентов: **инфраструктуры**, **сетей периметра**, **рабочих нагрузок**и **мониторинга**.

Каждый тип компонента состоит из различных функций и ресурсов Azure. Ваш виртуальный центр обработки данных состоит из экземпляров нескольких типов компонентов и нескольких вариантов одного типа компонента. Например, у вас может быть множество различных логически разделенных экземпляров рабочей нагрузки, представляющих разные приложения. В конечном итоге все эти различные экземпляры и типы компонентов используются для создания VDC.

![4][4]

На схеме высокоуровневой архитектуры виртуального центра обработки данных выше показаны разные типы компонентов, которые используются в различных зонах звездообразной топологии. На схеме показаны компоненты инфраструктуры в различных частях архитектуры.

В общем рекомендуется, чтобы права доступа и привилегии предоставлялись на основе группы. Работа с группами, а не отдельными пользователями, упрощает обслуживание политик доступа, предоставляя единообразный способ управления ИТ в группах и помогает свести к минимуму ошибки конфигурации. Назначение и удаление пользователей в соответствующих группах и из них помогает обеспечить актуальность привилегий конкретного пользователя.

Каждая группа роли должна содержать уникальный префикс в своем имени, позволяя легко определять связь между определенной группой и определенной рабочей нагрузкой. Например, рабочая нагрузка, размещающая службы проверки подлинности, должна содержать группы с именами **AuthServiceNetOps**, **AuthServiceSecOps**, **AuthServiceDevOps** и **AuthServiceInfraOps**. Для централизованных ролей или ролей, не связанных с определенной службой, может быть предваряется **Corp**. Например, **корпнетопс**.

Многие организации используют разновидность следующих групп для предоставления основной декомпозиции ролей:

- Центральная ИТ группа, **Corp,** имеет права собственности на управление компонентами инфраструктуры. Примерами являются сетевые компоненты и система безопасности. Группе должна быть назначена роль участника в подписке, а также предоставлены права управления концентратором и права участника сети в периферийных зонах. Крупные организации часто разделяют эти функции между несколькими командами. Примеры — команда, отвечающая за сетевые операции (**CorpNetOps**), которая фокусируется на сетевых компонентах, а также команда, отвечающая за операции системы безопасности (**CorpSecOps**), которая фокусируется на политиках безопасности и брандмауэра. В этом конкретном случае требуется создание двух разных групп для назначения этих пользовательских ролей.
- Группа разработки и тестирования, **аппдевопс,** отвечает за развертывание рабочих нагрузок приложений или служб. Эта группа принимает роль участника виртуальной машины для развертываний IaaS или одну или несколько ролей участника PaaS. Дополнительные сведения см. в статье [Встроенные роли для ресурсов Azure][Roles]. Кроме того, группе разработки и тестирования может потребоваться видимость политик безопасности (групп безопасности сети) и политик маршрутизации (определяемых пользователем маршрутов) в центре или определенном периферийном сервере. Кроме ролей участника для рабочих нагрузок этой группе также потребуется роль читателя сетей.
- Группа операций и обслуживания (**CorpInfraOps** или **AppInfraOps**) отвечает за управление рабочими нагрузками в рабочей среде. Эта группа должна быть участником подписки для рабочих нагрузок в любой рабочей подписке. Некоторые организации могут также определить необходимость в дополнительной эскалации группы службы поддержки с помощью роли участника подписки в рабочей среде и подписке центрального концентратора. Это позволит им решить потенциальные проблемы с конфигурацией в рабочей среде.

Блок постоянного тока спроектирован таким образом, чтобы группы, созданные для Центральной ИТ-группы, управляли концентратором, имели соответствующие группы на уровне рабочей нагрузки. В дополнение к управлению только ресурсами концентратора Центральная ИТ-группа может управлять внешним доступом и разрешениями верхнего уровня в подписке. Группы рабочей нагрузки также могут управлять ресурсами и разрешениями своей виртуальной сети независимо от центральной ИТ – группы.

Виртуальный центр обработки данных разбивается на разделы для безопасного размещения нескольких проектов в разных строках бизнеса. Для всех проектов требуются разные изолированные среды (dev, UAT и Production). Отдельные подписки Azure для каждой из этих сред могут обеспечить естественную изоляцию.

![5][5]

На предыдущей схеме показана связь между проектами организации, пользователями, группами и средами, в которых развернуты компоненты Azure.

Обычно в сфере ИТ среда (или уровень) представляет систему, в которой развертываются и выполняются несколько приложений. Крупные предприятия используют среду разработки (где изменения вносятся и тестируются) и рабочую среду (используемую конечными пользователями). Эти среды отделены, часто с помощью нескольких промежуточных сред, что позволяет выполнять поэтапное развертывание, тестирование и откат в случае возникновения проблем. Архитектуры развертывания сильно различаются, но обычно соблюдается основной процесс начала развертывания (разработка) и окончания развертывания (рабочая среда).

Общая архитектура для таких типов многоуровневой среды состоит из DevOps для разработки и тестирования, UAT для промежуточных и рабочих сред. Организации могут использовать один или несколько клиентов Azure AD для определения доступа и прав для этих сред. На предыдущей схеме показана ситуация, когда используются два разных клиента Azure AD: один для DevOps и UAT, а другой — исключительно для рабочей среды.

Наличие разных клиентов Azure AD обеспечивает разделение между средами. Та же группа пользователей, как Центральная ИТ-группа, должна пройти проверку подлинности с помощью другого URI для доступа к другому клиенту Azure AD, чтобы изменить роли или разрешения для DevOps или рабочих сред проекта. Выполнение проверки подлинности другого пользователя для доступа к другим средам минимизирует возможные простои и предотвращает появление других проблем, вызванных человеческим фактором.

#### <a name="component-type-infrastructure"></a>Тип компонента: инфраструктура

В этом типе компонента размещается большая часть вспомогательной инфраструктуры. С этим компонентом большую часть времени работает централизованная ИТ-команда и команда по обеспечению соответствия и безопасности.

![6][6]

Компоненты инфраструктуры обеспечивают взаимодействие для различных компонентов виртуального центра обработки данных и присутствуют в концентраторе и периферийных зонах. Ответственность за управление и обслуживание компонентов инфраструктуры обычно назначается Центральной группе ИТ или группе безопасности.

Одна из основных задач группы ИТ-инфраструктуры — обеспечение согласованности схем IP-адреса на предприятии. Диапазон частных IP-адресов, назначенный виртуальным центром обработки данных, должен быть согласован и не должен перекрываться с IP-адресами, назначенными локальным сетям.

Хотя преобразование NAT в локальных пограничных маршрутизаторах или средах Azure может помочь избежать конфликтов IP-адресов, оно усложняет работу компонентов инфраструктуры. Простота управления — одна из основных целей постоянного тока, поэтому использование NAT для решения проблем с IP-адресами, в то время как допустимое решение не является рекомендуемым решением.

Инфраструктура включает следующие компоненты:

- [Службы удостоверений и каталогов][azure-ad]. Доступ к каждому типу ресурса в Azure регулируется удостоверением, хранящимся в службе каталогов. В службе каталогов хранится не только список пользователей, но также права доступа к ресурсам в определенной подписке Azure. Эти службы могут существовать только в облаке или их можно синхронизировать с локальным удостоверением, хранящимся в Active Directory.
- [Виртуальная сеть][virtual-network]. Виртуальные сети являются одним из основных компонентов постоянного тока и позволяют создавать границы изоляции трафика на платформе Azure. Виртуальная сеть состоит из одного или нескольких сегментов виртуальной сети, каждый из которых имеет конкретный префикс IP-сети (подсеть, IPv4 или двойной стек IPv4/IPv6). Виртуальная сеть определяет внутреннюю область периметра, где виртуальные машины IaaS и службы PaaS могут осуществлять закрытый обмен данными. Виртуальные машины (и службы PaaS) в одной виртуальной сети не могут напрямую взаимодействовать с виртуальными машинами (и службами PaaS) в другой виртуальной сети, даже если обе виртуальные сети создаются одним и тем же клиентом в рамках одной подписки. Это критически важное свойство, которое гарантирует, что виртуальные машины и все коммуникации клиента останутся закрытыми в пределах виртуальной сети. Если требуется межсетевое подключение, следующие функции описывают, как это можно сделать.
- [Пиринг виртуальных сетей][virtual-network-peering]. Фундаментальным компонентом, используемым для создания инфраструктуры постоянного тока, является пиринг виртуальных сетей, который соединяет две виртуальные сети в одном регионе — через сеть центра обработки данных Azure или с помощью магистрали по всему миру Azure в разных регионах.
- [Конечные точки службы виртуальной сети][ServiceEndpoints]. Конечные точки службы расширяют пространство частных адресов виртуальной сети, чтобы включить пространство PaaS. Конечные точки также расширяют удостоверение виртуальной сети на службы Azure через прямое подключение. Конечные точки позволяют защищать критически важные ресурсы служб Azure в пределах отдельных виртуальных сетей.
- [Частная ссылка][PrivateLink]. Частная ссылка Azure позволяет получить доступ к службам Azure PaaS (например, службе [хранилища Azure][Storage], [Azure Cosmos DB][cosmos-db]и [базе данных SQL Azure][SQL]) и службам клиентов и партнеров Azure, размещенных в частной конечной точке в виртуальной сети. Трафик между виртуальной сетью и службой проходит через магистральную сеть Майкрософт, что позволяет избежать рисков общедоступного Интернета. Вы также можете создать собственную [службу частной связи][PrivateLinkSvc] в виртуальной сети и предоставить ее клиентам в частном порядке. Настройка и потребление с использованием Приватного канала Azure согласованы между службами Azure PaaS, владельцами и общими партнерскими службами.
- [Определяемые пользователем маршруты][UDR]. Трафик в виртуальной сети перенаправляется по умолчанию на основе системной таблицы маршрутизации. Определяемый пользователем маршрут — это пользовательская таблица маршрутизации, которую сетевые администраторы могут связать с одной или несколькими подсетями, чтобы переопределить поведение системной таблицы маршрутизации и определить путь обмена данными в виртуальной сети. Наличие определяемых пользователем маршрутов гарантирует, что исходящий трафик из периферийного транзитного трафика будет проходить через определенные пользовательские виртуальные машины или сетевые виртуальные устройства и подсистемы балансировки нагрузки, приходящие как в концентраторе, так и на периферийных устройствах.
- [Группы безопасности сети][NSG]. Группа безопасности сети — это список правил безопасности, которые действуют как фильтрация трафика в IP-источниках, назначения IP-адресов, протоколы, IP-адреса источника и порты назначения IP-адресов (также называемые кортежем уровня 4 5). Группа безопасности сети может быть применена к подсети, виртуальному сетевому адаптеру, связанному с виртуальной машиной Azure, или к обеим. Группы безопасности сети необходимы для реализации правильного управления потоком в концентраторе и в периферийных зонах. Уровень безопасности, обеспечиваемый группой безопасности сети, — это функция, с которой открываются порты, и для каких целей. Клиентам следует применять дополнительные фильтры для каждой виртуальной машины с брандмауэрами на основе узла, такими как iptables или брандмауэр Windows.
- [DNS][DNS]. DNS обеспечивает разрешение имен для ресурсов в виртуальном центре обработки данных. Azure предоставляет службы DNS как для [общедоступного][DNS], так и для [частного][PrivateDNS] разрешения имен. Частные зоны обеспечивают разрешение имен внутри виртуальной сети и между виртуальными сетями. Частные зоны могут не только охватывать виртуальные сети в том ж регионе, но также сети в разных регионах и подписках. Для общедоступного разрешения Azure DNS предоставляет службу размещения для доменов DNS, которая в свою очередь предоставляет разрешение имен с помощью инфраструктуры Microsoft Azure. Размещая домены в Azure, вы можете управлять своими записями DNS с помощью тех же учетных данных, API и инструментов и оплачивать использование, как и другие службы Azure.
- Управление [группой управления][MgmtGrp], [подпиской](../ready/azure-best-practices/scale-subscriptions.md)и [группой ресурсов][RGMgmt] . Подписка определяет естественную границу, чтобы создать несколько групп ресурсов в Azure. Это разделение может быть для функции, разделения ролей или выставления счетов. Ресурсы в подписке объединяются в логические контейнеры, называемые группами ресурсов. Группа ресурсов представляет логическую группу для Организации ресурсов в виртуальном центре обработки данных. Если в вашей организации оформлено много подписок, возможно, потребуется повысить эффективность управления доступом, политиками и соответствием требованиям для этих подписок. Группы управления Azure обеспечивают высокий уровень охвата подписок. Подписки группируются в контейнеры, известные как группы управления, и применяются к группам управления. Все подписки в группе управления автоматически наследуют условия, применяемые к группе управления. Чтобы просмотреть эти три функции в иерархическом представлении, см. раздел [организация ресурсов](../ready/azure-setup-guide/organize-resources.md) в облачной инфраструктуре внедрения.
- [Управление доступом на основе ролей (RBAC).][RBAC] RBAC может сопоставлять роли Организации и права доступа к определенным ресурсам Azure, позволяя ограничить пользователей только определенным набором действий. Если вы синхронизируете Azure Active Directory с локальной Active Directory, вы можете использовать те же группы Active Directory в Azure, которые используются в локальной среде. С помощью RBAC доступ предоставляется путем назначения соответствующей роли пользователям, группам и приложениям в определенной области. Областью назначения роли может быть подписка Azure, группа ресурсов или отдельный ресурс. RBAC разрешает наследование разрешений. Роли, назначенной в родительской области, предоставляется доступ также к содержащимся в ней дочерним элементам. С помощью RBAC вы можете распределить обязанности и предоставить пользователям доступ на уровне, который им необходим для выполнения поставленных задач. Например, один сотрудник может управлять виртуальными машинами в подписке, в то время как другой может управлять SQL Serverными базами данных в одной подписке.

#### <a name="component-type-perimeter-networks"></a>Тип компонента: сети периметра

Компоненты сети периметра (иногда называемой сетью ДЕМИЛИТАРИЗОВАНной зоны) соединяют локальные или физические центры обработки данных и подключения к Интернету. Сеть периметра обычно требует значительных затрат времени от групп по сети и безопасности.

Входящие пакеты должны проходить через устройства безопасности в концентраторе перед достижением внутренних серверов и служб на периферийных серверах. Примеры включают брандмауэр, ИДЕНТИФИКАТОРы и IP-адреса. Пакеты, направленные в Интернет рабочими нагрузками, также должны пройти через защитные устройства сети периметра перед выходом из сети. Этот поток обеспечивает принудительное применение политики, проверку и аудит.

Ниже перечислены компоненты сети периметра.

- [Виртуальные сети][virtual-network], [определяемые пользователем маршруты][UDR] и [группы безопасности сети][NSG].
- [Сетевые виртуальные модули][NVA]
- [Azure Load Balancer][ALB]
- [Шлюз приложений Azure][AppGW] с [брандмауэром веб-приложения (WAF)][AppGWWAF]
- [Общедоступные IP-адреса.][PIP]
- [Передняя дверца Azure][azure-front-door] с [брандмауэром веб-приложения (WAF)][AFDWAF]
- [Брандмауэр Azure][AzFW] и [Диспетчер брандмауэра Azure][AzFWMgr]
- [Стандартная защита от атак DDoS][DDoS]

Как правило, Центральная группа ИТ и группы безопасности ответственны за определение требований и работу сетей периметра.

![7][7]

На предыдущей схеме показано применение двух периметров с доступом к Интернету и локальной сети, которые находятся в центре DMZ. В центре ДЕМИЛИТАРИЗОВАНной зоны сеть периметра может масштабироваться для поддержки многих отраслей, используя несколько ферм брандмауэров веб-приложений (WAF) или брандмауэров Azure. Центр также позволяет выполнять локальные подключения через VPN или ExpressRoute по мере необходимости.

> [!NOTE]
> На предыдущей схеме в центре ДЕМИЛИТАРИЗОВАНной зоны многие из следующих функций можно объединить в виртуальный концентратор глобальной сети Azure (например, виртуальные сети, определяемые пользователем маршруты, группы безопасности сети, VPN-шлюзы, шлюзы ExpressRoute, подсистемы балансировки нагрузки Azure, брандмауэры Azure, диспетчер брандмауэра и от атак DDoS). Используя виртуальные глобальные концентраторы Azure, можно создать виртуальную сеть концентратора и, таким же, работать в постоянного тока гораздо проще, так как большая часть инженерной сложности обрабатывается Azure при развертывании виртуального концентратора глобальной сети Azure.

[Виртуальные сети][virtual-network]. Концентратор обычно строится на виртуальной сети с несколькими подсетями для размещения различных типов служб, которые фильтруют и проверяют трафик в Интернете через брандмауэр Azure, NVA, WAF и экземпляры шлюза приложений Azure.

[Определяемые пользователем маршруты][UDR] Используя определяемые пользователем маршруты, клиенты могут развертывать брандмауэры, ИДЕНТИФИКАТОРы и IP-адреса и другие виртуальные устройства, а также маршрутизировать сетевой трафик через эти устройства безопасности для принудительного применения политик границ безопасности, аудита и проверки. Определяемые пользователем маршруты можно создавать как в концентраторе, так и на периферийных устройствах, чтобы обеспечить передачу трафика через определенные пользовательские виртуальные машины, сетевые виртуальные устройства и подсистемы балансировки нагрузки, используемые реализацией в постоянного тока. Чтобы гарантировать, что трафик, созданный на виртуальных машинах, находящихся на периферийных серверах, перемещается в правильные виртуальные устройства, необходимо задать определяемый пользователем маршрут в подсетях периферийных устройств, установив внешний IP-адрес внутренней подсистемы балансировки нагрузки в качестве следующего прыжка. Внутренняя подсистема балансировки нагрузки распределяет внутренний трафик на виртуальные устройства (внутренний пул подсистемы балансировки нагрузки).

[Брандмауэр Azure][AzFW] — это управляемая служба безопасности сети, которая защищает ресурсы виртуальной сети Azure. Это управляемый брандмауэр с отслеживанием состояния с высоким уровнем доступности и масштабируемостью облака. Вы можете централизованно создавать, применять и регистрировать политики приложений и сетевых подключений в подписках и виртуальных сетях. Брандмауэр Azure использует статический общедоступный IP-адрес для ресурсов виртуальной сети. Он разрешает внешним брандмауэрам идентифицировать трафик, поступающий из вашей виртуальной сети. Служба полностью интегрирована с Azure Monitor для ведения журналов и аналитики.

При использовании топологии виртуальной глобальной сети Azure [Диспетчер брандмауэра Azure][AzFWMgr] — это служба управления безопасностью, которая предоставляет централизованную политику безопасности и управление маршрутами для периметра безопасности на основе облака. Он работает с виртуальным концентратором глобальной сети Azure, управляемым корпорацией Майкрософт ресурсом, который позволяет легко создавать центральные и периферийные архитектуры. Если политики безопасности и маршрутизации связаны с таким центром, он называется защищенным виртуальным концентратором.

[Сетевые виртуальные устройства][NVA]. В концентраторе сеть периметра с доступом в Интернет обычно управляется с помощью экземпляра Брандмауэра Azure, фермы брандмауэров или брандмауэров веб-приложений (WAF).

В разных отраслях часто используется много веб-приложений, что может негативно пострадать от различных уязвимостей и потенциальных эксплойтов. Брандмауэры веб-приложений — это особый тип продукта, используемый для обнаружения атак, направленных на веб-приложения (HTTP и HTTPS). Это отличает их от обычных брандмауэров. По сравнению с традиционными брандмауэрами WAF содержит набор специальных функций для защиты внутренних веб-серверов от угроз.

Как брандмауэр Azure, так и брандмауэр NVA используют общую панель администрирования с набором правил безопасности для защиты рабочих нагрузок, размещенных в периферийных зонах, а также управления доступом к локальным сетям. Брандмауэр Azure имеет встроенную масштабируемость, тогда как брандмауэры NVA можно масштабировать вручную за подсистемой балансировки нагрузки. Как правило, программное обеспечение фермы брандмауэра менее специализированное по сравнению с ПО WAF, но включает более широкую область для фильтрации и проверки любого типа трафика (входящего и исходящего). Если используется подход NVA, их можно найти и развернуть из Azure Marketplace.

Рекомендуется использовать один набор экземпляров Брандмауэров Azure или брандмауэров NVA для трафика в Интернете и другой — для трафика в локальной среде. Использование только одного набора брандмауэров в обоих случаях представляет угрозу безопасности, так как между двумя наборами сетевого трафика отсутствует периметр безопасности. Использование отдельных уровней брандмауэра упрощает проверку правил безопасности, а также помогает понять, какие правила соответствуют определенным входящим сетевым запросам.

[Azure Load Balancer][ALB] предлагает службу высокого уровня доступности 4 (TCP/UDP), которая может распределять входящий трафик между экземплярами службы, определенными в наборе балансировки нагрузки. Трафик, отправленный в подсистему балансировки нагрузки из интерфейсных конечных точек (конечных точек общедоступного IP-адреса или частных IP-адресов), можно распространять с помощью или без преобразования адресов в набор внутренних IP-адресов (таких как сетевые виртуальные устройства или виртуальные машины).

Azure Load Balancer может проверять работоспособность различных экземпляров сервера, а когда экземпляр не отвечает на проверку, балансировщик нагрузки останавливает передачу трафика в неработоспособный экземпляр. В виртуальном центре обработки данных внешняя подсистема балансировки нагрузки развертывается в центре и периферийных зонах. В центре подсистема балансировки нагрузки используется для эффективного маршрутизации трафика между экземплярами брандмауэра, а в периферийных зонах для управления трафиком приложений используются подсистемы балансировки нагрузки.

[Azure Front Door][azure-front-door] (AFD) – это высокодоступная и масштабируемая платформа для ускорения веб-приложений корпорации Майкрософт, глобальной балансировки нагрузки HTTP, защиты приложений и сети доставки содержимого. В более 100 расположениях на границе глобальной сети корпорации Майкрософт АФД позволяет создавать, использовать и масштабировать динамическое веб-приложение и статическое содержимое. Служба AFD предоставляет вашему приложению производительность конечного пользователя мирового класса, единую автоматизацию регионального/маркированного обслуживания, автоматизацию BCDR, унифицированную клиентскую/пользовательскую информацию, кэширование и полезные сведения об услугах. Платформа предлагает:
    - Производительность, надежность и поддержка соглашения об уровне обслуживания (SLA).
    - Сертификация на соответствие требованиям.
    - Рекомендации по обеспечению безопасности, которые разработаны, обслуживаются и изначально поддерживаются в Azure.
Передняя дверца Azure также предоставляет брандмауэр веб-приложения (WAF), который защищает веб-приложения от распространенных уязвимостей и эксплойтов.

[Шлюз приложений Azure][AppGW] — это выделенный виртуальный модуль, предоставляющий управляемый контроллер доставки приложений. Она предлагает различные возможности балансировки нагрузки уровня 7 для вашего приложения. Она позволяет оптимизировать производительность веб-фермы за счет разгрузки прерывания SSL с интенсивным использованием ЦП в шлюз приложений. Он также предоставляет другие возможности маршрутизации уровня 7, такие как циклическое распределение входящего трафика, сходство сеансов на основе файлов cookie, маршрутизация на основе URL-путей и возможность размещения нескольких веб-сайтов за одним шлюзом приложений. Брандмауэр веб-приложений (WAF) также предоставляется как часть SKU WAF шлюза приложений. Этот SKU обеспечивает защиту веб-приложений от распространенных веб-уязвимостей и эксплойтов. Шлюз приложений можно настроить как шлюз с выходом в Интернет, внутренний шлюз или их сочетание.

[Общедоступные IP-адреса][PIP]. С помощью некоторых функций Azure можно связать конечные точки службы с общедоступным IP-адресом, чтобы предоставить доступ к ресурсу через Интернет. Эта конечная точка использует NAT для маршрутизации трафика по внутреннему адресу и порту виртуальной сети в Azure. Это основной путь передачи внешнего трафика в виртуальную сеть. Общедоступные IP-адреса можно настроить, чтобы определить, какой трафик следует пропускать в виртуальную сеть, а также как и где его следует пропускать.

[Azure от атак DDoS Protection Standard][DDoS] предоставляет дополнительные возможности по устранению рисков по сравнению с уровнем [служб "базовый][DDoS] ", которые настроены специально для ресурсов виртуальной сети Azure. Службу "Защита от атак DDoS" уровня "Стандартный" легко включить, и для ее использования не нужно изменять приложение. Политики защиты корректируются на основе мониторинга выделенного трафика и алгоритмов машинного обучения. Они применяются к общедоступным IP-адресам, связанным с ресурсами, развернутыми в виртуальных сетях, Примеры: Azure Load Balancer, шлюз приложений Azure и экземпляры Service Fabric Azure. Журналы, созданные системой практически в реальном времени, доступны в Azure Monitor представлениях во время атаки и для ведения журнала. Можно также включить защиту на прикладном уровне с помощью брандмауэра веб-приложения в Шлюзе приложений Azure. Защита обеспечивается для общедоступных IP-адресов Azure IPv4 и IPv6.

Топология HUB и лучевой топологии используют пиринг виртуальных сетей и определяемые пользователем маршруты для правильной маршрутизации трафика.

![8][8]

На схеме определяемый пользователем маршрут обеспечивает передачу трафика с периферийного компьютера в брандмауэр перед передачей в локальную среду через шлюз ExpressRoute (если политика брандмауэра разрешает эту последовательность).

#### <a name="component-type-monitoring"></a>Тип компонента: мониторинг

[Компоненты мониторинга][MonitorOverview] обеспечивают видимость и оповещения от всех других типов компонентов. У всех групп должен быть доступ к мониторингу соответствующих компонентов и служб. Если у вас есть централизованная служба поддержки или операционные группы, им необходим интегрированный доступ к данным, которые обеспечивают эти компоненты.

Azure предлагает несколько типов служб ведения журналов и мониторинга для отслеживания поведения размещенных ресурсов Azure. Регулирование рабочих нагрузок и управление ими в Azure основано не только на сборе данных журнала, но также на возможности активировать действия на основе определенных сообщаемых событий.

[Azure Monitor][AzureMonitor]. Azure предлагает несколько служб, которые по отдельности выполняют определенную роль или задачу в пространстве мониторинга. Вместе эти службы предоставляют исчерпывающее решение для сбора, анализа и работы с созданными системой журналами из приложений и ресурсов Azure, которые их поддерживают. Они также могут выполнять мониторинг критически важных локальных ресурсов и предоставлять гибридную среду мониторинга. Понимание доступных средств и данных является первым шагом в разработке полной стратегии мониторинга для приложений.

В Azure Monitor есть два фундаментальных типа журналов:

- [Метрики][Metrics] — это числовые значения, описывающие конкретный аспект системы в определенный момент времени. Они занимают небольшой объем, и их можно использовать в сценариях, предусматривающих работу в режиме практически реального времени. Для многих ресурсов Azure данные, собранные службой Azure Monitor, отображаются непосредственно на странице "Обзор" портала Azure. В качестве примера рассмотрим любую виртуальную машину, и вы увидите несколько диаграмм, отображающих метрики производительности. Выберите любой из диаграмм, чтобы открыть данные в обозревателе метрик в портал Azure, что позволяет создавать диаграммы значений нескольких метрик с течением времени. Вы можете просматривать графики в интерактивном режиме или закрепить их на панели мониторинга, чтобы просматривать их вместе с другими визуализациями.

- [Журналы][Logs] содержат данные различных типов, упорядоченные по записям с разными наборами свойств для каждого типа. События и трассировки хранятся в виде журналов вместе с данными о производительности, которые могут быть объединены для анализа. Данные журналов, собранные службой Azure Monitor, можно проанализировать с помощью запросов, которые быстро получают, консолидируют и анализируют собранные данные. Журналы хранятся и запрашиваются из [log Analytics][LogAnalytics]. Вы можете создавать и тестировать запросы с помощью Log Analytics на портале Azure, а затем либо напрямую анализировать данные с помощью этих средств, либо сохранять запросы для использования с визуализациями или правилами генерации оповещений.

![9][9]

Azure Monitor может собирать данные из различных источников. Вы можете представить данные мониторинга для ваших приложений на разных уровнях: от приложения, от любой операционной системы и от служб, от которых она зависит, до самой платформы Azure. Azure Monitor собирает данные со следующих уровней.

- **Данные мониторинга приложений:** Данные о производительности и функциональности написанного кода, независимо от платформы.
- **Данные мониторинга гостевой ОС:** Данные о операционной системе, в которой работает приложение. Эта ОС может быть запущена в Azure, другом облаке или локальной среде.
- **Данные мониторинга ресурсов Azure:** Данные о работе ресурса Azure.
- **Данные мониторинга подписки Azure:** Данные об операциях и управлении подпиской Azure, а также данные о работоспособности и работе Azure.
- **Данные мониторинга клиента Azure:** Данные о работе служб Azure на уровне клиента, например Azure Active Directory.
- **Пользовательские источники:** Также можно включить журналы, отправляемые из локальных источников. Примеры включают в себя события локального сервера или выходные данные системного журнала для сетевых устройств.

Данные мониторинга полезны, только если они могут сделать работу вычислительной среды более открытой. Azure Monitor включает несколько функций и средств, предоставляющих ценные аналитические сведения о ваших приложениях и других ресурсах, от которых они зависят. Решения для мониторинга и такие функции, как Application Insights и Azure Monitor для контейнеров, предоставляют аналитические сведения о различных аспектах приложения и определенных служб Azure.

Решения для мониторинга в Azure Monitor — это упакованные наборы логики, которые предоставляют аналитические сведения об определенном приложении или службе. Они содержат логику для сбора данных мониторинга для приложения или службы, запросы для анализа этих данных и представления для визуализации. Корпорация Майкрософт и ее партнеры предоставляют решения для мониторинга, позволяющие контролировать различные службы Azure и другие приложения.

При сборе всех этих обширных данных важно принимать упреждающие меры о событиях, происходящих в вашей среде, где не вполне достаточно ручных запросов. Оповещения в Azure Monitor заранее сообщают вам о критических условиях и пытаются выполнить корректирующие действия. Правила генерации оповещений, основанные на метриках, обеспечивают оповещение практически в реальном времени на основе числовых значений, а правила, основанные на журналах, позволяют выполнять сложную логику между данными из нескольких источников. Правила генерации оповещений Azure Monitor используют группы действий, содержащие уникальные наборы получателей и действий, которые могут использоваться в различных правилах. В зависимости от требований группы действий могут выполнять такие действия, как использование веб-перехватчиков, которые приводят к запуску внешних действий или интеграции с инструментами ITSM.

Azure Monitor также позволяет создавать настраиваемые панели мониторинга. Панели мониторинга Azure позволяют объединять данные различных типов, включая метрики и журналы, в одну панель на портале Azure. При желании вы можете предоставить доступ к этой панели другим пользователям Azure. Помимо выходных данных для любого запроса на получение журнала или для диаграммы метрик, на панель мониторинга Azure можно добавлять элементы из Azure Monitor. Например, вы можете создать панель мониторинга, на которой содержатся плитки с графами метрик, таблица журналов действий, график использования из Application Insights и выходные данные запросов к журналу.

Наконец, Azure Monitor данные являются собственным источником для Power BI. Power BI — это служба бизнес-аналитики, предоставляющая интерактивные визуализации данных из различных источников. Это эффективное средство предоставления доступа к данным другим пользователям в организации и за ее пределами. Вы можете настроить Power BI на автоматический импорт данных журналов из Azure Monitor, чтобы воспользоваться этими дополнительными визуализациями.

[Наблюдатель за сетями Azure][NetWatch] предоставляет средства для мониторинга, диагностики и просмотра метрик, а также включения и отключения журналов для ресурсов в виртуальной сети в Azure. Это многоаспектная служба, обеспечивающая следующие возможности:

- мониторинг взаимодействия между виртуальной машиной и конечной точкой;
- просмотр ресурсов и их связей в виртуальной сети;
- диагностика проблем с фильтрацией входящего или исходящего трафика виртуальной машины;
- диагностика проблем с сетевой маршрутизацией на виртуальной машине;
- диагностика исходящих подключений виртуальной машины;
- сбор пакетов, направляющихся в виртуальную машину и из нее;
- Диагностика проблем с шлюзом и подключениями виртуальной сети.
- определение относительных задержек между регионами Azure и поставщиками услуг Интернета;
- просмотр правил безопасности для сетевого интерфейса;
- просмотр метрик сети;
- анализ трафика, направляющегося в группу безопасности сети или из нее;
- просмотр журналов диагностики для сетевых ресурсов.

#### <a name="component-type-workloads"></a>Тип компонента: рабочие нагрузки

Именно здесь находятся ваши фактические приложения и службы. В этом случае группы разработки приложений тратят большую часть времени.

Возможности рабочих нагрузок на самом деле безграничны. Ниже приведены всего несколько возможных типов рабочих нагрузок.

**Внутренние приложения:** Бизнес-приложения очень важны для корпоративных операций. Эти приложения имеют некоторые общие характеристики:

- **Интерактивный:** Данные будут указаны, а результаты или отчеты возвращаются.
- **На основе данных:** Интенсивное выполнение данных с частом доступом к базам данных или другому хранилищу.
- **Интеграция:** Интеграция с другими системами внутри организации или за ее пределами.

**Веб-сайты, доступные для клиентов (с выходом в Интернет или с внутренним доступом):** Большинство интернет-приложений — это Web Sites. Azure может запускать веб-сайт с помощью виртуальной машины IaaS или сайта [веб-приложений Azure][WebApps] (PaaS). Веб-приложения Azure интегрируются с виртуальными сетями для развертывания веб-приложений в зоне периферийной сети. Внутренним веб-узлам не нужно предоставлять общедоступную конечную точку Интернета, так как доступ к ресурсам осуществляется через частные адреса, не связанные с маршрутизацией в Интернете, из частной виртуальной сети.

**Аналитика больших данных:** Если данные необходимо масштабировать до более крупных томов, то реляционные базы данных могут не работать хорошо при экстремальной нагрузке или неструктурированной природе данных. [Azure HDInsight][HDInsight] — это управляемая Полнофункциональная служба аналитики с открытым кодом в облаке для предприятий. Вы можете использовать платформы с открытым кодом, такие как Hadoop, Apache Spark, Apache Hive, LLAP, Apache Kafka, Apache Storm и R. HDInsight, которые поддерживают развертывание в виртуальную сеть на основе расположения, можно развернуть в кластере на периферийном уровне виртуального центра обработки данных.

**События и обмен сообщениями.** [концентраторы событий Azure][EventHubs] — это платформа потоковой передачи больших данных и служба приема событий. Она может получать и обрабатывать миллионы событий в секунду. Он обеспечивает низкую задержку и настраиваемое хранение времени, позволяя принимать большие объемы данных в Azure и считывать их из нескольких приложений. Один поток может поддерживать конвейеры на основе реального времени и пакетной службы.

Вы можете реализовать высоконадежную облачную систему для обмена сообщениями между приложениями и службами, используя [Служебную шину Azure][ServiceBus]. Он обеспечивает асинхронный обмен сообщениями через брокер между клиентом и сервером, структурированный обмен сообщениями по принципу "первым поступил — первым обслужен" (FIFO), а также публикует и подписывает возможности подписки.

![10][10]

Эти примеры просто изменяют рабочую область типов рабочих нагрузок, которые можно создать в Azure &mdash; , начиная с базового веб-приложения и приложений SQL, до последних в IOT, больших данных, машинного обучения, искусственного интеллекта и т. д.

### <a name="highly-availability-multiple-virtual-datacenters"></a>Высокая доступность: несколько виртуальных центров обработки данных

До сих пор эта статья посвящена проектированию одного постоянного тока, в котором описываются основные компоненты и архитектуры, влияющие на устойчивость. Такие функции Azure, как балансировщик нагрузки Azure, NVA, зоны доступности, группы доступности, масштабируемые наборы и другие возможности, которые позволяют включать в рабочие службы надежные уровни соглашения об уровне обслуживания.

Однако поскольку виртуальный центр обработки данных обычно реализуется в одном регионе, он может быть уязвим для сбоев, влияющих на весь регион. Клиенты, которым требуется высокий уровень доступности, должны защищать службы с помощью развертываний одного и того же проекта в двух или более реализациях в постоянного тока, развернутых в разных регионах.

В дополнение к вопросам соглашения об уровне обслуживания, несколько распространенных сценариев работают с несколькими виртуальными центрами обработки данных:

- Региональный или глобальный присутствие конечных пользователей или партнеров.
- Требования к аварийному восстановлению.
- Механизм для перенаправления трафика между центрами обработки данных для загрузки или повышения производительности.

#### <a name="regionalglobal-presence"></a>Региональное и глобальное присутствие

Центры обработки данных Azure существуют во многих регионах по всему миру. При выборе нескольких центров обработки данных Azure рассмотрите два связанных фактора: географические расстояния и задержка. Чтобы оптимизировать взаимодействие с пользователем, оцените расстояние между каждым виртуальным центром обработки данных, а также расстояние от каждого виртуального центра обработки данных до конечных пользователей.

Регион Azure, в котором размещен виртуальный центр обработки данных, должен соответствовать нормативным требованиям любой юридической юрисдикции, с которой работает ваша организация.

#### <a name="disaster-recovery"></a>Аварийное восстановление

Проектирование плана аварийного восстановления зависит от типов рабочих нагрузок и способности синхронизировать состояние этих рабочих нагрузок между различными реализациями в постоянного тока. В идеале большинству клиентов требуется быстрый механизм отработки отказа, и для этого требования может потребоваться синхронизация данных приложения между развертываниями, работающими в нескольких реализациях постоянного тока. Однако при разработке планов аварийного восстановления важно учитывать, что большинство приложений чувствительны к задержке, которая может быть вызвана этой синхронизацией данных.

Для мониторинга синхронизации и пульса приложений в разных виртуальных центрах обработки данных требуется, чтобы они взаимодействовали через сеть. Несколько реализаций в разных регионах могут быть соединены через:

- Подключение концентратора к концентратору, встроенное в виртуальные глобальные концентраторы Azure по регионам в одной виртуальной глобальной сети.
- Пиринг виртуальных сетей для подключения центров между регионами.
- Частный пиринг ExpressRoute, когда концентраторы в каждой реализации в постоянного тока подключены к одному каналу ExpressRoute.
- Несколько каналов ExpressRoute, подключенных через вашу корпоративную магистраль, и реализации нескольких в постоянного тока, подключенные к каналам ExpressRoute.
- VPN-подключения типа "сеть — сеть" между зоной реализации в каждом регионе Azure.

Как правило, виртуальные глобальные концентраторы, пиринг виртуальных сетей или подключения ExpressRoute предпочтительны для подключения к сети из-за более высокой пропускной способности и непрерывности задержки при передаче через магистральную подсистему Майкрософт.

Выполните проверочные проверки сети, чтобы проверить задержку и пропускную способность этих подключений, а также определить, подходит ли для синхронной или асинхронной репликации данных соответствующий результат. Также важно взвесить эти результаты с точки зрения оптимальной цели времени восстановления (RTO).

#### <a name="disaster-recovery-diverting-traffic-from-one-region-to-another"></a>Аварийное восстановление: перенаправление трафика из одного региона в другой

Как [диспетчер трафика Azure][azure-traffic-manager] , так и [Передняя дверца Azure][azure-front-door] периодически проверяют работоспособность службы прослушивания конечных точек в различных реализациях в постоянного тока и, если эти конечные точки завершаются сбоем, автоматически перенаправляются в ближайшее к ближайшему Диспетчер трафика использует измерения пользователей в режиме реального времени и DNS для направления пользователей к ближайшему (или следующему ближайшему к возникновению) сбою. Передняя дверца Azure — это обратный прокси-сервер с более чем 100 магистральными сайтами Майкрософт, который используется для направления пользователей на ближайшую конечную точку прослушивания.

### <a name="summary"></a>Сводка

Подход виртуального центра обработки данных к миграции центра обработки Datacenter создает масштабируемую архитектуру, которая оптимизирует использование ресурсов Azure, снижает затраты и упрощает управление системой. Виртуальный центр обработки данных обычно основан на топологиях концентратора и периферийной сети (с использованием пиринга виртуальных сетей или виртуальных концентраторов глобальной сети). Общие общие службы, предоставляемые в концентраторе, и определенные приложения и рабочие нагрузки развертываются на периферийных ресурсах. Виртуальный центр обработки данных также соответствует структуре ролей компании, где различные подразделения, такие как Центральная ИТ, DevOps, а также все операции и обслуживание работают вместе при выполнении конкретных ролей. Виртуальный центр обработки данных поддерживает миграцию существующих локальных рабочих нагрузок в Azure, но также предоставляет множество преимуществ для развертываний в собственном облаке.

## <a name="references"></a>Ссылки

Дополнительные сведения о возможностях Azure, обсуждаемых в этом документе.

<!-- markdownlint-disable MD033 -->

:::row:::
    :::column:::
        **Сетевые компоненты** <br>
        [Виртуальные сети Azure][virtual-network] <br>
        [Группы безопасности сети][NSG] <br>
        [Конечные точки службы][ServiceEndpoints] <br>
        [Приватный канал][PrivateLink] <br>
        [Определяемые пользователем маршруты][UDR] <br>
        [Виртуальные сетевые модули][NVA] <br>
        [общедоступные IP-адреса][PIP] <br>
        [Azure DNS][DNS]
    :::column-end:::
    :::column:::
        **Балансировка нагрузки** <br>
        [Azure Front Door][azure-front-door] <br>
        [Azure Load Balancer (уровень 4)][ALB] <br>
        [Шлюз приложений (на уровне 7)][AppGW] <br>
        [Azure Traffic Manager][azure-traffic-manager]
    :::column-end:::
    :::column:::
        **Соединение** <br>
        [Пиринг между виртуальными сетями][virtual-network-peering] <br>
        [Виртуальная частная сеть][VPN] <br>
        [Виртуальная глобальная сеть][virtual-wan] <br>
        [ExpressRoute][ExR] <br>
        [ExpressRoute Direct][ExRD]
    :::column-end:::
:::row-end:::

:::row:::
    :::column:::
        **Удостоверение** <br>
        [Azure Active Directory][azure-ad] <br>
        [Многофакторная идентификация][multi-factor-authentication] <br>
        [Управление доступом на основе ролей][RBAC] <br>
        [Роли Azure AD по умолчанию][Roles]
    :::column-end:::
    :::column:::
        **Мониторинг** <br>
        [Наблюдатель за сетями][NetWatch] <br>
        [Azure Monitor][MonitorOverview] <br>
        [Служба Log Analytics][LogAnalytics]
    :::column-end:::
    :::column:::
        **Рекомендации** <br>
        [Группа управления][MgmtGrp] <br>
        [Управление подписками](../ready/azure-best-practices/scale-subscriptions.md) <br>
        [Управление группой ресурсов][RGMgmt] <br>
        [Ограничения подписки Azure][limits]
    :::column-end:::
:::row-end:::

:::row:::
    :::column:::
        **Безопасность** <br>
        [Брандмауэр Azure][AzFW] <br>
        [Диспетчер брандмауэра][AzFWMgr] <br>
        [WAF шлюза приложений][AppGWWAF] <br>
        [Передняя дверь WAF][AFDWAF] <br>
        [Защита от атак DDoS Azure][DDoS]
    :::column-end:::
    :::column:::
        **Другие службы Azure** <br>
        [Хранилище Azure][Storage] <br>
        [Azure SQL][SQL] <br>
        [Веб-приложения Azure][WebApps] <br>
        [Azure Cosmos DB][cosmos-db] <br>
        [HDInsight][HDInsight] <br>
        [Центры событий][EventHubs] <br>
        [Служебная шина][ServiceBus] <br>
        [Azure IoT][IoT] <br>
        [Машинное обучение Azure][machine-learning]
    :::column-end:::
:::row-end:::

<!-- markdownlint-enable MD033 -->

## <a name="next-steps"></a>Дальнейшие действия

- Узнайте больше о [пиринга виртуальных сетей][virtual-network-peering], основной технологии топологий ступицы и звезды.
- Реализуйте [Azure Active Directory][azure-ad] , чтобы использовать [Управление доступом на основе ролей][RBAC].
- Разработка модели подписки и управления ресурсами с помощью управления доступом на основе ролей, которая соответствует структуре, требованиям и политикам вашей организации. Планирование является самым важным действием: Проанализируйте, как реорганизации, слияния, новые линейки продуктов и другие соображения повлияют на первоначальные модели, чтобы обеспечить возможность масштабирования в соответствии с будущими потребностями и ростом.

<!-- images -->

[0]: ../_images/vdc/networking-vdc-redundant.png "Примеры перекрытия компонента"
<!-- _1_ >: ../_images/vdc/networking-vdc-high-level.png "Example of hub and spoke VDC" -->
[2]: ../_images/vdc/networking-vdc-cluster.png "Кластер концентраторов и периферийных серверов"
[3]: ../_images/vdc/networking-vdc-spoke-to-spoke.png "Связь между периферийными зонами"
[4]: ../_images/vdc/networking-vdc-block-level-diagram.png "Схема уровня блока постоянного тока"
[5]: ../_images/vdc/networking-vdc-users-groups-subscriptions.png "Пользователи, группы, подписки и проекты"
[6]: ../_images/vdc/networking-vdc-infrastructure.png "Схема инфраструктуры"
[7]: ../_images/vdc/networking-vdc-perimeter.png "Схема инфраструктуры"
[8]: ../_images/vdc/networking-vdc-perimeter-peering.png "Пиринг виртуальных сетей и сети периметра"
[9]: ../_images/vdc/networking-vdc-monitoring.png "Схема Azure Monitor"
[10]: ../_images/vdc/networking-vdc-workloads.png "Диаграмма рабочих нагрузок"
[11]: ../_images/vdc/networking-vdc-brief-flat.png "Пример плоской сети"
[12]: ../_images/vdc/networking-vdc-brief-mesh.png "Пример сети с сеткой"
[13]: ../_images/vdc/networking-vdc-brief-hub.png "Пример концентратора и периферийного постоянного тока"
[14]: ../_images/vdc/networking-vdc-brief-vwan.png "Пример виртуальной глобальной сети в постоянного тока"

<!-- links -->

[limits]: /azure/azure-resource-manager/management/azure-subscription-service-limits
[Roles]: /azure/role-based-access-control/built-in-roles
[virtual-network]: /azure/virtual-network/virtual-networks-overview
[NSG]: /azure/virtual-network/security-overview
[PrivateLink]: /azure/private-link/private-link-overview
[PrivateLinkSvc]: /azure/private-link/private-link-service-overview
[ServiceEndpoints]: /azure/virtual-network/virtual-network-service-endpoints-overview
[DNS]: /azure/dns/dns-overview
[PrivateDNS]: /azure/dns/private-dns-overview
[virtual-network-peering]: /azure/virtual-network/virtual-network-peering-overview
[UDR]: /azure/virtual-network/virtual-networks-udr-overview
[RBAC]: /azure/role-based-access-control/overview
[multi-factor-authentication]: /azure/active-directory/authentication/concept-mfa-howitworks
[azure-ad]: /azure/active-directory/fundamentals/active-directory-whatis
[VPN]: /azure/vpn-gateway/vpn-gateway-about-vpngateways
[ExR]: /azure/expressroute/expressroute-introduction
[ExRD]: /azure/expressroute/expressroute-erdirect-about
[virtual-wan]: /azure/virtual-wan/virtual-wan-about
[NVA]: /azure/architecture/reference-architectures/dmz/nva-ha
[AzFW]: /azure/firewall/overview
[AzFWMgr]: /azure/firewall-manager/overview
[MgmtGrp]: /azure/governance/management-groups/overview
[RGMgmt]: /azure/azure-resource-manager/management/manage-resource-groups-portal#what-is-a-resource-group
[ALB]: /azure/load-balancer/load-balancer-overview
[DDoS]: /azure/virtual-network/ddos-protection-overview
[PIP]: /azure/virtual-network/virtual-network-public-ip-address
[azure-front-door]: /azure/frontdoor/front-door-overview
[AFDWAF]: /azure/web-application-firewall/afds/afds-overview
[AppGW]: /azure/application-gateway/overview
[AppGWWAF]: /azure/web-application-firewall/ag/ag-overview
[MonitorOverview]: /azure/networking/networking-overview#monitor
[AzureMonitor]: /azure/azure-monitor/overview
[Metrics]: /azure/azure-monitor/platform/data-platform-metrics
[Logs]: /azure/azure-monitor/platform/data-platform-logs
[LogAnalytics]: /azure/azure-monitor/log-query/get-started-portal
[NetWatch]: /azure/network-watcher/network-watcher-monitoring-overview
[WebApps]: /azure/app-service/
[HDInsight]: /azure/hdinsight/hdinsight-overview
[EventHubs]: /azure/event-hubs/event-hubs-about
[ServiceBus]: /azure/service-bus-messaging/service-bus-messaging-overview
[azure-traffic-manager]: /azure/traffic-manager/traffic-manager-overview
[Storage]: /azure/storage/common/storage-introduction
[SQL]: /azure/sql-database/sql-database-technical-overview
[cosmos-db]: /azure/cosmos-db/introduction
[IoT]: /azure/iot-fundamentals/iot-introduction
[machine-learning]: /azure/machine-learning/overview-what-is-azure-ml
